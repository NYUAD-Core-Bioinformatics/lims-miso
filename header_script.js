Urls=function(){function a(k){return function(l){return k+"/"+l}}function b(k,l){return function(p){return k+"/"+p+l}}function c(k){return function(l,p){l="/rest/storagelocations/freezers/"+l;p&&(l+="/shelves/"+p);return l+="/"+k}}var d={},e={},g={},f={},h={};e.admin={clearHibernateCache:"/rest/admin/cache/clear",refreshConstants:"/rest/admin/constants/refresh",regenerateBarcodes:"/rest/admin/barcode/regen"};e.apiKeys={create:"/rest/apikeys"};d.arrays={create:"/array/new",edit:a("/array")};e.arrays=
{changelog:b("/rest/arrays","/changelog"),create:"/rest/arrays",update:a("/rest/arrays"),datatable:"/rest/arrays/dt",position:function(k,l){return"/rest/arrays/"+k+"/positions/"+l},sampleSearch:"/rest/arrays/sample-search"};d.arrayModels={bulkCreate:"/arraymodel/bulk/new",bulkEdit:"/arraymodel/bulk/edit"};e.arrayModels={bulkSave:"/rest/arraymodels/bulk",bulkSaveProgress:a("/rest/arraymodels/bulk")};d.arrayRuns={create:"/arrayrun/new",edit:a("/arrayrun")};e.arrayRuns={create:"/rest/arrayruns",update:a("/rest/arrayruns"),
datatable:"/rest/arrayruns/dt",projectDatatable:a("/rest/arrayruns/dt/project"),requisitionDatatable:a("/rest/arrayruns/dt/requisition"),arraySearch:"/rest/arrayruns/array-search"};d.assays={create:"/assay/new",edit:a("/assay")};e.assays={create:"/rest/assays",update:a("/rest/assays")};d.assayTests={bulkCreate:"/assaytest/bulk/new",bulkEdit:"/assaytest/bulk/edit"};e.assayTests={bulkSave:"/rest/assaytests/bulk",bulkSaveProgress:a("/rest/assaytests/bulk")};e.attachments={delete:function(k,l,p){return"/rest/attachments/"+
k+"/"+l+"/"+p},link:function(k,l){return"/rest/attachments/"+k+"/"+l}};d.attachmentCategories={bulkCreate:"/attachmentcategories/bulk/new",bulkEdit:"/attachmentcategories/bulk/edit"};e.attachmentCategories={bulkSave:"/rest/attachmentcategories/bulk",bulkSaveProgress:a("/rest/attachmentcategories/bulk")};e.barcodables={search:"/rest/barcodables/search"};d.boxes={create:"/box/new",edit:a("/box"),bulkCreate:"/box/bulk/new",bulkEdit:"/box/bulk/edit"};e.boxes={bulkSave:"/rest/boxes/bulk",bulkSaveProgress:a("/rest/boxes/bulk"),
create:"/rest/boxes",update:a("/rest/boxes"),updatePosition:function(k,l){return"/rest/boxes/"+k+"/position/"+l},removePosition:function(k,l){return"/rest/boxes/"+k+"/positions/"+l},discardPosition:function(k,l){return"/rest/boxes/"+k+"/positions/"+l+"/discard"},updateContents:b("/rest/boxes","/bulk-update"),removeContents:b("/rest/boxes","/bulk-remove"),discardContents:b("/rest/boxes","/bulk-discard"),discardAll:b("/rest/boxes","/discard-all"),searchPartial:"/rest/boxes/search/partial",setLocation:b("/rest/boxes",
"/setlocation"),datatable:"/rest/boxes/dt",useDatatable:a("/rest/boxes/dt/use"),bulkDelete:"/rest/boxes/bulk-delete",fillByPattern:b("/rest/boxes","/positions/fill-by-pattern"),prepareScan:"/rest/boxes/prepare-scan",scan:b("/rest/boxes","/scan"),spreadsheet:b("/rest/boxes","/spreadsheet"),boxSpreadsheet:"/rest/boxes/spreadsheet",fragmentAnalyserSheet:b("/rest/boxes","/fragmentAnalyser")};e.boxables={search:"/rest/boxables/search",queryByBox:"/rest/boxables/query-by-box"};d.boxSizes={bulkCreate:"/boxsize/bulk/new",
bulkEdit:"/boxsize/bulk/edit"};e.boxSizes={bulkSave:"/rest/boxsizes/bulk",bulkSaveProgress:a("/rest/boxsizes/bulk")};d.boxUses={bulkCreate:"/boxuse/bulk/new",bulkEdit:"/boxuse/bulk/edit"};e.boxUses={bulkSave:"/rest/boxuses/bulk",bulkSaveProgress:a("/rest/boxuses/bulk")};d.contacts={bulkCreate:"/contact/bulk/new",bulkEdit:"/contact/bulk/edit"};e.contacts={search:"/rest/contacts",bulkSave:"/rest/contacts/bulk",bulkSaveProgress:a("/rest/contacts/bulk")};d.containers={create:a("/container/new"),edit:a("/container")};
e.containers={create:"/rest/containers",update:a("/rest/containers"),spreadsheet:"/rest/containers/spreadsheet",datatable:"/rest/containers/dt",platformDatatable:a("/rest/containers/dt/platform"),spreadsheet:"/rest/containers/spreadsheet",bulkDelete:"/rest/containers/bulk-delete"};d.containerModels={bulkCreate:"/containermodel/bulk/new",bulkEdit:"/containermodel/bulk/edit"};e.containerModels={bulkSave:"/rest/containermodels/bulk",bulkSaveProgress:a("/rest/containermodels/bulk"),search:"/rest/containermodels/search"};
e.deletions={datatable:"/rest/deletions/dt"};d.detailedQcStatuses={bulkCreate:"/detailedqcstatus/bulk/new",bulkEdit:"/detailedqcstatus/bulk/edit"};e.detailedQcStatuses={bulkSave:"/rest/detailedqcstatuses/bulk",bulkSaveProgress:a("/rest/detailedqcstatuses/bulk")};d.experiments={edit:a("/experiment")};e.experiments={create:"/rest/experiments",update:a("/rest/experiments"),addKit:b("/rest/experiments","/addkit"),addRunPartition:b("/rest/experiments","/add")};d.freezers={create:"/freezer/new",edit:a("/freezer"),
createRecord:function(k){return"/freezer/"+k+"/servicerecord/new"},editRecord:function(k,l){return"/freezer/"+k+"/servicerecord/"+l}};d.freezerMaps={view:function(k,l){return"/freezermaps/"+k+(l?"#"+l:"")}};d.groups={create:"/admin/group/new",edit:a("/admin/group")};e.groups={create:"/rest/groups",update:a("/rest/groups"),addUsers:b("/rest/groups","/users"),removeUsers:b("/rest/groups","/users/remove")};e.hot={bulkImport:"/rest/hot/import",bulkExport:"/rest/hot/spreadsheet"};e.indexDistance={check:"/rest/indexdistance"};
d.instruments={create:"/instrument/new",edit:a("/instrument"),editRecord:function(k,l){return"/instrument/"+k+"/servicerecord/"+l},createRecord:function(k){return"/instrument/"+k+"/servicerecord/new"}};e.instruments={create:"/rest/instruments",update:a("/rest/instruments"),workstationDatatable:a("/rest/instruments/dt/workstation"),datatable:"/rest/instruments/dt",instrumentTypeDatatable:a("/rest/instruments/dt/instrument-type"),list:"/rest/instruments",createRecord:function(k){return"/rest/instruments/"+
k+"/servicerecords"}};d.instrumentModels={create:"/instrumentmodel/new",edit:a("/instrumentmodel")};e.instrumentModels={create:"/rest/instrumentmodels",datatable:"/rest/instrumentmodels/dt",update:a("/rest/instrumentmodels")};e.instrumentStatus="/rest/instrumentstatus";d.kitDescriptors={create:"/kitdescriptor/new",edit:a("/kitdescriptor")};e.kitDescriptors={create:"/rest/kitdescriptors",update:a("/rest/kitdescriptors"),updateTargetedSequencings:b("/rest/kitdescriptors","/targetedsequencing"),datatable:"/rest/kitdescriptors/dt",
typeDatatable:a("/rest/kitdescriptors/dt/type"),updateTargetedSequencings:b("/rest/kitdescriptors","/targetedsequencing"),search:"/rest/kitdescriptors/search"};d.labs={bulkCreate:"/lab/bulk/new",bulkEdit:"/lab/bulk/edit"};e.labs={bulkSave:"/rest/labs/bulk",bulkSaveProgress:a("/rest/labs/bulk")};d.libraries={edit:a("/library"),bulkReceive:"/library/bulk/receive",bulkEdit:"/library/bulk/edit",bulkPropagate:"/library/bulk/propagate",batch:function(k){return"/library/batch/"+encodeURIComponent(k)},qcHierarchy:b("/library",
"/qc-hierarchy")};e.libraries={create:"/rest/libraries",update:a("/rest/libraries"),parents:a("/rest/libraries/parents"),children:a("/rest/libraries/children"),query:"/rest/libraries/query",datatable:"/rest/libraries/dt",workstationDatatable:a("/rest/libraries/dt/workstation"),projectDatatable:a("/rest/libraries/dt/project"),batchDatatable:a("/rest/libraries/dt/batch"),requisitionDatatable:a("/rest/libraries/dt/requisition"),requisitionSupplementalDatatable:a("/rest/libraries/dt/requisition-supplemental"),
requisitionRelatedDatatable:a("/rest/libraries/dt/requisition-prepared"),bulkDelete:"/rest/libraries/bulk-delete",spreadsheet:"/rest/libraries/spreadsheet",bulkSave:"/rest/libraries/bulk",bulkSaveProgress:a("/rest/libraries/bulk"),worksetDatatable:a("/rest/libraries/dt/workset"),findRelated:"/rest/libraries/find-related"};d.libraryAliquots={edit:a("/libraryaliquot"),bulkEdit:"/libraryaliquot/bulk/edit",bulkPropagate:"/libraryaliquot/bulk/propagate",bulkRepropagate:"/libraryaliquot/bulk/repropagate",
bulkPoolTogether:"/libraryaliquot/bulk/merge",bulkPoolSeparate:"/libraryaliquot/bulk/pool-separate",bulkPoolCustom:"/libraryaliquot/bulk/pool",qcHierarchy:b("/libraryaliquot","/qc-hierarchy")};e.libraryAliquots={datatable:"/rest/libraryaliquots/dt",projectDatatable:function(k){return"/rest/libraryaliquots/dt/project/"+k},includedInPoolDatatable:function(k){return"/rest/libraryaliquots/dt/pool/"+k+"/included"},availableForPoolDatatable:function(k){return"/rest/libraryaliquots/dt/pool/"+k+"/available"},
query:"/rest/libraryaliquots/query",create:"/rest/libraryaliquots",update:a("/rest/libraryaliquots"),bulkDelete:"/rest/libraryaliquots/bulk-delete",spreadsheet:"/rest/libraryaliquots/spreadsheet",parents:a("/rest/libraryaliquots/parents"),children:a("/rest/libraryaliquots/children"),bulkSave:"/rest/libraryaliquots/bulk",bulkSaveProgress:a("/rest/libraryaliquots/bulk"),worksetDatatable:a("/rest/libraryaliquots/dt/workset")};d.libraryDesigns={bulkCreate:"/librarydesign/bulk/new",bulkEdit:"/librarydesign/bulk/edit"};
e.libraryDesigns={bulkDelete:"/rest/librarydesigns/bulk-delete",bulkSave:"/rest/librarydesigns/bulk",bulkSaveProgress:a("/rest/librarydesigns/bulk")};d.libraryDesignCodes={bulkCreate:"/librarydesigncode/bulk/new",bulkEdit:"/librarydesigncode/bulk/edit"};e.libraryDesignCodes={bulkSave:"/rest/librarydesigncodes/bulk",bulkSaveProgress:a("/rest/librarydesigncodes/bulk")};d.libraryIndexFamilies={create:"/libraryindexfamily/new",edit:a("/libraryindexfamily")};e.libraryIndexFamilies={create:"/rest/libraryindexfamilies",
update:a("/rest/libraryindexfamilies")};d.libraryIndices={bulkCreate:"/libraryindex/bulk/new",bulkEdit:"/libraryindex/bulk/edit"};e.libraryIndices={bulkSave:"/rest/libraryindices/bulk",bulkSaveProgress:a("/rest/libraryindices/bulk"),datatable:"/rest/libraryindices/dt",platformDatatable:a("/rest/libraryindices/dt/platform"),search:"/rest/libraryindices/search"};d.librarySelections={bulkCreate:"/libraryselection/bulk/new",bulkEdit:"/libraryselection/bulk/edit"};e.librarySelections={bulkSave:"/rest/libraryselections/bulk",
bulkSaveProgress:a("/rest/libraryselections/bulk")};d.librarySpikeIns={bulkCreate:"/libraryspikein/bulk/new",bulkEdit:"/libraryspikein/bulk/edit"};e.librarySpikeIns={bulkSave:"/rest/libraryspikeins/bulk",bulkSaveProgress:a("/rest/libraryspikeins/bulk")};d.libraryStrategies={bulkCreate:"/librarystrategy/bulk/new",bulkEdit:"/librarystrategy/bulk/edit"};e.libraryStrategies={bulkSave:"/rest/librarystrategies/bulk",bulkSaveProgress:a("/rest/librarystrategies/bulk")};d.libraryTemplates={create:"/librarytemplate/new",
edit:a("/librarytemplate"),bulkCreate:"/librarytemplate/bulk/new",bulkEdit:"/librarytemplate/bulk/edit",addIndices:b("/librarytemplate","/indices/add"),editIndices:b("/librarytemplate","/indices/edit")};e.libraryTemplates={create:"/rest/librarytemplates",update:a("/rest/librarytemplates"),bulkSave:"/rest/librarytemplates/bulk",bulkSaveIndices:b("/rest/librarytemplates","/indices"),bulkSaveProgress:a("/rest/librarytemplates/bulk"),query:"/rest/librarytemplates/query",datatable:"/rest/librarytemplates/dt",
projectDatatable:a("/rest/librarytemplates/dt/project"),bulkDelete:"/rest/librarytemplates/bulk-delete",addProject:"/rest/librarytemplates/project/add",removeProject:"/rest/librarytemplates/project/remove"};d.libraryTypes={bulkCreate:"/librarytype/bulk/new",bulkEdit:"/librarytype/bulk/edit"};e.libraryTypes={bulkSave:"/rest/librarytypes/bulk",bulkSaveProgress:a("/rest/librarytypes/bulk")};e.locationMaps={create:"/rest/locationmaps"};d.metrics={bulkCreate:"/metric/bulk/new",bulkEdit:"/metric/bulk/edit"};
e.metrics={bulkSave:"/rest/metrics/bulk",bulkSaveProgress:a("/rest/metrics/bulk")};d.metricSubcategories={bulkCreate:"/metricsubcategory/bulk/new",bulkEdit:"/metricsubcategory/bulk/edit"};e.metricSubcategories={bulkSave:"/rest/metricsubcategories/bulk",bulkSaveProgress:a("/rest/metricsubcategories/bulk")};e.notes={create:function(k,l){return"/rest/notes/"+k+"/"+l},remove:function(k,l,p){return"/rest/notes/"+k+"/"+l+"/"+p},bulkDelete:"/rest/notes/bulk-delete"};d.partitionQcTypes={bulkCreate:"/partitionqctype/bulk/new",
bulkEdit:"/partitionqctype/bulk/edit"};e.partitionQcTypes={bulkSave:"/rest/partitionqctypes/bulk",bulkSaveProgress:a("/rest/partitionqctypes/bulk")};d.pipelines={bulkCreate:"/pipeline/bulk/new",bulkEdit:"/pipeline/bulk/edit"};e.pipelines={bulkSave:"/rest/pipelines/bulk",bulkSaveProgress:a("/rest/pipelines/bulk")};d.pools={create:"/pool/new",edit:a("/pool"),bulkEdit:"/pool/bulk/edit",bulkMerge:"/pool/bulk/merge"};e.pools={create:"/rest/pools",update:a("/rest/pools"),parents:a("/rest/pools/parents"),
children:a("/rest/pools/children"),query:"/rest/pools/query",search:"/rest/pools/search",picker:{recent:"/rest/pools/picker/recent",search:"/rest/pools/picker/search"},assign:b("/rest/pools","/assign"),projectDatatable:a("/rest/pools/dt/project"),platformDatatable:a("/rest/pools/dt/platform"),completionsDatatable:b("/rest/pools","/dt/completions"),bulkDelete:"/rest/pools/bulk-delete",spreadsheet:"/rest/pools/spreadsheet",contentsSpreadsheet:"/rest/pools/contents/spreadsheet",samplesheet:"/rest/pools/samplesheet",
dragenSamplesheet:"/rest/pools/dragensamplesheet",bulkSave:"/rest/pools/bulk",bulkSaveProgress:a("/rest/pools/bulk")};d.poolOrders={create:"/poolorder/new",edit:a("/poolorder")};e.poolOrders={create:"/rest/poolorders",update:a("/rest/poolorders"),indexChecker:"/rest/poolorders/indexchecker",statusDatatable:a("/rest/poolorders/dt")};e.printers={datatable:"/rest/printers/dt",create:"/rest/printers",enable:"/rest/printers/enable",disable:"/rest/printers/disable",layout:b("/rest/printers","/layout"),
list:"/rest/printers",duplicate:b("/rest/printers","/duplicate"),print:a("/rest/printers"),printBoxContents:b("/rest/printers","/boxcontents"),printBoxPositions:b("/rest/printers","/boxpositions")};d.projects={create:"/project/new",edit:a("/project")};e.projects={datatable:"/rest/projects/dt",get:a("/rest/projects"),create:"/rest/projects",update:a("/rest/projects"),search:"/rest/projects/search",attachments:b("/rest/projects","/files")};d.qcs={bulkAddFrom:a("/qc/bulk/addFrom"),bulkEdit:a("/qc/bulk/edit"),
bulkEditFrom:a("/qc/bulk/editFrom")};e.qcs={bulkSave:"/rest/qcs/bulk",bulkSaveProgress:a("/rest/qcs/bulk"),bulkDelete:"/rest/qcs/bulk-delete"};e.qcStatuses={update:"/rest/qcstatuses",bulkUpdate:"/rest/qcstatuses/bulk"};d.qcTypes={create:"/qctype/new",edit:a("/qctype")};e.qcTypes={create:"/rest/qctypes",update:a("/rest/qctypes")};d.referenceGenomes={bulkCreate:"/referencegenome/bulk/new",bulkEdit:"/referencegenome/bulk/edit"};e.referenceGenomes={bulkSave:"/rest/referencegenomes/bulk",bulkSaveProgress:a("/rest/referencegenomes/bulk")};
d.requisitions={create:"/requisition/new",edit:a("/requisition")};e.requisitions={datatable:"/rest/requisitions/dt",create:"/rest/requisitions",update:a("/rest/requisitions"),addSamples:b("/rest/requisitions","/samples"),removeSamples:b("/rest/requisitions","/samples/remove"),moveSamples:b("/rest/requisitions","/samples/move"),samplesUpdateProgress:a("/rest/requisitions/samplesupdate"),addSupplementalSamples:b("/rest/requisitions","/supplementalsamples"),removeSupplementalSamples:b("/rest/requisitions",
"/supplementalsamples/remove"),addLibraries:b("/rest/requisitions","/libraries"),removeLibraries:b("/rest/requisitions","/libraries/remove"),moveLibraries:b("/rest/requisitions","/libraries/move"),librariesUpdateProgress:a("/rest/requisitions/librariesupdate"),addSupplementalLibraries:b("/rest/requisitions","/supplementallibraries"),removeSupplementalLibraries:b("/rest/requisitions","/supplementallibraries/remove"),search:"/rest/requisitions/search",searchPausedByIds:"/rest/requisitions/paused",bulkResume:"/rest/requisitions/bulk-resume",
bulkSaveProgress:a("/rest/requisitions/bulk"),listRunLibraries:b("/rest/requisitions","/runlibraries")};d.runs={create:a("/run/new"),edit:a("/run")};e.runs={create:"/rest/runs",update:a("/rest/runs"),datatable:"/rest/runs/dt",projectDatatable:a("/rest/runs/dt/project"),sequencerDatatable:a("/rest/runs/dt/sequencer"),platformDatatable:a("/rest/runs/dt/platform"),setPartitionQcs:b("/rest/runs","/qc"),setPartitionPurposes:b("/rest/runs","/partition-purposes"),updateAliquots:b("/rest/runs","/aliquots"),
addContainer:b("/rest/runs","/add"),removeContainers:b("/rest/runs","/remove"),potentialExperiments:b("/rest/runs","/potentialExperiments"),spreadsheet:"/rest/runs/spreadsheet",parents:a("/rest/runs/parents"),search:"/rest/runs/search",recent:"/rest/runs/recent"};d.runLibraries={qcHierarchy:b("/runlibraries","/qc-hierarchy")};d.runLibraryQcStatuses={bulkCreate:"/runlibraryqcstatus/bulk/new",bulkEdit:"/runlibraryqcstatus/bulk/edit"};e.runLibraryQcStatuses={bulkSave:"/rest/runlibraryqcstatuses/bulk",
bulkSaveProgress:a("/rest/runlibraryqcstatuses/bulk")};d.runPurposes={bulkCreate:"/runpurpose/bulk/new",bulkEdit:"/runpurpose/bulk/edit"};e.runPurposes={bulkSave:"/rest/runpurposes/bulk",bulkSaveProgress:a("/rest/runpurposes/bulk")};d.samples={edit:a("/sample"),bulkCreate:"/sample/bulk/new",bulkEdit:"/sample/bulk/edit",bulkPropagate:"/sample/bulk/propagate",qcHierarchy:b("/sample","/qc-hierarchy")};e.samples={create:"/rest/samples",update:a("/rest/samples"),parents:a("/rest/samples/parents"),children:a("/rest/samples/children"),
query:"/rest/samples/query",datatable:"/rest/samples/dt",projectDatatable:a("/rest/samples/dt/project"),projectArrayedDatatable:b("/rest/samples/dt/project","/arrayed"),bulkDelete:"/rest/samples/bulk-delete",identitiesLookup:"/rest/samples/identitiesLookup",spreadsheet:"/rest/samples/spreadsheet",bulkSave:"/rest/samples/bulk",bulkSaveProgress:a("/rest/samples/bulk"),worksetDatatable:a("/rest/samples/dt/workset"),requisitionDatatable:a("/rest/samples/dt/requisition"),requisitionSupplementalDatatable:a("/rest/samples/dt/requisition-supplemental"),
samplesPreparedDatatable:a("/rest/samples/dt/samples-prepared"),findRelated:"/rest/samples/find-related"};d.sampleClasses={create:"/sampleclass/new",edit:a("/sampleclass")};e.sampleClasses={create:"/rest/sampleclasses",update:a("/rest/sampleclasses")};d.sampleIndexFamilies={create:"/sampleindexfamily/new",edit:a("/sampleindexfamily")};e.sampleIndexFamilies={create:"/rest/sampleindexfamilies",update:a("/rest/sampleindexfamilies")};d.sampleIndices={bulkCreate:"/sampleindex/bulk/new",bulkEdit:"/sampleindex/bulk/edit"};
e.sampleIndices={bulkSave:"/rest/sampleindices/bulk",bulkSaveProgress:a("/rest/sampleindices/bulk")};d.samplePurposes={bulkCreate:"/samplepurpose/bulk/new",bulkEdit:"/samplepurpose/bulk/edit"};e.samplePurposes={bulkSave:"/rest/samplepurposes/bulk",bulkSaveProgress:a("/rest/samplepurposes/bulk")};d.sampleTypes={bulkCreate:"/sampletype/bulk/new",bulkEdit:"/sampletype/bulk/edit"};e.sampleTypes={bulkSave:"/rest/sampletypes/bulk",bulkSaveProgress:a("/rest/sampletypes/bulk")};d.scientificNames={bulkCreate:"/scientificname/bulk/new",
bulkEdit:"/scientificname/bulk/edit"};e.scientificNames={bulkSave:"/rest/scientificnames/bulk",bulkSaveProgress:a("/rest/scientificnames/bulk")};d.sequencingControlTypes={bulkCreate:"/sequencingcontroltype/bulk/new",bulkEdit:"/sequencingcontroltype/bulk/edit"};e.sequencingControlTypes={bulkSave:"/rest/sequencingcontroltypes/bulk",bulkSaveProgress:a("/rest/sequencingcontroltypes/bulk")};d.sequencingOrders={bulkCreate:"/sequencingorder/bulk/new"};e.sequencingOrders={create:"/rest/sequencingorders",
update:a("/rest/sequencingorders"),bulkSave:"/rest/sequencingorders/bulk",bulkSaveProgress:a("/rest/sequencingorders/bulk"),search:"/rest/sequencingorders/search",picker:{chemistry:"/rest/sequencingorders/picker/chemistry",active:"/rest/sequencingorders/picker/active"},completionsDatatable:function(k,l){return"/rest/sequencingorders/dt/completions/"+k+"/"+l}};d.sequencingParameters={bulkCreate:"/sequencingparameters/bulk/new",bulkEdit:"/sequencingparameters/bulk/edit"};e.sequencingParameters={bulkSave:"/rest/sequencingparameters/bulk",
bulkSaveProgress:a("/rest/sequencingparameters/bulk")};e.serviceRecords={update:a("/rest/servicerecords"),bulkDelete:"/rest/servicerecords/bulk-delete"};d.attachments={serviceRecord:function(k,l){return"/attachments/servicerecord/"+k+"/"+l}};d.sops={bulkCreate:"/sop/bulk/new",bulkEdit:"/sop/bulk/edit"};e.sops={bulkSave:"/rest/sops/bulk",bulkSaveProgress:a("/rest/sops/bulk"),categoryDatatable:a("/rest/sops/dt/category")};d.stains={bulkCreate:"/stain/bulk/new",bulkEdit:"/stain/bulk/edit"};e.stains=
{bulkSave:"/rest/stains/bulk",bulkSaveProgress:a("/rest/stains/bulk")};d.stainCategories={bulkCreate:"/staincategory/bulk/new",bulkEdit:"/staincategory/bulk/edit"};e.stainCategories={bulkSave:"/rest/staincategories/bulk",bulkSaveProgress:a("/rest/staincategories/bulk")};d.storageLabels={bulkCreate:"/storagelabel/bulk/new",bulkEdit:"/storagelabel/bulk/edit"};e.storageLabels={bulkSave:"/rest/storagelabels/bulk",bulkSaveProgress:a("/rest/storagelabels/bulk")};e.storageLocations={children:b("/rest/storagelocations",
"/children"),createFreezer:"/rest/storagelocations/freezers",createLooseStorage:c("loose"),createRack:c("racks"),createRoom:"/rest/storagelocations/rooms",createShelf:c("shelves"),createStack:c("stacks"),createTrayRack:c("tray-racks"),deleteComponent:a("/rest/storagelocations"),freezers:"/rest/storagelocations/freezers",updateComponent:a("/rest/storagelocations"),updateFreezer:a("/rest/storagelocations/freezers"),queryByBarcode:"/rest/storagelocations/bybarcode",createRecord:function(k){return"/rest/storagelocations/"+
k+"/servicerecords"}};d.studies={create:"/study/new",createInProject:a("/study/new"),edit:a("/study")};e.studies={create:"/rest/studies",update:a("/rest/studies"),datatable:"/rest/studies/dt",projectDatatable:a("/rest/studies/dt/project")};d.studyTypes={bulkCreate:"/studytype/bulk/new",bulkEdit:"/studytype/bulk/edit"};e.studyTypes={bulkSave:"/rest/studytypes/bulk",bulkSaveProgress:a("/rest/studytypes/bulk")};d.submissions={create:"/submission/new",edit:a("/submission")};e.submissions={create:"/rest/submissions",
update:a("/rest/submissions"),download:b("/rest/submissions","/download")};d.subprojects={bulkCreate:"/subproject/bulk/new",bulkEdit:"/subproject/bulk/edit"};e.subprojects={bulkSave:"/rest/subprojects/bulk",bulkSaveProgress:a("/rest/subprojects/bulk")};d.targetedSequencings={bulkCreate:"/targetedsequencing/bulk/new",bulkEdit:"/targetedsequencing/bulk/edit"};e.targetedSequencings={bulkSave:"/rest/targetedsequencings/bulk",bulkSaveProgress:a("/rest/targetedsequencings/bulk"),kitAvailableDatatable:b("/rest/targetedsequencings/dt/kit",
"/available")};d.tissueMaterials={bulkCreate:"/tissuematerial/bulk/new",bulkEdit:"/tissuematerial/bulk/edit"};e.tissueMaterials={bulkSave:"/rest/tissuematerials/bulk",bulkSaveProgress:a("/rest/tissuematerials/bulk")};d.tissueOrigins={bulkCreate:"/tissueorigin/bulk/new",bulkEdit:"/tissueorigin/bulk/edit"};e.tissueOrigins={bulkSave:"/rest/tissueorigins/bulk",bulkSaveProgress:a("/rest/tissueorigins/bulk")};d.tissuePieceTypes={bulkCreate:"/tissuepiecetype/bulk/new",bulkEdit:"/tissuepiecetype/bulk/edit"};
e.tissuePieceTypes={bulkSave:"/rest/tissuepiecetypes/bulk",bulkSaveProgress:a("/rest/tissuepiecetypes/bulk")};d.tissueTypes={bulkCreate:"/tissuetype/bulk/new",bulkEdit:"/tissuetype/bulk/edit"};e.tissueTypes={bulkSave:"/rest/tissuetypes/bulk",bulkSaveProgress:a("/rest/tissuetypes/bulk")};d.transfers={create:"/transfer/new",edit:a("/transfer")};e.transfers={datatable:a("/rest/transfers/dt"),create:"/rest/transfers",update:a("/rest/transfers"),addNotification:b("/rest/transfers","/notifications"),resendNotification:function(k,
l){return"/rest/transfers/"+k+"/notifications/"+l+"/resend"},bulkDeleteNotifications:b("/rest/transfers","/notifications/bulk-delete")};d.users={create:"/admin/user/new",edit:a("/admin/user"),editSelf:a("/user")};e.users={create:"/rest/users",update:a("/rest/users"),resetPassword:b("/rest/users","/password"),search:"/rest/users"};d.deliverables={bulkCreate:"/deliverable/bulk/new",bulkEdit:"/deliverable/bulk/edit"};e.deliverables={bulkSave:"/rest/deliverables/bulk",bulkSaveProgress:a("/rest/deliverables/bulk")};
d.deliverableCategories={bulkCreate:"/deliverablecategory/bulk/new",bulkEdit:"/deliverablecategory/bulk/edit"};e.deliverableCategories={bulkSave:"/rest/deliverablecategories/bulk",bulkSaveProgress:a("/rest/deliverablecategories/bulk")};d.contactRoles={bulkCreate:"/contactrole/bulk/new",bulkEdit:"/contactrole/bulk/edit"};e.contactRoles={bulkSave:"/rest/contactroles/bulk",bulkSaveProgress:a("/rest/contactroles/bulk")};d.workflows={create:a("/workflow/new"),edit:a("/workflow")};e.workflows={list:"/rest/workflows",
addFavourite:a("/rest/workflows/favourites/add"),removeFavourite:a("/rest/workflows/favourites/remove"),getStep:function(k,l){return"/rest/workflows/"+k+"/step/"+l},processInput:function(k,l){return"/rest/workflows/"+k+"/step/"+l},latestStep:b("/rest/workflows","/step/latest"),execute:b("/rest/workflows","/execute")};d.worksets={create:"/workset/new",edit:a("/workset")};e.worksets={create:"/rest/worksets",update:a("/rest/worksets"),query:"/rest/worksets",addSamples:b("/rest/worksets","/samples"),
addLibraries:b("/rest/worksets","/libraries"),addLibraryAliquots:b("/rest/worksets","/libraryaliquots"),removeSamples:b("/rest/worksets","/samples"),removeLibraries:b("/rest/worksets","/libraries"),removeLibraryAliquots:b("/rest/worksets","/libraryaliquots"),moveSamples:b("/rest/worksets","/samples/move"),moveLibraries:b("/rest/worksets","/libraries/move"),moveLibraryAliquots:b("/rest/worksets","/libraryaliquots/move"),merge:"/rest/worksets/merge",categoryDatatable:a("/rest/worksets/dt"),bulkDelete:"/rest/worksets/bulk-delete"};
d.worksetCategories={bulkCreate:"/worksetcategory/bulk/new",bulkEdit:"/worksetcategory/bulk/edit"};e.worksetCategories={bulkSave:"/rest/worksetcategories/bulk",bulkSaveProgress:a("/rest/worksetcategories/bulk")};d.worksetStages={bulkCreate:"/worksetstage/bulk/new",bulkEdit:"/worksetstage/bulk/edit"};e.worksetStages={bulkSave:"/rest/worksetstages/bulk",bulkSaveProgress:a("/rest/worksetstages/bulk")};d.workstations={bulkCreate:"/workstation/bulk/new",bulkEdit:"/workstation/bulk/edit",edit:a("/workstation")};
e.workstations={update:a("/rest/workstations"),bulkSave:"/rest/workstations/bulk",bulkSaveProgress:a("/rest/workstations/bulk")};g.attachment=function(k,l,p){return"/attachments/"+k+"/"+l+"/"+p};g.boxSpreadsheet=a("/download/box/forms");f.attachment=function(k,l){return"/attachments/"+k+"/"+l};h.userManual=function(k,l){var p="https://miso-lims.readthedocs.io/projects/docs/en/"+Constants.docsVersion+"/user_manual/";k&&(p+=k+"/",l&&(p+="#"+l));return p};h.enaAccession=a("http://www.ebi.ac.uk/ena/data/view");
return{ui:d,rest:e,download:g,upload:f,external:h}}();window.addEventListener("error",function(a){console.log(a.error)});
var Admin=Admin||{clearCache:function(){Utils.showConfirmDialog("Hibernate Cache","Clear",["Clear Hibernate cache?"],function(){Utils.ajaxWithDialog("Clearing Cache","POST",Urls.rest.admin.clearHibernateCache,null,function(a){Utils.showOkDialog("Cache",[a?"Cache cleared.":"Failed to clear cache."])})})},regenBarcodes:function(){Utils.showConfirmDialog("Barcodes","Generate",["Generate missing barcodes?"],function(){Utils.ajaxWithDialog("Generating Barcodes","POST",Urls.rest.admin.regenerateBarcodes,
null,function(a){Utils.showOkDialog("Cache",a.filter(function(b){return 0<b.count}).map(function(b){return"Regenerated "+b.updated+" barcodes of "+b.blank+" "+b.target+". "+b.total+" "+b.target+" processed."}))})})},refreshConstants:function(){Utils.showConfirmDialog("Constants","Refresh",["Refresh constants?"],function(){Utils.ajaxWithDialog("Refreshing Constants","POST",Urls.rest.admin.refreshConstants,null,function(a){Utils.showOkDialog("Constants",["Constants refreshed."])})})}};
(function(a,b,c){function d(w){b("#resultSelect").empty();b("#warningMessages").html("");w&&w.length?(p=w.filter(function(v){return"Revoked"===v.identityConsentLevel}).map(function(v){return v.id}),1<w.length&&b("#resultSelect").append('\x3coption value\x3d"-1" selected\x3d"selected"\x3eSELECT\x3c/option\x3e'),b.each(w,function(v,E){v=b("\x3coption\x3e");v.val(E.id);v.text(E.name+": "+E.alias);b("#resultSelect").append(v)}),b("#updateSelected").prop("disabled",!1).removeClass("disabled")):(p=[],b("#resultSelect").append('\x3coption value\x3d"-1" selected\x3d"selected"\x3eNo results\x3c/option\x3e'));
b("#ajaxLoader").addClass("hidden");b("#searchField, #search, #resultSelect").prop("disabled",!1).removeClass("disabled");k.setDisabled(!1)}function e(w){var v=h.samples.filter(function(E){return E.coordinates===w});return 1===v.length?v[0]:null}function g(w){var v=b("#updateSelected, #removeSelected, #resultSelect, #search, #searchField");k.setDisabled(w);w?v.prop("disabled",!0).addClass("disabled"):v.prop("disabled",!1).removeClass("disabled");w?b("#warningMessages").html('\x3cimg id\x3d"ajaxLoader" src\x3d"/styles/images/ajax-loader.gif" alt\x3d"Loading" /\x3e'):
b("#warningMessages").html("")}function f(){b.ajax({url:Urls.rest.arrays.changelog(h.id),type:"GET",dataType:"json"}).done(function(w){l&&(b("#changelog").dataTable().fnDestroy(),b("#changelog").empty());l=!0;ListUtils.createStaticTable("changelog",ListTarget.changelog,{},w)}).fail(function(w,v,E){showAjaxErrorDialog(w,v,E)})}var h=null,k=null,l=!1,p=[],r={getRowLabel:function(w){return a.getRowLabel(w)},getColLabel:function(w){return a.getColLabel(w)},getPositionString:function(w,v){return a.getPositionString(w,
v)}};a.getRowLabel=function(w){return 10<=w?w:"0"+w};a.getColLabel=function(w){return r.getRowLabel(w)};a.getPositionString=function(w,v){return"R"+r.getRowLabel(w)+"C"+r.getColLabel(v)};a.Visual=function(){var w=new Box.Visual;w.isMultiSelectEnabled=function(){return!1};w.onSelectionChanged=function(v){var E=null;0<v.length&&(E=v[0].position);v=Utils.array.findFirstOrNull(function(q){return q.coordinates===E},w.data);d();v?(b("#selectedPosition").text(E),b("#selectedName").text(v.name),v.identificationBarcode?
b("#selectedBarcode").text(v.identificationBarcode):b("#selectedBarcode").empty(),b("#selectedAlias").html(Box.utils.hyperlinkifyBoxable(v.name,v.id,v.alias)),b("#selectedName").html(Box.utils.hyperlinkifyBoxable(v.name,v.id,v.name)),b("#removeSelected, #searchField, #search").prop("disabled",!1).removeClass("disabled")):(E?b("#selectedPosition").text(E):(b("#selectedPosition").empty(),b("#search, #searchField, #resultSelect, #updateSelected").prop("disabled",!0).addClass("disabled")),b("#selectedName").empty(),
b("#selectedAlias").empty(),b("#selectedBarcode").empty(),b("#updateSelected, #removeSelected").prop("disabled",!0).addClass("disabled"));b("#warningMessages").html("");b("#searchField").val("");b("#searchField").select().focus()};w.getRowLabel=function(v){return 10<=v?v:"0"+v};w.getColLabel=function(v){return r.getRowLabel(v)};w.getPositionString=function(v,E){return"R"+r.getRowLabel(v)+"C"+r.getColLabel(E)};return w};a.setArrayJson=function(w){h=w;k||(k=new a.Visual);h.id&&(b("#id").text(h.id),
b("#alias").val(h.alias),b("#arrayModel").text(h.arrayModelAlias),b("#serialNumber").val(h.serialNumber),b("#description").val(h.description),k.create({div:"#arraySamplesVisual",size:{rows:h.rows,cols:h.columns},data:h.samples}),k.setDisabled(!1),a.updateSamplesTable(h),f())};a.removeSelected=function(){g(!0);b.ajax({url:Urls.rest.arrays.position(h.id,k.selectedItems[0].position),type:"DELETE",dataType:"json"}).done(function(w){d();a.setArrayJson(w)}).fail(function(w,v,E){Utils.showOkDialog("Error removing sample",
[JSON.parse(w.responseText).detail]);g(!1)})};a.searchSamples=function(){var w=b("#searchField").val();w?(g(!0),w=Urls.rest.arrays.sampleSearch+"?"+Utils.page.param({q:w}),b.ajax({url:w,dataType:"json",type:"GET"}).done(function(v){d(v)}).fail(function(v,E,q){d();v=JSON.parse(v.responseText);Utils.showOkDialog("Search error",[v.detail?v.detail:v.message])})):d()};a.updatePosition=function(){if(1!==k.selectedItems.length)b("#warningMessages").html("Please select a single position from the grid, then retry.");
else if(-1==b("#resultSelect").val())b("#warningMessages").html("Please select an item to add.");else{var w=k.selectedItems[0].position,v=e(w),E=function(){g(!0);b.ajax({url:Urls.rest.arrays.position(h.id,w)+"?"+Utils.page.param({sampleId:jQuery("#resultSelect").val()}),type:"PUT",dataType:"json"}).done(function(t){d();a.setArrayJson(t)}).fail(function(t,z,x){t=JSON.parse(t.responseText);t=t.detail?t.detail:t.message;b("#warningMessages").html("Error adding item: "+t);b("#ajaxLoader").addClass("hidden");
g(!1)})},q=function(){var t=b("#resultSelect").val(),z=Utils.array.findFirstOrNull(function(x){return x==t},p);t&&0<t&&z?(z=["Donor has revoked consent for the following item."],z.push("* "+jQuery("#resultSelect").text()),Utils.showConfirmDialog("Warning","Proceed anyway",z,E)):E()};v?v.id==b("#resultSelect").val()?(d(),b("#searchField").val("")):Utils.showConfirmDialog("Replace Sample","Replace",[v.alias+" is already located at position "+w+". Replace it?"],q):q()}};a.updateSamplesTable=function(w){b("#listingSamplesTable").empty();
w=w?w.samples.map(function(v){return[v.coordinates,Box.utils.hyperlinkifyBoxable(v.name,v.id,v.name),Box.utils.hyperlinkifyBoxable(v.name,v.id,v.alias)]}):[];b("#listingSamplesTable").dataTable({aaData:w,aoColumns:[{sTitle:"Position"},{sTitle:"Sample Name"},{sTitle:"Sample Alias"}],bJQueryUI:!0,bDestroy:!0,sPaginationType:"full_numbers",sDom:'\x3c"#toolbar.fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"lf\x3er\x3ct\x3e\x3c"fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"ip\x3e',
aaSorting:[[0,"asc"]]}).css("width","100%")}})(window.SampleArray=window.SampleArray||{},jQuery);
var Assay=function(){function a(d,e){var g=d.label;switch(d.thresholdType){case "LT":g+=": \x3c "+e.maximumThreshold;break;case "LE":g+=": \x3c\x3d "+e.maximumThreshold;break;case "GT":g+=": \x3e "+e.minimumThreshold;break;case "GE":g+=": \x3e\x3d "+e.minimumThreshold;break;case "BETWEEN":g+=": "+e.minimumThreshold+" - "+e.maximumThreshold}d.units&&(g+=" "+d.units);return g}var b=null,c={};return{setForm:function(d){b=d},setListConfig:function(d){c=d},setMetrics:function(d){FormUtils.setTableData(ListTarget.assaymetric,
c,"listMetrics",d,b)},getMetrics:function(){return FormUtils.getTableData("listMetrics")},addMetric:function(d){var e=Assay.getMetrics();e.find(function(g){return g.id===d.id})?Utils.showOkDialog("Error",["This metric is already included"]):(e.push(d),Assay.setMetrics(e))},removeMetrics:function(d){var e=Assay.getMetrics().filter(function(g){return!d.some(function(f){return f.id===g.id})});Assay.setMetrics(e)},setTests:function(d){FormUtils.setTableData(ListTarget.assaytest,c,"listTests",d,b)},getTests:function(){return FormUtils.getTableData("listTests")},
addTest:function(d){var e=Assay.getTests();e.find(function(g){return g.id===d.id})?Utils.showOkDialog("Error",["This test is already included"]):(e.push(d),Assay.setTests(e))},removeTests:function(d){var e=Assay.getTests().filter(function(g){return!d.some(function(f){return f.id===g.id})});Assay.setTests(e)},utils:{makeLabel:function(d){return d.alias+" v"+d.version},getSortPriority:function(d,e,g){e||(e=Utils.array.findUniqueOrThrow(function(f){return f.value===d.category},Constants.metricCategories));
d.subcategoryId&&!g&&(g=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.subcategoryId),Constants.metricSubcategories));return 1E6*e.sortPriority+1E3*(g?g.sortPriority||500:0)+(d.sortPriority||500)},getAssays:function(d){return d&&d.length?d.map(function(e){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),Constants.assays)}):null},showMetrics:function(d,e){var g=Utils.array.findUniqueOrThrow(function(p){return p.value===e},Constants.metricCategories),f=d.metrics.map(function(p){var r=
Utils.array.findUniqueOrThrow(Utils.array.idPredicate(p.id),Constants.metrics);var w=r.subcategoryId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(r.subcategoryId),Constants.metricSubcategories):null;return{metric:r,metricSubcategory:w,assayMetric:p}}).filter(function(p){return p.metric.category===g.value}).sort(Utils.sorting.standardSortByCallback(function(p){return Assay.utils.getSortPriority(p.metric,g,p.metricSubcategory)}));lines=[];for(var h=null,k=0;k<f.length;k++){var l=f[k];l.metric.subcategoryId!==
h&&(lines.push(l.metricSubcategory.alias+":"),h=l.metricSubcategory.id);lines.push("\u2022 "+a(l.metric,l.assayMetric))}lines.length||lines.push("(No metrics defined)");Utils.showOkDialog(d.alias+" v"+d.version+" "+g.label+" Metrics",lines)}}}}(),Box=Box||{boxJSON:null,originalBox:null,boxId:null,visual:null,fakeScan:function(){var a=jQuery("#dialogDialog");jQuery("#dialogInfoBelow").html("");jQuery("#dialogInfoAbove").html("\x3cp\x3ePlease enter the prefix for your bacodes (e.g., MYBOX for MYBOXA01, MYBOXA02, ...). Existing items with barcodes matching this pattern will be added to the box in positions depending on the suffix.\x3c/p\x3e");
jQuery("#dialogVisual").html('\x3cp\x3ePrefix: \x3cinput id\x3d"prefix" type\x3d"text"/\x3e\x3c/p\x3e\x3cp\x3eSuffix: \x3cinput type\x3d"radio" name\x3d"suffix" id\x3d"standardSuffix" value\x3d"standard"/\x3e\x3clabel for\x3d"standardSuffix"\x3e Standard (A01, A02, ... as row letter/column number)\x3c/label\x3e \x3cinput type\x3d"radio" name\x3d"suffix" id\x3d"numericSuffix" value\x3d"numeric"/\x3e\x3clabel for\x3d"numericSuffix"\x3e Numeric (001, 002, ... moving in rows)\x3c/label\x3e\x3c/p\x3e');
a.dialog({autoOpen:!0,width:500,height:400,modal:!0,resizable:!1,title:"Fill by Barcode Pattern",position:[jQuery(window).width()/2-200,50],buttons:{Fill:function(){var b=document.getElementById("prefix").value,c=jQuery('input[name\x3d"suffix"]:checked').val()||"standard";b&&(new RegExp(Utils.validation.sanitizeRegex)).test(b)?(a.dialog("close"),jQuery("#dialogVisual").html("\x3cp\x3eSaving...\x3c/p\x3e"),jQuery("#dialogInfoAbove").html(""),a.dialog({autoOpen:!0,width:400,height:300,modal:!0,resizable:!1,
position:[jQuery(window).width()/2-200,50],buttons:{}}),b=Urls.rest.boxes.fillByPattern(Box.boxJSON.id)+"?"+Utils.page.param({prefix:b,suffix:c}),Utils.ajaxWithDialog("Filling by Pattern","POST",b,null,function(){Utils.page.pageReload()})):Utils.showOkDialog("Invalid prefix",[(b?b+" is n":"N")+"ot a valid prefix."])},Cancel:function(){a.dialog("close")}}})},initScan:function(a){Box.dialogWidth=40*Box.boxJSON.cols+150;Box.dialogHeight=40*Box.boxJSON.rows+300;Box.scanDialog=Box.ScanDialog(a);Box.prepareScannerDialog=
Box.PrepareScannerDialog(a);Box.scanDiff=Box.ScanDiff(a);Box.prepareScannerDialog.show()},createVisualization:function(){Box.visual.setDisabled(!1);var a=Box.visual.selectedItems&&1===Box.visual.selectedItems.length?Box.visual.selectedItems[0]:null;Box.visual.create({div:"#boxContentsTable",size:{rows:Box.boxJSON.rows,cols:Box.boxJSON.cols},data:Box.boxJSON.items});a&&Box.visual.selectPos(a.row,a.col)},saveContents:function(a,b){b=a.map(function(d){return{position:d.coordinates,searchString:d.identificationBarcode}}).concat(b.map(function(d){return{position:d,
searchString:null}}));var c=Urls.rest.boxes.updateContents(Box.boxJSON.id);jQuery.ajax({url:c,type:"POST",contentType:"application/json; charset\x3dutf8",data:JSON.stringify(b)}).done(function(d){Box.boxJSON.items=a;Box.ui.update()}).fail(function(d,e,g){Utils.showAjaxErrorDialog(d,e,g)})}};
Box.scan={prepareScanner:function(a,b,c){var d=setTimeout(Box.prepareScannerDialog.error,1E4);jQuery.ajax({url:Urls.rest.boxes.prepareScan,type:"POST",contentType:"application/json; charset\x3dutf8",data:JSON.stringify({scannerName:a,rows:b,columns:c})}).done(function(e){clearTimeout(d);jQuery("#dialogDialog").dialog("close");Box.scanDialog.show({size:{rows:Box.boxJSON.rows,cols:Box.boxJSON.cols},data:Box.boxJSON.items})}).fail(function(e,g,f){clearTimeout(d);Box.prepareScannerDialog.error()})},scanBox:function(a){jQuery.ajax({url:Urls.rest.boxes.scan(Box.boxJSON.id),
type:"POST",contentType:"application/json; charset\x3dutf8",data:JSON.stringify({scannerName:a})}).done(function(b){jQuery("#magnify").stop();Box.scanDiff.show(b)}).fail(function(b,c,d){jQuery("#magnify").stop();jQuery("#dialogDialog").dialog("close");Box.scanDialog.error(b&&b.responseText&&b.responseText.detail?b.responseText.detail:"Scan failed")})}};
Box.ui={update:function(){Box.ui.createListingBoxablesTable(Box.boxJSON);Box.createVisualization();Utils.ui.setDisabled("#updateSelected, #removeSelected, #emptySelected, #resultSelect, #search, #searchField",!0)},onSelectionChanged:function(a,b){jQuery("#singlePositionControls").hide();jQuery("#bulkPositionControls").hide();a=a.map(function(c){return Box.utils.getPositionString(c.row,c.col)});Box.ui.filterTableByBoxPositions(a);Box.ui.clearBoxableSearchResults();b?(jQuery("#singlePositionControls").show(),
jQuery("#selectedPosition").text(a[0]),jQuery("#selectedName").text(b.name),b.identificationBarcode?jQuery("#selectedBarcode").text(b.identificationBarcode):jQuery("#selectedBarcode").empty(),jQuery("#selectedAlias").html(Box.utils.hyperlinkifyBoxable(b.name,b.id,b.alias)),jQuery("#selectedName").html(Box.utils.hyperlinkifyBoxable(b.name,b.id,b.name)),jQuery("#removeSelected, #emptySelected, #searchField, #search").prop("disabled",!1).removeClass("disabled")):(1<a.length?Box.ui.showBulkUpdateTable(a):
1===a.length?(jQuery("#singlePositionControls").show(),jQuery("#selectedPosition").text(a[0])):(jQuery("#selectedPosition").empty(),jQuery("#search, #searchField, #resultSelect, #updateSelected").prop("disabled",!0).addClass("disabled")),jQuery("#selectedName").empty(),jQuery("#selectedAlias").empty(),jQuery("#selectedBarcode").empty(),jQuery("#updateSelected, #removeSelected, #emptySelected").prop("disabled",!0).addClass("disabled"));jQuery("#warningMessages").html("");jQuery("#searchField").val("");
jQuery("#searchField").select().focus()},showBulkUpdateTable:function(a){jQuery("#bulkUpdateTable tbody").empty();jQuery("#bulkPositionControls").show();for(var b=0;b<a.length;b++){var c=a[b],d=jQuery("\x3ctr\x3e");d.append(jQuery("\x3ctd\x3e"+c+"\x3c/td\x3e"));var e=jQuery("\x3ctd\x3e"),g=jQuery('\x3cinput type\x3d"text" class\x3d"bulkUpdateInput"/\x3e');g.data("position",c);b<a.length-1?(g.keyup(function(f){var h=b;return function(k){"13"==k.which&&jQuery("#bulkUpdateTable tbody input:eq("+(h+1)+
")").focus()}}()),g.on("paste",function(){var f=b;return function(h){for(var k=h;k.originalEvent&&"paste"==k.type;k=k.originalEvent);k=k.clipboardData?k.clipboardData.getData("Text").split(/\r?\n/):[];if(1<k.length){for(var l=0;l<k.length;l++)jQuery("#bulkUpdateTable tbody input:eq("+l+")").val(k[l].replace(/^\s*|\s*$/g,""));jQuery("#bulkUpdateTable tbody input:eq("+l+")").focus();h.preventDefault()}else window.setTimeout(function(){jQuery("#bulkUpdateTable tbody input:eq("+(f+1)+")").focus()},100)}}())):
g.keyup(function(f){"13"==f.which&&jQuery("#bulkUpdate").click()});e.append(g);d.append(e);jQuery("#bulkUpdateTable tbody").append(d);0===b&&g.focus()}jQuery("#bulkUpdateInput").click(function(){$(this).select()})},changeBoxListing:function(a){jQuery("#listingBoxesTable").dataTable().fnFilter(a,5)},bulkRemoveItems:function(){Utils.showConfirmDialog("Remove Items","Remove",["Are you sure you wish to set location to unknown for all selected items? You should re-home them as soon as possible."],function(){var a=
Box.ui.getSelectedPositions(),b=Urls.rest.boxes.removeContents(Box.boxJSON.id);Utils.ajaxWithDialog("Remove Items","POST",b,a,function(c){Box.boxJSON=c;Box.ui.update()})})},bulkDiscardItems:function(){Utils.showConfirmDialog("Discard Items","Discard",["Are you sure you wish to set discard all selected items?"],function(){var a=Box.ui.getSelectedPositions(),b=Urls.rest.boxes.discardContents(Box.boxJSON.id);Utils.ajaxWithDialog("Discard Items","POST",b,a,function(c){Box.boxJSON=c;Box.ui.update()})})},
getSelectedPositions:function(){return jQuery.map(jQuery("#bulkUpdateTable tbody input"),function(a){return jQuery(a).data("position")})},bulkUpdatePositions:function(){var a=[];jQuery("#bulkUpdateTable tbody input").each(function(g,f){a.push({position:jQuery(f).data("position"),searchString:jQuery(f).val()})});var b=a.map(function(g){return g.position}),c=Box.boxJSON.items.filter(function(g){return 0<=b.indexOf(g.coordinates)}),d=function(){var g=Urls.rest.boxes.updateContents(Box.boxJSON.id);Utils.ajaxWithDialog("Update Positions",
"POST",g,a,function(f){Box.boxJSON=f;Box.ui.update()})};if(c.length){var e=["Some of these positions already contain other items:"];c.forEach(function(g){e.push("* "+g.coordinates+": "+g.name+" ("+g.alias+")")});e.push("Are you sure you wish to replace them?");Utils.showConfirmDialog("Replace Items","Replace",e,d)}else d()},createListingBoxablesTable:function(a){jQuery("#listingBoxablesTable").empty();a=a.items.map(function(b){return[b.coordinates,Box.utils.hyperlinkifyBoxable(b.name,b.id,b.name),
Box.utils.hyperlinkifyBoxable(b.name,b.id,b.alias)]});jQuery("#listingBoxablesTable").dataTable({aaData:a,aoColumns:[{sTitle:"Position"},{sTitle:"Element Name"},{sTitle:"Element Alias"}],bJQueryUI:!0,bDestroy:!0,aLengthMenu:[[Box.boxJSON.cols*Box.boxJSON.rows,50,25,10],[Box.boxJSON.cols*Box.boxJSON.rows,50,25,10]],iDisplayLength:Box.boxJSON.cols*Box.boxJSON.rows,sPaginationType:"full_numbers",sDom:'\x3c"#toolbar.fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"lf\x3er\x3ct\x3e\x3c"fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"ip\x3e',
aaSorting:[[0,"asc"]]}).css("width","100%");jQuery("#toolbar").append('\x3cbutton style\x3d"margin-left:5px;" class\x3d"fg-button ui-state-default ui-corner-all" id\x3d"listAllItems" onclick\x3d"Box.ui.selectNone();"\x3eList all Box Contents\x3c/button\x3e');Box.ui.getBulkActions()},selectNone:function(){Box.visual.clearSelection();Box.ui.filterTableByBoxPositions();Box.ui.onSelectionChanged([])},filterTableByBoxPositions:function(a){var b=jQuery("#listingBoxablesTable").dataTable(),c="";a&&0<a.length&&
(c="^(?:"+a.join("|")+")$");b.fnFilter(c,0,!0);Box.ui.getBulkActions(a)},getBulkActions:function(a){var b=a?Box.boxJSON.items.filter(function(e){return 0<=a.indexOf(e.coordinates)}):Box.boxJSON.items;var c=[{name:"Print Barcodes by Position",action:function(){Utils.printSelectDialog(function(e,g,f){var h=0==b.length?Box.boxJSON.items.map(function(k){return k.coordinates}):a;Utils.ajaxWithDialog("Printing","POST",Urls.rest.printers.printBoxPositions(e),{boxId:Box.boxId,positions:h,copies:g,sortOrder:f.order},
function(k){Utils.showOkDialog("Printing",[k==h.length?"Barcodes sent to printer.":k+" of "+h.length+" printed."])})},[{label:"Print by",type:"select",property:"order",required:!0,values:["column","row"]}])}}];if(1>b.length)Box.boxJSON.items.length?Box.ui.refreshToolbar(c,b,"Select one or more items to see bulk actions."):Box.ui.refreshToolbar([],b,"Add items to box to see bulk actions.");else{1==b.length&&(c=[]);var d=Utils.array.deduplicateString(b.map(function(e){return e.entityType}));if(1<d.length)a?
Box.ui.refreshToolbar(c,b,"Selection contains multiple types of items. Select items of the same type to see bulk actions."):Box.ui.refreshToolbar(c,b,"Box contains multiple types of items. Select items of same type to see bulk actions.");else{switch(d[0]){case "SAMPLE":c=c.concat(BulkTarget.sample.getBulkActions({sortLibraryPropagate:"sampleBoxColumn"}));break;case "LIBRARY":c=c.concat(BulkTarget.library.getBulkActions({}));break;case "LIBRARY_ALIQUOT":c=c.concat(BulkTarget.libraryaliquot.getBulkActions({}));
break;case "POOL":c=c.concat(BulkTarget.pool.getBulkActions({}))}Box.ui.refreshToolbar(c,b,null)}}},createToolbarIfNecessary:function(){var a=jQuery("#listingBoxablesToolbar");a.length||(a=jQuery("\x3cdiv /\x3e",{id:"listingBoxablesToolbar",class:"fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix paging_full_numbers"}),a.insertBefore(jQuery("#toolbar")))},refreshToolbar:function(a,b,c){Box.ui.createToolbarIfNecessary();var d=jQuery("#listingBoxablesToolbar");d.empty();a.forEach(function(e){(e?
Utils.ui.makeBulkActionButton(e,function(){return b}):jQuery("\x3cspan /\x3e",{class:"ui-state-default"})).appendTo(d)});c&&jQuery("\x3cspan/\x3e",{text:c}).appendTo(d)},exportBox:function(a){jQuery.ajax({url:Urls.rest.boxes.spreadsheet(a),type:"GET",contentType:"application/json; charset\x3dutf8",dataType:"json"}).done(function(b){Utils.page.pageRedirect(Urls.download.boxSpreadsheet(b.hashCode))})},exportFragmentAnalyser:function(a){Box.boxJSON.items.some(function(b){return"H12"===b.coordinates})?
Utils.showConfirmDialog("Warning","OK",["The item in position H12 will not be included in the sheet because Fragment Analyser requires H12 for ladder. Generate sheet anyway?"],function(){Utils.ajaxDownloadWithDialog(Urls.rest.boxes.fragmentAnalyserSheet(a))}):Utils.ajaxDownloadWithDialog(Urls.rest.boxes.fragmentAnalyserSheet(a))},getItemAtPosition:function(a){var b=Box.boxJSON.items.filter(function(c){return c.coordinates==a});return 1==b.length?b[0]:null},addItemToBox:function(){if(1!==Box.visual.selectedItems.length)jQuery("#warningMessages").html("Please select a single position from the grid, then retry.");
else if(-1==jQuery("#resultSelect").val())jQuery("#warningMessages").html("Please select an item to add.");else{var a=Box.utils.getPositionString(Box.visual.selectedItems[0].row,Box.visual.selectedItems[0].col),b=Box.ui.getItemAtPosition(a),c=function(){jQuery("#emptySelected, #removeSelected").prop("disabled",!0).addClass("disabled");Box.ui.showBoxableSearchLoading();jQuery.ajax({url:Urls.rest.boxes.updatePosition(Box.boxId,a)+"?"+Utils.page.param({entity:jQuery("#resultSelect").val()}),type:"PUT",
dataType:"json",contentType:"application/json; charset\x3dutf8"}).done(function(d){Box.boxJSON=d;Box.ui.update();Box.ui.getBulkActions();Box.ui.clearBoxableSearchResults();jQuery("#searchField").val("");jQuery("#emptySelected, #removeSelected").prop("disabled",!1).removeClass("disabled")}).fail(function(d,e,g){d=JSON.parse(d.responseText);d=d.detail?d.detail:d.message;jQuery("#warningMessages").html("Error adding item: "+d);jQuery("#ajaxLoader").addClass("hidden");jQuery("#searchField, #search, #resultSelect, #updateSelected").prop("disabled",
!1).removeClass("disabled");Box.visual.setDisabled(!1);1===Box.visual.selectedItems.length&&jQuery("#emptySelected, #removeSelected").prop("disabled",!1).removeClass("disabled")})};b?b.entityType+":"+b.id===jQuery("#resultSelect").val()?(Box.ui.clearBoxableSearchResults(),jQuery("#searchField").val("")):Utils.showConfirmDialog("Replace Item","Replace",[b.name+" ("+b.alias+") is already located at position "+a+". Are you sure you wish to replace it?","If so, you should re-home "+b.name+" as soon as possible."],
c):c()}},removeOneItem:function(){if(1!==Box.visual.selectedItems.length)Utils.showOkDialog("Too many items selected",["Select a single item to remove."]);else{var a=Box.utils.getPositionString(Box.visual.selectedItems[0].row,Box.visual.selectedItems[0].col),b=Box.ui.getItemAtPosition(a);Utils.showConfirmDialog("Remove Item","Remove",["Are you sure you wish to set location to unknown for "+b.name+"? You should re-home it as soon as possible."],function(){jQuery("#updateSelected, #emptySelected, #removeSelected").prop("disabled",
!0).addClass("disabled");jQuery("#warningMessages").html('\x3cimg id\x3d"ajaxLoader" src\x3d"/styles/images/ajax-loader.gif" alt\x3d"Loading" /\x3e');var c=Urls.rest.boxes.removePosition(Box.boxJSON.id,a);Utils.ajaxWithDialog("Remove item","DELETE",c,null,function(){Utils.page.pageReload()},function(){jQuery("#updateSelected, #emptySelected, #removeSelected").prop("disabled",!1).removeClass("disabled");jQuery("#selectedBarcode").val(b.identificationBarcode)})})}},discardOneItem:function(){if(1!==
Box.visual.selectedItems.length)Utils.showOkDialog("Too many items selected",["Select a single item to discard"]);else{var a=Box.utils.getPositionString(Box.visual.selectedItems[0].row,Box.visual.selectedItems[0].col);Utils.showConfirmDialog("Discard Item","Discard",["Are you sure you wish to discard this item?"],function(){jQuery("#updateSelected, #emptySelected, #removeSelected").prop("disabled",!0).addClass("disabled");jQuery("#warningMessages").html('\x3cimg id\x3d"ajaxLoader" src\x3d"/styles/images/ajax-loader.gif" alt\x3d"Loading" /\x3e');
var b=Urls.rest.boxes.discardPosition(Box.boxJSON.id,a);Utils.ajaxWithDialog("Discard item","POST",b,null,function(){Utils.page.pageReload()},function(){jQuery("#updateSelected, #emptySelected, #removeSelected").prop("disabled",!1).removeClass("disabled")})})}},discardAllContents:function(a){var b=Urls.rest.boxes.discardAll(a);Utils.showConfirmDialog("Discard All Contents","Discard",["Are you sure you wish to discard all contents of this box?"],function(){Utils.ajaxWithDialog("Discard All Contents",
"POST",b,null,function(){Utils.page.pageReload()})})},searchBoxables:function(){var a=jQuery("#searchField").val();a?(Box.ui.showBoxableSearchLoading(),jQuery.ajax({url:Urls.rest.boxables.search+"?q\x3d"+a,contentType:"application/json; charset\x3dutf8",dataType:"json",type:"GET"}).done(function(b){Box.ui.showBoxableSearchResults(b)}).fail(function(b,c,d){Box.ui.clearBoxableSearchResults();b=JSON.parse(b.responseText);Utils.showOkDialog("Search error",[b.detail?b.detail:b.message])})):Box.ui.clearBoxableSearchResults()},
showBoxableSearchLoading:function(){jQuery("#ajaxLoader").removeClass("hidden");jQuery("#searchField, #search, #resultSelect, #updateSelected").prop("disabled",!0).addClass("disabled");Box.visual.setDisabled(!0)},clearBoxableSearchResults:function(){Box.ui.showBoxableSearchResults()},showBoxableSearchResults:function(a){jQuery("#resultSelect").empty();jQuery("#warningMessages").html("");var b=null;a&&a.length?(1<a.length?(jQuery("#resultSelect").append('\x3coption value\x3d"-1" selected\x3d"selected"\x3eSELECT\x3c/option\x3e'),
b="#resultSelect"):b="#updateSelected",jQuery.each(a,function(c,d){c=jQuery("\x3coption\x3e");c.val(d.entityType+":"+d.id);c.text(d.name+": "+d.alias);jQuery("#resultSelect").append(c)}),jQuery("#updateSelected").prop("disabled",!1).removeClass("disabled")):(jQuery("#resultSelect").append('\x3coption value\x3d"-1" selected\x3d"selected"\x3eNo results\x3c/option\x3e'),b="#searchField");jQuery("#ajaxLoader").addClass("hidden");jQuery("#searchField, #search, #resultSelect").prop("disabled",!1).removeClass("disabled");
Box.visual.setDisabled(!1);jQuery(b).focus()}};
(function(a,b,c){function d(f){return-1!=navigator.platform.indexOf("Mac")?f.metaKey:f.ctrlKey}var e=function(f){var h={};h.title=f.title||"";h.parentVisual=f.parentVisual;h.row=f.row;h.col=f.col;h.cell=f.cell;h.position=h.parentVisual.getPositionString(h.row,h.col);h.selectedImg=f.selectedImg||null;h.unselectedImg=f.unselectedImg||null;h.element=f.element||jQuery("\x3cimg\x3e");h.setTitle=function(){h.cell.prop("title",h.parentVisual.getPositionString(h.row,h.col)+": "+h.title)};h.setImage=f.setImage||
function(k){h.element.prop("src",k)};h.select=f.select||function(){h.setImage(h.selectedImg)};h.unselect=f.unselect||function(){h.setImage(h.unselectedImg)};h.click=function(k){h.parentVisual.isMultiSelectEnabled()&&d(k)?h.controlClick():h.normalClick()};h.normalClick=function(){h.parentVisual.clearSelection();h.parentVisual.select(h)};h.controlClick=function(){-1===jQuery.inArray(h,h.parentVisual.selectedItems)?h.parentVisual.select(h):h.parentVisual.unselect(h)};h.setTitle();h.unselect();h.element.click({row:h.row,
col:h.col},h.click);h.cell.append(h.element);return h},g=function(){var f={},h=!1;f.selectedItems=[];f.isMultiSelectEnabled=function(){return!0};f.clearSelection=function(){h||(f.selectedItems.forEach(function(r){r.unselect()}),f.selectedItems=[])};var k=function(r){var w=null;if(r&&1===r.length){var v=f.getPositionString(r[0].row,r[0].col);w=f.data.filter(function(E){return E.coordinates===v})[0]}f.onSelectionChanged(r,w)};f.select=function(r,w){h||(r.select(),f.selectedItems.push(r),w||k(f.selectedItems))};
f.unselect=function(r,w){h||(r.unselect(),f.selectedItems=f.selectedItems.filter(function(v){return v!==r}),w||k(f.selectedItems))};f.clear=function(){jQuery(f.div).empty()};f.create=function(r){f.data=r.data;f.size=r.size;f.div=r.div;f.table=f.div+"Visualization";f.position=Array(f.size.rows+1);for(r=1;r<=f.size.rows;r++)f.position[r]=Array(f.size.cols+1);f.clear();r=jQuery("\x3ctable\x3e");r.attr("id",f.table.substring(1));r.attr("style","border:1px solid darkgrey;background:lightgrey;padding:10px;");
jQuery(f.div).append(r);r=jQuery("\x3ctBody\x3e");var w=jQuery("\x3ctr\x3e"),v=jQuery("\x3cth\x3e");v.addClass("boxVisColHeader boxVisRowHeader");w.append(v);for(v=1;v<=f.size.cols;v++){var E=jQuery("\x3cth\x3e").text(f.getColLabel(v));E.addClass("boxVisColHeader");E.click({col:v},f.selectCol);w.append(E)}r.append(w);for(E=1;E<=f.size.rows;E++){w=jQuery("\x3ctr\x3e");w.attr("id",f.div.substring(1)+"Row"+E);var q=jQuery("\x3ctd\x3e");q.addClass("boxVisRowHeader");q.text(f.getRowLabel(E));q.click({row:E},
f.selectRow);w.append(q);for(v=1;v<=f.size.cols;v++)q=jQuery("\x3ctd\x3e"),q.addClass("Col"+v+" boxVisCell"),f.position[E][v]=f.getBoxPosition(E,v,q),w.append(f.position[E][v].cell);r.append(w)}jQuery(f.table).append(r);f.clearSelection();k(f.selectedItems)};var l=function(r,w){d(r)||f.clearSelection();var v=!0;w.forEach(function(E){-1===jQuery.inArray(E,f.selectedItems)&&(f.select(E,!0),v=!1)});if(d(r)&&v)for(r=0;r<w.length;r++)f.unselect(w[r],!0);k(f.selectedItems)};f.selectAll=function(r){if(f.isMultiSelectEnabled()){r=
[];for(var w=1;w<=f.size.rows;w++)for(var v=1;v<=f.size.cols;v++)r.push(f.position[w][v]);r.forEach(function(E){f.select(E,!0)});k(f.selectedItems)}};f.selectRow=function(r){if(f.isMultiSelectEnabled()){for(var w=r.data.row,v=[],E=1;E<=f.size.cols;E++)v.push(f.position[w][E]);l(r,v)}};f.selectCol=function(r){if(f.isMultiSelectEnabled()){for(var w=r.data.col,v=[],E=1;E<=f.size.rows;E++)v.push(f.position[E][w]);l(r,v)}};f.selectOddColumns=function(){p(!0)};f.selectEvenColumns=function(){p(!1)};var p=
function(r){if(f.isMultiSelectEnabled()){f.clearSelection();var w=[];for(r=r?1:2;r<=f.size.cols;r+=2)for(var v=1;v<=f.size.rows;v++)w.push(f.position[v][r]);w.forEach(function(E){f.select(E,!0)});k(f.selectedItems)}};f.selectPos=function(r,w){f.clearSelection();f.select(f.position[r][w],!1)};f.getBoxPosition=function(r,w,v){var E=f.getBoxPositionOpts(r,w);E.row=r;E.col=w;E.cell=v;E.parentVisual=f;return new e(E)};f.onSelectionChanged=function(r,w){};f.setDisabled=function(r){h=r};f.getRowLabel=function(r){return a.utils.getRowLabel(r)};
f.getColLabel=function(r){return a.utils.getColLabel(r)};f.getPositionString=function(r,w){return a.utils.getPositionString(r,w)};return f};a.DialogVisual=function(f){var h=new g;h.scan=f;h.show=function(k){jQuery("#dialogInfoAbove").html(k.infoabove);jQuery("#dialogInfoBelow").html(k.infobelow);jQuery("#dialogDialog").dialog({autoOpen:!1,title:"Scan",width:a.dialogWidth,modal:!0,resizable:!1,position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{}});h.create({div:"#dialogVisual",size:{rows:h.size.rows,
cols:h.size.cols},data:h.scan.items});jQuery("#updateSelected, #removeSelected, #emptySelected").prop("disabled",!0).addClass("disabled");jQuery("#dialogDialog").dialog("open")};h.getBoxPositionOpts=function(k,l){var p=h.getPositionString(k,l);if(-1!==jQuery.inArray(p,h.scan.readErrorPositions))return{title:"Read Error",selectedImg:"/styles/images/tube_error.png",unselectedImg:"/styles/images/tube_error.png"};k=h.data.filter(function(r){return r.coordinates==p});return 0<k.length?{title:k[0].alias,
selectedImg:"/styles/images/tube_full_selected.png",unselectedImg:"/styles/images/tube_full.png"}:{title:"Empty",selectedImg:"/styles/images/tube_empty_selected.png",unselectedImg:"/styles/images/tube_empty.png"}};return h};a.Visual=function(f){var h=new g;h.getBoxPositionOpts=function(k,l){var p=h.getPositionString(k,l);k=h.data.filter(function(r){return r.coordinates==p});return 0<k.length?{title:k[0].alias,selectedImg:"/styles/images/tube_full_selected.png",unselectedImg:"/styles/images/tube_full.png"}:
{title:"Empty",selectedImg:"/styles/images/tube_empty_selected.png",unselectedImg:"/styles/images/tube_empty.png"}};h.onSelectionChanged=f||function(k,l){};return h};a.ScanDialog=function(f){var h=new g;h.show=function(k){h.size=k.size;h.data=k.data;h.getNewPosition=function(){return[Math.floor(Math.random()*(30*a.boxJSON.rows-100))+100,Math.floor(Math.random()*(a.dialogWidth-400))+100]};h.animateMag=function(){var l=h.getNewPosition(),p=jQuery("#magnify").offset();p=h.getSpeed([p.top,p.left],l);
jQuery("#magnify").animate({top:l[0],left:l[1]},p,function(){h.animateMag()})};h.getSpeed=function(l,p){var r=Math.abs(l[1]-p[1]);l=Math.abs(l[0]-p[0]);return Math.ceil((r>l?r:l)/.1)};jQuery("#dialogInfoAbove").html('\x3ch1\x3ePlace box on scanner\x3c/h1\x3e\x3cbr\x3e\x3cimg id\x3d"magnify" src\x3d"/styles/images/magnifying_glass.png" style\x3d"position:absolute;"\x3e\x3c/img\x3e');jQuery("#dialogInfoBelow").html("\x3cp\x3ePlease place the box on the scanner. The box will be scanned automatically.\x3c/p\x3e");
jQuery("#magnify").offset({top:h.getNewPosition()[0],left:h.getNewPosition()[1]});h.animateMag();jQuery("#dialogDialog").dialog({autoOpen:!1,title:"Scan",width:a.dialogWidth,height:a.dialogHeight,modal:!0,resizable:!1,position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{}});h.create({div:"#dialogVisual",size:{rows:h.size.rows,cols:h.size.cols},data:h.data});jQuery("#updateSelected, #removeSelected, #emptySelected").prop("disabled",!0).addClass("disabled");jQuery("#dialogDialog").dialog("open");
a.scan.scanBox(f)};h.getBoxPositionOpts=function(k,l){return{title:"Empty",selectedImg:"/styles/images/tube_empty_selected.png",unselectedImg:"/styles/images/tube_empty.png"}};h.error=function(k){jQuery("#dialogInfoBelow").html("");jQuery("#dialogInfoAbove").html('\x3ch1 class\x3d"warning"\x3eError: Scanner did not detect a box\x3c/h1\x3e\x3cp\x3e'+k+"\x3c/p\x3e\x3cbr\x3e");jQuery("#dialogVisual").html("");jQuery("#dialogDialog").dialog({autoOpen:!1,title:"Scan",width:a.dialogWidth,modal:!0,height:"auto",
position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{Retry:function(){a.initScan(f)},Cancel:function(){jQuery("#dialogDialog").dialog("close")}}});jQuery("#dialogDialog").dialog("open")};return h};a.ScanDiff=function(f){var h=new g;h.show=function(k){h.results=k;var l=k.diffs.map(function(r){switch(r.action){case "added":return'\x3cli style\x3d"color:green;"\x3e\x3cb\x3e+\x3c/b\x3e '+r.modified.name+" added to the box at position "+r.coordinates+"\x3c/li\x3e";case "removed":return'\x3cli style\x3d"color:red;"\x3e\x3cb\x3e-\x3c/b\x3e '+
r.original.name+" removed from "+r.coordinates+"\x3c/li\x3e";case "changed":return'\x3cli style\x3d"color:orange;"\x3e\x3cb\x3e!\x3c/b\x3e '+r.original.name+" replaced by "+r.modified.name+" at "+r.coordinates+"\x3c/li\x3e";default:return"\x3cli\x3e\x3cb\x3e?\x3c/b\x3e Unknown change at "+(r.coordinates||"unknown position")+"\x3c/li\x3e"}}),p=(0==k.errors.length?"\x3ch1\x3eScan Success! \x3c/h1\x3e":'\x3ch1 class\x3d"warning"\x3eScan Failed!\x3c/h1\x3e')+k.errors.map(function(r){return"\x3cp\x3ePosition "+
r.coordinates+": "+r.message+"\x3c/p\x3e"}).join("")+(0==l.length?"":"\x3cp\x3eBox has changed. See below.\x3c/p\x3e");jQuery("#dialogInfoAbove").html(p);jQuery("#dialogInfoBelow").html('\x3cul style\x3d"list-style-type: none;overflow:hidden; overflow-y:scroll;height:125px;"\x3e'+l.join("")+"\x3c/ul\x3e");jQuery("#dialogDialog").dialog({autoOpen:!1,title:"Scan Results",width:a.dialogWidth,modal:!0,resizable:!1,position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{Save:function(){if(0==k.errors.length||
confirm("Do you want to save changes even though there are scanning errors?"))a.saveContents(k.items,k.emptyPositions),jQuery("#dialogDialog").dialog("close")},Rescan:function(){a.initScan(f)},Cancel:function(){jQuery("#dialogDialog").dialog("close")}}});h.create({div:"#dialogVisual",size:{rows:a.boxJSON.rows,cols:a.boxJSON.cols},data:h.results.items});jQuery("#updateSelected, #removeSelected, #emptySelected").prop("disabled",!0).addClass("disabled");jQuery("#dialogDialog").dialog("open")};h.getBoxPositionOpts=
function(k,l){var p=h.getPositionString(k,l);l=h.results.items.filter(function(w){return w.coordinates==p});k=h.results.diffs.filter(function(w){return w.coordinates==p});var r=h.results.errors.filter(function(w){return w.coordinates==p});0<r.length?(r=r[0].message,k=l="/styles/images/tube_error.png"):0<k.length?(r=(k[0].modified?k[0].modified.alias:"Empty")+" (Previously "+(k[0].original?k[0].original.alias:"Empty")+")",l=k[0].modified?"/styles/images/tube_full_selected_changed.png":"/styles/images/tube_empty_selected_changed.png",
k=k[0].modified?"/styles/images/tube_full_changed.png":"/styles/images/tube_empty_changed.png"):0<l.length?(r=l[0].alias,l="/styles/images/tube_full_selected.png",k="/styles/images/tube_full.png"):(r="Empty",l="/styles/images/tube_empty_selected.png",k="/styles/images/tube_empty.png");return{title:r,selectedImg:l,unselectedImg:k}};return h};a.PrepareScannerDialog=function(f){return{show:function(){jQuery("#dialogInfoAbove").html("\x3ch1\x3ePreparing scanner\x3c/h1\x3e");jQuery("#dialogVisual").html("");
jQuery("#dialogInfoBelow").html('\x3cp\x3ePlease remove box from scanner until prompted.\x3c/p\x3e\x3cimg class\x3d"center" src\x3d"/styles/images/ajax-loader.gif"/\x3e');jQuery("#dialogDialog").dialog({autoOpen:!1,title:"Scan",width:a.dialogWidth,height:"auto",modal:!0,resizable:!1,position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{}});jQuery("#dialogDialog").dialog("open");a.scan.prepareScanner(f,a.boxJSON.rows,a.boxJSON.cols)},error:function(){jQuery("#dialogInfoAbove").html('\x3ch1 class\x3d"warning"\x3eError: could not find the scanner\x3c/h1\x3e');
jQuery("#dialogVisual").html("");jQuery("#dialogInfoBelow").html("\x3cp\x3ePlease ensure that the scanner software is running, and remove the box before retrying.\x3c/p\x3e");jQuery("#dialogDialog").dialog({autoOpen:!0,title:"Scan",width:a.dialogWidth,height:"auto",modal:!0,resizable:!1,position:[jQuery(window).width()/2-a.dialogWidth/2,50],buttons:{Retry:function(){a.initScan(f)},Cancel:function(){jQuery("#dialogDialog").dialog("close")}}});jQuery("#dialogDialog").dialog("open")}}};a.utils={hyperlinkify:function(f,
h){return'\x3ca href\x3d"'+f+'"\x3e'+h+"\x3c/a\x3e"},hyperlinkifyBoxable:function(f,h,k){var l="/";f=f.substring(0,3);return["SAM","LIB","LDI","IPO"].includes(f)?("SAM"==f?l+="sample/":"LIB"==f?l+="library/":"LDI"==f?l+="libraryaliquot/":"IPO"==f&&(l+="pool/"),a.utils.hyperlinkify(l+h,k)):k},getRowLabel:function(f){return String.fromCharCode(64+f)},getColLabel:function(f){return 10<=f?f:"0"+f},getPositionString:function(f,h){return a.utils.getRowLabel(f)+a.utils.getColLabel(h)}}})(window.Box=window.Box||
{},jQuery);
BulkUtils=function(a){function b(y,B){Utils.showDialog("Resume Requisitions","Resume and Continue",[{label:"Resume Date",property:"resumeDate",type:"date",required:!0}],function(C){c(y,C.resumeDate,B)},null,B.reject)}function c(y,B,C){var I=y.map(function(J){return J.id});Utils.saveWithProgressDialog("POST",Urls.rest.requisitions.bulkResume,{requisitionIds:I,resumeDate:B},Urls.rest.requisitions.bulkSaveProgress,function(J){switch(J.status){case "completed":C.resolve();break;case "failed":Utils.asyncSaveErrorsDialog(J,y,
Utils.array.getAlias,C.reject);break;default:Utils.showOkDialog("Error",["Unexpected operation status. The save may still be in progress or completed."],C.reject)}})}function d(y,B,C,I){return{name:B,action:function(J){var H=C.filter(function(K){if(!Constants.isDetailedSample)return function(U){return I?U.index>=Constants.sampleCategories.length:U.index>Constants.sampleCategories.length};var M=Constants.sampleCategories.length-1,R=0;for(sample in K){var Q=Constants.sampleClasses.find(function(U){return U.id==
K[sample].sampleClassId});Q?(Q=Constants.sampleCategories.indexOf(Q.sampleCategory),Q>R&&(R=Q),Q<M&&(M=Q)):"Identity"===K[sample].type?M=1:R=Constants.sampleCategories.length-1}return I?function(U){return U.index<=R||U.index>=Constants.sampleCategories.length}:function(U){return U.index>=M}}(J)).map(function(K){return{name:K.name,handler:function(){Utils.ajaxWithDialog("Searching","POST",y(K.name),J.map(function(M){return M.id}),function(M){var R=K.getBulkActions(K.config).filter(function(U){return!!U}).map(function(U){return{name:U.name,
handler:function(){U.action(M)}}});R.unshift({name:"View Selected",handler:function(){Utils.showOkDialog(K.name+" "+B,M.map(function(U){return U.name+(U.alias?" ("+U.alias+")":"")}),Q)}});var Q=function(){Utils.showWizardDialog(K.name+" Actions",R)};Q()})}}});1==H.length?H[0].handler():Utils.showWizardDialog(B,H)}}}function e(y,B,C){var I=Utils.sorting.standardSort("id");y.getDefaultSortFunction?C.sort(y.getDefaultSortFunction(B)||I):C.sort(I)}function g(y,B,C){var I=document.getElementById(CONTAINER_ID);
y.prepareData&&y.prepareData(C,B);var J=r(),H=y.getColumns(B,J).filter(function(U){return(!U.hasOwnProperty("include")||U.include)&&(!ja||!U.hasOwnProperty("includeSaved")||U.includeSaved)}),K=y.getDescription?y.getDescription(B):null;f(K,H);K=w(C,H,B,J);var M=v(H,C,K,J);E(M,H,C);var R=G(M,H,K),Q=new Handsontable(I,{licenseKey:"non-commercial-and-evaluation",fixedColumnsLeft:y.hasOwnProperty("getFixedColumns")?y.getFixedColumns(B):1,manualColumnResize:!0,rowHeaders:!0,colHeaders:H.map(function(U){return U.title+
(U.required?"*":"")}),viewportColumnRenderingOffset:700,preventOverflow:"horizontal",contextMenu:!1,columns:H.map(h),cell:M,data:K,maxRows:C.length,renderAllRows:!0,cells:function(U,Z,aa){U={};ja&&(U.readOnly=!0);return U}});Q.addHook("beforeAutofill",function(U,Z,aa){t(Q,U,Z,aa)});Q.addHook("afterChange",function(U,Z){var aa=r();n(aa,Q,H,B,C);var ca=[],ba=!0;aa.updateField=function(da,fa,ha){if(ba&&ha.hasOwnProperty("value")&&void 0!==ha.value){var na=F(fa,H);ca.push([da,na,ha.value]);ha=Object.assign({},
ha);ha.value=void 0}m(Q,H,da,fa,ha)};U.forEach(function(da){if(R[da[1]])R[da[1]](da[0],da[3],aa)});ba=!1;ca.length&&Q.setDataAtCell(ca)});Q.addHook("beforePaste",function(U,Z){if(1===Z.length&&U.length&&U[0]&&U[0].length)for(var aa=Z[0].startCol;aa<U[0].length+Z[0].startCol;aa++)if("dropdown"===H[aa].type)for(var ca=Q.getSettings().columns[aa].source,ba=Z[0].startRow;ba<U.length+Z[0].startRow;ba++){var da=Q.getCellMeta(ba,aa).source||ca;if(da&&da.length){var fa=U[ba-Z[0].startRow][aa-Z[0].startCol];
fa=fa.replaceAll(/ +/g," ").trim();if(-1===da.indexOf(fa)){var ha=da.filter(function(na){return na.includes(fa)});1<ha.length&&(ha=da.filter(function(na){return na.startsWith(fa)}));if(1===ha.length){U[ba-Z[0].startRow][aa-Z[0].startCol]=ha[0];continue}}U[ba-Z[0].startRow][aa-Z[0].startCol]=fa}}});Q.validateCells();n(J,Q,H,B,C);ja?ka(y,B,C):(D(Q,y,H,J,B,C),S(Q,y,H,J,B,C))}function f(y,B){a(TARGET_HELP).empty();y&&a(TARGET_HELP).append("\x3cbr\x3e",a("\x3cp\x3e").text(y));a(COLUMN_HELP).empty();B.filter(function(C){return C.description}).forEach(function(C,
I){0===I&&a(COLUMN_HELP).append("\x3cbr\x3e",a("\x3cp\x3e").text("Column Descriptions:"));a(COLUMN_HELP).append(a("\x3cp\x3e").html("\x3cb\x3e"+C.title+"\x3c/b\x3e - "+C.description))})}function h(y){var B={data:y.data,allowEmpty:ja||!y.required,readOnly:y.disabled};switch(y.type){case "text":return B.type="text",B.validator=wa(y),B.renderer=qa.standardText,B;case "int":return B.type="numeric",B.validator=xa(y),B;case "decimal":return B.type="text",B.validator=ua(y),B;case "date":return B.type="date",
B.dateFormat="YYYY-MM-DD",B.datePickerConfig={firstDay:0,numberOfMonths:1},B;case "time":return B.type="time",B.timeFormat="h:mm a",B.correctFormat=!0,B;case "dropdown":var C=[];Array.isArray(y.source)&&(C=k(y.source,y.getItemLabel,y.sortSource));B.type="dropdown";B.source=C;B.trimDropdown=!1;y.validationCache&&(B.validator=ya("boxes"));B.renderer=qa.standardDropdown;return B;default:throw Error("Unknown field type: "+y.type);}}function k(y,B,C){"function"===typeof C&&y.sort(C);y=B?y.map(B):y.slice();
!0===C&&(y=y.sort());return y}function l(y,B,C){var I=B;C.getItemValue&&(I=y.find(function(J){return C.getItemValue(J)===B}));return void 0===I||null===I?null:C.getItemLabel?C.getItemLabel(I):I}function p(y,B,C){return y.find(function(I){return C.getItemLabel?C.getItemLabel(I)===B:I===B})}function r(){return{getCache:function(y){la[y]||(la[y]={});return la[y]},showError:function(y){ma(y)},isSaved:function(){return ja}}}function w(y,B,C,I){for(var J=[],H=0;H<y.length;H++){var K={};B.forEach(function(M){if(!M.data)throw Error("Missing data property for column definition: "+
M.title);var R=null;!M.hasOwnProperty("initial")||ja||!M.initializeOnEdit&&"edit"===C.pageMode||(R=M.initial);if(M.getData)K[M.data]=M.getData(y[H],I)||R;else{var Q=Utils.getObjectField(y[H],M.data);null!==Q&&void 0!==Q?"dropdown"===M.type?Array.isArray(M.source)?K[M.data]=l(M.source,Q,M):K[M.data]=null:K[M.data]=Q:"dropdown"===M.type?null!==R?K[M.data]=R:Array.isArray(M.source)?K[M.data]=l(M.source,null,M):K[M.data]=null:K[M.data]=R}});J.push(K)}return J}function v(y,B,C,I){var J=[];y.forEach(function(H,
K){if("dropdown"===H.type&&"function"===typeof H.source)for(var M=0;M<B.length;M++){var R=H.source(B[M],I),Q=k(R,H.getItemLabel,H.sortSource);J.push({row:M,col:K,source:Q,sourceData:R});C[M][H.data]||(Q=Utils.getObjectField(B[M],H.data),C[M][H.data]=l(R,Q,H))}});return J}function E(y,B,C){B.forEach(function(I,J){if(I.getFormatter)for(var H=0;H<C.length;H++){var K=I.getFormatter(C[H]);q(y,H,J,"format",K);"nonStandardAlias"===K&&a(NON_STANDARD_ALIAS_NOTE).show()}})}function q(y,B,C,I,J){var H=y.find(function(K){return K.row===
B&&K.col===C});H||(H={row:B,col:C},y.push(H));H[I]=J}function t(y,B,C,I){if(2===I.length&&(I=z(I),!a.isEmptyObject(I))){var J=[],H=C.row-B.row+1;C=C.col-B.col+1;for(var K=0;K<C;K++){var M=I[K];if(M)for(var R=M.pattern.match(/{\d+}/g),Q=0;Q<H;Q++){for(var U=M.pattern,Z=0;Z<R.length;Z++){var aa=x(M.secondNumbers[Z],Q+1);U=U.replace(R[Z],aa)}J.push([B.row+Q,B.col+K,U])}}setTimeout(function(){y.setDataAtCell(J)},200)}}function z(y){for(var B=y[0].length,C=0;C<B;C++){var I=[],J=""+y[0][C],H=""+y[1][C],
K=J.match(/\d+/g),M=H.match(/\d+/g);if(K&&M&&K.length===M.length){M=0;for(var R="",Q=!1,U={},Z=0,aa=0;aa<K.length;aa++){var ca=J.indexOf(K[aa],M),ba=ca+K[aa].length,da=x(K[aa],1);if(J.substring(M,ba)===H.substring(M,ba))R+=J.substring(M,ba);else if(H.substring(M,ba)===J.substring(M,ca)+da)R+=J.substring(M,ca)+"{"+Z+"}",Z++,I.push(da),Q=!0;else{Q=!1;break}M=ba}J.substring(M)!==H.substring(M)?Q=!1:R+=J.substring(M);Q&&(U[C]={pattern:R,secondNumbers:I})}}return U}function x(y,B){B=(parseInt(y)+B).toString();
y.startsWith("0")&&(B=B.padStart(y.length,"0"));return B}function F(y,B,C){B=B.findIndex(function(I){return I.data===y});if(-1===B){if(C)return null;throw Error("No column found for data property: "+y);}return B}function n(y,B,C,I,J){y.showError=function(H){ma(H)};y.getRowCount=function(){return B.countRows()};y.getValue=function(H,K){return B.getDataAtRowProp(H,K)};y.getValueObject=function(H,K){var M=F(K,C),R=C[M];if("dropdown"!==R.type)throw Error("Cannot get value object for non-dropdown column: "+
K);M=B.getCellMeta(H,M).sourceData;return(H=B.getDataAtRowProp(H,K))?p(M,H,R):null};y.getSourceData=function(H,K){K=F(K,C);return B.getCellMeta(H,K).sourceData};y.updateField=function(H,K,M){m(B,C,H,K,M)};y.updateData=function(H){B.setDataAtRowProp(H)};y.getData=function(){Y(J,B,C,y);return J};y.rebuildTable=function(H,K){X(B,H,I,K)}}function m(y,B,C,I,J){var H=F(I,B),K=B[H],M=!1;Object.keys(J).forEach(function(R){switch(R){case "value":break;case "source":if("dropdown"!==y.getCellMeta(C,H).type)throw Error("Can't update source of non-dropdown column: "+
I);R=k(J.source,K.getItemLabel,K.sortSource);y.setCellMeta(C,H,"source",R);y.setCellMeta(C,H,"sourceData",J.source);M=!0;break;case "required":y.setCellMeta(C,H,"allowEmpty",!J.required);M=!0;break;case "disabled":y.setCellMeta(C,H,"readOnly",J.disabled);break;case "formatter":y.setCellMeta(C,H,"format",J.formatter);break;case "type":switch(J.type){case "decimal":y.setCellMeta(C,H,"type","text");y.setCellMeta(C,H,"renderer","text");y.setCellMeta(C,H,"editor","text");break;case "dropdown":y.setCellMeta(C,
H,"validator","autocomplete");y.setCellMeta(C,H,"type","dropdown");y.setCellMeta(C,H,"renderer",qa.standardDropdown);y.setCellMeta(C,H,"editor",Handsontable.editors.DropdownEditor);M=!0;break;default:throw Error("Cannot change field type to "+J.type);}break;case "precision":case "scale":if(J.type&&"decimal"!==J.type||!J.type&&"decimal"!==y.getCellMeta(C,H).type)throw Error("Cannot change precision or scale of non-decimal column: "+I);break;default:throw Error("Invalid field update option: "+R);}});
u(J)&&(y.setCellMeta(C,H,"validator",A(J,K)),M=!0);J.hasOwnProperty("value")&&void 0!==J.value?y.setDataAtCell(C,H,J.value):M&&y._validateCells(null,[C],[H])}function u(y){return"decimal"===y.type||y.hasOwnProperty("precision")||y.hasOwnProperty("scale")}function A(y,B){return ua({precision:void 0===y.precision?B.precision:y.precision,scale:void 0===y.scale?B.scale:y.scale,min:B.min,max:B.max})}function G(y,B,C){var I={getCache:function(H){la[H]||(la[H]={});return la[H]},showError:function(H){ma(H)},
getRowCount:function(){return C.length},getValue:function(H,K){return C[H][K]},getValueObject:function(H,K){var M=F(K,B),R=B[M];if("dropdown"!==R.type)throw Error("Cannot get value object for non-dropdown column: "+K);var Q=y.find(function(U){return U.row===H&&U.col===M}).sourceData;return p(Q,C[H][K],R)},getSourceData:function(H,K){var M=F(K,B);return(K=y.find(function(R){return R.row===H&&R.col===M}))&&K.sourceData?K.sourceData:null},updateField:function(H,K,M){var R=F(K,B,ja);if(null!==R){var Q=
B[R];Object.keys(M).forEach(function(U){switch(U){case "value":ja||void 0===M.value||(C[H][K]=M.value);break;case "source":if("dropdown"!==Q.type&&(!M.type||"dropdown"!==M.type))throw Error("Can't update source of non-dropdown field: "+K);U=k(M.source,Q.getItemLabel,Q.sortSource);q(y,H,R,"source",U);q(y,H,R,"sourceData",M.source);break;case "required":q(y,H,R,"allowEmpty",!M.required);break;case "disabled":q(y,H,R,"readOnly",M.disabled);break;case "formatter":q(y,H,R,"format",M.formatter);break;case "type":switch(M.type){case "decimal":q(y,
H,R,"type","text");q(y,H,R,"renderer","text");q(y,H,R,"editor","text");break;case "dropdown":q(y,H,R,"type","dropdown");q(y,H,R,"renderer",qa.standardDropdown);q(y,H,R,"editor",Handsontable.editors.DropdownEditor);q(y,H,R,"validator","autocomplete");break;default:throw Error("Cannot change field type to "+M.type);}break;case "precision":case "scale":if(M.type&&"decimal"!==M.type||!M.type&&"decimal"!==hot.getCellMeta(H,R).type)throw Error("Cannot change precision or scale of non-decimal column: "+
K);break;default:throw Error("Invalid field update option: "+U);}u(M)&&q(y,H,R,"validator",A(M,Q))})}},updateData:function(H){H.forEach(function(K){C[K[0]][K[1]]=K[2]})},isSaved:function(){return ja}},J={};B.forEach(function(H){if(H.onChange){J[H.data]=H.onChange;for(var K=0;K<C.length;K++)if(!1!==H.initOnChange)H.onChange(K,C[K][H.data],I)}});return J}function D(y,B,C,I,J,H){var K=B.getCustomActions?B.getCustomActions(J,I):[];K.push(N(y,B,C,I,J,H),L(y),O(y));a(ACTION_BAR).empty().append(K.map(function(M){return a("\x3ca\x3e").text(M.name).prop("href",
"#").addClass("ui-button ui-state-default").prop("title",M.title||"").click(function(){M.action(I)})}))}function N(y,B,C,I,J,H){return{name:"Sort",action:function(){var K=[],M=function(Z){return function(aa,ca){return aa?ca?Z(aa,ca):-1:ca?1:0}},R=M(function(Z,aa){return Z.localeCompare(aa)});C.filter(function(Z){return!Z.hasOwnProperty("sortable")||Z.sortable}).forEach(function(Z){Z.customSorting?K=K.concat(Z.customSorting.map(function(aa){return{name:aa.name,data:Z.data,sort:M(aa.sort)}})):K.push({name:Z.title,
data:Z.data,sort:R})});var Q=function(Z,aa,ca){return{property:Z,label:aa,type:"select",values:ca?K:[{name:"(None)",sort:null}].concat(K),getLabel:function(ba){return ba.name}}},U=function(Z){return{property:Z,label:"Order",type:"select",values:["Ascending","Descending"]}};Utils.showDialog("Sort Table","Sort",[Q("option1","Primary Sort",!0),U("order1"),Q("option2","Secondary Sort",!1),U("order2"),Q("option3","Tertiary Sort",!1),U("order3")],function(Z){Y(H,y,C,I);var aa=H.map(function(ca,ba){return{data:ca,
index:ba}}).sort(function(ca,ba){var da=function(fa,ha){if(!fa.sort)return 0;var na=y.getDataAtRowProp(ca.index,fa.data),za=y.getDataAtRowProp(ba.index,fa.data);fa=fa.sort(na,za);"Descending"===ha&&(fa*=-1);return fa};return da(Z.option1,Z.order1)||da(Z.option2,Z.order2)||da(Z.option3,Z.order3)}).map(function(ca){return ca.data});Utils.showWorkingDialog("Sorting",function(){X(y,B,J,aa)})})}}}function L(y){return{name:"Import",action:function(){var B=function(){var C=a("#dialog");C.empty();var I=jQuery('\x3cform id\x3d"uploadForm"\x3e');
I.append(jQuery('\x3cp\x3e\x3cinput id\x3d"fileInput" type\x3d"file" name\x3d"file"\x3e\x3c/p\x3e'));C.append(I);var J=C.dialog({autoOpen:!0,width:500,title:"Import Spreadsheet",modal:!0,buttons:{upload:{id:"upload",text:"Import",click:function(){if(a("#fileInput").val()){var H=new FormData(a("#uploadForm")[0]);J.dialog("close");C.empty();C.append(a("\x3cp\x3eUploading...\x3c/p\x3e"));J=a("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Uploading File",modal:!0,buttons:{},closeOnEscape:!1,
open:function(K,M){a(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});jQuery.ajax({url:Urls.rest.hot.bulkImport,type:"POST",data:H,cache:!1,contentType:!1,processData:!1}).done(function(K){J.dialog("close");Utils.showWorkingDialog("Import",function(){var M=y.getColHeader(),R=[],Q=0;K.forEach(function(aa){-1===M.indexOf(aa.heading)&&R.push(aa.heading);aa.data.length>Q&&(Q=aa.data.length)});if(R.length)return Utils.showOkDialog("Error",["The following spreadsheet columns do not match any table columns:"].concat(R.map(function(aa){return"* "+
aa}))),!0;if(Q>y.countRows())return Utils.showOkDialog("Error",["The spreadsheet contains "+Q+" rows, but the table only contains "+y.countRows()]),!0;var U=[];K.forEach(function(aa){for(var ca=M.indexOf(aa.heading),ba=0;ba<aa.data.length;ba++)U.push([ba,ca,aa.data[ba]])});var Z=function(aa){y.setDataAtCell(U,"CopyPaste.paste");0<--aa?setTimeout(function(){Z(aa)},500):J.dialog("close")};Z(3);return!0})}).fail(function(K,M,R){J.dialog("close");Utils.showAjaxErrorDialog(K,M,R)})}else Utils.showOkDialog("Error",
["No file selected!"],B)}},cancel:{id:"cancel",text:"Cancel",click:function(){J.dialog("close")}}}})};B()}}}function O(y){return{name:"Export",action:function(){for(var B={headers:y.getColHeader(),rows:[]},C=0;C<y.countRows();C++)B.rows.push(y.getDataAtRow(C));Utils.showDialog("Export Data","Export",[{property:"format",type:"select",label:"Format",values:Constants.spreadsheetFormats,getLabel:function(I){return I.description}}],function(I){Utils.ajaxDownloadWithDialog(Urls.rest.hot.bulkExport+"?"+
Utils.page.param({format:I.format.name}),B)})}}}function S(y,B,C,I,J,H){a(SAVE).click(function(){W(!0,!1);pa();y.validateCells(function(K){K?(Y(H,y,C,I),a.when(B.confirmSave?B.confirmSave(H,J,I):null).then(function(){V(y,B,C,J,H)}).fail(function(M){M||(ma("Save cancelled"),W(!1,!0))})):(K=T(y,C),ra("Please fix highlighted cells. See the Quick Help section (above) for additional information regarding specific fields.",K,y,C),W(!1,!0))})})}function T(y,B){errors=[];y.getCellsMeta().filter(function(C){return C.hasOwnProperty("valid")&&
!C.valid}).forEach(function(C){var I=errors.find(function(H){return H.row===C.row});I||(I={row:C.row,fields:[]},errors.push(I));var J=B.find(function(H){return H.data===C.prop});I.fields.push({field:C.prop,errors:[P(y.getDataAtCell(C.row,C.col),C,J)]})});return errors}function P(y,B,C){return C?Utils.validation.isEmpty(y)?!1===B.allowEmpty?"This field is required":"Unknown error - field empty and not required":B.validator&&(message=B.validator(y,function(){}))?message:"This field is invalid":"Unknown error - failed to determine requirements"}
function V(y,B,C,I,J){var H=a("#dialog");H.empty();H.append(a("\x3cp\x3e").text("Processed ").append(a("\x3cspan\x3e").attr("id","dialogProgressText").text("0/"+J.length)));H.append(Utils.ui.makeProgressBar("dialogProgressBar"));var K=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Saving",modal:!0,buttons:{},closeOnEscape:!1,open:function(M,R){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});jQuery.ajax({dataType:"json",type:"edit"===I.pageMode?"PUT":
"POST",url:B.getSaveUrl(I),data:null==J?void 0:JSON.stringify(J),contentType:"application/json; charset\x3dutf8"}).done(function(M){var R=function(Q){a("#dialogProgressText").text(Q.completedUnits+"/"+Q.totalUnits);Utils.ui.setProgressBarProgress("dialogProgressBar",100*Q.completedUnits/Q.totalUnits);switch(Q.status){case "running":window.setTimeout(function(){a.ajax({dataType:"json",type:"GET",url:B.getSaveProgressUrl(Q.operationId),contentType:"application/json; charset\x3dutf8"}).done(function(Z){R(Z)}).fail(function(Z,
aa,ca){ea(Z,y,C,"Failed to verify save status - operation may still be in progress or completed.");W(!1,!1);K.dialog("close")})},2E3);break;case "completed":ja=!0;var U=B.manipulateSavedData?B.manipulateSavedData(Q.data):Q.data;e(B,I,U);X(y,B,I,U);oa("Saved "+Q.totalUnits+" items");W(!1,!1);K.dialog("close");break;case "failed":ia(Q,y,C);W(!1,!0);K.dialog("close");break;default:throw ma("Something went terribly wrong. Please file a ticket with a screenshot or copy-paste of the data that you were trying to save."),
W(!1,!1),K.dialog("close"),Error("Unexpected operation status: "+Q.status);}};R(M)}).fail(function(M,R,Q){ea(M,y,C);W(!1,!0);K.dialog("close")})}function W(y,B){Utils.ui.setDisabled(SAVE,y||!1===B);y?a(LOADER).removeClass("hidden"):a(LOADER).addClass("hidden")}function Y(y,B,C,I){for(var J=B.getData(),H=0;H<J.length;H++)for(var K=0;K<C.length;K++){"string"===typeof J[H][K]&&(J[H][K]=J[H][K].trim());var M=C[K];if(!M.omit)if(null===J[H][K]||void 0===J[H][K]||""===J[H][K])Utils.setObjectField(y[H],M.data,
null);else{var R=B.getCellMeta(H,K),Q=J[H][K];if("dropdown"===R.type)if(M.validationCache){R=M.validationCache;Q=J[H][K];var U=la[R];if(!U)throw Error('Cache "'+R+'" does not exist');if(U[Q])Q=U[Q];else throw Error('Label "'+Q+'" not found in cache "'+R+'"');}else if(Q=B.getCellMeta(H,K).sourceData,Q&&Q.length||!Array.isArray(M.source)||(Q=M.source),U=J[H][K],R=M,null===U||""===U)Q=null;else{Q=p(Q,U,R);if(void 0===Q)throw Error("No matching item found in source");Q=R.getItemValue?R.getItemValue(Q):
Q}M.setData?M.setData(y[H],Q,H,I):Utils.setObjectField(y[H],M.data,Q)}}}function X(y,B,C,I){pa();a(ACTION_BAR).empty();a(SAVE).off("click");y.destroy();g(B,C,I)}function ka(y,B,C){var I=a(ACTION_BAR);I.empty();y.getBulkActions&&I.append(y.getBulkActions(B).map(function(J){return a("\x3ca\x3e").text(J.name).prop("href","#").addClass("ui-button ui-state-default").prop("title",J.title||"").click(function(){J.action(C)})}))}function oa(y){pa();a(SUCCESS_MESSAGE).text(y);a(SUCCESS_CONTAINER).removeClass("hidden")}
function ea(y,B,C,I){var J=null;y&&y.responseText&&(J=JSON.parse(y.responseText));J&&J.detail?"bulk validation"===J.dataFormat?ra(J.detail,J.data,B,C):(!I&&J.data&&(I=J.data.uiHelp),ma(J.detail,I)):ma("Something went terribly wrong. Please file a ticket with a screenshot or copy-paste of the data that you were trying to save.",I)}function ia(y,B,C){if("failed"!==y.status)throw Error("Update is not failure");y.data?ra(y.detail,y.data,B,C):y.detail?ma(y.detail):ma("Something went terribly wrong. Please file a ticket with a screenshot or copy-paste of the data that you were trying to save.")}
function ma(y,B){pa();a(ERRORS_BOX).append(a("\x3cp\x3e").text(y));B&&a(ERRORS_BOX).append(a("\x3cp\x3e").text(B));a(ERRORS_CONTAINER).removeClass("hidden")}function ra(y,B,C,I){pa();a(ERRORS_BOX).append(a("\x3cp\x3e").text(y));var J=a("\x3cul\x3e");B.forEach(function(H){J.append(a("\x3cli\x3e").text("Row "+(H.row+1)));H.fields.forEach(function(K){var M=a("\x3cul\x3e"),R=-1;"GENERAL"!==K.field&&(R=I.findIndex(function(Q){return Q.data===K.field}));-1!==R?(C.setCellMeta(H.row,R,"valid",!1),K.errors.forEach(function(Q){M.append(a("\x3cli\x3e").text(I[R].title+
": "+Q))})):K.errors.forEach(function(Q){M.append(a("\x3cli\x3e").text(("GENERAL"===K.field?"":K.field+": ")+Q))});J.append(M)})});C.render();a(ERRORS_BOX).append(J);a(ERRORS_CONTAINER).removeClass("hidden")}function pa(){a(SUCCESS_CONTAINER).addClass("hidden");a(ERRORS_CONTAINER).addClass("hidden");a(SUCCESS_MESSAGE).empty();a(ERRORS_BOX).empty()}function wa(y){var B=new RegExp(Utils.validation.sanitizeRegex);return function(C,I){if(Utils.validation.isEmpty(C))return sa(this,I);if(y.maxLength&&C.length>
y.maxLength)return I(!1),"Max length is "+y.maxLength+" characters";if(y.regex){if(!(new RegExp(y.regex)).test(C))return I(!1),"Does not match expected pattern"}else if(!B.test(C))return I(!1),"Cannot contain tabs, line breaks, or the following characters: \x3c\x3e\x26";I(!0);return null}}function sa(y,B){if(y.instance.getCellMeta(y.row,y.col).allowEmpty)return B(!0),null;B(!1);return"This field is required"}function ua(y){var B=void 0===y.precision?21:y.precision,C=void 0===y.scale?17:y.scale,I=
Math.pow(10,B-C)-Math.pow(.1,C),J=void 0===y.min?-1*I:y.min;I=void 0===y.max?I:y.max;y="^-?\\d{0,"+(B-C)+"}";0<C&&(y+="(?:\\.\\d{1,"+C+"})?");var H=new RegExp(y+"$");return function(K,M){if(Utils.validation.isEmpty(K))return sa(this,M);if(Handsontable.helper.isNumeric(K)){if(!H.test(K)||K<J||K>I)return M(!1),"Must be between "+J+" and "+I;M(!0);return null}M(!1);return"Must be a decimal number"}}function xa(y){return function(B,C){if(Utils.validation.isEmpty(B))return sa(this,C);if(Aa.test(B)){if(y.hasOwnProperty("min")&&
B<y.min)return C(!1),"Must be at least "+y.min;if(y.hasOwnProperty("max")&&B>y.max)return C(!1),"Must be no greater than "+y.max;C(!0);return null}C(!1);return"Must be an integer"}}function ya(y){return function(B,C){B&&la[y]?C(!!la[y][B]):Handsontable.validators.AutocompleteValidator.call(this,B,C)}}function ta(y,B,C){var I=y[B.alias];I||(B.emptyPositions=Utils.getEmptyBoxPositions(B),I=y[B.alias]=B);C&&-1===I.emptyPositions.indexOf(C)&&(I.emptyPositions.push(C),I.emptyPositions.sort())}function va(y,
B){for(var C=y.getRowCount(),I=[],J=y.getCache("boxes"),H=0;H<C;H++){var K=y.getValue(H,"box");if(K){I[K]=I[K]||J[K].emptyPositions.slice();var M=y.getValue(H,"boxPosition");M&&(I[K]=I[K].filter(function(Q){return Q!==M}))}}for(var R in I)I[R].sort(B);B=[];for(H=0;H<C;H++)(K=y.getValue(H,"box"))&&!y.getValue(H,"boxPosition")&&(J=I[K])&&0<J.length&&(M=J.shift(),B.push([H,"boxPosition",M]),I[K]=J.filter(function(Q){return Q!==M}));B.length&&y.updateData(B)}CONTAINER_ID="hotContainer";SAVE="#save";LOADER=
"#ajaxLoader";SUCCESS_CONTAINER="#successes";SUCCESS_MESSAGE="#successMessage";ERRORS_CONTAINER="#errorsContainer";ERRORS_BOX="#errors";ACTION_BAR="#bulkactions";TARGET_HELP="#hotTargetHelp";COLUMN_HELP="#hotColumnHelp";NON_STANDARD_ALIAS_NOTE="#nonStandardAliasNote";var Aa=RegExp("^-?\\d+$"),la={},ja=!1,qa={standardText:function(y,B,C,I,J,H,K){Handsontable.renderers.TextRenderer.apply(this,arguments);K.format&&B.classList.add(K.format);return B},standardDropdown:function(y,B,C,I,J,H,K){Handsontable.renderers.AutocompleteRenderer.apply(this,
arguments);K.format&&B.classList.add(K.format);return B}};return{makeTable:function(y,B,C){Utils.showWorkingDialog("Bulk Table",function(){e(y,B,C);g(y,B,C);W(!1,!0)})},checkPausedRequisitions:function(y,B){(y=y.filter(function(C){return C.requisitionId}).map(function(C){return C.requisitionId}).filter(function(C,I,J){return J.indexOf(C)===I}))?a.ajax({url:Urls.rest.requisitions.searchPausedByIds,data:JSON.stringify(y),contentType:"application/json; charset\x3dutf8",dataType:"json",type:"POST"}).done(function(C){if(C&&
C.length){var I=C.map(function(J){return"* "+J.alias});I.unshift("The following affected requisitions are currently paused. Do you wish to resume them all now?");Utils.showConfirmDialog("Resume Requisitions","Yes",I,function(){b(C,B)},B.resolve,"No")}else B.resolve()}).fail(function(C,I,J){C=JSON.parse(C.responseText);Utils.showOkDialog("Error",["Failed looking up requisitions:",C.detail]);B.reject()}):B.resolve()},updateProjectAssays:function(y,B,C){y=y.assayIds.map(function(I){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(I),
Constants.assays)}).filter(function(I){return!I.archived});B.updateField(C,"requisitionAssayIds",{source:y,disabled:!1})},columns:{name:{title:"Name",type:"text",data:"name",disabled:!0},simpleAlias:function(y){return{title:"Alias",type:"text",data:"alias",required:!0,maxLength:y}},generatedAlias:function(y){return{title:"Alias",type:"text",data:"alias",required:"edit"===y.pageMode,maxLength:100,getFormatter:function(B){return B.nonStandardAlias?"nonStandardAlias":null}}},receipt:function(y){return[{title:"Date of Receipt",
type:"date",data:"receivedDate",includeSaved:!1,getData:function(B){return B.receivedTime?B.receivedTime.split(" ")[0]:null},setData:function(B,C,I,J){B.receivedTime=C?C+" "+Utils.formatTwentyFourHourTime(J.getValue(I,"receivedTime")):null},initial:Utils.getCurrentDate(),onChange:function(B,C,I){var J=function(H,K){var M={disabled:!C,required:!!C};C?K&&!I.getValue(B,H)&&(M.value=K):M.value=null;I.updateField(B,H,M)};J("receivedTime",Utils.getCurrentTime());J("senderLabId");J("recipientGroupId",1===
y.recipientGroups.length?y.recipientGroups[0].name:null);J("received","True");J("receiptQcPassed","True");J={disabled:!C};C||(J.value=null);I.updateField(B,"receiptQcNote",J)}},{title:"Time of Receipt",type:"time",data:"receivedTime",includeSaved:!1,getData:function(B){return B.receivedTime?Utils.formatTwelveHourTime(B.receivedTime.split(" ")[1]):null},setData:function(B,C,I,J){},initial:Utils.getCurrentTime()},{title:"Received From",type:"dropdown",data:"senderLabId",includeSaved:!1,source:Constants.labs.filter(function(B){return!B.archived}),
getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0},{title:"Received By",type:"dropdown",data:"recipientGroupId",includeSaved:!1,source:y.recipientGroups,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,initial:1===y.recipientGroups.length?y.recipientGroups[0].name:null},{title:"Receipt Confirmed",type:"dropdown",data:"received",includeSaved:!1,source:[{label:"Unknown",value:null},{label:"True",value:!0},{label:"False",value:!1}],initial:"True",getItemLabel:function(B){return B.label},
getItemValue:function(B){return B.value}},{title:"Receipt QC Passed",type:"dropdown",data:"receiptQcPassed",includeSaved:!1,source:[{label:"Unknown",value:null},{label:"True",value:!0},{label:"False",value:!1}],initial:"True",getItemLabel:function(B){return B.label},getItemValue:function(B){return B.value},onChange:function(B,C,I){I.updateField(B,"receiptQcNote",{required:"False"===C})}},{title:"Receipt QC Note",type:"text",data:"receiptQcNote",includeSaved:!1}]},description:{title:"Description",
type:"text",data:"description",maxLength:255},matrixBarcode:{title:"Matrix Barcode",type:"text",data:"identificationBarcode",include:!Constants.automaticBarcodes,maxLength:255},boxable:function(y,B){y.box&&(B=B.getCache("boxes"),ta(B,y.box));return[BulkUtils.columns.matrixBarcode,{title:"Box Search",type:"text",data:"boxSearch",includeSaved:!1,omit:!0,sortable:!1,onChange:function(C,I,J){if(I){var H=function(R){if(R.length)if(1===R.length)var Q=R[0].alias;else for(Q="SELECT";0<R.length;){if(R[0].name.toLowerCase()===
M||R[0].alias.toLowerCase()==M||R[0].identificationBarcode&&R[0].identificationBarcode.toLowerCase())Q=R[0].alias;break}else Q=null;J.updateField(C,"box",{source:R,value:Q})},K=J.getCache("boxSearches"),M=I.toLowerCase();K[M]?H(K[M]):(J.updateField(C,"box",{source:[],value:"(searching...)"}),a.ajax({url:Urls.rest.boxes.searchPartial+"?"+Utils.page.param({q:I,b:!1}),dataType:"json"}).done(function(R){K[M]=R;var Q=J.getCache("boxes");R.forEach(function(U){ta(Q,U)});H(R)}).fail(function(R,Q,U){J.showError("Box search failed")}))}}},
{title:"Box Alias",type:"dropdown",data:"box",source:function(C,I){return C.box?(I=I.getCache("boxes"),ta(I,C.box,C.boxPosition),[C.box]):[]},validationCache:"boxes",getItemLabel:Utils.array.getAlias,onChange:function(C,I,J){if(I&&(I=J.getCache("boxes")[I])){J.updateField(C,"boxPosition",{source:I.emptyPositions,required:!0,disabled:!1});return}J.updateField(C,"boxPosition",{source:[],value:null,required:!1,disabled:!0})},initial:y.box?y.box.alias:null},{title:"Position",type:"dropdown",data:"boxPosition",
source:[],customSorting:[{name:"Position (by rows)",sort:function(C,I){return Utils.sorting.sortBoxPositions(C,I,!0)}},{name:"Position (by columns)",sort:function(C,I){return Utils.sorting.sortBoxPositions(C,I,!1)}}]},{title:"Discarded",type:"dropdown",data:"discarded",required:!0,source:[{label:"False",value:!1},{label:"True",value:!0}],getItemLabel:function(C){return C.label},getItemValue:function(C){return C.value},initial:"False",onChange:function(C,I,J){if(I){var H={disabled:"True"===I};"True"===
I&&(J.updateField(C,"boxPosition",{value:null}),H.value=null);J.updateField(C,"box",H)}}}]},groupId:function(y,B){var C=[],I={title:"Group ID",type:"text",data:"groupId",include:Constants.isDetailedSample,maxLength:100,regex:Utils.validation.alphanumRegex};y&&(C.push({title:"Effective Group ID",type:"text",data:"effectiveGroupId",disabled:!0,include:Constants.isDetailedSample}),I.onChange=function(J,H,K){K.updateField(J,"effectiveGroupId",{value:H||B(J)})});C.push(I,{title:"Group Desc.",type:"text",
data:"groupDescription",include:Constants.isDetailedSample,maxLength:255});return C},creationDate:function(y,B,C,I){return{title:"Creation Date",type:"date",data:"creationDate",description:"The date that the "+I+" was created in lab",include:y,required:B,initial:C?Utils.getCurrentDate():null}},concentration:function(){return[{title:"Conc.",type:"decimal",data:"concentration",precision:14,scale:10,min:0},{title:"Conc. Units",type:"dropdown",data:"concentrationUnits",source:Constants.concentrationUnits,
getItemLabel:function(y){return Utils.decodeHtmlString(y.units)},getItemValue:Utils.array.getName,required:!0,initial:"ng/\u00b5L",initializeOnEdit:!0}]},volume:function(y,B){var C=[{title:"Volume",type:"decimal",data:"volume",precision:16,scale:10},{title:"Vol. Units",type:"dropdown",data:"volumeUnits",source:Constants.volumeUnits,getItemLabel:function(I){return Utils.decodeHtmlString(I.units)},getItemValue:Utils.array.getName,required:!0,initial:"\u00b5L",initializeOnEdit:!0}];y&&C.unshift({title:"Initial Volume",
type:"decimal",data:"initialVolume",include:"edit"===B.pageMode,precision:16,scale:10,onChange:function(I,J,H){"edit"===B.pageMode&&H.updateField(I,"volume",{required:J})}});return C},parentUsed:[{title:"Parent ng Used",type:"decimal",data:"ngUsed",precision:14,scale:10,min:0},{title:"Parent Vol. Used",type:"decimal",data:"volumeUsed",precision:16,scale:10,min:0}],detailedQcStatus:function(){return[{title:"QC Status",type:"dropdown",data:"detailedQcStatusId",required:!0,source:function(y,B){return[{id:null,
description:"Not Ready"}].concat(Constants.detailedQcStatuses.filter(function(C){return!C.archived||C.id===y.detailedQcStatusId}))},sortSource:Utils.sorting.detailedQcStatusSort,getItemLabel:Utils.array.get("description"),getItemValue:Utils.array.getId,initial:" ",onChange:function(y,B,C){var I=Constants.detailedQcStatuses.find(function(J){return J.description===B});C.updateField(y,"detailedQcStatusNote",{required:I&&I.noteRequired})}},{title:"QC Note",type:"text",data:"detailedQcStatusNote"}]},dnaSize:{title:"Size (bp)",
type:"int",data:"dnaSize",min:1,max:1E7},archived:function(){return{title:"Archived",type:"dropdown",data:"archived",source:[{label:"True",value:!0},{label:"False",value:!1}],initial:"False",getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),required:!0}},sop:function(y,B){return{title:"SOP",type:"dropdown",data:"sopId",include:y&&y.length,source:function(C){return y.filter(function(I){return!I.archived||C.sopId===I.id})},sortSource:Utils.sorting.standardSort("alias"),getItemLabel:function(C){return C.alias+
" v."+C.version},getItemValue:Utils.array.getId,required:!!B}},requisition:function(y){return[{title:"Requisition Alias",data:"requisitionAlias",type:"text",maxLength:150,description:"Should usually match the ID of a requisition form stored in a separate system. Enter an alias to search for existing requisitions.",onChange:function(B,C,I){C?(I.updateField(B,"requisitionId",{source:[],value:"(searching...)",formatter:null,disabled:!0}),a.ajax({url:Urls.rest.requisitions.search+"?"+Utils.page.param({q:C}),
contentType:"application/json; charset\x3dutf8",type:"GET"}).done(function(J){var H=null;J.some(function(K){return K.alias===C})?H=C:(J.unshift({id:0,alias:"Create New"}),H="Create New");I.updateField(B,"requisitionId",{source:J,value:H,formatter:1<J.length?"multipleOptions":null,disabled:!1})}).fail(function(J,H,K){J=JSON.parse(J.responseText);I.showError(J.detail)})):I.updateField(B,"requisitionId",{source:[],value:null,formatter:null,disabled:!0})}},{title:"Requisition",type:"dropdown",data:"requisitionId",
includeSaved:!1,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,disabled:!0,onChange:function(B,C,I){C=I.getValueObject(B,"requisitionId");var J=I.getValueObject(B,y);C&&C.id?(J=null,C.assayIds&&C.assayIds.length&&(J=C.assayIds.map(function(H){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(H),Constants.assays)})),I.updateField(B,"requisitionAssayIds",{source:J&&J.length?1===J.length?J:[J]:[],value:J&&J.length?1===J.length?Assay.utils.makeLabel(J[0]):"("+J.length+" assays)":
null,disabled:!0})):C&&J&&null!==J.assayIds?BulkUtils.updateProjectAssays(J,I,B):I.updateField(B,"requisitionAssayIds",{source:[],value:null,disabled:!0})}}]},assay:function(y){return{title:"Assay",data:"requisitionAssayIds",getData:function(B,C){return B.requisitionAssayIds&&B.requisitionAssayIds.length?1===B.requisitionAssayIds.length?(B=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(B.requisitionAssayIds[0]),Constants.assays),Assay.utils.makeLabel(B)):"("+B.requisitionAssayIds.length+" assays)":
null},omit:"create"!==y,type:"create"===y?"dropdown":"text",description:"The assay assigned to the requisition that the item belongs to. For receipt, the options are limited to the assays assigned to the project. Additional assays may be added on the Edit Requisition page.",source:function(B,C){if(!B.requisitionAssayIds||!B.requisitionAssayIds.length)return[];B=B.requisitionAssayIds.map(function(I){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(I),Constants.assays)});return 1===B.length?
B:[B]},getItemLabel:function(B){return Array.isArray(B)?1===B.length?Assay.utils.makeLabel(B[0]):"("+B.length+" assays)":Assay.utils.makeLabel(B)},getItemValue:function(B){return Array.isArray(B)?B.map(Utils.array.getId):[B.id]},disabled:!0}},makeBoolean:function(y,B,C,I){source=[{label:"True",value:!0},{label:"False",value:!1}];C||source.push({label:"Unknown",value:null});return{title:y,type:"dropdown",data:B,source:source,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),
required:!!C,include:!!I}}},actions:{boxable:function(y,B){var C=[{name:"Fill Boxes by Row",action:function(I){va(I,function(J,H){return Utils.sorting.sortBoxPositions(J,H,!0)})}},{name:"Fill Boxes by Column",action:function(I){va(I,function(J,H){return Utils.sorting.sortBoxPositions(J,H,!1)})}}];y&&B&&Object.keys(B).length&&C.push({name:"Match Parent Positions",action:function(I){for(var J=[],H=!1,K=0;K<I.getRowCount();K++)B[K]&&(I.getValue(K,"box")?J.push([K,"boxPosition",B[K]]):H=!0);J.length&&
I.updateData(J);H&&(I=[],J.length&&I.push("Only some of the box positions were matched."),I.push("You must choose a box before the position can be set."),Utils.showOkDialog("Warning",I))}});return C},edit:function(y){return{name:"Edit",action:function(B){Utils.page.post(y,{ids:B.map(Utils.array.getId).join(",")})}}},qc:function(y){return[{name:"Add QCs",action:function(B){Utils.showDialog("Add QCs","Add",[{property:"copies",type:"int",label:"QCs per "+y,value:1},{property:"controls",type:"int",label:"Controls per QC",
value:1}],function(C){!Number.isInteger(C.copies)||1>C.copies?Utils.showOkDialog("Error",["Invalid number of QCs entered"]):!Number.isInteger(C.controls)||0>C.controls?Utils.showOkDialog("Error",["Invalid number of controls entered"]):Utils.page.post(Urls.ui.qcs.bulkAddFrom(y),{entityIds:B.map(Utils.array.getId).join(","),copies:C.copies,controls:C.controls})})}},{name:"Edit QCs",action:function(B){Utils.showDialog("Edit QCs","Edit",[{property:"controls",type:"int",label:"Add controls per QC",value:0}],
function(C){!Number.isInteger(C.controls)||0>C.controls?Utils.showOkDialog("Error",["Invalid number of controls entered"]):Utils.page.post(Urls.ui.qcs.bulkEditFrom(y),{entityIds:B.map(Utils.array.getId).join(","),addControls:C.controls})})}}]},showDialogForBoxCreation:function(y,B,C,I,J,H){C.push(ListUtils.createBoxField);Utils.showDialog(y,B,C,function(K){var M=J(K);if(null!=M){var R=H(K);!R||1>R?Utils.showOkDialog("Error",["Quantity must be 1 or greater"]):K.createBox?Utils.createBoxDialog(K,H,
function(Q){M.boxId=Q.id;Utils.page.post(I,M)}):Utils.page.post(I,M)}})},transfer:function(y){return{name:"Transfer",action:function(B){var C={};C[y]=B.map(Utils.array.getId).join(",");Utils.page.post(Urls.ui.transfers.create,C)}}},viewMetrics:function(y,B,C,I){var J=function(U){var Z=function(aa){if(1<B.length){var ca=B.map(function(ba){return{name:Utils.array.findUniqueOrThrow(function(da){return da.value===ba},Constants.metricCategories).label,handler:function(){Assay.utils.showMetrics(aa,ba)}}});
Utils.showWizardDialog("View Metrics",ca,C)}else Assay.utils.showMetrics(aa,B[0])};1<U.length?(U=U.map(function(aa){return{name:Assay.utils.makeLabel(aa),handler:function(){Z(aa)}}}),Utils.showWizardDialog("View Metrics",U,"Multiple assays found:")):Z(U[0])},H=[],K=[],M=0;if("create"===I){I=y.getRowCount();for(var R=0;R<I;R++){var Q=y.getValueObject(R,"requisitionAssayIds");Q?-1===H.indexOf(Q.id)&&(H.push(Q.id),K.push(Q)):M++}}else y.getData().forEach(function(U){U.requisitionAssayIds&&U.requisitionAssayIds.length?
U.requisitionAssayIds.forEach(function(Z){-1===H.indexOf(Z)&&(H.push(Z),K.push(Utils.array.findUniqueOrThrow(Utils.array.idPredicate(Z),Constants.assays)))}):M++});K.length?0<M?Utils.showConfirmDialog("Warning","Continue",[M+" items have no assay assigned"],function(){J(K)}):J(K):Utils.showOkDialog("Error",["No assays assigned"])},print:function(y){return{name:"Print Barcode(s)",action:function(B){Utils.printDialog(y,B.map(Utils.array.getId))},allowOnLibraryPage:!0}},download:function(y,B,C,I){return{name:I||
"Download",action:function(J){Utils.showDialog("Download Spreadsheet","Download",[{property:"sheet",type:"select",label:"Type",values:B,getLabel:function(H){return H.description}},{property:"format",type:"select",label:"Format",values:Constants.spreadsheetFormats,getLabel:function(H){return H.description}}],function(H){var K=C?C(J,H):[];1<=K.length?Utils.showOkDialog("Error",K):Utils.ajaxDownloadWithDialog(y,{ids:J.map(Utils.array.getId),format:H.format.name,sheet:H.sheet.name})})},allowOnLibraryPage:!0}},
parents:function(y,B){return d(y,"Parents",B,!0)},children:function(y,B){return d(y,"Children",B,!1)},addToWorkset:function(y,B,C){return{name:"Add to Workset",action:function(I){var J=function(K,M){Utils.showWizardDialog("Add to Workset",[{name:"Edit Workset",handler:function(){window.location=Urls.ui.worksets.edit(M.id)}},{name:"Edit in New Tab",handler:function(){window.open(Urls.ui.worksets.edit(M.id))}},{name:"Copy Link",handler:function(){Utils.copyText(Utils.page.getBaseUrl()+Urls.ui.worksets.edit(M.id));
Utils.showOkDialog("Add to Workset",["Workset URL copied to clipboard"])}}],"The selected "+K+" have been added to workset '"+M.alias+"'.","Close")},H=I.map(Utils.array.getId);Utils.showWizardDialog("Add to Workset",[{name:"Existing Workset",handler:function(){var K=function(){Utils.showDialog("Add to Existing Workset","Search",[{label:"Workset search",property:"query",type:"text",required:!0}],function(M){Utils.ajaxWithDialog("Finding Worksets","GET",Urls.rest.worksets.query+"?"+Utils.page.param({q:M.query}),
null,function(R){var Q=[];R&&R.length?R.forEach(function(U){Q.push({name:U.alias,handler:function(){Utils.ajaxWithDialog("Adding to Workset","POST",C(U.id),H,function(){J(y,U)})}});Utils.showWizardDialog("Add to Existing Workset",Q)}):Utils.showOkDialog("Workset Search",["No matching worksets found."],K)})})};K()}},{name:"New Workset",handler:function(){var K={};K[B]=H;FormUtils.createFormDialog("New Workset",K,"workset",{},function(M){J(y,M)})}}])}}},removeFromWorkset:function(y,B){return{name:"Remove from Workset",
action:function(C){Utils.showConfirmDialog("Remove "+y,"Remove",["Remove these "+C.length+" "+y+" from the workset?"],function(){var I=C.map(Utils.array.getId);Utils.ajaxWithDialog("Removing "+y,"DELETE",B,I,function(){Utils.showOkDialog("Removed",[C.length+" "+y+" removed."],function(){Utils.page.pageReload()})})})}}},moveFromWorkset:function(y,B){return{name:"Move to Workset",action:function(C){var I=function(){Utils.showDialog("Move to Workset","Search",[{label:"Workset search",property:"query",
type:"text",required:!0}],function(J){Utils.ajaxWithDialog("Finding Worksets","GET",Urls.rest.worksets.query+"?"+Utils.page.param({q:J.query}),null,function(H){H&&H.length?Utils.showWizardDialog("Move to Workset",H.map(function(K){return{name:K.alias,handler:function(){var M={targetWorksetId:K.id,itemIds:C.map(Utils.array.getId)};Utils.ajaxWithDialog("Moving items","POST",B,M,function(){Utils.showOkDialog("Items moved",["The selected "+y+" have been moved to workset '"+K.alias+"'."],Utils.page.pageReload)})}}})):
Utils.showOkDialog("Workset Search",["No matching worksets found."],I)})})};I()}}},attachFile:function(y,B){return{name:"Attach Files",action:function(C){var I=C.map(Utils.array.getId).join(","),J=Utils.array.deduplicateNumeric(C.map(B));1<J.length?ListTarget.attachment.showUploadDialog(y,"shared",!1,I):Utils.showWizardDialog("Attach Files",[{name:"Upload New Files",handler:function(){ListTarget.attachment.showUploadDialog(y,"shared",!1,I)}},{name:"Link Project File",handler:function(){ListTarget.attachment.showLinkDialog(y,
"shared",J[0],!1,I)}}])}}}},relations:{library:function(){return{name:"Library",getBulkActions:BulkTarget.library.getBulkActions,config:{},index:Constants.sampleCategories.length+1}},libraryAliquot:function(){return{name:"Library Aliquot",getBulkActions:BulkTarget.libraryaliquot.getBulkActions,config:{},index:Constants.sampleCategories.length+2}},pool:function(){return{name:"Pool",getBulkActions:BulkTarget.pool.getBulkActions,config:{},index:Constants.sampleCategories.length+3}},run:function(){return{name:"Run",
getBulkActions:ListTarget.run.createBulkActions,config:{},index:Constants.sampleCategories.length+4}},categoriesForDetailed:function(){return Constants.isDetailedSample?Constants.sampleCategories.map(function(y){return{name:y,getBulkActions:BulkTarget.sample.getBulkActions,config:{},index:Constants.sampleCategories.indexOf(y)}}):[{name:"Sample",getBulkActions:BulkTarget.sample.getBulkActions,config:{},index:Constants.sampleCategories.length}]}}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.arraymodel=function(a){return{getSaveUrl:function(){return Urls.rest.arrayModels.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.arrayModels.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","array-models")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.arrayModels.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255),{title:"Rows",data:"rows",type:"int",required:!0,min:1},{title:"Columns",
data:"columns",type:"int",required:!0,min:1}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.assaytest=function(a){function b(c){return c.code+" ("+c.description+")"}return{getSaveUrl:function(){return Urls.rest.assayTests.bulkSave},getSaveProgressUrl:function(c){return Urls.rest.assayTests.bulkSaveProgress(c)},getUserManualUrl:function(){return Urls.external.userManual("type_data","assay-tests")},getBulkActions:function(c){return c.isAdmin&&"view"!==c.pageMode?[BulkUtils.actions.edit(Urls.ui.assayTests.bulkEdit)]:[]},getColumns:function(c,d){return[BulkUtils.columns.simpleAlias(50),
{title:"Tissue Origin",data:"tissueOriginId",type:"dropdown",source:Constants.tissueOrigins,getItemLabel:function(e){return e.alias+" ("+e.description+")"},getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample},BulkUtils.columns.makeBoolean("Negate Tissue Origin","negateTissueOrigin",!0,Constants.isDetailedSample),{title:"Tissue Type",data:"tissueTypeId",type:"dropdown",source:Constants.tissueTypes,getItemLabel:function(e){return e.alias+" ("+e.description+")"},getItemValue:Utils.array.getId,
sortSource:!0,include:Constants.isDetailedSample},BulkUtils.columns.makeBoolean("Negate Tissue Type","negateTissueType",!0,Constants.isDetailedSample),{title:"Extraction Class",data:"extractionClassId",type:"dropdown",source:function(e,g){return Constants.sampleClasses.filter(function(f){return"Stock"===f.sampleCategory&&(!f.archived||f.id===e.extractionClassId)})},getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,required:!0},{title:"Library Design Code",
data:"libraryDesignCodeId",type:"dropdown",source:Constants.libraryDesignCodes,getItemLabel:b,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,required:!0},{title:"Library Qualification Method",data:"libraryQualificationMethod",type:"dropdown",source:c.libraryQualificationMethods,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),sortSource:!0,required:!0,onChange:function(e,g,f){var h="None"===g;f.updateField(e,"libraryQualificationDesignCodeId",
{required:"Aliquot"===g,disabled:h,value:h?null:void 0})},description:"Describes how libraries are qualified before full depth sequencing - via library aliquot QC, low-depth sequencing, or not at all"},{title:"Library Qualification Design Code",data:"libraryQualificationDesignCodeId",type:"dropdown",source:Constants.libraryDesignCodes,getItemLabel:b,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,required:!0},function(){var e=BulkUtils.columns.makeBoolean("Repeat Per Timepoint",
"repeatPerTimepoint",!0,Constants.isDetailedSample);e.description="If true, the test must be repeated for each timepoint received; if false, the test must only be completed once per identity";return e}(),{title:"Permitted Samples",data:"permittedSamples",type:"dropdown",source:Constants.permittedSamples,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),required:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.attachmentcategory=function(){return{getSaveUrl:function(){return Urls.rest.attachmentCategories.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.attachmentCategories.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","attachment-categories")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.attachmentCategories.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(255)]}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.box=function(a){return{getSaveUrl:function(){return Urls.rest.boxes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.boxes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("boxes")},getBulkActions:function(b){return[BulkUtils.actions.edit(Urls.ui.boxes.bulkEdit),BulkUtils.actions.transfer("boxIds"),BulkUtils.actions.download(Urls.rest.boxes.boxSpreadsheet,Constants.boxSpreadsheets,function(c,d){return[]})]},getColumns:function(b,c){return[BulkUtils.columns.name,
BulkUtils.columns.simpleAlias(255),BulkUtils.columns.description,BulkUtils.columns.matrixBarcode,{title:"Box Use",type:"dropdown",data:"useId",required:!0,source:Constants.boxUses,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0},{title:"Box Size",type:"dropdown",data:"sizeId",required:!0,source:Constants.boxSizes,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId,sortSource:!0},{title:"Freezer Location Barcode",type:"text",data:"storageLocationBarcode",
initOnChange:!1,onChange:function(d,e,g){var f=function(h,k){g.updateField(d,"storageLocationId",{source:h||[],value:k})};Utils.validation.isEmpty(e)?f(null,null):(f(null,"(searching...)"),a.ajax({url:Urls.rest.storageLocations.queryByBarcode+"?"+Utils.page.param({q:e}),contentType:"application/json; charset\x3dutf8",dataType:"json"}).done(function(h){f([h],h.fullDisplayLocation)}).fail(function(h,k,l){f(null,"(Not found)")}))}},{title:"Freezer Location",type:"dropdown",data:"storageLocationId",disabled:!0,
source:function(d,e){return d.storageLocationId?[{id:d.storageLocationId,fullDisplayLocation:d.storageDisplayLocation}]:[]},getItemLabel:Utils.array.get("fullDisplayLocation"),getItemValue:Utils.array.getId},{title:"Location Note",type:"text",data:"locationBarcode",maxLength:255}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.boxsize=function(a){return{getSaveUrl:function(){return Urls.rest.boxSizes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.boxSizes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","box-sizes")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.boxSizes.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Rows",data:"rows",type:"int",required:!0,min:1},{title:"Columns",data:"columns",type:"int",required:!0,
min:1},{title:"Box Type",data:"boxType",type:"dropdown",source:b.boxTypes,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getName,initial:"Storage",required:!0},{title:"Scannable",data:"scannable",type:"dropdown",source:[{label:"True",value:!0},{label:"False",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),initial:"False",required:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.boxuse=function(a){return{getSaveUrl:function(){return Urls.rest.boxUses.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.boxUses.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","box-uses")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.boxUses.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255)]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.contact=function(){return{getSaveUrl:function(){return Urls.rest.contacts.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.contacts.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","contacts")},getBulkActions:function(a){return[BulkUtils.actions.edit(Urls.ui.contacts.bulkEdit)]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255},{title:"Email",type:"text",data:"email",required:!0,maxLength:255,
regex:Utils.validation.emailRegex}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.contactrole=function(){return{getSaveUrl:function(){return Urls.rest.contactRoles.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.contactRoles.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","contact-roles")},getBulkActions:function(a){return[BulkUtils.actions.edit(Urls.ui.contactRoles.bulkEdit)]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.containermodel=function(){return{getSaveUrl:function(){return Urls.rest.containerModels.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.containerModels.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-container-models")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.containerModels.bulkEdit)]:[]},getColumns:function(a,b){b=BulkUtils.columns.simpleAlias(255);a={title:"Platform",type:"dropdown",
data:"platformType",disabled:"edit"===a.pageMode,source:Constants.platformTypes,getItemLabel:Utils.array.get("key"),getItemValue:Utils.array.getName,sortSource:!0,required:!0};var c=BulkUtils.columns.makeBoolean("Fallback","fallback",!0,!0);c.description="Fallback containers do not represent actual products, and are only intended for use when the real container model cannot be determined.";return[b,{title:"Barcode",type:"text",data:"identificationBarcode",maxLength:255},a,{title:"Partitions",type:"int",
data:"partitionCount",required:!0,min:1},c,BulkUtils.columns.archived()]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.deliverable=function(){return{getSaveUrl:function(){return Urls.rest.deliverables.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.deliverables.bulkSaveProgress(a)},getUserManualUrls:function(){return Urls.external.userManual("type_data","deliverables")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.deliverables.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255},{title:"Category",type:"dropdown",
data:"categoryId",required:!0,source:a.categories,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0},BulkUtils.columns.makeBoolean("Analysis Review Required","analysisReviewRequired",!0,!0)]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.deliverablecategory=function(){return{getSaveUrl:function(){return Urls.rest.deliverableCategories.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.deliverableCategories.bulkSaveProgress(a)},getUserManualUrls:function(){return Urls.external.userManual("type_data","deliverables")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.deliverableCategories.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255}]}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.detailedqcstatus=function(a){return{getSaveUrl:function(){return Urls.rest.detailedQcStatuses.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.detailedQcStatuses.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","detailed-qc-status")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.detailedQcStatuses.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Description",data:"description",type:"text",required:!0,
maxLength:255},{title:"QC Passed?",data:"status",type:"dropdown",required:!0,source:[{label:"True",value:!0},{label:"False",value:!1},{label:"Unknown",value:null}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")},{title:"Note Required?",data:"noteRequired",type:"dropdown",required:!0,source:[{label:"True",value:!0},{label:"False",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")},BulkUtils.columns.archived()]}}}(jQuery);
BulkTarget=window.BulkTarget||{};BulkTarget.lab=function(){return{getSaveUrl:function(){return Urls.rest.labs.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.labs.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","labs")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.labs.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(255),BulkUtils.columns.archived()]}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.library=function(a){function b(v){var E={title:"Index "+v,type:"dropdown",data:"index"+v+"Id",source:function(q,t){return q.indexFamilyId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.indexFamilyId),Constants.libraryIndexFamilies).indices.filter(function(z){return z.position===v}):[]},sortSource:Utils.sorting.standardSort("label"),getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId};E.onChange=1===v?function(q,t,z){if(!r[q])c(q,z);else if(t){var x=z.getValue(q,
"indexFamilyId");if((x=Utils.array.findFirstOrNull(Utils.array.namePredicate(x),Constants.libraryIndexFamilies))&&x.uniqueDualIndex){var F=x.indices.find(function(n){return 1===n.position&&n.label===t});F&&(x=x.indices.find(function(n){return 2===n.position&&n.name===F.name}))&&z.updateField(q,"index2Id",{value:x.label})}}}:function(q,t,z){c(q,z)};return E}function c(v,E){var q=E.getValue(v,"indexFamilyId");Constants.libraryIndexFamilies.find(Utils.array.namePredicate(q))?(q=E.getValueObject(v,"index1Id"),
E=E.getValueObject(v,"index2Id"),r[v]=E?q?q.name===E.name:!1:!0):r[v]=!0}function d(v,E,q){return E?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(E),v)[q]:null}function e(v,E,q,t){g(v,E,"libraryDesignCodeId",t,"designCodeId",q,"designCodeId",Constants.libraryDesignCodes,k);g(v,E,"librarySelectionTypeId",t,"selectionId",q,"selectionId",Constants.librarySelections,Utils.array.getName);g(v,E,"libraryStrategyTypeId",t,"strategyId",q,"strategyId",Constants.libraryStrategies,Utils.array.getName)}
function g(v,E,q,t,z,x,F,n,m){if(t)t=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(t[z]),n);else if(x&&x[F])t=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(x[F]),n);else{E.updateField(v,q,{disabled:!1});return}E.updateField(v,q,{value:m(t),disabled:!0})}function f(v,E,q,t,z,x,F,n){t&&t[z]?(x=Utils.array.findUniqueOrThrow(function(m){return m[F]===t[z]},x),q.updateField(v,E,{value:x[n],disabled:!0})):q.updateField(v,E,{disabled:!1})}function h(v,E,q,t,z){t&&E.indexOneIds&&E.indexOneIds[t]?
z.updateField(v,"index1Id",{value:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(E.indexOneIds[t]),q.indices).label,disabled:!0}):z.updateField(v,"index1Id",{disabled:!1});t&&E.indexTwoIds&&E.indexTwoIds[t]?z.updateField(v,"index2Id",{value:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(E.indexTwoIds[t]),q.indices).label,disabled:!0}):z.updateField(v,"index2Id",{disabled:q.indices.some(function(x){return 2===x.position})})}function k(v){return v.code+" ("+v.description+")"}var l={},
p=null,r={},w=[];return{getSaveUrl:function(){return Urls.rest.libraries.bulkSave},getSaveProgressUrl:function(v){return Urls.rest.libraries.bulkSaveProgress(v)},getUserManualUrl:function(){return Urls.external.userManual("samples")},getCustomActions:function(v){function E(z,x){var F=Constants.detailedQcStatuses.filter(function(n){return n.status===z&&!1===n.noteRequired});return 1===F.length?F[0]:F.find(function(n){return n.description===x})}var q=E(!0,"Ready"),t=E(!1,"Failed: QC");return BulkUtils.actions.boxable("propagate"===
v.pageMode,p).concat({name:"Check QCs",action:function(z){Utils.showDialog("QC Criteria","Check",[{label:"Concentration",type:"compare",property:"concentrationComparator"},{label:"Volume",type:"compare",property:"volumeComparator"},{label:"Size",type:"compare",property:"sizeComparator"},{label:"Status for Pass",type:"select",property:"passStatus",values:Constants.detailedQcStatuses.filter(function(x){return!0===x.status}).map(function(x){return x.description}),value:q?q.description:void 0},{label:"Status for Fail",
type:"select",property:"failStatus",values:Constants.detailedQcStatuses.filter(function(x){return!1===x.status}).map(function(x){return x.description}),value:t?t.description:void 0}],function(x){for(var F=z.getRowCount(),n=[],m=0;m<F;m++){var u=x.concentrationComparator(z.getValue(m,"concentration"))&&x.volumeComparator(z.getValue(m,"volume"))&&x.sizeComparator(z.getValue(m,"dnaSize"));n.push([m,"detailedQcStatusId",u?x.passStatus:x.failStatus])}z.updateData(n)})}},{name:"View Metrics",action:function(z){BulkUtils.actions.viewMetrics(z,
w,void 0,v.pageMode)}})},getBulkActions:function(v){return[BulkUtils.actions.edit(Urls.ui.libraries.bulkEdit),{name:"Make aliquots",action:function(E){Utils.warnIfConsentRevoked(E,function(){BulkUtils.actions.showDialogForBoxCreation("Make Aliquots","Create",[],Urls.ui.libraryAliquots.bulkPropagate,function(q){return{ids:E.map(Utils.array.getId).join(",")}},function(q){return E.length})})}},BulkUtils.actions.print("library"),BulkUtils.actions.download(Urls.rest.libraries.spreadsheet,Constants.librarySpreadsheets,
function(E,q){return[]}),BulkUtils.actions.parents(Urls.rest.libraries.parents,BulkUtils.relations.categoriesForDetailed()),BulkUtils.actions.children(Urls.rest.libraries.children,[BulkUtils.relations.libraryAliquot(),BulkUtils.relations.pool(),BulkUtils.relations.run()])].concat(BulkUtils.actions.qc("Library")).concat([v.worksetId?BulkUtils.actions.removeFromWorkset("libraries",Urls.rest.worksets.removeLibraries(v.worksetId)):BulkUtils.actions.addToWorkset("libraries","libraryIds",Urls.rest.worksets.addLibraries),
BulkUtils.actions.attachFile("library",function(E){return E.projectId}),BulkUtils.actions.transfer("libraryIds")])},getDefaultSortFunction:function(v){return"sampleBoxColumn"===v.sort?function(E,q){return Utils.sorting.sortBoxPositions(E.sampleBoxPosition,q.sampleBoxPosition,!1)}:"propagate"===v.pageMode?Utils.sorting.standardSort("parentSampleId"):null},prepareData:function(v,E){p={};r={};v.forEach(function(q,t){l[t]={effectiveGroupId:q.effectiveGroupId,projectId:q.projectId,libraryTypeId:q.libraryTypeId,
indexFamilyId:q.indexFamilyId,kitDescriptorId:q.kitDescriptorId};q.sampleBoxPosition&&(p[t]=q.sampleBoxPosition);r[t]=!1});w=[];(E.isLibraryReceipt||v.some(function(q){return q.requisitionId}))&&w.push("RECEIPT");w.push("LIBRARY_PREP")},getFixedColumns:function(v){switch(v.pageMode){case "propagate":return 2;case "edit":return v.showLibraryAlias?2:1;case "create":return v.sampleAliasMaybeRequired?1:0;default:throw Error("Unexpected pageMode: "+v.pageMode);}},getColumns:function(v,E){var q=[{title:"Sample Name",
type:"text",data:"parentSampleName",include:"propagate"===v.pageMode,disabled:!0},{title:"Sample Alias",type:"text",data:"parentSampleAlias",setData:function(n,m,u,A){v.isLibraryReceipt&&v.sampleAliasMaybeRequired&&(n.sample.alias=m)},include:"propagate"===v.pageMode||v.sampleAliasMaybeRequired,disabled:!v.isLibraryReceipt},{title:"Sample Location",type:"text",data:"sampleBoxPositionLabel",disabled:!0,include:"propagate"===v.pageMode,customSorting:[{name:"Sample Location (by rows)",sort:function(n,
m){return Utils.sorting.sortBoxPositions(n,m,!0)}},{name:"Sample Location (by columns)",sort:function(n,m){return Utils.sorting.sortBoxPositions(n,m,!1)}}]},BulkUtils.columns.name];v.showLibraryAlias&&q.push(BulkUtils.columns.generatedAlias(v));q.push({title:"Project",type:"text",data:Constants.isDetailedSample?"projectCode":"projectName",include:!v.isLibraryReceipt,disabled:!0});if(v.isLibraryReceipt){var t=function(n){return{bypassIntercept:n,getCache:n.getCache,showError:n.showError,getRowCount:n.getRowCount,
getValue:function(m,u){return n.getValue(m,"sample."+u)},getValueObject:function(m,u){return n.getValueObject(m,"sample."+u)},getSourceData:function(m,u){return n.getSourceData(m,"sample."+u)},updateField:function(m,u,A){n.updateField(m,"sample."+u,A)},updateData:function(m){n.updateData(m.map(function(u){return[u[0],"sample."+u[1],u[2]]}))},isSaved:function(){return n.isSaved()}}},z=BulkTarget.sample.getColumns(v,E);z.forEach(function(n){if(n.setData)throw Error("sample column setData function not handled for library receipt");
n.data="sample."+n.data;n.includeSaved=!1;if(n.getData){var m=n.getData;n.getData=function(G){return m(G.sample)}}if(n.onChange){var u=n.onChange;n.onChange=function(G,D,N){u(G,D,t(N))}}if("function"===typeof n.source){var A=n.source;n.source=function(G,D){return A(G.sample,t(D))}}});if(v.templatesByProjectId){var x=Utils.array.findUniqueOrThrow(function(n){return"sample.projectId"===n.data},z),F=x.onChange;x.onChange=function(n,m,u){F(n,m,u);var A=Constants.isDetailedSample?"code":"name",G=v.projects.find(function(L){return L[A]===
m}),D=[];if(G&&v.templatesByProjectId[G.id]){D=u.getValue(n,"sample.sampleClassId");var N=Utils.array.findUniqueOrThrow(Utils.array.aliasPredicate(D),Constants.sampleClasses);D=v.templatesByProjectId[G.id].filter(function(L){return!L.designId||Constants.libraryDesigns.some(function(O){return O.id===L.designId&&O.sampleClassId===N.id})})}u.updateField(n,"template",{source:D})}}q=q.concat(z)}else q.push({title:"Tissue Origin",type:"text",disabled:!0,data:"effectiveTissueOriginAlias",getData:function(n,
m){return n.effectiveTissueOriginAlias+" ("+n.effectiveTissueOriginDescription+")"},omit:!0,include:Constants.isDetailedSample},{title:"Tissue Type",type:"text",disabled:!0,data:"effectiveTissueTypeAlias",getData:function(n,m){return n.effectiveTissueTypeAlias+" ("+n.effectiveTissueTypeDescription+")"},omit:!0,include:Constants.isDetailedSample});v.showDescription&&q.push(BulkUtils.columns.description);v.isLibraryReceipt&&(q=q.concat(BulkUtils.columns.receipt(v)),q=q.concat(BulkUtils.columns.requisition("sample.projectId")));
q.push(BulkUtils.columns.assay(v.pageMode));q=q.concat(BulkUtils.columns.boxable(v,E));v.templatesByProjectId&&!E.isSaved()&&(Utils.array.findUniqueOrThrow(function(n){return"boxPosition"===n.data},q).onChange=function(n,m,u){if(!u.isSaved()){var A=u.getValueObject(n,"template");if(A&&A.indexFamilyId){var G=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(A.indexFamilyId),Constants.libraryIndexFamilies);h(n,A,G,m,u)}}});q.push(BulkUtils.columns.creationDate(!v.isLibraryReceipt,!1,"propagate"==
v.pageMode,"library"));v.isLibraryReceipt||q.push(BulkUtils.columns.sop(v.sops,"propagate"===v.pageMode));q.push({title:"Workstation",type:"dropdown",data:"workstationId",include:!v.isLibraryReceipt,source:v.workstations,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Thermal Cycler",type:"dropdown",data:"thermalCyclerId",include:!v.isLibraryReceipt,source:v.thermalCyclers,sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,
getItemValue:Utils.array.getId,required:"propagate"===v.pageMode&&v.thermalCyclers&&v.thermalCyclers.length});q=q.concat(BulkUtils.columns.groupId(!v.isLibraryReceipt,function(n){return l[n].effectiveGroupId}));q.push({title:"Template",type:"dropdown",data:"template",omit:!0,include:!!v.templatesByProjectId,includeSaved:!1,source:function(n,m){return(m=n.sample?n.sample.projectId:n.projectId)&&v.templatesByProjectId[m]?v.templatesByProjectId[m].filter(function(u){return!u.designId||Constants.libraryDesigns.some(function(A){return A.id===
u.designId&&A.sampleClassId===n.parentSampleClassId})}):[]},sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,onChange:function(n,m,u){if((m=u.getValueObject(n,"template"))&&v.showVolume&&(m.defaultVolume&&u.updateField(n,"volume",{value:m.defaultVolume}),m.volumeUnits)){var A=Utils.array.findUniqueOrThrow(Utils.array.namePredicate(m.volumeUnits),Constants.volumeUnits);u.updateField(n,"volumeUnits",{value:Utils.decodeHtmlString(A.units)})}Constants.isDetailedSample?
m&&m.designId?(A=d(Constants.libraryDesigns,m.designId,"name"),u.updateField(n,"libraryDesignId",{value:A,disabled:!0})):m&&(m.designCodeId||m.selectionId||m.strategyId)?(A=u.getValue(n,"libraryDesignId"),u.updateField(n,"libraryDesignId",{value:null,disabled:!0}),A||(A=u.getValueObject(n,"libraryDesignId"),e(n,u,m,A))):(u.updateField(n,"libraryDesignId",{disabled:!1}),A=u.getValueObject(n,"libraryDesignId"),e(n,u,m,A)):(f(n,"librarySelectionTypeId",u,m,"selectionId",Constants.librarySelections,"id",
"name"),f(n,"libraryStrategyTypeId",u,m,"strategyId",Constants.libraryStrategies,"id","name"));f(n,"platformType",u,m,"platformType",Constants.platformTypes,"name","key");f(n,"libraryTypeId",u,m,"libraryTypeId",Constants.libraryTypes,"id","description");f(n,"indexFamilyId",u,m,"indexFamilyId",Constants.libraryIndexFamilies,"id","name");if(m&&m.indexFamilyId){A=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(m.indexFamilyId),Constants.libraryIndexFamilies);var G=u.getValue(n,"boxPosition");h(n,
m,A,G,u)}else A=u.getValue(n,"indexFamilyId"),A=Constants.libraryIndexFamilies.find(Utils.array.namePredicate(A)),u.updateField(n,"index1Id",{disabled:!A}),u.updateField(n,"index2Id",{disabled:!A||!A.indices.some(function(D){return 2===D.position})});f(n,"kitDescriptorId",u,m,"kitDescriptorId",Constants.kitDescriptors,"id","name")}},{title:"Design",type:"dropdown",data:"libraryDesignId",include:Constants.isDetailedSample,source:function(n,m){return Constants.libraryDesigns.filter(function(u){return u.sampleClassId==
n.parentSampleClassId})},sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,onChange:function(n,m,u){if(!u.isSaved()){m=u.getValueObject(n,"libraryDesignId");var A=v.templatesByProjectId?u.getValueObject(n,"template"):null;e(n,u,A,m)}}},{title:"Code",type:"dropdown",data:"libraryDesignCodeId",include:Constants.isDetailedSample,required:!0,source:Constants.libraryDesignCodes,sortSource:Utils.sorting.standardSort("code"),getItemLabel:k,getItemValue:Utils.array.getId},
{title:"Platform",type:"dropdown",disabled:"edit"===v.pageMode,data:"platformType",required:!0,source:Constants.platformTypes,getItemLabel:Utils.array.get("key"),getItemValue:Utils.array.get("key"),onChange:function(n,m,u){var A=Constants.platformTypes.find(function(D){return D.key===m});u.updateField(n,"libraryTypeId",{source:m?Constants.libraryTypes.filter(function(D){return D.platform===A.name&&(!D.archived||D.id===l[n].libraryTypeId)}):[]});var G=[];m&&(G=Constants.libraryIndexFamilies.filter(function(D){return D.platformType===
A.name&&(!D.archived||D.id===l[n].indexFamilyId)}).sort(Utils.sorting.standardSort("name")),G.unshift({id:null,name:"No indices"}));u.updateField(n,"indexFamilyId",{source:G});u.updateField(n,"kitDescriptorId",{source:m?Constants.kitDescriptors.filter(function(D){return"Library"===D.kitType&&D.platformType===A.key&&(!D.archived||D.id===l[n].kitDescriptorId)}):[]})}},{title:"Type",type:"dropdown",data:"libraryTypeId",getData:function(n){return d(Constants.libraryTypes,n.libraryTypeId,"description")},
required:!0,source:[],sortSource:Utils.sorting.standardSort("description"),getItemLabel:Utils.array.get("description"),getItemValue:Utils.array.getId},{title:"Selection",type:"dropdown",data:"librarySelectionTypeId",required:!0,source:Constants.librarySelections,sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"Strategy",type:"dropdown",data:"libraryStrategyTypeId",required:!0,source:Constants.libraryStrategies,sortSource:Utils.sorting.standardSort("name"),
getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"Index Kit",type:"dropdown",data:"indexFamilyId",getData:function(n){return n.indexFamilyId?d(Constants.libraryIndexFamilies,n.indexFamilyId,"name"):"edit"===v.pageMode||E.isSaved()?"No indices":""},required:!0,source:[],getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,onChange:function(n,m,u){var A=m?Utils.array.findFirstOrNull(Utils.array.namePredicate(m),Constants.libraryIndexFamilies):null,G=m=null;if(A){var D=
!u.isSaved()&&v.templatesByProjectId?u.getValueObject(n,"template"):null,N=u.getValue(n,"boxPosition");G=function(L,O){var S=A.indices.filter(function(T){return T.position===L});1!==L||S.length||Utils.showOkDialog("Error",["Selected index family has no indices for position 1"]);O={source:S,required:!!S.length,disabled:!S.length||D&&N&&D[O]&&D[O][N]};S.length||(O.value=null);return O};m=G(1,"indexOneIds");G=G(2,"indexTwoIds")}else G=m={source:[],required:!1,disabled:!0,value:null};u.updateField(n,
"index1Id",m);u.updateField(n,"index2Id",G)}},b(1),b(2),{title:"Has UMIs",type:"dropdown",data:"umis",required:!0,source:[{label:"True",value:!0},{label:"False",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")},{title:"Kit",type:"dropdown",data:"kitDescriptorId",getData:function(n){return d(Constants.kitDescriptors,n.kitDescriptorId,"name")},required:!0,source:[],sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},
{title:"Kit Lot",type:"text",data:"kitLot",maxLength:255,include:!v.isLibraryReceipt,required:"propagate"===v.pageMode,regex:Utils.validation.uriComponentRegex});q=q.concat(BulkUtils.columns.detailedQcStatus());q.push(BulkUtils.columns.dnaSize);v.showVolume&&(q=q.concat(BulkUtils.columns.volume(!0,v)),v.isLibraryReceipt||(q=q.concat(BulkUtils.columns.parentUsed)));q=q.concat(BulkUtils.columns.concentration());q.push({title:"Spike-In",type:"dropdown",data:"spikeInId",source:Constants.spikeIns,sortSource:Utils.sorting.standardSort("alias"),
getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,onChange:function(n,m,u){var A={disabled:!m,required:!!m};m||(A.value=null);u.updateField(n,"spikeInDilutionFactor",A);u.updateField(n,"spikeInVolume",A)}},{title:"Spike-In Dilution Factor",type:"dropdown",data:"spikeInDilutionFactor",source:Constants.dilutionFactors},{title:"Spike-In Volume",type:"decimal",data:"spikeInVolume",precision:14,scale:10});return q},confirmSave:function(v,E){var q=a.Deferred();E.isLibraryReceipt?BulkUtils.checkPausedRequisitions(v,
q):q.resolve();return q.promise()}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.libraryaliquot=function(a){function b(g){return g.name+" ("+g.alias+")"}var c={},d={},e=null;return{getSaveUrl:function(){return Urls.rest.libraryAliquots.bulkSave},getSaveProgressUrl:function(g){return Urls.rest.libraryAliquots.bulkSaveProgress(g)},getUserManualUrl:function(){return Urls.external.userManual("library_aliquots")},getCustomActions:function(g){var f=BulkUtils.actions.boxable("propagate"===g.pageMode,e);f.push({name:"View Metrics",action:function(h){BulkUtils.actions.viewMetrics(h,
["LIBRARY_PREP","LIBRARY_QUALIFICATION"],"Select category to view metrics. Relevant category depends on the assay test that this library aliquot will be used for. Sequencing metrics may be included.",g.pageMode)}});return f},getBulkActions:function(g){var f=BulkUtils.actions.edit(Urls.ui.libraryAliquots.bulkEdit);f.allowOnLibraryPage=!0;return[f,{name:"Propagate",action:function(h){Utils.warnIfConsentRevoked(h,function(){BulkUtils.actions.showDialogForBoxCreation("Create Library Aliquots","Create",
[],Urls.ui.libraryAliquots.bulkRepropagate,function(k){return{ids:h.map(Utils.array.getId).join(",")}},function(k){return h.length})},b)}},{name:"Create Order",action:function(h){Utils.warnIfConsentRevoked(h,function(){window.location=Urls.ui.poolOrders.create+"?"+Utils.page.param({aliquotIds:h.map(Utils.array.getId).join(",")})},b)}},{name:"Pool Together",title:"Create one pool from many library aliquots",action:function(h){Utils.warnIfConsentRevoked(h,function(){BulkUtils.actions.showDialogForBoxCreation("Create Pools",
"Create",[],Urls.ui.libraryAliquots.bulkPoolTogether,function(k){return{ids:h.map(Utils.array.getId).join(",")}},function(k){return 1})},b)},allowOnLibraryPage:!1},{name:"Pool Separately",title:"Create a pool for each library aliquot",action:function(h){Utils.warnIfConsentRevoked(h,function(){BulkUtils.actions.showDialogForBoxCreation("Create Pools","Create",[],Urls.ui.libraryAliquots.bulkPoolSeparate,function(k){return{ids:h.map(Utils.array.getId).join(",")}},function(k){return h.length})},b)},allowOnLibraryPage:!0},
{name:"Pool Custom",title:"Divide library aliquots into several pools",action:function(h){Utils.warnIfConsentRevoked(h,function(){BulkUtils.actions.showDialogForBoxCreation("Create Pools","Create",[{label:"Quantity",property:"quantity",type:"int"}],Urls.ui.libraryAliquots.bulkPoolCustom,function(k){return{ids:h.map(Utils.array.getId).join(","),quantity:k.quantity}},function(k){return k.quantity})},b)},allowOnLibraryPage:!0},BulkUtils.actions.print("libraryaliquot"),BulkUtils.actions.download(Urls.rest.libraryAliquots.spreadsheet,
Constants.libraryAliquotSpreadsheets,function(h,k){return[]}),BulkUtils.actions.parents(Urls.rest.libraryAliquots.parents,BulkUtils.relations.categoriesForDetailed().concat([BulkUtils.relations.library()])),BulkUtils.actions.children(Urls.rest.libraryAliquots.children,[BulkUtils.relations.pool(),BulkUtils.relations.run()]),g.worksetId?BulkUtils.actions.removeFromWorkset("library aliquots",Urls.rest.worksets.removeLibraryAliquots(g.worksetId)):BulkUtils.actions.addToWorkset("library aliquots","libraryAliquotIds",
Urls.rest.worksets.addLibraryAliquots),BulkUtils.actions.transfer("libraryAliquotIds")]},getFixedColumns:function(g){return 2},getColumns:function(g,f){var h=[{title:"Parent Name",type:"text",data:"parentName",disabled:!0,include:"propagate"===g.pageMode},{title:"Parent Alias",type:"text",data:"parentAlias",disabled:!0,getData:function(k){return k.parentAliquotAlias||k.libraryAlias},include:"propagate"===g.pageMode,omit:!0},{title:"Parent Location",type:"text",data:"parentBoxPositionLabel",disabled:!0,
include:"propagate"===g.pageMode,customSorting:[{name:"Parent Location (by rows)",sort:function(k,l){return Utils.sorting.sortBoxPositions(k,l,!0)}},{name:"Parent Location (by columns)",sort:function(k,l){return Utils.sorting.sortBoxPositions(k,l,!1)}}]},BulkUtils.columns.name,BulkUtils.columns.generatedAlias(g),{title:"Project",type:"text",disabled:!0,data:Constants.isDetailedSample?"projectCode":"projectName"},BulkUtils.columns.assay(),{title:"Tissue Origin",type:"text",disabled:!0,data:"effectiveTissueOriginAlias",
getData:function(k,l){return k.effectiveTissueOriginAlias+" ("+k.effectiveTissueOriginDescription+")"},omit:!0,include:Constants.isDetailedSample},{title:"Tissue Type",type:"text",disabled:!0,data:"effectiveTissueTypeAlias",getData:function(k,l){return k.effectiveTissueTypeAlias+" ("+k.effectiveTissueTypeDescription+")"},omit:!0,include:Constants.isDetailedSample},BulkUtils.columns.description];h=h.concat(BulkUtils.columns.boxable(g,f));h=h.concat(BulkUtils.columns.groupId(!0,function(k){return c[k].effectiveGroupIds}));
h.push({title:"Design Code",type:"dropdown",data:"libraryDesignCodeId",include:Constants.isDetailedSample,source:Constants.libraryDesignCodes,getItemLabel:function(k){return k.code},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("code"),required:!0,onChange:function(k,l,p){var r=Utils.array.findFirstOrNull(function(w){return w.code===l},Constants.libraryDesignCodes);r={required:r?r.targetedSequencingRequired:!1};p.updateField(k,"kitDescriptorId",r);p.updateField(k,"targetedSequencingId",
r)}});h=h.concat(BulkUtils.columns.detailedQcStatus());h.push(BulkUtils.columns.dnaSize);h=h.concat(BulkUtils.columns.concentration());h=h.concat(BulkUtils.columns.volume(!1,g));h=h.concat(BulkUtils.columns.parentUsed);h.push(BulkUtils.columns.creationDate(!0,!0,!0,"library aliquot"),{title:"Kit",type:"dropdown",data:"kitDescriptorId",source:function(k){return Constants.kitDescriptors.filter(function(l){return"Library"===l.kitType&&l.platformType===k.libraryPlatformType&&(!l.archived||l.id===k.kitDescriptorId)})},
sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,onChange:function(k,l,p){p.updateField(k,"kitLot",{disabled:!l,required:!!l});var r=l?Constants.kitDescriptors.find(function(q){return"Library"===q.kitType&&q.name===l}):null,w=l&&r?Constants.targetedSequencings.filter(function(q){return-1!==q.kitDescriptorIds.indexOf(r.id)&&(!q.archived||c[k].targetedSequencingId===q.id)}):[],v=void 0;if("propagate"===g.pageMode&&!p.getValue(k,"targetedSequencingId")){var E=
w.find(Utils.array.idPredicate(g.defaultTargetedSequencingByProject[c[k].projectId]));E&&(v=E.alias)}p.updateField(k,"targetedSequencingId",{source:w,disabled:!w.length,value:l?v:null})}},{title:"Kit Lot",type:"text",data:"kitLot",maxLength:255,required:"propagate"===g.pageMode,regex:Utils.validation.uriComponentRegex},{title:"Targeted Sequencing",type:"dropdown",data:"targetedSequencingId",getData:function(k){return k.targetedSequencingId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k.targetedSequencingId),
Constants.targetedSequencings).alias:null},source:[],sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId});return h},getDefaultSortFunction:function(g){return"propagate"===g.pageMode?function(f,h){return f.parentAliquotId&&h.parentAliquotId?Utils.sorting.standardSort("parentAliquotId")(f,h):Utils.sorting.standardSort("libraryId")(f,h)}:null},prepareData:function(g,f){e={};g.forEach(function(h,k){c[k]={effectiveGroupIds:h.effectiveGroupId,
targetedSequencingId:h.targetedSequencingId,projectId:h.projectId};void 0!==h.parentVolume&&null!==h.parentVolume&&(d[k]=h.volumeUsed?Utils.decimalStrings.add(h.parentVolume,h.volumeUsed):h.parentVolume);h.parentBoxPosition&&(e[k]=h.parentBoxPosition)})},confirmSave:function(g){var f=jQuery.Deferred();(g=g.filter(function(h,k){return h.volumeUsed&&d.hasOwnProperty(k)&&Utils.decimalStrings.subtract(d[k],h.volumeUsed).startsWith("-")}).length)?Utils.showConfirmDialog("Not Enough Library Volume","Save",
["Saving will cause "+g+(1<g?" libraries to have negative volumes. ":" library to have a negative volume. ")+"Are you sure you want to proceed?"],function(){f.resolve()},function(){f.reject()}):f.resolve();return f.promise()}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.librarydesign=function(){return{getSaveUrl:function(){return Urls.rest.libraryDesigns.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.libraryDesigns.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","library-designs")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.libraryDesigns.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255},{title:"Sample Class",
type:"dropdown",data:"sampleClassId",source:function(c,d){return Constants.sampleClasses.filter(function(e){return"Aliquot"===e.sampleCategory&&(!e.archived||c.sampleClassId===e.id)})},getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,required:!0},{title:"Selection",type:"dropdown",data:"selectionId",source:Constants.librarySelections,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0,required:!0},{title:"Strategy",type:"dropdown",data:"strategyId",
source:Constants.libraryStrategies,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0,required:!0},{title:"DesignCode",type:"dropdown",data:"designCodeId",source:Constants.libraryDesignCodes,getItemLabel:Utils.array.get("code"),getItemValue:Utils.array.getId,sortSource:!0,required:!0}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.librarydesigncode=function(a){return{getSaveUrl:function(){return Urls.rest.libraryDesignCodes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.libraryDesignCodes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("libraries","library-designs")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.libraryDesignCodes.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Code",type:"text",data:"code",required:!0,maxLength:2},
BulkUtils.columns.description,BulkUtils.columns.makeBoolean("Targeted Sequencing Req'd","targetedSequencingRequired",!0,!0)]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.libraryindex=function(a){return{getSaveUrl:function(){return Urls.rest.libraryIndices.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.libraryIndices.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","indices")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.libraryIndices.bulkEdit)]:[]},prepareData:function(b,c){b.forEach(function(d){d.family=c.indexFamily})},getColumns:function(b,c){return[{title:"Family",
data:"family.name",type:"text",disabled:!0},{title:"Position",data:"position",type:"dropdown",source:[1,2],required:!0},{title:"Name",data:"name",type:"text",maxLength:50,required:!0},{title:"Demultiplexing Name",data:"sequence",type:"text",maxLength:24,required:!0,include:!!b.indexFamily.fakeSequence},{title:"Sequence",data:"sequence",type:"text",maxLength:120,required:!0,regex:"^[ACGTKYR+]+$",description:"Can only include the characters [A, C, G, T, K, Y, R, +]",include:!b.indexFamily.fakeSequence},{title:"Sequences",
data:"realSequences",getData:function(d,e){return d.realSequences?d.realSequences.join(", "):""},setData:function(d,e,g,f){d.realSequences=e.split(",").map(function(h){return h.trim()}).filter(function(h){return h&&h.length})},type:"text",required:!0,regex:"^\\s*([ACGT]+\\s*,\\s*)*[ACGT]+\\s*$",description:'Values can only include the characters [A, C, G, T] and should be comma-separated. e.g. "ACACAC, GTGTGT"',include:!!b.indexFamily.fakeSequence}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.libraryselection=function(){return{getSaveUrl:function(){return Urls.rest.librarySelections.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.librarySelections.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","library-selection-types")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.librarySelections.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:50},
{title:"Description",type:"text",data:"description",required:!0,maxLength:255}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.libraryspikein=function(){return{getSaveUrl:function(){return Urls.rest.librarySpikeIns.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.librarySpikeIns.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","library-spike-ins")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.librarySpikeIns.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(255)]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.librarystrategy=function(){return{getSaveUrl:function(){return Urls.rest.libraryStrategies.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.libraryStrategies.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","library-strategy-types")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.libraryStrategies.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:50},
{title:"Description",type:"text",data:"description",required:!0,maxLength:255}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.librarytemplate=function(a){function b(e){return e.name+" - "+e.sampleClassAlias}function c(e){return e.code+" ("+e.description+")"}var d={};return{getSaveUrl:function(){return Urls.rest.libraryTemplates.bulkSave},getSaveProgressUrl:function(e){return Urls.rest.libraryTemplates.bulkSaveProgress(e)},getUserManualUrl:function(){return Urls.external.userManual("libraries","library-templates")},getBulkActions:function(e){return[BulkUtils.actions.edit(Urls.ui.libraryTemplates.bulkEdit)]},prepareData:function(e,
g){e.forEach(function(f,h){d[h]={libraryTypeId:f.libraryTypeId,kitDescriptorId:f.kitDescriptorId,indexFamilyId:f.indexFamilyId}})},getColumns:function(e,g){return[BulkUtils.columns.simpleAlias(255),{title:"Design",type:"dropdown",data:"designId",source:Constants.libraryDesigns,getItemLabel:b,getItemValue:Utils.array.getId,sortSource:!0,onChange:function(f,h,k){var l=Constants.libraryDesigns.find(function(r){return b(r)===h}),p=null;l?(p=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(l.designCodeId),
Constants.libraryDesignCodes),k.updateField(f,"designCodeId",{value:c(p),disabled:!0}),k.updateField(f,"selectionId",{value:l.selectionName,disabled:!0}),k.updateField(f,"strategyId",{value:l.strategyName,disabled:!0})):(k.updateField(f,"designCodeId",{disabled:!1}),k.updateField(f,"selectionId",{disabled:!1}),k.updateField(f,"strategyId",{disabled:!1}))},include:Constants.isDetailedSample},{title:"Code",type:"dropdown",data:"designCodeId",source:Constants.libraryDesignCodes,getItemLabel:c,getItemValue:Utils.array.getId,
sortSource:!0,include:Constants.isDetailedSample},{title:"Platform",type:"dropdown",data:"platformType",source:function(f,h){return Constants.platformTypes.filter(function(k){return k.active||f.platformType===k.name})},getItemLabel:Utils.array.get("key"),getItemValue:Utils.array.getName,sortSource:!0,onChange:function(f,h,k){var l=Constants.platformTypes.find(function(p){return p.key===h});l&&(k.updateField(f,"libraryTypeId",{source:Constants.libraryTypes.filter(function(p){return p.platform===l.name&&
(!p.archived||d[f].libraryTypeId===p.id)})}),k.updateField(f,"kitDescriptorId",{source:Constants.kitDescriptors.filter(function(p){return p.platformType===l.key&&"Library"===p.kitType&&(!p.archived||d[f].kitDescriptorId===p.id)})}),k.updateField(f,"indexFamilyId",{source:Constants.libraryIndexFamilies.filter(function(p){return p.platformType===l.name&&(!p.archived||d[f].indexFamilyId===p.id)})}))}},{title:"Type",type:"dropdown",data:"libraryTypeId",getData:function(f,h){return f.libraryTypeId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.libraryTypeId),
Constants.libraryTypes).description:null},source:[],getItemLabel:Utils.array.get("description"),getItemValue:Utils.array.getId,sortSource:!0},{title:"Selection",type:"dropdown",data:"selectionId",getData:function(f,h){return f.selectionId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.selectionId),Constants.librarySelections).name:null},source:Constants.librarySelections,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0},{title:"Strategy",type:"dropdown",data:"strategyId",
getData:function(f,h){return f.strategyId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.strategyId),Constants.libraryStrategies).name:null},source:Constants.libraryStrategies,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0},{title:"Kit",type:"dropdown",data:"kitDescriptorId",getData:function(f,h){return f.kitDescriptorId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.kitDescriptorId),Constants.kitDescriptors).name:null},source:[],getItemLabel:Utils.array.getName,
getItemValue:Utils.array.getId,sortSource:!0},{title:"Index Kit",type:"dropdown",data:"indexFamilyId",getData:function(f,h){return f.indexFamilyId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.indexFamilyId),Constants.libraryIndexFamilies).name:null},source:[],getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0},{title:"Default Volume",type:"decimal",data:"defaultVolume",precision:16,scale:10,onChange:function(f,h,k){k.updateField(f,"volumeUnits",{required:!!h})}},
{title:"Vol. Units",type:"dropdown",data:"volumeUnits",source:Constants.volumeUnits,getItemLabel:function(f){return Utils.decodeHtmlString(f.units)},getItemValue:Utils.array.getName,initializeOnEdit:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.librarytemplate_index=function(a){var b=null;return{getSaveUrl:function(c){return Urls.rest.libraryTemplates.bulkSaveIndices(c.libraryTemplate.id)},getSaveProgressUrl:function(c){return Urls.rest.libraryTemplates.bulkSaveProgress(c)},getUserManualUrl:function(){return Urls.external.userManual("libraries","library-templates")},getBulkActions:function(c){return[]},getColumns:function(c,d){d=c.indexFamily.indices.filter(function(g){return 1===g.position});var e=c.indexFamily.indices.filter(function(g){return 2===
g.position});return[{title:"Box Position",data:"boxPosition",type:"text",disabled:"edit"===c.pageMode,required:!0,regex:"^[A-Z](0[1-9]|1[0-9]|2[0-6])$",customSorting:[{name:"Box Position (by rows)",sort:function(g,f){return Utils.sorting.sortBoxPositions(g,f,!0)}},{name:"Box Position (by columns)",sort:function(g,f){return Utils.sorting.sortBoxPositions(g,f,!1)}}]},{title:"Index 1",data:"index1Id",type:"dropdown",source:d,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId,sortSource:!0},
{title:"Index 2",data:"index2Id",type:"dropdown",source:e,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId,sortSource:!0}]},confirmSave:function(c,d,e){b=c.map(function(g){return g.boxPosition})},manipulateSavedData:function(c){return b.map(function(d){return{boxPosition:d,index1Id:c[0].indexOneIds?c[0].indexOneIds[d]:null,index2Id:c[0].indexTwoIds?c[0].indexTwoIds[d]:null}})}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.librarytype=function(){return{getSaveUrl:function(){return Urls.rest.libraryTypes.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.libraryTypes.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","library-types")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.libraryTypes.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Description",type:"text",data:"description",required:!0,maxLength:255},{title:"Platform",
type:"dropdown",data:"platform",disabled:"edit"===a.pageMode,source:Constants.platformTypes,getItemLabel:Utils.array.get("key"),getItemValue:Utils.array.getName,sortSource:!0,required:!0},{title:"Abbreviation",type:"text",data:"abbreviation",maxLength:5},BulkUtils.columns.archived()]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.metric=function(){return{getSaveUrl:function(){return Urls.rest.metrics.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.metrics.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","metrics")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.metrics.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(100),{title:"Category",type:"dropdown",data:"category",source:Constants.metricCategories,
getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),required:!0,disabled:"edit"===a.pageMode,onChange:function(c,d,e){var g=Constants.metricCategories.find(function(h){return h.label===d}),f=g?Constants.metricSubcategories.filter(function(h){return h.category===g.value}):[];e.updateField(c,"subcategoryId",{source:f,disabled:!f.length,value:f.length?void 0:null})}},{title:"Subcategory",type:"dropdown",data:"subcategoryId",getData:function(c){return c.subcategoryId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(c.subcategoryId),
Constants.metricSubcategories).alias:""},source:[],getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,disabled:!0},{title:"Threshold Type",type:"dropdown",data:"thresholdType",source:Constants.thresholdTypes,getItemLabel:function(c){return Utils.decodeHtmlString(c.sign)},getItemValue:Utils.array.get("value"),required:!0},{title:"Units",type:"text",data:"units"},{title:"Sort Priority",type:"int",data:"sortPriority",min:1,max:255,description:"Defines sorting order for metrics within a category and subcategory. Lower numbers should be sorted higher, and unspecified should be at the bottom. Must be between 1 and 255 inclusive"},
{title:"Nucleic Acid Type",type:"dropdown",data:"nucleicAcidType",source:["DNA","RNA"],description:"Metric only applies to samples of this nucleic acid type if selected"},{title:"Tissue Material",type:"dropdown",data:"tissueMaterialId",source:Constants.tissueMaterials,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,description:"Metric only applies to samples of this tissue material if selected"},{title:"Tissue Type",type:"dropdown",
data:"tissueTypeId",source:Constants.tissueTypes,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,description:"Metric only applies to samples of this tissue type if selected. If negate tissue type is selected, applies instead to all EXCEPT the selected tissue type"},{title:"Negate Tissue Type",type:"dropdown",data:"negateTissueType",source:[{label:"No",value:!1},{label:"Yes",value:!0}],required:!0,getItemLabel:Utils.array.get("label"),
getItemValue:Utils.array.get("value"),include:Constants.isDetailedSample,description:"If yes, the metric applies to all EXCEPT the selected tissue type"},{title:"Tissue Origin",type:"dropdown",data:"tissueOriginId",source:Constants.tissueOrigins,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,include:Constants.isDetailedSample,description:"Metric only applies to samples of this tissue origin if selected"},{title:"Container Model",type:"dropdown",data:"containerModelId",
source:Constants.containerModels,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,description:"Metric only applies to runs of this container model if selected"},{title:"Read 1 Length",type:"int",data:"readLength",min:0,description:"Metric only applies to runs with this read 1 length if specified"},{title:"Read 2 Length",type:"int",data:"readLength2",min:0,description:"Metric only applies to runs with this read 2 length if specified. Use zero (0) to indicate single end"}]}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.metricsubcategory=function(){return{getSaveUrl:function(){return Urls.rest.metricSubcategories.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.metricSubcategories.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","metric-subcategories")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.metricSubcategories.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(100),{title:"Category",type:"dropdown",
data:"category",source:Constants.metricCategories,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),required:!0,disabled:"edit"===a.pageMode},{title:"Design Code",type:"dropdown",data:"libraryDesignCodeId",source:Constants.libraryDesignCodes,getItemLabel:Utils.array.get("code"),getItemValue:Utils.array.getId,description:"Subcategory is only applicable to the selected library design code, if any",include:Constants.isDetailedSample},{title:"Sort Priority",type:"int",data:"sortPriority",
min:1,max:255,description:"Defines sorting order for subcategories within a category. Lower numbers should be sorted higher, and unspecified should be at the bottom. Must be between 1 and 255 inclusive"}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.partitionqctype=function(){return{getSaveUrl:function(){return Urls.rest.partitionQcTypes.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.partitionQcTypes.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","partition-qc-types")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.partitionQcTypes.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Description",type:"text",data:"description",required:!0,maxLength:255},
BulkUtils.columns.makeBoolean("Note Required","noteRequired",!0,!0),BulkUtils.columns.makeBoolean("Order Fulfilled","orderFulfilled",!0,!0),BulkUtils.columns.makeBoolean("Disable Pipeline","analysisSkipped",!0,!0)]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.pipeline=function(){return{getSaveUrl:function(){return Urls.rest.pipelines.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.pipelines.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","pipelines")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.pipelines.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(50)]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.pool=function(a){function b(f,h){function k(v,E,q){for(var t=[{property:"sequencingParameters",label:"Sequencing Parameters",required:!0,type:"select",getLabel:Utils.array.getName,values:Constants.sequencingParameters.filter(function(F){return F.instrumentModelId==v})},{property:"genomeFolder",type:"text",label:"Genome Folder",value:h.genomeFolder,required:!0},{property:"customRead1Primer",type:"text",label:"Custom Read 1 Primer Well",required:!1},{property:"customIndexPrimer",type:"text",
label:"Custom Index Primer Well",required:!1},{property:"customRead2Primer",type:"text",label:"Custom Read 2 Primer Well",required:!1}],z=w.find(function(F){return F.id===v}),x=0;x<E;x++)t.push({property:"pool_"+(x+1),label:Utils.array.findUniqueOrThrow(function(F){return F.name===z.platformType},Constants.platformTypes).partitionName+" "+(x+1),required:!1,type:"select",getLabel:Utils.array.getAlias,values:f.concat([{value:null,alias:"empty"}])});q.dragen&&t.push({property:"dragenVersion",type:"text",
label:"DRAGEN Version",value:h.dragenVersion,required:!0},{property:"fastqCompressionFormat",label:"FastQ Compression Format",required:!0,type:"select",getLabel:function(F){return F.description},values:h.compressionFormats,value:h.compressionFormat},{property:"trimUMI",type:"select",label:"Trim UMI?",values:["true","false"],required:!0});Utils.showDialog("Create Samplesheet","Download",t,function(F){for(var n=[],m=0;m<E;m++)n.push(F["pool_"+(m+1)]);Utils.ajaxDownloadWithDialog(Urls.rest.pools.samplesheet,
{customRead1Primer:F.customRead1Primer,customIndexPrimer:F.customIndexPrimer,customRead2Primer:F.customRead2Primer,dragenVersion:F.dragenVersion||null,trimUMI:F.trimUMI||null,fastqCompressionFormat:F.fastqCompressionFormat?F.fastqCompressionFormat.description:null,experimentType:q.name,genomeFolder:F.genomeFolder,sequencingParametersId:F.sequencingParameters.id,poolIds:n.map(Utils.array.getId)})},null)}function l(v,E){Utils.showDialog("Create Samplesheet","Continue",[{property:"experimentType",label:"Type",
required:!0,type:"select",getLabel:function(q){return q.description},values:Constants.illuminaExperimentTypes}],function(q){k(v,E,q.experimentType)},null)}function p(v){Utils.showWizardDialog("Create Samplesheet",Constants.containerModels.filter(function(E){return-1!==E.instrumentModelIds.indexOf(v)&&!E.archived}).sort(Utils.sorting.standardSort("alias")).map(function(E){return{name:E.alias,handler:function(){l(v,E.partitionCount)}}}))}var r=Utils.array.deduplicateString(f.map(function(v){return v.platformType}));
if(1<r.length)Utils.showOkDialog("Error",["Cannot create a sample sheet from pools for different platforms."]);else if("ILLUMINA"!=r[0])Utils.showOkDialog("Error",["Can only create sample sheets for Illumina sequencers."]);else{var w=Constants.instrumentModels.filter(function(v){return"SEQUENCER"==v.instrumentType&&v.platformType==r[0]&&v.active});0==w.length?Utils.showOkDialog("Error",["No instruments are available for these pools.","Please add a sequencer first."]):Utils.showWizardDialog("Create Samplesheet",
Constants.instrumentModels.filter(function(v){return v.platformType===r[0]&&"SEQUENCER"===v.instrumentType&&v.active}).sort(Utils.sorting.standardSort("alias")).map(function(v){return{name:v.alias,handler:function(){p(v.id)}}}))}}function c(f,h){e=f.getData();d||(d=h.aliquotsToPool);f.rebuildTable(g,d)}var d=null,e=null,g={getDescription:function(f){return"Switch between Pool and Library Aliquot views using the 'Choose Library Aliquots'/'Edit Pools' buttons"},getColumns:function(f,h){return[{title:"Library Aliquot Name",
type:"text",disabled:!0,data:"name"},{title:"Alias",type:"text",disabled:!0,data:"alias"},{title:"Box Alias",type:"text",disabled:!0,data:"box.alias"},{title:"Position",type:"text",disabled:!0,data:"boxPosition"},{title:"Size (bp)",type:"int",disabled:!0,data:"dnaSize"},{title:"Pool",type:"dropdown",data:"pool",required:!0,source:function(){return e?e.filter(function(k){return k.alias}).map(function(k){return k.alias}):[]}}]},getCustomActions:function(f,h){return[{name:"Edit Pools",action:function(){d=
h.getData();h.rebuildTable(BulkTarget.pool,e)}}]},confirmSave:function(f,h,k){f=a.Deferred();f.reject(!0);window.setTimeout(function(){d=k.getData();k.rebuildTable(BulkTarget.pool,e);a("#save").click()},1E3);return f.promise()}};return{getSaveUrl:function(){return Urls.rest.pools.bulkSave},getSaveProgressUrl:function(f){return Urls.rest.pools.bulkSaveProgress(f)},getUserManualUrl:function(){return Urls.external.userManual("pools")},getDescription:function(f){return f.aliquotsToPool?"Switch between Pool and Library Aliquot views using the 'Choose Library Aliquots'/'Edit Pools' buttons":
null},getBulkActions:function(f){return[BulkUtils.actions.edit(Urls.ui.pools.bulkEdit),{name:"Create Orders",excludeOnOrders:!0,action:function(h){Utils.page.post(Urls.ui.sequencingOrders.bulkCreate,{poolIds:h.map(Utils.array.getId).join(",")})}},BulkUtils.actions.print("pool"),BulkUtils.actions.download(Urls.rest.pools.spreadsheet,Constants.poolSpreadsheets,function(h,k){return[]}),BulkUtils.actions.download(Urls.rest.pools.contentsSpreadsheet,Constants.libraryAliquotSpreadsheets,function(h,k){return[]},
"Download Contents"),{name:"Create Samplesheet",action:function(h){b(h,f)}},BulkUtils.actions.parents(Urls.rest.pools.parents,BulkUtils.relations.categoriesForDetailed().concat([BulkUtils.relations.library(),BulkUtils.relations.libraryAliquot()])),BulkUtils.actions.children(Urls.rest.pools.children,[BulkUtils.relations.run()])].concat(BulkUtils.actions.qc("Pool")).concat([{name:"Attach Files",action:function(h){1===h.length?ListTarget.attachment.showUploadDialog("pool",h[0].id,!1):(h=h.map(Utils.array.getId).join(","),
ListTarget.attachment.showUploadDialog("pool","shared",!1,h))}},BulkUtils.actions.transfer("poolIds")])},getColumns:function(f,h){return[BulkUtils.columns.name,BulkUtils.columns.simpleAlias(255),BulkUtils.columns.description].concat(BulkUtils.columns.boxable(f,h)).concat([{title:"Creation Date",type:"date",data:"creationDate",required:!0,initial:Utils.getCurrentDate()},BulkUtils.columns.dnaSize]).concat(BulkUtils.columns.concentration()).concat(BulkUtils.columns.volume()).concat([{title:"QC Status",
type:"dropdown",data:"qcPassed",source:[{label:"Ready",value:!0},{label:"Failed",value:!1},{label:"Not Ready",value:null}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")}])},getCustomActions:function(f){var h=BulkUtils.actions.boxable(!1);f.aliquotsToPool&&h.unshift({name:"Choose Library Aliquots",action:function(k){c(k,f)}});return h},confirmSave:function(f,h,k){var l=a.Deferred();if(h.aliquotsToPool){e=f;for(var p=!1,r=0;r<e.length;r++)for(var w=r+1;w<e.length;w++)e[r].alias===
e[w].alias&&(p=!0);if(p)return Utils.showOkDialog("Error",["There are duplicate Pool aliases"],function(){l.reject()}),l.promise();e.forEach(function(E){E.pooledElements=[]});d||(d=h.aliquotsToPool);var v=!1;d.forEach(function(E){if(!E.pool)return v=!0,l.promise();var q=Utils.array.findFirstOrNull(function(t){return t.alias===E.pool},e);q?q.pooledElements.push(E):v=!0});if(v)return Utils.showOkDialog("Error",["All aliquots must be added to pools"],function(){c(k,h);l.reject()}),l.promise();p=e.filter(function(E){return!E.pooledElements||
!E.pooledElements.length});if(p.length)return Utils.showOkDialog("Error",[1<p.length?"There are empty pools":"Pool '"+p[0].alias+"' is empty"],function(){c(k,h);l.reject()}),l.promise()}f=f.filter(function(E){return!E.identificationBarcode}).length;"edit"===h.pageMode||Constants.automaticBarcodes||!f?l.resolve():Utils.showConfirmDialog("Missing Barcodes","Save",["Pools should usually have barcodes. Are you sure you wish to save "+f+(1<f?" pools without barcodes":" pool without one")+"?"],function(){l.resolve()},
function(){l.reject()});return l.promise()}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.qc=function(){function a(c){c.controls&&(c.controls=c.controls.filter(function(d){return d.controlId}))}var b=0;return{getSaveUrl:function(){return Urls.rest.qcs.bulkSave},getSaveProgressUrl:function(c){return Urls.rest.qcs.bulkSaveProgress(c)},getUserManualUrl:function(){return Urls.external.userManual("qcs")},getBulkActions:function(c){return[{name:"Edit",action:function(d){Utils.showDialog("Edit QCs","Edit",[{property:"controls",type:"int",label:"Add controls per QC",value:0}],function(e){!Number.isInteger(e.controls)||
0>e.controls?Utils.showOkDialog("Error",["Invalid number of controls entered"]):Utils.page.post(Urls.ui.qcs.bulkEdit(c.qcTarget),{ids:d.map(Utils.array.getId).join(","),addControls:e.controls})})}}]},prepareData:function(c,d){c.forEach(function(e){a(e)});b=Math.max.apply(null,c.map(function(e){return e.controls?e.controls.length:0}))+(d.addControls||0)},getColumns:function(c,d){for(var e=[{title:c.qcTarget+" Alias",type:"text",data:"entityAlias",disabled:!0},{title:"Date",type:"date",data:"date",
required:!0},{title:"Type",type:"dropdown",data:"qcTypeId",source:function(f,h){return"edit"===c.pageMode?[Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.qcTypeId),Constants.qcTypes)]:Constants.qcTypes.filter(function(k){return k.qcTarget==c.qcTarget&&!k.archived})},getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("name"),required:!0,disabled:"edit"===c.pageMode,onChange:function(f,h,k){var l=Utils.array.findFirstOrNull(function(E){return E.qcTarget===
c.qcTarget&&E.name===h},Constants.qcTypes),p=null;if(l){var r=k.getValue(f,"instrumentId");p=Utils.array.findFirstOrNull(function(E){return E.instrumentModelId===l.instrumentModelId&&E.name===r},c.instruments)}var w=l&&l.instrumentModelId;k.updateField(f,"instrumentId",{source:w?c.instruments.filter(function(E){return E.instrumentModelId===l.instrumentModelId&&(!E.dateDecommissioned||p&&E.id===p.id)}):[],disabled:!w,required:w,value:w?void 0:null});w=l&&l.kitDescriptors&&l.kitDescriptors.length;k.updateField(f,
"kitDescriptorId",{source:w?l.kitDescriptors:[],disabled:!w,required:w,value:w?void 0:null});k.updateField(f,"kitLot",{disabled:!w,required:w,value:w?void 0:null});l&&(0>l.precisionAfterDecimal?k.updateField(f,"results",{type:"dropdown",source:[{label:"Pass",value:"1.0"},{label:"Fail",value:"0.0"}]}):k.updateField(f,"results",{type:"decimal",precision:l.precisionAfterDecimal+6,scale:l.precisionAfterDecimal}));k.updateField(f,"units",{value:l?l.units:null});w=l&&l.controls&&l.controls.length;for(var v=
0;v<b;v++)k.updateField(f,"controls."+v+".controlId",{source:w?l.controls:[],disabled:!w,required:w&&0==v}),w||(k.updateField(f,"controls."+v+".lot",{disabled:!0,required:!1,value:null}),k.updateField(f,"controls."+v+".qcPassed",{disabled:!0,required:!1,value:null}))}},{title:"Instrument",type:"dropdown",data:"instrumentId",getData:function(f){return f.instrumentId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.instrumentId),c.instruments).name:null},source:[],getItemLabel:Utils.array.getName,
getItemValue:Utils.array.getId,sortSource:!0},{title:"Kit",type:"dropdown",data:"kitDescriptorId",getData:function(f){return f.kitDescriptorId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.kitDescriptorId),Constants.kitDescriptors).name:null},source:[],getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0},{title:"Kit Lot",type:"text",data:"kitLot",maxLength:50},{title:"Result",type:"decimal",data:"results",getData:function(f,h){if(null===f.results)return null;h=
Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.qcTypeId),Constants.qcTypes);return 0>h.precisionAfterDecimal?0<f.results?"Pass":"Fail":0===h.precisionAfterDecimal?f.results.split(".")[0]:f.results},required:!0,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")},{title:"Units",type:"text",data:"units",omit:!0,disabled:!0},BulkUtils.columns.description],g=1;g<=b;g++)(function(){var f=g,h=g-1;e.push({title:"Control "+f,type:"dropdown",data:"controls."+h+".controlId",
getData:function(k){if(!k.qcTypeId||!k.controls||!k.controls.length||k.controls.length<f||!k.controls[h].controlId)return null;var l=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k.qcTypeId),Constants.qcTypes);return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k.controls[h].controlId),l.controls).alias},source:[],getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,onChange:function(k,l,p){p.updateField(k,"controls."+h+".lot",{disabled:!l,required:!!l,value:l?
void 0:null});p.updateField(k,"controls."+h+".qcPassed",{disabled:!l,required:!!l,value:l?void 0:null})}},{title:"Control "+f+" Lot",type:"text",data:"controls."+h+".lot",maxLength:50},{title:"Control "+f+" Passed?",type:"dropdown",data:"controls."+h+".qcPassed",source:[{label:"True",value:!0},{label:"False",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")})})();return e},confirmSave:function(c,d){c.forEach(function(e){e.qcTarget=d.qcTarget;a(e)})}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.referencegenome=function(){return{getSaveUrl:function(){return Urls.rest.referenceGenomes.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.referenceGenomes.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","reference-genomes")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.referenceGenomes.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(255),{title:"Default Sci. Name",type:"dropdown",
data:"defaultScientificNameId",source:Constants.scientificNames,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.runlibraryqcstatus=function(){return{getSaveUrl:function(){return Urls.rest.runLibraryQcStatuses.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.runLibraryQcStatuses.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","run-library-qc-statuses")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.runLibraryQcStatuses.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Description",type:"text",data:"description",
required:!0,maxLength:50},{title:"QC Passed?",type:"dropdown",data:"qcPassed",source:[{label:"Yes",value:!0},{label:"No",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.runpurpose=function(){return{getSaveUrl:function(){return Urls.rest.runPurposes.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.runPurposes.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","run-purposes")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.runPurposes.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(50)]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.sample=function(a){function b(t,z,x){var F=t.filter(function(u){return u.projectId!==p[u.id]}).map(function(u){return{sample:u,originalProject:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(p[u.id]),z.projects),newProject:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(u.projectId),z.projects)}}),n=Constants.isDetailedSample?"code":"name";t=F.filter(function(u){return u.sample.identityConsentLevel&&"All Projects"!==u.sample.identityConsentLevel}).map(function(u){return"\u2022 "+
(u.sample.alias||u.sample.parentAlias)+": "+u.originalProject[n]+" \u2192 "+u.newProject[n]+"; Consent: "+u.sample.identityConsentLevel});F=F.filter(function(u){return 0<u.sample.libraryCount}).map(function(u){return"\u2022 "+(u.sample.alias||u.sample.parentAlias)+": "+u.originalProject[n]+" \u2192 "+u.newProject[n]+"; "+u.sample.libraryCount+" librar"+(1<u.sample.libraryCount?"ies":"y")+" affected"});var m=[];t.length&&(m.push("The following project changes may violate consent:"),m=m.concat(t));
F.length&&(m.push("The following project changes affect existing libraries:"),m=m.concat(F));m.length?(m.push("Are you sure you wish to save?"),Utils.showConfirmDialog("Project Changes","Save",m,x.resolve,x.reject)):x.resolve()}function c(t){return Constants.isDetailedSample?Constants.sampleClasses.find(function(z){return t.sampleClassId==z.id}).sampleCategory:"Plain"}function d(t){var z=Utils.array.deduplicateNumeric(t.map(function(x){return x.sampleClassId||-1}));return Constants.sampleClasses.filter(function(x){return-1!==
z.indexOf(x.id)})}function e(t){var z=t.map(function(x){return Constants.sampleClasses.filter(function(F){return Constants.sampleValidRelationships.some(function(n){return n.parentId===x.id&&n.childId===F.id&&!1===F.archived&&!1===n.archived})}).map(function(F){return F.sampleCategory})});return["Identity","Tissue","Tissue Processing","Stock","Aliquot"].filter(function(x){return z.every(function(F){return-1!==F.indexOf(x)})})}function g(t,z){t={title:"Reference Slide",type:"dropdown",data:"referenceSlideId",
include:t,source:function(x,F){return x.relatedSlides||[]},sortSource:Utils.sorting.standardSort("id"),getItemLabel:function(x){return x.name+" ("+x.alias+")"},getItemValue:Utils.array.getId,description:"Indicates a slide whose attributes such as marked area and % tumour are relevant to this sample. May be used for calculating extraction input per yield, for example."};z&&(t.sampleSubcategory=z);return t}function f(t,z,x){var F=null;F=t?[t]:Constants.sampleClasses.filter(function(n){return n.sampleCategory===
z&&!n.archived&&n.directCreationAllowed});x&&(F=h(F,x));return F}function h(t,z){return t.filter(function(x){return Constants.sampleValidRelationships.find(function(F){return F.parentId===z&&F.childId===x.id})})}function k(t){return t?t.split(",").map(function(z){return z.trim()}).filter(function(z){return!!z}):[]}function l(t,z){return t.some(function(x){return z.includes(x)})}var p={},r={},w=null,v=[],E=!1,q=[];return{getSaveUrl:function(){return Urls.rest.samples.bulkSave},getSaveProgressUrl:function(t){return Urls.rest.samples.bulkSaveProgress(t)},
getUserManualUrl:function(){return Urls.external.userManual("samples")},getCustomActions:function(t){var z=BulkUtils.actions.boxable(Constants.isDetailedSample&&("propagate"===t.pageMode||"edit"===t.pageMode&&"Identity"!==t.targetCategory),w);z.push({name:"View Metrics",action:function(x){BulkUtils.actions.viewMetrics(x,v,"Samples found for multiple metric categories:",t.pageMode)}});return z},getBulkActions:function(t){var z=[{name:"Edit",action:function(x){if(x.some(function(n){return n.sampleClassId})&&
!Constants.isDetailedSample)Utils.showOkDialog("Error",["There are detailed samples, but MISO is not configured for this."]);else{var F=Utils.array.deduplicateString(d(x).map(function(n){return n.sampleCategory}));1<F.length?Utils.showOkDialog("Error",["You have selected samples of categories "+F.join(" \x26 ")+". Please select samples from only one category."]):Utils.page.post(Urls.ui.samples.bulkEdit,{ids:x.map(Utils.array.getId).join(",")})}}},{name:"Propagate",action:function(x){Utils.warnIfConsentRevoked(x,
function(){var F=x.map(Utils.array.getId).join(","),n=d(x),m=Utils.array.deduplicateString(n.map(function(A){return A.sampleCategory}));if(1<m.length)Utils.showOkDialog("Error",["You have selected samples of categories "+m.join(" \x26 ")+". Please select samples from only one category."]);else{var u=e(n).map(function(A){return{name:A,action:function(G,D){Utils.page.post(Urls.ui.samples.bulkPropagate,{boxId:D,parentIds:F,replicates:G,targetCategory:A})}}});Constants.isDetailedSample&&"Aliquot"!==m[0]||
u.push({name:"Library",action:function(A,G){A={boxId:G,ids:F,replicates:A};t.sortLibraryPropagate&&(A.sort=t.sortLibraryPropagate);Utils.page.post(Urls.ui.libraries.bulkPropagate,A)}});0==u.length?Utils.showOkDialog("Error",["No propagation is possible from the selected samples."]):Utils.showDialog(1<u.length?"Propagate Samples":"Propagate to "+u[0].name,"Propagate",[{property:"replicates",type:"int",label:"Replicates",value:1,required:!0},1<x.length?{property:"customReplication",type:"checkbox",
label:"Specify replicates per sample",value:!1}:null,1<u.length?{property:"target",type:"select",label:"To",values:u,getLabel:Utils.array.getName}:null,ListUtils.createBoxField].filter(function(A){return!!A}),function(A){var G=function(O,S){(A.target||u[0]).action(S,O)},D=function(O,S){Utils.createBoxDialog(A,function(T){return O},function(T){G(T.id,S)})};if(A.customReplication){for(var N=[],L=0;L<x.length;L++)N.push({property:"replicates"+L,type:"int",label:x[L].alias,value:A.replicates,required:!0});
Utils.showDialog("Propagate Samples - Replicates","OK",N,function(O){var S=[],T;for(T in O)S.push(O[T]);O=S.join(",");A.createBox?D(S.reduce(function(P,V){return P+V}),O):G(null,O)})}else A.createBox?D(A.replicates*x.length,A.replicates):G(null,A.replicates)})}})}},BulkUtils.actions.print("sample"),BulkUtils.actions.download(Urls.rest.samples.spreadsheet,Constants.sampleSpreadsheets.filter(function(x){return Constants.isDetailedSample||-1!==x.allowedClasses.indexOf("Plain")}),function(x,F){var n=
[],m=[];x.forEach(function(u){F.sheet.allowedClasses.includes(c(u))||m.push(u)});0<m.length&&(n.push("Error: Invalid sample class types"),n.push("Allowed types: "+F.sheet.allowedClasses.join(", ")),n.push("Invalid samples:"),m.forEach(function(u){n.push("* "+u.alias+" ("+c(u)+")")}));return n})];Constants.isDetailedSample&&z.push(BulkUtils.actions.parents(Urls.rest.samples.parents,BulkUtils.relations.categoriesForDetailed()));z.push(BulkUtils.actions.children(Urls.rest.samples.children,BulkUtils.relations.categoriesForDetailed().concat([BulkUtils.relations.library(),
BulkUtils.relations.libraryAliquot(),BulkUtils.relations.pool(),BulkUtils.relations.run()])));z=z.concat(BulkUtils.actions.qc("Sample"));t&&t.worksetId?z.push(BulkUtils.actions.removeFromWorkset("samples",Urls.rest.worksets.removeSamples(t.worksetId))):z.push(BulkUtils.actions.addToWorkset("samples","sampleIds",Urls.rest.worksets.addSamples));z.push(BulkUtils.actions.attachFile("sample",function(x){return x.projectId}),BulkUtils.actions.transfer("sampleIds"));return z},getDefaultSortFunction:function(t){return"propagate"===
t.pageMode?Utils.sorting.standardSort("parentId"):null},prepareData:function(t,z){w={};t.forEach(function(x,F){r[F]=x.effectiveGroupId;Constants.isDetailedSample&&x.parentBoxPosition&&(w[F]=x.parentBoxPosition);"edit"===z.pageMode?p[x.id]=x.projectId:Constants.isDetailedSample&&(x.relatedSlides&&1===x.relatedSlides.length&&(x.referenceSlideId=x.relatedSlides[0].id),z.targetSampleClass?x.sampleClassId=z.targetSampleClass.id:(F=f(z.targetSampleClass,z.targetCategory,x.parentSampleClassId),1===F.length&&
(x.sampleClassId=F[0].id)));x.labId&&(E=!0)});"edit"===z.pageMode&&Constants.isDetailedSample&&(q=d(t).filter(function(x){return x.sampleSubcategory}).map(function(x){return x.sampleSubcategory}));v=[];("create"===z.pageMode||t.some(function(x){return x.requisitionId}))&&v.push("RECEIPT");"Stock"===z.targetCategory&&v.push("EXTRACTION")},getFixedColumns:function(t){switch(t.pageMode){case "edit":return 2;case "propagate":return 2;default:return 0}},getColumns:function(t,z){for(var x=t.isLibraryReceipt?
"Aliquot":t.targetCategory,F={},n=["Identity","Tissue","Tissue Processing","Stock","Aliquot"],m=0;m<n.length;m++)F[n[m]]=!1;var u=x?n.indexOf(x):-1;Constants.isDetailedSample?t.isLibraryReceipt||"create"==t.pageMode?m=0:"edit"==t.pageMode?m=u:(m=n.indexOf(t.sourceCategory),n.indexOf(x)>m&&(m+=1)):m=-1;for(;m<=u&&-1!=m;m++)F[n[m]]=!0;var A=Constants.isDetailedSample?f(t.targetSampleClass,x):null,G=[];t.isLibraryReceipt||(G.push(BulkUtils.columns.name,BulkUtils.columns.generatedAlias(t)),Constants.isDetailedSample&&
(n=[{title:"Parent Name",type:"text",data:"parentName",disabled:!0},{title:"Parent Alias",type:"text",data:"parentAlias",disabled:!0},{title:"Parent Location",type:"text",data:"parentBoxPositionLabel",disabled:!0,customSorting:[{name:"Parent Location (by rows)",sort:function(D,N){return Utils.sorting.sortBoxPositions(D,N,!0)}},{name:"Parent Location (by columns)",sort:function(D,N){return Utils.sorting.sortBoxPositions(D,N,!1)}}]},{title:"Parent Sample Class",type:"text",data:"parentSampleClassAlias",
disabled:!0,include:"propagate"===t.pageMode,getData:function(D){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(function(N){return N.id==D.parentSampleClassId},Constants.sampleClasses),"alias")},omit:!0}],"propagate"===t.pageMode?G=n.concat(G):"edit"===t.pageMode&&"Identity"!==x&&(G=G.concat(n))),G.push(BulkUtils.columns.description),"create"!==t.pageMode||Constants.isDetailedSample&&"Identity"===x||(G=G.concat(BulkUtils.columns.receipt(t))));G.push({title:"Project",type:"dropdown",
data:"projectId",required:!0,disabled:!!t.project,source:function(D,N){return t.projects.filter(function(L){return"Active"===L.status||L.id===D.projectId||t.project&&L.id===t.project.id})},sortSource:Utils.sorting.standardSort(Constants.isDetailedSample?"code":"id"),getItemLabel:Constants.isDetailedSample?function(D){return D.code}:Utils.array.getName,getItemValue:Utils.array.getId,initial:t.project?t.project[Constants.isDetailedSample?"code":"name"]:null,onChange:function(D,N,L){if("Identity"!==
x&&"create"===t.pageMode){var O=L.bypassIntercept||L;if("Create New"===O.getValue(D,"requisitionId")){var S=L.getValueObject(D,"projectId");S&&null!==S.assayIds?BulkUtils.updateProjectAssays(S,O,D):O.updateField(D,"requisitionAssayIds",{source:[],value:null})}}var T=t.projects.find(function(P){return Constants.isDetailedSample?P.code===N:P.name===N});Constants.isDetailedSample&&(O=T?Constants.subprojects.filter(function(P){return P.parentProjectId===T.id}):[],S={source:O,disabled:!O.length},O.length||
(S.value=null),L.updateField(D,"subprojectId",S));T&&T.defaultSciName&&"edit"!==t.pageMode&&L.updateField(D,"scientificNameId",{value:T.defaultSciName})}});"create"!==t.pageMode||t.isLibraryReceipt||"Identity"===x||(G=G.concat(BulkUtils.columns.requisition("projectId")));"Identity"===x||t.isLibraryReceipt||(G.push(BulkUtils.columns.assay(t.pageMode)),G=G.concat(BulkUtils.columns.boxable(t,z)));G.push({title:"Subproject",type:"dropdown",data:"subprojectId",include:Constants.isDetailedSample,source:function(D,
N){if(!D.projectId)return[];var L=t.projects.find(Utils.array.idPredicate(D.projectId));return Constants.subprojects.filter(function(O){return O.parentProjectId===L.id})},sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Sample Class",type:"dropdown",disabled:"edit"===t.pageMode||t.isLibraryReceipt,data:"sampleClassId",include:Constants.isDetailedSample,required:!0,source:function(D,N){return"edit"===t.pageMode?Constants.sampleClasses.filter(Utils.array.idPredicate(D.sampleClassId)):
D.parentSampleClassId?h(A,D.parentSampleClassId):A},getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,onChange:function(D,N,L){var O=null;N&&(O=Utils.array.findFirstOrNull(Utils.array.aliasPredicate(N),Constants.sampleClasses));O&&(G.filter(function(S){return(!S.hasOwnProperty("include")||S.include)&&S.sampleSubcategory}).forEach(function(S){var T=Array.isArray(S.sampleSubcategory)&&-1!==S.sampleSubcategory.indexOf(O.sampleSubcategory)||"string"===typeof S.sampleSubcategory&&
S.sampleSubcategory===O.sampleSubcategory,P=t.isLibraryReceipt?S.data.replace("sample.",""):S.data,V=void 0;T?"edit"!==t.pageMode&&S.initial&&(V=S.initial):V=null;L.updateField(D,P,{disabled:!T,required:T?S.required:!1,value:V})}),O.defaultSampleType&&"edit"!==t.pageMode&&L.updateField(D,"sampleType",{value:O.defaultSampleType}))}},{title:"Sample Type",type:"dropdown",data:"sampleType",required:!0,source:function(D,N){N=Constants.sampleTypes;D.sampleType&&-1===N.indexOf(D.sampleType)&&(N=N.concat([D.sampleType]));
return N},sortSource:Utils.sorting.standardSortItems},{title:"Sci. Name",type:"dropdown",data:"scientificNameId",required:!0,source:Constants.scientificNames,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,initial:t.project&&t.project.defaultSciName?t.project.defaultSciName:t.defaultSciName},{title:"External Name",type:"text",data:"externalName",description:"Name or other identifier for the donor or organism in an external system",include:F.Identity,
includeSaved:"Identity"===x,required:!0,onChange:function(D,N,L){var O=k(N);if("Identity"!==x)if(O&&O.length){var S=Constants.isDetailedSample?"code":"name",T=Utils.array.findFirstOrNull(function(P){return P[S]===L.getValue(D,"projectId")},t.projects);null==T?L.updateField(D,"identityId",{value:"Delete external name, select a project, then re-enter external name."}):(L.updateField(D,"identityId",{source:[],value:"(searching...)",formatter:null}),a.ajax({url:Urls.rest.samples.identitiesLookup+"?"+
Utils.page.param({exactMatch:!0}),data:JSON.stringify({identitiesSearches:O,project:null}),contentType:"application/json; charset\x3dutf8",dataType:"json",type:"POST"}).done(function(P){var V=[];P&&P.length&&(V=P.sort(function(W,Y){return(W.projectId==T.id?0:W.projectId)-(Y.projectId==T.id?0:Y.projectId)}));P=null;P=V.filter(function(W){return W.projectId===T.id&&l(O,k(W.externalName))});1===P.length?P=P[0].alias+" -- "+P[0].externalName:(P="First Receipt ("+T[S]+")",V.unshift({id:null,label:P}));
L.updateField(D,"identityId",{source:V,value:P,formatter:1<V.length?"multipleOptions":null})}).fail(function(P,V,W){P=JSON.parse(P.responseText);L.showError(P.detail)}))}else L.updateField(D,"identityId",{source:[],value:null,formatter:null})}},{title:"Identity Alias",type:"dropdown",data:"identityId",include:F.Identity&&"Identity"!==x,includeSaved:!1,required:!0,source:[],getItemLabel:function(D){return D.label||D.alias+" -- "+D.externalName},getItemValue:Utils.array.getId,description:"A yellow background indicates that multiple identities correspond to the external name.",
onChange:function(D,N,L){var O=null,S=L.getSourceData(D,"identityId");if(S&&S.length&&(S=S.find(function(P){return N===P.alias+" -- "+P.externalName}))){var T=S.externalName.toLowerCase().split(",").map(function(P){return P.trim()});L.getValue(D,"externalName").toLowerCase().split(",").map(function(P){return P.trim()}).every(function(P){return-1!=T.indexOf(P)})||(O="notification")}L.updateField(D,"externalName",{formatter:O})}},{title:"Donor Sex",type:"dropdown",data:"donorSex",include:F.Identity,
includeSaved:"Identity"===x,required:!0,source:Constants.donorSexes,initial:"Unknown"},{title:"Consent",type:"dropdown",data:"consentLevel",include:F.Identity,includeSaved:"Identity"===x,required:!0,source:Constants.consentLevels,initial:"This Project"},{title:"Piece Type",type:"dropdown",data:"tissuePieceTypeId",include:"Tissue Processing"===x,sampleSubcategory:"Tissue Piece",required:!0,source:Constants.tissuePieceTypes,sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,
getItemValue:Utils.array.getId});(!Constants.isDetailedSample||"Identity"!==x&&"Tissue"!==x)&&G.push(BulkUtils.columns.sop(t.sops));Constants.isDetailedSample&&!t.isLibraryReceipt&&(G=G.concat(BulkUtils.columns.groupId("Identity"!==x&&"edit"===t.pageMode,function(D){return r[D]})));G.push(BulkUtils.columns.creationDate(Constants.isDetailedSample&&!t.isLibraryReceipt,!1,"propagate"==t.pageMode,"sample"),{title:"Tissue Origin",type:"dropdown",data:"tissueOriginId",include:F.Tissue,includeSaved:"Tissue"===
x,required:!0,source:Constants.tissueOrigins,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId},{title:"Tissue Type",type:"dropdown",data:"tissueTypeId",include:F.Tissue,includeSaved:"Tissue"===x,required:!0,source:Constants.tissueTypes,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId},{title:"Passage #",type:"int",data:"passageNumber",include:F.Tissue,includeSaved:"Tissue"===
x,min:1},{title:"Times Received",type:"int",data:"timesReceived",include:F.Tissue,includeSaved:"Tissue"===x,min:1,max:1E9},{title:"Tube Number",type:"int",data:"tubeNumber",include:F.Tissue,includeSaved:"Tissue"===x,min:1,max:1E9},{title:"Lab",type:"dropdown",data:"labId",include:E,source:Constants.labs,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,description:"The external lab that a tissue came from. This field is intended for historical data only as the lab should normally be recorded in a receipt transfer instead"},
{title:"Secondary ID",type:"text",data:"secondaryIdentifier",include:F.Tissue&&!t.isLibraryReceipt,includeSaved:"Tissue"===x,maxLength:255,description:"Identifier for the tissue sample in an external system"},{title:"Material",type:"dropdown",data:"tissueMaterialId",include:F.Tissue,includeSaved:"Tissue"===x,source:Constants.tissueMaterials,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Region",type:"text",data:"region",include:F.Tissue,
includeSaved:"Tissue"===x,maxLength:255},{title:"Timepoint",type:"text",data:"timepoint",include:F.Tissue,includeSaved:"Tissue"===x,maxLength:50,description:"When the sample was taken"},{title:"Index Family",type:"dropdown",data:"indexFamilyId",include:["Tissue Processing","Stock"].includes(x)&&Constants.sampleIndexFamilies&&Constants.sampleIndexFamilies.length,source:Constants.sampleIndexFamilies,sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,
onChange:function(D,N,L){N=Utils.array.findFirstOrNull(Utils.array.namePredicate(N),Constants.sampleIndexFamilies);var O={required:!!N,disabled:!N};N?O.source=N.indices:(O.source=[],O.value=null);L.updateField(D,"indexId",O)}},{title:"Index",type:"dropdown",data:"indexId",include:["Tissue Processing","Stock"].includes(x)&&Constants.sampleIndexFamilies&&Constants.sampleIndexFamilies.length,source:function(D,N){return D.indexFamilyId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(D.indexFamilyId),
Constants.sampleIndexFamilies).indices:[]},sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"Initial Slides",type:"int",data:"initialSlides",include:"edit"===t.pageMode&&"Tissue Processing"===x,sampleSubcategory:"Slide",required:!0,min:0},{title:"Slides",type:"int",data:"slides",include:"Tissue Processing"===x,sampleSubcategory:"Slide",required:!0,min:0},{title:"Thickness",type:"int",data:"thickness",include:"Tissue Processing"===
x,sampleSubcategory:"Slide",min:1},{title:"Stain",type:"dropdown",data:"stainId",include:"Tissue Processing"===x,sampleSubcategory:"Slide",source:Constants.stains,sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"% Tumour",type:"decimal",data:"percentTumour",include:"Tissue Processing"===x,sampleSubcategory:"Slide",precision:11,scale:8,min:0,max:100},{title:"% Necrosis",type:"decimal",data:"percentNecrosis",include:"Tissue Processing"===
x,sampleSubcategory:"Slide",precision:11,scale:8,min:0,max:100},{title:"Marked Area (mm\u00b2)",type:"decimal",data:"markedArea",include:"Tissue Processing"===x,sampleSubcategory:"Slide",precision:11,scale:8,min:0},{title:"Marked Area % Tumour",type:"decimal",data:"markedAreaPercentTumour",include:"Tissue Processing"===x,sampleSubcategory:"Slide",precision:11,scale:8,min:0,max:100},{title:"Slides Consumed",type:"int",data:"slidesConsumed",include:"Tissue Processing"===x,sampleSubcategory:"Tissue Piece",
required:!0,min:0},{title:"Slides Consumed",type:"int",data:"slidesConsumed",include:"create"!==t.pageMode&&"Stock"===x,min:0},{title:"Initial Cell Conc.",type:"decimal",data:"initialCellConcentration",include:F["Tissue Processing"],sampleSubcategory:["Single Cell","Single Cell (stock)","Single Cell (aliquot)"],includeSaved:"Tissue Processing"===x,precision:14,scale:10,description:"Initial concentration of cells in the sample at the time of receipt"},{title:"Target Cell Recovery",type:"int",data:"targetCellRecovery",
min:0,include:"Tissue Processing"===x,sampleSubcategory:["Single Cell"],includeSaved:"Tissue Processing"===x},{title:"Loading Cell Conc.",type:"decimal",data:"loadingCellConcentration",include:"Tissue Processing"===x,sampleSubcategory:["Single Cell"],includeSaved:"Tissue Processing"===x,precision:14,scale:10,description:"Concentration of cells prepared for loading into the instrument"},{title:"Digestion",type:"text",data:"digestion",include:F["Tissue Processing"],sampleSubcategory:["Single Cell",
"Single Cell (stock)","Single Cell (aliquot)"],includeSaved:"Tissue Processing"===x,required:!0},{title:"STR Status",type:"dropdown",data:"strStatus",include:F.Stock&&!t.isLibraryReceipt,includeSaved:"Stock"===x,required:!0,source:Constants.strStatuses,initial:"Not Submitted",description:"Status of short tandem repeat analysis"},{title:"DNAse",type:"dropdown",data:"dnaseTreated",include:F.Stock,sampleSubcategory:["RNA (stock)","RNA (aliquot)"],includeSaved:"Stock"===x,required:!0,source:[{label:"True",
value:!0},{label:"False",value:!1}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value"),initial:"True"});Constants.isDetailedSample&&!F.Stock&&!F.Aliquot&&!F["Tissue Processing"]||t.isLibraryReceipt||(G=G.concat(BulkUtils.columns.volume(!0,t)),Constants.isDetailedSample&&"Tissue Processing"!==x&&(G=G.concat(BulkUtils.columns.parentUsed)),G=G.concat(BulkUtils.columns.concentration()));G.push({title:"Target Cell Recovery",type:"int",data:"targetCellRecovery",min:0,include:F.Stock,
sampleSubcategory:["Single Cell (stock)","Single Cell (aliquot)"],includeSaved:"Stock"===x},{title:"Cell Viability",type:"decimal",data:"cellViability",include:F.Stock,sampleSubcategory:["Single Cell (stock)","Single Cell (aliquot)"],includeSaved:"Stock"===x,precision:14,scale:10},{title:"Loading Cell Conc.",type:"decimal",data:"loadingCellConcentration",include:F.Stock,sampleSubcategory:["Single Cell (stock)","Single Cell (aliquot)"],includeSaved:"Stock"===x,precision:14,scale:10},g("create"!==t.pageMode&&
"Tissue Processing"===x,"Tissue Piece"),g("create"!==t.pageMode&&"Stock"===x));t.isLibraryReceipt||(G=G.concat(BulkUtils.columns.detailedQcStatus()));G.push({title:"Purpose",type:"dropdown",data:"samplePurposeId",include:F.Aliquot&&!t.isLibraryReceipt,includeSaved:"Aliquot"===x,source:function(D,N){return Constants.samplePurposes.filter(function(L){return!L.archived||D.samplePurposeId===L.id})},sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},
{title:"Input into Library",type:"decimal",data:"inputIntoLibrary",include:F.Aliquot,sampleSubcategory:"Single Cell (aliquot)",includeSaved:"Aliquot"===x,precision:14,scale:10});Constants.isDetailedSample&&(z=function(D){G=G.filter(function(N){return N.sampleSubcategory?Array.isArray(N.sampleSubcategory)?N.sampleSubcategory.some(function(L){return-1!==D.indexOf(L)}):-1!==D.indexOf(N.sampleSubcategory):!0})},t.targetSampleClass?z(t.targetSampleClass.sampleSubcategory?[t.targetSampleClass.sampleSubcategory]:
[]):"edit"===t.pageMode&&z(q));G.forEach(function(D){if(D.sampleSubcategory){var N="Only applicable to "+Utils.array.list(D.sampleSubcategory)+" sample classes";D.description=D.description?D.description+"; "+N:N}});return G},confirmSave:function(t,z){var x=a.Deferred();Constants.isDetailedSample&&t.forEach(function(F){var n=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(F.sampleClassId),Constants.sampleClasses);F.type=n.sampleSubcategory||n.sampleCategory});"create"===z.pageMode?BulkUtils.checkPausedRequisitions(t,
x):"edit"===z.pageMode?b(t,z,x):x.resolve();return x.promise()}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.sampleindex=function(a){return{getSaveUrl:function(){return Urls.rest.sampleIndices.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.sampleIndices.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","indices")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.sampleIndices.bulkEdit)]:[]},prepareData:function(b,c){b.forEach(function(d){d.indexFamilyId=c.indexFamily.id;d.familyName=c.indexFamily.name})},getColumns:function(b,
c){return[{title:"Family",data:"familyName",type:"text",disabled:!0},{title:"Name",data:"name",type:"text",maxLength:24,required:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.samplepurpose=function(a){return{getSaveUrl:function(){return Urls.rest.samplePurposes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.samplePurposes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-purposes")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.samplePurposes.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255),BulkUtils.columns.archived()]}}}(jQuery);
BulkTarget=window.BulkTarget||{};
BulkTarget.sampletype=function(a){return{getSaveUrl:function(){return Urls.rest.sampleTypes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.sampleTypes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-types")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.sampleTypes.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Name",data:"name",type:"text",maxLength:255,required:!0},BulkUtils.columns.archived()]}}}(jQuery);
BulkTarget=window.BulkTarget||{};BulkTarget.scientificname=function(a){return{getSaveUrl:function(){return Urls.rest.scientificNames.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.scientificNames.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","scientific-names")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.scientificNames.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255)]}}}(jQuery);
BulkTarget=window.BulkTarget||{};BulkTarget.sequencingcontroltype=function(a){return{getSaveUrl:function(){return Urls.rest.sequencingControlTypes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.sequencingControlTypes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-control-types")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.sequencingControlTypes.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255)]}}}(jQuery);
BulkTarget=window.BulkTarget||{};
BulkTarget.sequencingorder=function(){return{getSaveUrl:function(){return Urls.rest.sequencingOrders.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.sequencingOrders.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("sequencing_orders")},getBulkActions:function(a){return[]},getColumns:function(a,b){return[{title:"Pool Name",type:"text",data:"pool.name",disabled:!0},{title:"Pool Alias",type:"text",data:"pool.alias",disabled:!0},{title:"Purpose",type:"dropdown",
data:"purposeId",source:Constants.runPurposes,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,required:!0},BulkUtils.columns.description,{title:"Instrument Model",type:"dropdown",data:"instrumentModelId",omit:!0,includeSaved:!1,source:function(c,d){return Constants.instrumentModels.filter(function(e){return"SEQUENCER"===e.instrumentType&&e.platformType===c.pool.platformType&&e.active})},getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,required:!0,onChange:function(c,
d,e){if(d){var g=Constants.instrumentModels.find(function(f){return"SEQUENCER"===f.instrumentType&&f.alias===d});e.updateField(c,"containerModelId",{source:g?g.containerModels.filter(function(f){return!f.archived}):[],value:g?void 0:null});e.updateField(c,"parameters.id",{source:g?Constants.sequencingParameters.filter(function(f){return f.instrumentModelId==g.id}):[],value:g?void 0:null})}}},{title:"Container Model",type:"dropdown",data:"containerModelId",source:function(c,d){return c.containerModelId?
Constants.containerModels.filter(Utils.array.idPredicate(c.containerModelId)):[]},getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,required:!0},{title:"Sequencing Parameters",type:"dropdown",data:"parameters.id",source:function(c,d){return c.parameters&&c.parameters.id?Constants.sequencingParameters.filter(Utils.array.idPredicate(c.parameters.id)):[]},getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0,required:!0},{title:"Partitions",type:"int",
data:"partitions",required:!0,min:1}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.sequencingparameters=function(){function a(b,c,d,e,g,f){var h={disabled:!1};e&&e.platformType===g||(h.disabled=!0,h.value=f||null);b.updateField(c,d,h)}return{getSaveUrl:function(){return Urls.rest.sequencingParameters.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.sequencingParameters.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-parameters")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.sequencingParameters.bulkEdit)]:
[]},getColumns:function(b,c){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255},{title:"Instrument Model",type:"dropdown",data:"instrumentModelId",disabled:"edit"===b.pageMode,source:Constants.instrumentModels.filter(function(d){return"SEQUENCER"===d.instrumentType}),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,required:!0,onChange:function(d,e,g){e=Utils.array.findFirstOrNull(Utils.array.aliasPredicate(e),Constants.instrumentModels);a(g,d,"chemistry",
e,"ILLUMINA","UNKNOWN");a(g,d,"runType",e,"OXFORDNANOPORE");a(g,d,"movieTime",e,"PACBIO");a(g,d,"flows",e,"ULTIMA")}},{title:"Read 1 Length",description:"For Illumina instruments, read 1 length should be greater than zero. For other platforms, read lengths should be set to zero.",type:"int",data:"read1Length",required:!0,min:0},{title:"Read 2 Length",description:"For Illumina instruments, read 2 should be set to zero for single end, or greater than zero for paired end. For other platforms, read lengths should be set to zero.",
type:"int",data:"read2Length",required:!0,min:0},{title:"Illumina Chemistry",description:'Should be set for Illumina instruments, and "UNKNOWN" for other platforms.',type:"dropdown",data:"chemistry",source:Constants.illuminaChemistry,sortSource:!0,required:!0},{title:"ONT Run Type",description:"Should be set for Oxford Nanopore instruments, and blank for other platforms.",type:"text",data:"runType",maxLength:255},{title:"PacBio Movie Time",description:"Should be set for PacBio instruments, and blank for other platforms.",
type:"int",data:"movieTime",min:0},{title:"Ultima Flows",description:"Should be set for Ultima instruments, and blank for other platforms.",type:"int",data:"flows",min:0,max:65535}]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.sop=function(){return{getSaveUrl:function(){return Urls.rest.sops.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.sops.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","standard-operating-procedures")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.sops.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(200),{title:"Version",type:"text",data:"version",required:!0,maxLength:50,disabled:"edit"===
a.pageMode,description:"Version of the SOP. this is not modifiable as changing the version would affect items already using the SOP. A new SOP should be created to represent a new version. The old version can then be archived if it will no longer be used."},{title:"Category",type:"dropdown",data:"category",required:!0,source:[{label:"Sample",value:"SAMPLE"},{label:"Library",value:"LIBRARY"},{label:"Run",value:"RUN"}],getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.get("value")},{title:"URL",
type:"text",data:"url",required:!0,maxLength:500,regex:Utils.validation.uriRegex},BulkUtils.columns.archived()]}}}();BulkTarget=window.BulkTarget||{};
BulkTarget.stain=function(a){return{getSaveUrl:function(){return Urls.rest.stains.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.stains.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","stains")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.stains.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Name",data:"name",type:"text",required:!0,maxLength:20},{title:"Category",data:"categoryId",type:"dropdown",source:b.stainCategories,
getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.staincategory=function(a){return{getSaveUrl:function(){return Urls.rest.stainCategories.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.stainCategories.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","stains")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.stainCategories.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Name",data:"name",type:"text",required:!0,maxLength:20}]}}}(jQuery);
BulkTarget=window.BulkTarget||{};
BulkTarget.storagelabel=function(){return{getSaveUrl:function(){return Urls.rest.storageLabels.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.storageLabels.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","storage-labels")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.storageLabels.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Label",type:"text",data:"label",required:!0,maxLength:100}]}}}();
BulkTarget=window.BulkTarget||{};BulkTarget.studytype=function(){return{getSaveUrl:function(){return Urls.rest.studyTypes.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.studyTypes.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","study-types")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.studyTypes.bulkEdit)]:[]},getColumns:function(a,b){return[{title:"Name",type:"text",data:"name",required:!0,maxLength:255}]}}}();
BulkTarget=window.BulkTarget||{};
BulkTarget.subproject=function(a){return{getSaveUrl:function(){return Urls.rest.subprojects.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.subprojects.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("projects","subprojects")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.subprojects.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Project",type:"dropdown",data:"parentProjectId",source:b.projects,getItemLabel:Utils.array.get("title"),
getItemValue:Utils.array.getId,sortSource:!0,required:!0,disabled:"edit"===b.pageMode},BulkUtils.columns.simpleAlias(255),BulkUtils.columns.description,BulkUtils.columns.makeBoolean("Priority","priority",!0,!0),{title:"Reference Genome",data:"referenceGenomeId",type:"dropdown",source:Constants.referenceGenomes,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:!0,required:!0}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.targetedsequencing=function(){return{getSaveUrl:function(){return Urls.rest.targetedSequencings.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.targetedSequencings.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","targeted-sequencing")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.targetedSequencings.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(255),BulkUtils.columns.description,
BulkUtils.columns.archived()]}}}();BulkTarget=window.BulkTarget||{};BulkTarget.tissuematerial=function(a){return{getSaveUrl:function(){return Urls.rest.tissueMaterials.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.tissueMaterials.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-materials")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.tissueMaterials.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255)]}}}(jQuery);
BulkTarget=window.BulkTarget||{};
BulkTarget.tissueorigin=function(a){return{getSaveUrl:function(){return Urls.rest.tissueOrigins.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.tissueOrigins.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-origins")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.tissueOrigins.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255),{title:"Description",data:"description",type:"text",
required:!0,maxLength:255}]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.tissuepiecetype=function(a){return{getSaveUrl:function(){return Urls.rest.tissuePieceTypes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.tissuePieceTypes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-piece-types")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.tissuePieceTypes.bulkEdit)]:[]},getColumns:function(b,c){return[{title:"Name",data:"name",type:"text",required:!0,maxLength:500},{title:"Abbreviation",
data:"abbreviation",type:"text",required:!0,maxLength:500},{title:"V2 Naming Code",data:"v2NamingCode",type:"text",required:!0,maxLength:2},BulkUtils.columns.archived()]}}}(jQuery);BulkTarget=window.BulkTarget||{};
BulkTarget.tissuetype=function(a){return{getSaveUrl:function(){return Urls.rest.tissueTypes.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.tissueTypes.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-types")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.tissueTypes.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(255),{title:"Description",data:"description",type:"text",required:!0,
maxLength:255}]}}}(jQuery);BulkTarget=window.BulkTarget||{};BulkTarget.worksetcategory=function(a){return{getSaveUrl:function(){return Urls.rest.worksetCategories.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.worksetCategories.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","workset-categories")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.worksetCategories.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(20)]}}}(jQuery);
BulkTarget=window.BulkTarget||{};BulkTarget.worksetstage=function(a){return{getSaveUrl:function(){return Urls.rest.worksetStages.bulkSave},getSaveProgressUrl:function(b){return Urls.rest.worksetStages.bulkSaveProgress(b)},getUserManualUrl:function(){return Urls.external.userManual("type_data","workset-stages")},getBulkActions:function(b){return b.isAdmin?[BulkUtils.actions.edit(Urls.ui.worksetStages.bulkEdit)]:[]},getColumns:function(b,c){return[BulkUtils.columns.simpleAlias(20)]}}}(jQuery);
BulkTarget=window.BulkTarget||{};
BulkTarget.workstation=function(){return{getSaveUrl:function(){return Urls.rest.workstations.bulkSave},getSaveProgressUrl:function(a){return Urls.rest.workstations.bulkSaveProgress(a)},getUserManualUrl:function(){return Urls.external.userManual("type_data","workstations")},getBulkActions:function(a){return a.isAdmin?[BulkUtils.actions.edit(Urls.ui.workstations.bulkEdit)]:[]},getColumns:function(a,b){return[BulkUtils.columns.simpleAlias(50),BulkUtils.columns.description,{title:"Barcode",data:"identificationBarcode",
type:"text",maxLength:255}]}}}();
var Contacts=function(a){function b(g,f){Utils.showDialog("Search Internal Users","Search",[{label:"Name",property:"q",type:"text",required:!0}],function(h){d(Urls.rest.users.search,h.q,g,f)})}function c(g,f){Utils.showDialog("Search Contacts","Search",[{label:"Name",property:"q",type:"text",required:!0}],function(h){d(Urls.rest.contacts.search,h.q,g,f)})}function d(g,f,h,k){Utils.ajaxWithDialog("Searching","GET",g+"?"+Utils.page.param({q:f}),null,function(l){l=l.map(function(p){return{name:Contacts.makeContactLabel(p.name,p.email),
handler:function(){k(p)}}});l.push({name:"New contact",handler:function(){e(h,k)}});Utils.showWizardDialog(1<l.length?"Select Contact":"No Results",l)})}function e(g,f){var h=[{label:"Name",property:"name",type:"text",required:!0},{label:"Email",property:"email",type:"text",regex:Utils.validation.emailRegex,required:!0}];g&&h.push({label:"Save contact",property:"save",type:"checkbox"});Utils.showDialog("New Contact","Continue",h,f)}return{makeContactLabel:function(g,f){return g+" \x3c"+f+"\x3e"},
selectContactDialog:function(g,f,h){var k=[{name:"Search contacts",handler:function(){c(f,h)}},{name:"New contact",handler:function(){e(f,h)}}];g&&k.unshift({name:"Search internal users",handler:function(){b(f,h)}});Utils.showWizardDialog("Change Contact",k)}}}(jQuery);
FormUtils=function(a){function b(m,u,A,G,D,N){function L(){P=!1;A.forEach(function(W){W.fields.forEach(function(Y){Y.omit||!1===Y.trackChanges||"special"===Y.type||Utils.setObjectField(T,Y.data,c(m,Y))})})}function O(W){var Y;if(Y=!W.omit&&!1!==W.trackChanges&&"special"!==W.type)if(Y=c(m,W),!(Y=null!=Y&&""!=Y)){Y=T;var X=W.data;Y=Y.hasOwnProperty(X)&&null!=Y[X]}return Y&&c(m,W)!=Utils.getObjectField(T,W.data)}var S,T={},P=!1,V="#"+u;return S={setUnchanged:L,isChanged:function(W){if(W)return W=d(A,
W),O(W);if(P)return!0;var Y=!1;A.forEach(function(X){Y|=X.fields.some(O)});return Y},markOtherChanges:function(){P=!0},get:function(W){return c(m,d(A,W))},updateField:function(W,Y){var X=d(A,W),ka="#"+p(m,X.data),oa=!1;Object.keys(Y).sort(e).forEach(function(ea){switch(ea){case "disabled":Utils.ui.setDisabled(ka,Y.disabled);break;case "value":if(void 0!==Y.value){ea=Y.value;var ia="#"+p(m,X.data);switch(X.type){case "text":case "textarea":case "password":case "dropdown":case "date":case "datetime":case "decimal":case "int":a(ia).val(ea);
break;case "checkbox":a(ia).prop("checked",ea);break;case "read-only":X.getDisplayValue?a(ia).val(ea):a(ia).text(ea);break;default:throw Error("Can't set value of field with type "+X.type);}oa=!0}break;case "required":X.required=Y.required;ea=a(ka).closest("tr").children().first();ea.text((X.title?X.title+":":"")+(X.required?"* ":" "));l(ea,X);break;case "source":if("dropdown"!==X.type)throw Error("Cannot set source for non-dropdown field '"+X.title+"'");X.source=Y.source;ea=c(m,X);ia=a(ka);ia.empty();
v(X,ia);a(ka+' option[value\x3d"'+ea+'"]').length?ia.val(ea):oa=!0;break;case "label":if("read-only"!==X.type||!X.getDisplayValue)throw Error("Cannot set label for field '"+X.title+"'");void 0!==Y.label&&(a("#"+p(m,X.data)+"Label").text(Y.label||""),oa=!0);break;case "link":ea=a("#"+p(m,X.data)+"Label");if("read-only"!==X.type||!ea.length)throw Error("Cannot set link for field '"+X.title+"'");Y.link?(ia=a("\x3ca\x3e").attr("id",p(m,X.data)+"Label").attr("href",Y.link).text(ea.text()),X.openNewTab&&
ia.attr("target","_blank").attr("rel","noopener noreferrer"),ea.replaceWith(ia)):ea.replaceWith(a("\x3cspan\x3e").attr("id",p(m,X.data)+"Label").text(ea.text()));break;default:throw Error("Invalid field update option: "+ea);}});if(oa&&X.onChange)X.onChange(c(m,X),S)},save:function(W){g(m,G,D,A,N,function(Y){"dialogForm"!==m&&L();null!==V&&Utils.ui.setDisabled(V,!1);W?W(Y):window.location.href=D.getEditUrl(Y,N)},function(){null!==V&&Utils.ui.setDisabled(V,!1)},S)}}}function c(m,u){m=a("#"+p(m,u.data));
switch(u.type){case "read-only":return u.getDisplayValue?m.val():m.text();case "text":case "textarea":case "password":case "date":case "datetime":case "decimal":return null!==m.val()&&m.val().length?m.val():null;case "dropdown":return m=null!==m.val()&&m.val().length?m.val():null,u.convertToBoolean?q(m):m;case "int":return m.val().length?Number(m.val()):null;case "checkbox":return m.is(":checked");default:throw Error("Can't get value of field with type "+u.type);}}function d(m,u){m=m.map(function(A){return A.fields}).reduce(function(A,
G){return A.concat(G)}).filter(function(A){return A.data===u});if(!m.length)throw Error("No field found for data property: "+u);if(1<m.length)throw Error("Multiple fields found for data property: "+u);return m[0]}function e(m,u){return(t[m]||0)-(t[u]||0)}function g(m,u,A,G,D,N,L,O){var S="#"+m;Validate.removeValidation(S+" .form-control");Validate.cleanFields(S);Validate.clearErrors(S);G.forEach(function(T){T.fields.forEach(function(P){P.omit||"special"===P.type||Utils.setObjectField(u,P.data,c(m,
P));if(-1!=="text textarea password dropdown date datetime decimal int".split(" ").indexOf(P.type)){var V=p(m,P.data);V=a("#"+V).addClass("form-control").attr("data-parsley-errors-container","#"+V+"Error");P.required&&V.attr("data-parsley-required",!0);P.maxLength&&V.attr("data-parsley-maxlength",P.maxLength);if("text"===P.type||"textarea"===P.type||"password"===P.type)if(P.regex)switch(P.regex){case "url":case "email":V.attr("data-parsley-type",P.regex);break;default:V.attr("data-parsley-pattern",
P.regex)}else V.attr("data-parsley-pattern",Utils.validation.sanitizeRegex);else if("date"===P.type)V.attr("data-date-format","YYYY-MM-DD"),V.attr("data-parsley-pattern",Utils.validation.dateRegex),V.attr("data-parsley-error-message","Date must be of form YYYY-MM-DD");else if("datetime"===P.type)V.attr("data-date-format","YYYY-MM-DD hh:mm:ss"),V.attr("data-parsley-pattern",Utils.validation.dateTimeRegex),V.attr("data-parsley-error-message","Time must be of form YYYY-MM-DD hh:mm:ss");else if("int"===
P.type)V.attr("data-parsley-type","integer"),P.hasOwnProperty("min")?P.hasOwnProperty("max")?V.attr("data-parsley-range","["+P.min+","+P.max+"]"):V.attr("data-parsley-min",P.min):P.hasOwnProperty("max")&&V.attr("data-parsley-max",P.min);else if("decimal"===P.type){var W=P.precision||21,Y=P.scale||17;V.attr("data-parsley-type","number");V.attr("data-parsley-maxlength",W+2);var X=Math.pow(10,W-Y)-Math.pow(.1,Y),ka=P.hasOwnProperty("max")?P.max:X;X=P.hasOwnProperty("min")?P.min:-1*X;V.attr("data-parsley-range",
"["+X+", "+ka+"]");V.attr("data-parsley-pattern","-?\\d{0,"+(W-Y)+"}(?:\\.\\d{1,"+Y+"})?");V.attr("data-parsley-error-message","Must be a number between "+X+" and "+ka)}P.match&&V.attr("data-parsley-equalto","#"+p(m,P.match))}})});a(S).parsley();a(S).parsley().validate();Validate.updateWarningOrSubmit(S,null,function(){a.when(A.confirmSave?A.confirmSave(u,"dialogForm"===m,O):null).then(function(){f(m,u,A,D,N,L)}).fail(L)},L)}function f(m,u,A,G,D,N){a.ajax({url:A.getSaveUrl(u,G),type:A.getSaveMethod(u),
dataType:"json",contentType:"application/json; charset\x3dutf8",data:JSON.stringify(u)}).done(function(L){D(L)}).fail(function(L,O,S){"dialogForm"===m?Utils.showAjaxErrorDialog(L,O,S):(Validate.displayErrors(JSON.parse(L.responseText),m),N())})}function h(m,u,A){var G=[];m.getSections(u,A).filter(function(D){return!D.hasOwnProperty("include")||D.include}).forEach(function(D){var N=D.fields.filter(function(L){return!L.hasOwnProperty("include")||L.include});N.length&&G.push({title:D.title,fields:N})});
return G}function k(m,u,A,G){m.append(a("\x3ch2\x3e").text(u.title));var D=a("\x3ctbody\x3e");u.fields.forEach(function(L){var O=a("\x3ctr\x3e"),S=O.append,T=a("\x3ctd\x3e").addClass("h").text((L.title?L.title+":":"")+(L.required?"* ":" "));l(T,L);S.call(O,T);S=O.append;var P=m.attr("id");T=a("\x3ctd\x3e");var V=null;L.getDisplayValue?V=L.getDisplayValue(A):L.data&&(V=Utils.getObjectField(A,L.data));null===V&&L.hasOwnProperty("initial")&&(V=L.initial);if(L.getDisplayValue){var W=a("\x3cinput\x3e").attr("id",
p(P,L.data)).attr("type","hidden"),Y=Utils.getObjectField(A,L.data);Y&&W.val(Y);T.append(W)}P="special"===L.type?null:p(P,L.data);switch(L.type){case "read-only":W=T.append;Y=L.getLink&&L.getLink(A);var X=a(Y?"\x3ca\x3e":"\x3cspan\x3e").attr("id",P+(L.getDisplayValue?"Label":""));null!==V&&X.text(V);Y&&Utils.getObjectField(A,L.data)&&(X.attr("href",L.getLink(A)),L.openNewTab&&X.attr("target","_blank").attr("rel","noopener noreferrer"));W.call(T,X);break;case "text":case "int":case "decimal":case "date":case "datetime":T.append(r(P,
L,V,"text",G));break;case "textarea":W=T.append;Y=a("\x3ctextarea\x3e").attr("id",P);null!==V&&Y.val(V);L.maxLength&&Y.attr("maxlength",L.maxlength);W.call(T,Y);break;case "password":T.append(r(P,L,V,"password",G).attr("autocomplete","new-password"));break;case "dropdown":T.append(w(P,L,V,G));break;case "checkbox":T.append(E(P,L,V,G));break;case "special":T.append(L.makeControls(G));break;default:throw Error("Unknown field type: "+L.type);}L.note&&(V=T.append,W=a("\x3cdiv\x3e").addClass("message-info").text(L.note),
V.call(T,W));"special"!==L.type&&(L=T.append,V=a("\x3cdiv\x3e").attr("id",P+"Error").addClass("errorContainer"),L.call(T,V));S.call(O,T);D.append(O)});m.append(a("\x3cdiv\x3e").attr("id",u.id).append(a("\x3ctable\x3e").addClass("in").append(D)));var N=m.attr("id");u.fields.forEach(function(L){if("special"!==L.type){var O=p(N,L.data);"date"===L.type?(a("#"+O).attr("placeholder","YYYY-MM-DD"),Utils.ui.addDatePicker(O)):"datetime"===L.type&&(a("#"+O).attr("placeholder","YYYY-MM-DD hh:mm:ss"),Utils.ui.addDateTimePicker(O));
L.disabled&&Utils.ui.setDisabled("#"+O,!0)}})}function l(m,u){u.description&&m.append(a("\x3cimg\x3e").attr("src","/styles/images/question_mark.png").attr("title",u.description).addClass("field-help-icon").click(function(){Utils.showOkDialog(u.title,[u.description])}))}function p(m,u){return m+"_"+u.replace(".","_")}function r(m,u,A,G,D){m=a("\x3cinput\x3e").attr("id",m).attr("type",G||"text");null!==A&&m.val(A);u.maxLength&&m.attr("maxlength",u.maxlength);u.onChange&&m.change(function(){u.onChange(this.value,
D)});return m}function w(m,u,A,G){m=a("\x3cselect\x3e").attr("id",m);v(u,m);"boolean"===typeof A&&(A=A.toString());null!==A&&m.val(A);u.onChange&&m.change(function(){var D=this.value;u.convertToBoolean&&(D=q(D));u.onChange(D,G)});return m}function v(m,u){m.required&&!m.nullLabel||u.append(a("\x3coption\x3e").val(null).text(m.nullLabel||"None"));(m.sortSource?m.source.sort(m.sortSource):m.source).forEach(function(A){var G=m.getItemValue?m.getItemValue(A):A;m.getItemLabel&&m.getItemLabel(A);if(m.getItemLabel)A=
m.getItemLabel(A);else if("string"!==typeof A)throw Error("Unable to determine label for dropdown item in field: "+m.title);u.append(a("\x3coption\x3e").val(G).text(A))})}function E(m,u,A,G){m=a("\x3cinput\x3e").attr("id",m).attr("type","checkbox").prop("checked",A);u.onChange&&m.change(function(){u.onChange(this.checked,G)});return m}function q(m){return"true"===m?!0:"false"===m?!1:null!==m&&m.length?m:null}var t={disabled:1,required:1,source:2,value:3,label:3,link:3},z={volume:{title:"Volume Units",
data:"volumeUnits",source:Constants.volumeUnits},concentration:{title:"Concentration Units",data:"concentrationUnits",source:Constants.concentrationUnits}},x=[],F=[],n=0;return{createForm:function(m,u,A,G,D){var N=a("#"+m);G=FormTarget[G];A||(A={});N.append(a("\x3cdiv\x3e").addClass("bs-callout bs-callout-warning hidden").append(a("\x3ch2\x3e").text("Oh snap!")).append(a("\x3cp\x3e").text("This form seems to be invalid")).append(a("\x3cdiv\x3e").addClass("generalErrors")));var L=h(G,D,A),O=b(m,u,
L,A,G,D);L.forEach(function(S){k(N,S,A,O)});u&&a("#"+u).click(function(){Utils.ui.setDisabled("#"+u,!0);O.save()});L.forEach(function(S){S.fields.forEach(function(T){if(T.onChange)T.onChange(c(m,T),O)})});if(G.onLoad)G.onLoad(O);"dialogForm"!==m&&(window.onbeforeunload=function(){if(O.isChanged())return""});O.setUnchanged();x.push(m);return O},createFormDialog:function(m,u,A,G,D){var N=a("#dialog");N.empty();N.append(a("\x3cform\x3e").attr("id","dialogForm").attr("data-parsley-validate","").attr("autocomplete",
"off").attr("acceptCharset","utf-8"));var L=FormUtils.createForm("dialogForm",null,u,A,G);h(FormTarget[A],G,u);N.dialog({autoOpen:!0,width:500,title:m,modal:!0,buttons:{Save:{id:"ok",text:"Save",click:function(){L.save(D)}}}})},isInitialized:function(m){return-1!==x.indexOf(m)},makeIdField:function(m){return{title:m+" ID",data:"id",type:"read-only",getDisplayValue:function(u){return u.id||"Unsaved"}}},makeQcPassedField:function(){return{title:"QC Status",data:"qcPassed",type:"dropdown",source:[{label:"Ready",
value:!0},{label:"Failed",value:!1}],convertToBoolean:!0,getItemLabel:function(m){return m.label},getItemValue:function(m){return m.value},nullLabel:"Not Ready"}},makeQcUserField:function(){return{title:"QC User",data:"qcUserName",type:"read-only",getDisplayValue:function(m){return m.qcUserName||"n/a"}}},makeQcDateField:function(){return{title:"QC Date",data:"qcDate",type:"read-only",getDisplayValue:function(m){return m.qcDate||"n/a"}}},makeDetailedQcStatusFields:function(m){return[{title:"QC Status",
data:"detailedQcStatusId",type:"dropdown",nullLabel:"Not Ready",source:Constants.detailedQcStatuses.filter(function(u){return!u.archived||u.id===m.detailedQcStatusId}),sortSource:Utils.sorting.detailedQcStatusSort,getItemLabel:function(u){return u.description},getItemValue:function(u){return u.id},required:!1,onChange:function(u,A){var G=u?Utils.array.findUniqueOrThrow(function(D){return D.id===Number(u)},Constants.detailedQcStatuses).noteRequired:!1;A.updateField("detailedQcStatusNote",{required:G})}},
{title:"QC Note",data:"detailedQcStatusNote",type:"text",maxLength:500},FormUtils.makeQcUserField(),FormUtils.makeQcDateField()]},makeUnitsField:function(m,u){var A=z[u];if(!A)throw Error("Unknown unit type: "+u);return{title:A.title,data:A.data,type:"dropdown",source:A.source,getItemLabel:function(G){return Utils.decodeHtmlString(G.units)},getItemValue:function(G){return G.name},required:!0,trackChanges:!!m[u]}},makeBoxLocationField:function(){return{title:"Box Location",data:"boxPosition",type:"read-only",
getDisplayValue:function(m){if(!m.box)return"n/a";var u="";m.box.locationBarcode&&(u+=m.box.locationBarcode+", ");return u+=m.box.alias+" "+m.boxPosition},getLink:function(m){return m.box?Urls.ui.boxes.edit(m.box.id):null}}},makeDistributionFields:function(){return[{title:"Distributed",data:"distributed",type:"checkbox",onChange:function(m,u){var A={disabled:!m,required:m};m||(A.value="");u.updateField("distributionDate",A);u.updateField("distributionRecipient",A)}},{title:"Distribution Date",data:"distributionDate",
type:"date"},{title:"Distribution Recipient",data:"distributionRecipient",type:"text",maxLength:250}]},makeSopFields:function(m,u){return[{title:"SOP",data:"sopId",type:"dropdown",source:u.filter(function(A){return!A.archived||m.sopId===A.id}),sortSource:Utils.sorting.standardSort("alias"),getItemLabel:function(A){return A.alias+" v."+A.version},getItemValue:Utils.array.getId,include:u&&u.length,onChange:function(A,G){A=A?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(A),u):null;G.updateField("sopLink",
{label:A?"View SOP":null,link:A?A.url:null})}},{title:"",data:"sopLink",omit:!0,type:"read-only",getDisplayValue:function(A){return A.sopId?"View SOP":null},getLink:function(A){return A.sopId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(A.sopId),u).url:null},openNewTab:!0}]},makeDnaSizeField:function(){return{title:"Size (bp)",data:"dnaSize",type:"int",min:1,max:1E7}},makeRequisitionField:function(m){return{title:"Requisition",data:"requisitionId",type:"read-only",getDisplayValue:function(u){return u.requisitionAlias||
"n/a"},getLink:function(u){return u.requisitionId?Urls.ui.requisitions.edit(u.requisitionId):null},include:m.requisitionId||!m.effectiveRequisitionId}},makeEffectiveRequisitionField:function(m){return{title:"Requisition",data:"effectiveRequisitionId",type:"read-only",getDisplayValue:function(u){return u.effectiveRequisitionAlias},getLink:function(u){return Urls.ui.requisitions.edit(u.effectiveRequisitionId)},include:!m.requisitionId&&m.effectiveRequisitionId}},makeAssaysFieldWithButtons:function(m,
u){m=Assay.utils.getAssays(m);if(!m||!m.length)return a("\x3cspan\x3e").text("n/a");var A=a("\x3cdiv\x3e").addClass("assaysFieldContainer");m.forEach(function(G){var D=a("\x3cdiv\x3e").addClass("assaysFieldItem"),N=G.alias+" v"+G.version;D.append(a("\x3cspan\x3e").text(N));D.append(a("\x3cbutton\x3e").addClass("ui-state-default").attr("type","button").text("View Metrics").click(function(){u(G)}));A.append(D)});return A},setTableData:function(m,u,A,G,D){var N=A+"Table";-1!==F.indexOf(A)&&(D&&D.markOtherChanges(),
a("#"+N).dataTable().fnDestroy(),a("#"+A).empty(),ListState[N]=null);var L=[];G.forEach(function(O){var S=Object.assign({},O);S.original=O;S.isTemporaryId=!0;L.push(S)});L.forEach(function(O){O.id||(n--,O.id=n)});a("#"+A).append(a("\x3ctable\x3e").attr("id",N).addClass("display no-border ui-widget-content"));ListUtils.createStaticTable(N,m,u,L);F.push(A)},getTableData:function(m){return-1===F.indexOf(m)?null:a("#"+m+"Table").dataTable().fnGetData().map(function(u){return u.original})},getSelectedTableData:function(m){return-1===
F.indexOf(m)?null:ListState[m+"Table"].selected}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.array=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("arrays")},getSaveUrl:function(b){return b.id?Urls.rest.arrays.update(b.id):Urls.rest.arrays.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.arrays.edit(b.id)},getSections:function(b,c){return[{title:"Array Information",fields:[{title:"Array ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Array Model",data:"arrayModelId",
type:"dropdown",include:!c.id,required:!0,source:b.arrayModels,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias")},{title:"Array Model",data:"arrayModelId",type:"read-only",include:!!c.id,getDisplayValue:function(d){return d.arrayModelAlias}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Serial Number",data:"serialNumber",type:"text",required:!0,maxLength:255},{title:"Description",data:"description",type:"text",
maxLength:255}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.arrayrun=function(a){function b(c){return Utils.array.findUniqueOrThrow(function(d){return d.label===c},Constants.healthTypes)}return{getUserManualUrl:function(){return Urls.external.userManual("array_runs")},getSaveUrl:function(c){return c.id?Urls.rest.arrayRuns.update(c.id):Urls.rest.arrayRuns.create},getSaveMethod:function(c){return c.id?"PUT":"POST"},getEditUrl:function(c){return Urls.ui.arrayRuns.edit(c.id)},getSections:function(c,d){return[{title:"Array Run Information",fields:[{title:"Array Run ID",
data:"id",type:"read-only",getDisplayValue:function(e){return e.id||"Unsaved"}},{title:"Instrument",data:"instrumentId",type:"dropdown",include:!d.id,required:!0,nullValue:"SELECT",source:c.instruments,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("name")},{title:"Instrument",data:"instrumentId",type:"read-only",include:!!d.id,getDisplayValue:function(e){return e.instrumentName}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},
{title:"Description",data:"description",type:"text",maxLength:255},{title:"Run Path",data:"filePath",type:"text",maxLength:255},{title:"Array",data:"arrayId",type:"read-only",getDisplayValue:function(e){return e.arrayAlias},getLink:function(e){return Urls.ui.arrays.edit(e.arrayId)}},{title:"Change Array",type:"special",makeControls:function(e){return[a("\x3cbutton\x3e").addClass("ui-state-default").attr("type","button").text("Search").click(function(){Utils.showDialog("Array Search","Search",[{label:"Search",
property:"query",type:"text",required:!0}],function(g){Utils.ajaxWithDialog("Searching","GET",Urls.rest.arrayRuns.arraySearch+"?"+Utils.page.param({q:g.query}),null,function(f){f&&f.length?Utils.showWizardDialog("Search Results",f.map(function(h){return{name:h.alias,handler:function(){e.updateField("arrayId",{value:h.id,label:h.alias,link:Urls.ui.arrays.edit(h.id)});SampleArray.updateSamplesTable(h)}}})):Utils.showOkDialog("Search Results",["No matching arrays found"])})})}),a("\x3cbutton\x3e").addClass("ui-state-default").attr("type",
"button").text("Remove").click(function(){e.get("arrayId")?Utils.showConfirmDialog("Remove Array","Remove",["Remove the array from this array run?"],function(){e.updateField("arrayId",{value:null,label:"",link:null});SampleArray.updateSamplesTable(null)}):Utils.showOkDialog("Remove Array",["No array set"])})]}},{title:"Status",data:"status",type:"dropdown",required:!0,source:Constants.healthTypes,getItemLabel:function(e){return e.label},getItemValue:function(e){return e.label},onChange:function(e,
g){e=b(e);var f={required:e.isDone,disabled:!e.isDone||g.get("completionDate")&&!c.isAdmin};e.isDone||(f.value=null);g.updateField("completionDate",f)},disabled:d.status?b(d.status).isDone&&!c.isAdmin:!1},{title:"Start Date",data:"startDate",type:"date",required:!0,disabled:d.startDate&&!c.isAdmin},{title:"Completion Date",data:"completionDate",type:"date"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.assay=function(){function a(b,c,d,e){return{title:b,type:d?"int":"read-only",data:c,getDisplayValue:d?void 0:function(g){return g[c]||"?"},min:0,max:365,include:e}}return{getUserManualUrl:function(){return Urls.external.userManual("requisitions","assays")},getSaveUrl:function(b){return b.id?Urls.rest.assays.update(b.id):Urls.rest.assays.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.assays.edit(b.id)},getSections:function(b,c){c=b.isAdmin&&
"view"!==b.pageMode;return[{title:"Assay Information",fields:[FormUtils.makeIdField("Assay"),{title:"Alias",type:c?"text":"read-only",data:"alias",required:!0,maxLength:50},{title:"Version",type:b.isAdmin&&"create"==b.pageMode?"text":"read-only",data:"version",required:!0,maxLength:50},{title:"Description",type:c?"text":"read-only",data:"description",maxLength:255},{title:"Archived",type:"checkbox",data:"archived",disabled:!c}]},{title:"Turn-around Time Targets (Days)",fields:[a("Overall Case","caseTargetDays",
c,!0),a("Receipt/Inspection","receiptTargetDays",c,!0),a("Extraction","extractionTargetDays",c,Constants.isDetailedSample),a("Library Preparation","libraryPreparationTargetDays",c,!0),a("Library Qualification","libraryQualificationTargetDays",c,!0),a("Full-Depth Sequencing","fullDepthSequencingTargetDays",c,!0),a("Analysis Review","analysisReviewTargetDays",c,!0),a("Release Approval","releaseApprovalTargetDays",c,!0),a("Release","releaseTargetDays",c,!0)]}]},confirmSave:function(b,c,d){b.tests=Assay.getTests();
b.metrics=Assay.getMetrics()}}}();"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.box=function(a){function b(f,h){f=a("\x3cdiv\x3e").css({width:"95%",display:"flex","align-items":"center"});f.append(a("\x3cspan\x3e").attr("id","freezerLocationLabel").css({flex:1,margin:"2px"}).text(h.storageDisplayLocation||"Not specified"));f.append(a("\x3cbutton\x3e").attr("id","scanFreezerLocation").addClass("ui-state-default").attr("type","button").css("margin-right","2px").text("Scan").click(function(){c(h)}));f.append(a("\x3cbutton\x3e").attr("id","selectFreezerLocation").addClass("ui-state-default").attr("type",
"button").css("margin","2px").text("Select").click(function(){d(h)}));f.append(a("\x3cbutton\x3e").attr("id","removeFreezerLocation").addClass("ui-state-default").attr("type","button").css("margin-left","2px").text("Remove").click(function(){h.storageLocationId=null;a("#freezerLocationLabel").text("Not specified")}));return f}function c(f){Utils.showDialog("Scan Freezer Location","OK",[{label:"Location Barcode",property:"barcode",required:!0,type:"text"}],function(h){h=Urls.rest.storageLocations.queryByBarcode+
"?"+Utils.page.param({q:h.barcode});Utils.ajaxWithDialog("Finding Location...","GET",h,null,function(k){g(k,f)})})}function d(f){Utils.ajaxWithDialog("Finding Freezers...","GET",Urls.rest.storageLocations.freezers,null,function(h){h&&h.length?e(f,h):Utils.showOkDialog("Error","No freezers found")})}function e(f,h,k){var l=k?k.fullDisplayLocation:null,p=k?"displayLocation":"fullDisplayLocation";h=h.sort(Utils.sorting.standardSort(p)).map(function(r){return{name:r[p],handler:function(){g(r,f)}}});Utils.showWizardDialog("Select Location",
h,l)}function g(f,h){f.availableStorage?(h.storageLocationId=f.id,a("#freezerLocationLabel").text(f.fullDisplayLocation)):Utils.ajaxWithDialog("Finding Storage...","GET",Urls.rest.storageLocations.children(f.id),null,function(k){k&&k.length?e(h,k,f):Utils.showOkDialog("Select Location",["No space in the selected location:",f.fullDisplayLocation])})}return{getUserManualUrl:function(){return Urls.external.userManual("boxes")},getSaveUrl:function(f){return f.id?Urls.rest.boxes.update(f.id):Urls.rest.boxes.create},
getSaveMethod:function(f){return f.id?"PUT":"POST"},getEditUrl:function(f){return Urls.ui.boxes.edit(f.id)},getSections:function(f,h){return[{title:"Box Information",fields:[{title:"Box ID",data:"id",type:"read-only",getDisplayValue:function(k){return k.id||"Unsaved"}},{title:"Name",data:"name",type:"read-only",getDisplayValue:function(k){return k.name||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Description",data:"description",type:"text",maxLength:255},
{title:"Matrix Barcode",data:"identificationBarcode",type:"text",maxLength:255},{title:"Box Use",data:"useId",type:"dropdown",source:Constants.boxUses,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,required:!0},{title:"Box Size",data:"sizeId",type:"dropdown",source:Constants.boxSizes,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId,required:!0},{title:"Freezer Location",type:"special",makeControls:function(k){return b(k,h)}},{title:"Location Note",data:"locationBarcode",
type:"text",maxLength:255}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.container=function(a){function b(d){var e=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.model.id),Constants.containerModels);Utils.array.findUniqueOrThrow(Utils.array.namePredicate(e.platformType),Constants.platformTypes);var g=null;g=d.lastRunInstrumentModelId?[Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.lastRunInstrumentModelId),Constants.instrumentModels)]:Constants.instrumentModels.filter(function(f){return-1!==e.instrumentModelIds.indexOf(f.id)});return g.flatMap(function(f){return f.containerModels}).reduce(function(f,
h){h.partitionCount!==e.partitionCount||f.find(function(k){return k.id===h.id})||f.push(h);return f},[])}function c(d,e,g){return Constants.kitDescriptors.filter(function(f){return f.kitType===d&&f.platformType===e&&(!f.archived||f.id===g)})}return{getUserManualUrl:function(){return Urls.external.userManual("sequencing_containers")},getSaveUrl:function(d){return d.id?Urls.rest.containers.update(d.id):Urls.rest.containers.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.containers.edit(d.id)},
getSections:function(d,e){return[{title:"Container Information",fields:[{title:"Container ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Serial Number",data:"identificationBarcode",type:"text",required:!0,maxLength:255},{title:"Container Model",data:"model.id",type:"dropdown",required:!0,source:b(e),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias"),onChange:function(g,f){g?(g=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g),
Constants.containerModels),g=Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.platformType),Constants.platformTypes),f.updateField("clusteringKitId",{source:c("Clustering",g.key,e.clusteringKitId)}),f.updateField("multiplexingKitId",{source:c("Multiplexing",g.key,e.multiplexingKitId)})):(f.updateField("clusteringKitId",{source:[]}),f.updateField("multiplexingKitId",{source:[]}))}},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Clustering Kit",data:"clusteringKitId",
type:"dropdown",source:function(){var g=Utils.array.findUniqueOrThrow(Utils.array.namePredicate(e.model.platformType),Constants.platformTypes);return c("Clustering",g.key,e.clusteringKitId)}(),getItemLabel:function(g){return g.name},getItemValue:function(g){return g.id},onChange:function(g,f){var h={disabled:!g};g||(h.value=null);f.updateField("clusteringKitLot",h)}},{title:"Clustering Kit Lot",data:"clusteringKitLot",type:"text",maxLength:100},{title:"Multiplexing Kit",data:"multiplexingKitId",type:"dropdown",
source:function(){var g=Utils.array.findUniqueOrThrow(Utils.array.namePredicate(e.model.platformType),Constants.platformTypes);return c("Multiplexing",g.key,e.multiplexingKitId)}(),getItemLabel:function(g){return g.name},getItemValue:function(g){return g.id},onChange:function(g,f){var h={disabled:!g};g||(h.value=null);f.updateField("multiplexingKitLot",h)}},{title:"Multiplexing Kit Lot",data:"multiplexingKitLot",type:"text",maxLength:100},{title:"Pore Version",data:"poreVersionId",type:"dropdown",
source:Constants.poreVersions,getItemLabel:function(g){return g.alias},getItemValue:function(g){return g.id},include:"OXFORDNANOPORE"===d.platformType},{title:"Received Date",data:"receivedDate",type:"date",include:"OXFORDNANOPORE"===d.platformType},{title:"Returned Date",data:"returnedDate",type:"date",include:"OXFORDNANOPORE"===d.platformType}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.experiment=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","experiments")},getSaveUrl:function(b){if(b.id)return Urls.rest.experiments.update(b.id);throw Error("Page not intended for new experiment creation");},getSaveMethod:function(b){return"PUT"},getEditUrl:function(b){return Urls.ui.experiments.edit(b.id)},getSections:function(b,c){return[{title:"Experiment Information",fields:[{title:"Experiment ID",data:"id",type:"read-only"},
{title:"Name",data:"id",type:"read-only"},{title:"Title",data:"title",type:"text",required:!0,maxLength:255},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Accession",data:"accession",type:"read-only",getLink:function(d){return Urls.external.enaAccession(d.accession)},include:c.accession},{title:"Study",data:"study.id",type:"read-only",getDisplayValue:function(d){return d.study.name+" ("+d.study.alias+")"},
getLink:function(d){return Urls.ui.studies.edit(d.study.id)}},{title:"Platform",data:"instrumentModel.id",type:"read-only",getDisplayValue:function(d){return d.instrumentModel.platformType+" - "+d.instrumentModel.alias}},{title:"Library",data:"library.id",type:"read-only",getDisplayValue:function(d){return d.library.name+" ("+d.library.alias+")"},getLink:function(d){return Urls.ui.libraries.edit(d.libraryId)}}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.freezer=function(a){function b(c,d){var e=c.get("mapId");d=e?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),d):null;var g=c.get("mapAnchor");c.updateField("mapLink",{label:e?"Open":"n/a",link:e?Urls.ui.freezerMaps.view(d.filename,g):null})}return{getUserManualUrl:function(){return Urls.external.userManual("freezers_and_rooms")},getSaveUrl:function(c){return c.id?Urls.rest.storageLocations.updateFreezer(c.id):Urls.rest.storageLocations.createFreezer},getSaveMethod:function(c){return c.id?
"PUT":"POST"},getEditUrl:function(c){return Urls.ui.freezers.edit(c.id)},getSections:function(c,d){return[{title:"Freezer Information",fields:[{title:"Location ID",data:"id",type:"read-only",getDisplayValue:function(e){return e.id||"Unsaved"}},{title:"Room",data:"parentLocationId",type:"dropdown",required:!0,source:c.rooms,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias")},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},
{title:"Label",data:"labelId",type:"dropdown",source:c.storageLabels,getItemLabel:Utils.array.get("label"),getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("label"),description:"A storage label to associate with the freezer"},{title:"Barcode",data:"identificationBarcode",type:"text",maxLength:255},{title:"Map",data:"mapId",type:"dropdown",source:c.locationMaps,getItemLabel:function(e){return e.filename},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("filename"),
onChange:function(e,g){var f={disabled:!e};e||(f.value=null);g.updateField("mapAnchor",f);b(g,c.locationMaps)},description:"The location map on which the freezer appears"},{title:"Map Anchor",data:"mapAnchor",type:"text",maxLength:100,onChange:function(e,g){b(g,c.locationMaps)},description:"Anchor tag ID to use in a link to the location map in order to highlight this freezer. For this to work, the map must be designed to include such anchor IDs"},{title:"View Map",data:"mapLink",type:"read-only",
openNewTab:!0,omit:!0,getDisplayValue:function(e){return"n/a"}},{title:"Probe ID",data:"probeId",type:"text",maxLength:50,description:"Identifier used in a monitoring system"},{title:"Retired",type:"checkbox",data:"retired"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.group=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("users_and_groups","groups")},getSaveUrl:function(b){return b.id?Urls.rest.groups.update(b.id):Urls.rest.groups.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.groups.edit(b.id)},getSections:function(b,c){return[{title:"Group Information",fields:[{title:"Group ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Name",
data:"name",type:"text",required:!0,maxLength:255},{title:"Description",data:"description",type:"text",maxLength:255}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.instrument=function(a){function b(e,g){return[{title:"Instrument ID",data:"id",type:"read-only"},{title:"Instrument Type",data:"instrumentType",type:"read-only",getDisplayValue:function(f){return Utils.array.findUniqueOrThrow(function(h){return h.value===f.instrumentType},e.instrumentTypes).label}},{title:"Instrument Model",data:"instrumentModelAlias",type:"read-only",getDisplayValue:function(f){return f.platformType+" - "+f.instrumentModelAlias}},{title:"Name",data:"name",type:"read-only"},
{title:"Serial Number",data:"serialNumber",type:"read-only"},{title:"Barcode",data:"identificationBarcode",type:"read-only"},{title:"Workstation",data:"workstationId",type:"read-only",getDisplayValue:function(f){return f.workstationAlias||"Not specified"}},{title:"Upgraded From",data:"preUpgradeInstrumentId",type:"read-only",getDisplayValue:function(f){return f.preUpgradeInstrumentAlias},getLink:function(f){return Urls.ui.instruments.edit(f.preUpgradeInstrumentId)},include:!!g.preUpgradeInstrumentId},
{title:"Commissioned",data:"dateCommissioned",type:"read-only"},{title:"Status",data:"status",type:"read-only"},{title:"Decommissioned",data:"dateDecommissioned",type:"read-only",include:!!g.dateDecommissioned},{title:"Upgraded To",data:"upgradedInstrumentId",type:"read-only",getDisplayValue:function(f){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.upgradedInstrumentId),e.instruments)},include:!!g.upgradedInstrumentId}]}function c(e,g){return[{title:"Instrument ID",data:"id",type:"read-only",
getDisplayValue:function(f){return f.id||"Unsaved"}},{title:"Instrument Type",data:"instrumentType",type:"read-only",include:!!g.id,getDisplayValue:function(f){return Utils.array.findUniqueOrThrow(function(h){return h.value===f.instrumentType},e.instrumentTypes).label}},{title:"Instrument Type",data:"instrumentType",type:"dropdown",include:!g.id,required:!0,source:e.instrumentTypes,getItemLabel:function(f){return f.label},getItemValue:function(f){return f.value},initial:"SEQUENCER",onChange:function(f,
h){h.updateField("instrumentModelId",{source:Constants.instrumentModels.filter(function(l){return l.instrumentType===f})});var k={required:"SEQUENCER"===f,disabled:"SEQUENCER"!==f};"SEQUENCER"!==f&&(k.value=null);h.updateField("defaultRunPurposeId",k)}},{title:"Instrument Model",data:"instrumentModelId",type:"dropdown",required:!0,source:Constants.instrumentModels.filter(function(f){return f.instrumentType===g.instrumentType}),getItemLabel:function(f){return Utils.array.findUniqueOrThrow(function(h){return h.name===
f.platformType},Constants.platformTypes).key+" - "+f.alias},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSortByCallback(function(f){return f.platformType+f.alias})},{title:"Name",data:"name",type:"text",required:!0,maxLength:30},{title:"Serial Number",data:"serialNumber",type:"text",maxLength:30},{title:"Barcode",data:"identificationBarcode",type:"text",maxLength:255},{title:"Workstation",data:"workstationId",type:"dropdown",source:e.workstations,getItemLabel:Utils.array.getAlias,
getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias")},{title:"Upgraded From",data:"preUpgradeInstrumentId",type:"read-only",getDisplayValue:function(f){return f.preUpgradeInstrumentAlias},getLink:function(f){return Urls.ui.instruments.edit(f.preUpgradeInstrumentId)},include:!!g.preUpgradeInstrumentId},{title:"Commissioned",data:"dateCommissioned",type:"date"},{title:"Status",data:"status",type:"dropdown",required:!0,source:["Production","Retired","Upgraded"],onChange:function(f,
h){var k={disabled:!0,required:!1},l={disabled:!0,required:!1};switch(f){case "Production":k.value=null;l.value=null;break;case "Retired":k.disabled=!1;k.required=!0;l.value=null;break;case "Upgraded":k.disabled=!1;k.required=!0;l.disabled=!1;l.required=!0;break;default:throw Error("Unexpected status value: "+f);}h.updateField("dateDecommissioned",k);h.updateField("upgradedInstrumentId",l)}},{title:"Decommissioned",data:"dateDecommissioned",type:"date",disabled:!0},{title:"Upgraded To",data:"upgradedInstrumentId",
type:"dropdown",nullLabel:"N/A",source:e.instruments,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("name"),disabled:!0},{title:"Default Run Purpose",data:"defaultRunPurposeId",type:"dropdown",source:Constants.runPurposes,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,nullLabel:"N/A",sortSource:Utils.sorting.standardSort("alias"),required:d(g.instrumentModelId),disabled:!d(g.instrumentModelId)}]}function d(e){return e&&"SEQUENCER"===
Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),Constants.instrumentModels).instrumentType}return{getUserManualUrl:function(){return Urls.external.userManual("instruments")},getSaveUrl:function(e){return e.id?Urls.rest.instruments.update(e.id):Urls.rest.instruments.create},getSaveMethod:function(e){return e.id?"PUT":"POST"},getEditUrl:function(e){return Urls.ui.instruments.edit(e.id)},getSections:function(e,g){return[{title:"Instrument Information",fields:e.isAdmin?c(e,g):b(e,g)}]}}}(jQuery);
"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.instrumentmodel=function(a){function b(d,e){a("#save").remove();return[{title:"Instrument Model ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Alias",data:"alias",type:"read-only"},{title:"Description",data:"description",type:"read-only"},{title:"Platform",data:"platformType",type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.platformType),Constants.platformTypes).key}},{title:"Instrument Type",
data:"instrumentType",type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(function(f){return f.value===g.instrumentType},Constants.instrumentTypes).label}},{title:"Sequencing Containers per Run",data:"numContainers",type:"read-only"},{title:"Index Sequencing",data:"dataManglingPolicy",type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(function(f){return f.value===g.dataManglingPolicy},Constants.dataManglingPolicies).label}}]}function c(d,
e){return[{title:"Instrument Model ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Platform",data:"platformType",type:"dropdown",include:"create"===d.pageMode,required:!0,source:Constants.platformTypes,getItemLabel:function(g){return g.key},getItemValue:Utils.array.getName},{title:"Platform",data:"platformType",include:"create"!==
d.pageMode,type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.platformType),Constants.platformTypes).key}},{title:"Instrument Type",data:"instrumentType",type:"dropdown",include:"create"===d.pageMode,required:!0,source:Constants.instrumentTypes,getItemLabel:function(g){return g.label},getItemValue:function(g){return g.value},initial:"SEQUENCER",onChange:function(g,f){"SEQUENCER"===g?f.updateField("dataManglingPolicy",{source:Constants.dataManglingPolicies}):
f.updateField("dataManglingPolicy",{source:[{label:"Normal",value:"NONE"}],value:"NONE"})}},{title:"Instrument Type",data:"instrumentType",type:"read-only",include:"create"!==d.pageMode,getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(function(f){return f.value===g.instrumentType},Constants.instrumentTypes).label}},{title:"Sequencing Containers per Run",data:"numContainers",type:"int",min:0,max:127,required:!0},{title:"Index Sequencing",data:"dataManglingPolicy",type:"dropdown",required:!0,
source:"SEQUENCER"===e.instrumentType?Constants.dataManglingPolicies:[{label:"Normal",value:"NONE"}],getItemLabel:function(g){return g.label},getItemValue:function(g){return g.value},initial:"NONE"}]}return{getUserManualUrl:function(){return Urls.external.userManual("type_data","instrument-models")},getSaveUrl:function(d){return d.id?Urls.rest.instrumentModels.update(d.id):Urls.rest.instrumentModels.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.instrumentModels.edit(d.id)},
getSections:function(d,e){return[{title:"Model Information",fields:d.isAdmin?c(d,e):b(d,e)}]},confirmSave:function(d){d.positions=InstrumentModel.getInstrumentPositions();d.containerModels=InstrumentModel.getContainerModels()}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.kitdescriptor=function(a){function b(c,d){d=!d.id;return[{title:"Kit Descriptor ID",data:"id",type:"read-only",getDisplayValue:function(e){return e.id||"Unsaved"}},{title:"Name",data:"name",type:"text",required:!0,maxLength:255},{title:"Version",data:"version",type:"int"},{title:"Manufacturer",data:"manufacturer",type:"text",required:!0,maxLength:100},{title:"Part Number",data:"partNumber",type:"text",required:!0,maxLength:50},{title:"Stock Level",data:"stockLevel",type:"int",required:!0,
min:0,initial:0},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Kit Type",include:d,data:"kitType",type:"dropdown",required:!0,source:c.kitTypes},{title:"Kit Type",include:!d,data:"kitType",type:"read-only"},{title:"Platform Type",include:d,data:"platformType",type:"dropdown",required:!0,source:Constants.platformTypes,getItemLabel:function(e){return e.key},getItemValue:function(e){return e.key}},{title:"Platform Type",include:!d,data:"platformType",type:"read-only"},{title:"Archived",
data:"archived",type:"checkbox"}]}return{getUserManualUrl:function(){return Urls.external.userManual("type_data","kit-descriptors")},getSaveUrl:function(c){return c.id?Urls.rest.kitDescriptors.update(c.id):Urls.rest.kitDescriptors.create},getSaveMethod:function(c){return c.id?"PUT":"POST"},getEditUrl:function(c){return Urls.ui.kitDescriptors.edit(c.id)},getSections:function(c,d){return[{title:"Kit Descriptor Information",fields:c.isAdmin?b(c,d):[{title:"Kit Descriptor ID",data:"id",type:"read-only"},
{title:"Name",data:"name",type:"read-only"},{title:"Version",data:"version",type:"read-only"},{title:"Manufacturer",data:"manufacturer",type:"read-only"},{title:"Part Number",data:"partNumber",type:"read-only"},{title:"Stock Level",data:"stockLevel",type:"read-only"},{title:"Description",data:"description",type:"read-only"},{title:"Kit Type",data:"kitType",type:"read-only"},{title:"Platform Type",data:"platformType",type:"read-only"},{title:"Archived",data:"archived",type:"checkbox",disabled:!0}]}]}}}(jQuery);
"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.library=function(a){function b(f,h){f={title:"Index "+h,data:"index"+h+"Id",type:"dropdown",source:d(f.indexFamilyId,h),sortSource:Utils.sorting.standardSort("label"),getItemLabel:function(k){return k.label},getItemValue:function(k){return k.id}};f.onChange=1===h?function(k,l){if(g){var p=l.get("indexFamilyId");if(p&&(p=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(p),Constants.libraryIndexFamilies),p.uniqueDualIndex&&k)){var r=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k),p.indices);
(k=p.indices.find(function(w){return 2===w.position&&w.name===r.name}))&&l.updateField("index2Id",{value:k.id})}}else c(l)}:function(k,l){c(l)};return f}function c(f){var h=f.get("indexFamilyId");if(h){var k=f.get("index1Id");(f=f.get("index2Id"))?k?(h=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(h),Constants.libraryIndexFamilies),k=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k),h.indices),f=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f),h.indices),g=k.name===f.name):
g=!1:g=!0}else g=!0}function d(f,h){return f?Utils.array.findUniqueOrThrow(function(k){return k.id==f},Constants.libraryIndexFamilies).indices.filter(function(k){return k.position===h}):[]}function e(f){return FormUtils.makeAssaysFieldWithButtons(f.requisitionAssayIds,function(h){Assay.utils.showMetrics(h,"LIBRARY_PREP")})}var g=!1;return{getUserManualUrl:function(){return Urls.external.userManual("libraries")},getSaveUrl:function(f){if(f.id)return Urls.rest.libraries.update(f.id);throw Error("Page not intended for new library creation");
},getSaveMethod:function(f){return"PUT"},getEditUrl:function(f){return Urls.ui.libraries.edit(f.id)},getSections:function(f,h){var k=Utils.array.findUniqueOrThrow(function(l){return l.key===h.platformType},Constants.platformTypes).name;return[{title:"Library Information",fields:[{title:"Library ID",data:"id",type:"read-only"},{title:"Name",data:"name",type:"read-only"},{title:"Parent Sample",data:"parentSampleAlias",type:"read-only",getLink:function(l){return Urls.ui.samples.edit(l.parentSampleId)}},
{title:"Batch",data:"batchId",type:"read-only",getDisplayValue:function(l){return l.batchId||"n/a"},getLink:function(l){return l.batchId?Urls.ui.libraries.batch(l.batchId):null}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Matrix Barcode",data:"identificationBarcode",type:"text",maxLength:255},FormUtils.makeRequisitionField(h),FormUtils.makeEffectiveRequisitionField(h),{title:"Assays",data:"requisitionAssayIds",
type:"special",makeControls:function(){return e(h)}},{title:"Date of Receipt",data:"receivedDate",type:"date"},{title:"Creation Date",data:"creationDate",type:"date"}].concat(FormUtils.makeSopFields(h,f.sops)).concat([{title:"Workstation",data:"workstationId",type:"dropdown",source:f.workstations,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Thermal Cycler",data:"thermalCyclerId",type:"dropdown",source:f.thermalCyclers,sortSource:Utils.sorting.standardSort("name"),
getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"Accession",data:"accession",type:"read-only",getLink:function(l){return Urls.external.enaAccession(l.accession)},include:h.accession},{title:"Paired",data:"paired",type:"checkbox",include:!f.detailedSample},{title:"Platform",data:"platformType",type:"dropdown",required:!0,source:Constants.platformTypes.filter(function(l){return l.active||l.key===h.platformType}),sortSource:Utils.sorting.standardSort("key"),getItemLabel:function(l){return l.key},
getItemValue:function(l){return l.key},onChange:function(l,p){var r=Utils.array.findUniqueOrThrow(function(w){return w.key===l},Constants.platformTypes);p.updateField("libraryTypeId",{source:Constants.libraryTypes.filter(function(w){return w.platform===r.name})});p.updateField("indexFamilyId",{source:Constants.libraryIndexFamilies.filter(function(w){return w.platformType===r.name})});p.updateField("kitDescriptorId",{source:Constants.kitDescriptors.filter(function(w){return"Library"===w.kitType&&w.platformType===
r.key&&(!w.archived||w.id===h.kitDescriptorId)})})}},{title:"Library Type",data:"libraryTypeId",type:"dropdown",required:!0,source:Constants.libraryTypes.filter(function(l){return l.platform===k}),sortSource:Utils.sorting.standardSort("description"),getItemLabel:function(l){return l.description},getItemValue:function(l){return l.id}},{title:"Library Design",data:"libraryDesignId",type:"dropdown",include:f.detailedSample,source:Constants.libraryDesigns.filter(function(l){return l.sampleClassId===h.parentSampleClassId}),
sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(l){return l.name},getItemValue:function(l){return l.id},onChange:function(l,p){l?(l=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(l),Constants.libraryDesigns),p.updateField("libraryDesignCodeId",{disabled:!0,value:l.designCodeId}),p.updateField("librarySelectionTypeId",{disabled:!0,value:l.selectionId}),p.updateField("libraryStrategyTypeId",{disabled:!0,value:l.strategyId})):(p.updateField("libraryDesignCodeId",{disabled:!1}),
p.updateField("librarySelectionTypeId",{disabled:!1}),p.updateField("libraryStrategyTypeId",{disabled:!1}))}},{title:"Design Code",data:"libraryDesignCodeId",type:"dropdown",include:f.detailedSample,required:!0,source:Constants.libraryDesignCodes,sortSource:Utils.sorting.standardSort("code"),getItemLabel:function(l){return l.code+" ("+l.description+")"},getItemValue:function(l){return l.id}},{title:"Library Selection Type",data:"librarySelectionTypeId",type:"dropdown",source:Constants.librarySelections,
sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(l){return l.name},getItemValue:function(l){return l.id}},{title:"Library Strategy Type",data:"libraryStrategyTypeId",type:"dropdown",source:Constants.libraryStrategies,sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(l){return l.name},getItemValue:function(l){return l.id}},{title:"Index Family",data:"indexFamilyId",type:"dropdown",nullLabel:"No indices",source:Constants.libraryIndexFamilies.filter(function(l){return l.platformType===
k}),sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(l){return l.name},getItemValue:function(l){return l.id},onChange:function(l,p){if(l){var r=d(l,2);p.updateField("index2Id",{source:r,disabled:!r||!r.length});l=d(l,1);l.length||Utils.showOkDialog("Error",["Selected index family has no indices for position 1"]);p.updateField("index1Id",{source:l,disabled:!1,required:!0})}else p.updateField("index2Id",{source:[],disabled:!0}),p.updateField("index1Id",{source:[],disabled:!0,required:!1})}},
b(h,1),b(h,2),{title:"Has UMIs",data:"umis",type:"checkbox"}].concat(FormUtils.makeDetailedQcStatusFields(h)).concat([{title:"Low Quality Sequencing",data:"lowQuality",type:"checkbox"},FormUtils.makeDnaSizeField(),{title:"Discarded",data:"discarded",type:"checkbox",onChange:function(l,p){p.updateField("volume",{disabled:l})}},{title:"Initial Volume",data:"initialVolume",type:"decimal",precision:16,scale:10,min:0,onChange:function(l,p){p.updateField("volume",{required:l})}},{title:"Volume",data:"volume",
type:"decimal",precision:16,scale:10},FormUtils.makeUnitsField(h,"volume"),{title:"Parent ng Used",data:"ngUsed",type:"decimal",precision:14,scale:10},{title:"Parent Volume Used",data:"volumeUsed",type:"decimal",precision:16,scale:10,min:0},{title:"Concentration",data:"concentration",type:"decimal",precision:14,scale:10},FormUtils.makeUnitsField(h,"concentration"),FormUtils.makeBoxLocationField(),{title:"Location Note",data:"locationBarcode",type:"text",maxLength:255},{title:"Kit",data:"kitDescriptorId",
type:"dropdown",required:!0,source:Constants.kitDescriptors.filter(function(l){return"Library"===l.kitType&&l.platformType===h.platformType&&(!l.archived||l.id===h.kitDescriptorId)}),sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(l){return l.name},getItemValue:function(l){return l.id}},{title:"Kit Lot",data:"kitLot",type:"text",maxLength:100,regex:Utils.validation.uriComponentRegex},{title:"Spike-In",data:"spikeInId",type:"dropdown",source:Constants.spikeIns,sortSource:Utils.sorting.standardSort("alias"),
getItemLabel:function(l){return l.alias},getItemValue:function(l){return l.id},onChange:function(l,p){var r={disabled:!l,required:!!l};l||(r.value="");p.updateField("spikeInDilutionFactor",r);p.updateField("spikeInVolume",r)}},{title:"Spike-In Dilution Factor",data:"spikeInDilutionFactor",type:"dropdown",source:Constants.dilutionFactors,sortSource:function(l,p){return l.length-p.length},nullLabel:"n/a"},{title:"Spike-In Volume",data:"spikeInVolume",type:"decimal",precision:14,scale:10}]))},{title:"Details",
include:f.detailedSample,fields:[{title:"External Names",data:"effectiveExternalNames",type:"read-only"},{title:"Tissue Origin",data:"effectiveTissueOriginAlias",getDisplayValue:function(l){return l.effectiveTissueOriginAlias+" ("+l.effectiveTissueOriginDescription+")"},type:"read-only"},{title:"Tissue Type",data:"effectiveTissueTypeAlias",getDisplayValue:function(l){return l.effectiveTissueTypeAlias+" ("+l.effectiveTissueTypeDescription+")"},type:"read-only"},{title:"Effective Group ID",data:"effectiveGroupId",
type:"read-only",getDisplayValue:function(l){return l.hasOwnProperty("effectiveGroupId")&&null!==l.effectiveGroupId?l.effectiveGroupId+" ("+l.effectiveGroupIdSample+")":"None"}},{title:"Group ID",data:"groupId",type:"text",maxLength:100,regex:Utils.validation.alphanumRegex},{title:"Group Description",data:"groupDescription",type:"text",maxLength:255},{title:"Archived",data:"archived",type:"checkbox"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.libraryaliquot=function(a){function b(c){return FormUtils.makeAssaysFieldWithButtons(c.requisitionAssayIds,function(d){Utils.showWizardDialog("View Metrics",[{name:"Library Preparation",handler:function(){Assay.utils.showMetrics(d,"LIBRARY_PREP")}},{name:"Library Qualification",handler:function(){Assay.utils.showMetrics(d,"LIBRARY_QUALIFICATION")}}],"Select category to view metrics. Relevant category depends on the assay test that this library aliquot will be used for. Sequencing metrics may be included.")})}
return{getUserManualUrl:function(){return Urls.external.userManual("library_aliquots")},getSaveUrl:function(c){if(c.id)return Urls.rest.libraryAliquots.update(c.id);throw Error("Page not intended for new library aliquot creation");},getSaveMethod:function(c){return"PUT"},getEditUrl:function(c){return Urls.ui.libraryAliquots.edit(c.id)},getSections:function(c,d){return[{title:"Library Aliquot Information",fields:[{title:"Library Aliquot ID",data:"id",type:"read-only"},{title:"Name",data:"name",type:"read-only"},
{title:"Parent Library Aliquot",data:"parentAliquotId",include:!!d.parentAliquotId,type:"read-only",getDisplayValue:function(e){return e.parentAliquotAlias},getLink:function(e){return Urls.ui.libraryAliquots.edit(e.parentAliquotId)}},{title:"Parent Library",data:"libraryId",include:!d.parentAliquotId,type:"read-only",getDisplayValue:function(e){return e.libraryAlias},getLink:function(e){return Urls.ui.libraries.edit(e.libraryId)}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},
{title:"Description",data:"description",type:"text",maxLength:255},{title:"Matrix Barcode",data:"identificationBarcode",type:"text",maxLength:255},{title:"Requisition",data:"requisitionId",type:"read-only",getDisplayValue:function(e){return e.requisitionAlias||"n/a"},getLink:function(e){return e.requisitionId?Urls.ui.requisitions.edit(e.requisitionId):null}},{title:"Assays",data:"requisitionAssayIds",type:"special",makeControls:function(){return b(d)}},{title:"Design Code",data:"libraryDesignCodeId",
type:"dropdown",include:c.detailedSample,required:!0,source:Constants.libraryDesignCodes,sortSource:Utils.sorting.standardSort("code"),getItemLabel:function(e){return e.code+" ("+e.description+")"},getItemValue:function(e){return e.id},onChange:function(e,g){e={required:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),Constants.libraryDesignCodes).targetedSequencingRequired};g.updateField("kitDescriptorId",e);g.updateField("targetedSequencingId",e)}}].concat(FormUtils.makeDetailedQcStatusFields(d)).concat([FormUtils.makeDnaSizeField(),
{title:"Discarded",data:"discarded",type:"checkbox",onChange:function(e,g){g.updateField("volume",{disabled:e})}},{title:"Volume",data:"volume",type:"decimal",precision:16,scale:10},FormUtils.makeUnitsField(d,"volume"),{title:"Concentration",data:"concentration",type:"decimal",precision:14,scale:10},FormUtils.makeUnitsField(d,"concentration"),FormUtils.makeBoxLocationField(),{title:"Creation Date",data:"creationDate",required:"true",type:"date"},{title:"Kit",data:"kitDescriptorId",type:"dropdown",
source:Constants.kitDescriptors.filter(function(e){return"Library"===e.kitType&&e.platformType===d.libraryPlatformType&&(!e.archived||e.id===d.kitDescriptorId)}),sortSource:Utils.sorting.standardSort("name"),getItemLabel:function(e){return e.name},getItemValue:function(e){return e.id},onChange:function(e,g){var f=e?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),Constants.kitDescriptors):null;e=f?Constants.targetedSequencings.filter(function(h){return-1!==h.kitDescriptorIds.indexOf(f.id)&&
(!h.archived||d.targetedSequencingId===h.id)}):[];g.updateField("targetedSequencingId",{source:e})}},{title:"Kit Lot",data:"kitLot",type:"text",maxLength:100,regex:Utils.validation.uriComponentRegex},{title:"Targeted Sequencing",data:"targetedSequencingId",type:"dropdown",source:d.kitDescriptorId?Constants.targetedSequencings.filter(function(e){return-1!==e.kitDescriptorIds.indexOf(d.kitDescriptorId)&&(!e.archived||d.targetedSequencingId===e.id)}):[],sortSource:Utils.sorting.standardSort("alias"),
getItemLabel:function(e){return e.alias},getItemValue:function(e){return e.id}},{title:"Parent ng Used",data:"ngUsed",type:"decimal",precision:14,scale:10,min:0},{title:"Parent Volume Used",data:"volumeUsed",type:"decimal",precision:16,scale:10,min:0}])},{title:"Details",include:c.detailedSample,fields:[{title:"Tissue Origin",data:"effectiveTissueOriginAlias",getDisplayValue:function(e){return e.effectiveTissueOriginAlias+" ("+e.effectiveTissueOriginDescription+")"},type:"read-only"},{title:"Tissue Type",
data:"effectiveTissueTypeAlias",getDisplayValue:function(e){return e.effectiveTissueTypeAlias+" ("+e.effectiveTissueTypeDescription+")"},type:"read-only"},{title:"Effective Group ID",data:"effectiveGroupId",type:"read-only",getDisplayValue:function(e){return e.hasOwnProperty("effectiveGroupId")&&null!==e.effectiveGroupId?e.effectiveGroupId+" ("+e.effectiveGroupIdSample+")":"None"}},{title:"Group ID",data:"groupId",type:"text",maxLength:100,regex:Utils.validation.alphanumRegex},{title:"Group Description",
data:"groupDescription",type:"text",maxLength:255}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.librarybatch=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("libraries")},getSaveUrl:function(b){throw Error("Batches cannot be saved");},getSaveMethod:function(b){throw Error("Batches cannot be saved");},getEditUrl:function(b){return Urls.ui.libraries.batch(b.id)},getSections:function(b,c){return[{title:"Batch Information",fields:[{title:"Batch ID",data:"batchId",type:"read-only"},{title:"Creation Date",data:"date",type:"read-only"},{title:"Creator",data:"username",
type:"read-only"},{title:"SOP",data:"sopLabel",type:"read-only",getLink:function(d){return d.sopUrl}},{title:"Kit",data:"kitName",type:"read-only"},{title:"Kit Lot",data:"kitLot",type:"read-only"}]}]}}}(jQuery);FormTarget=FormTarget||{};
FormTarget.libraryindexfamily=function(a){function b(d,e){return[{title:"Index Family ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Name",data:"name",type:"text",required:!0,maxLength:255},{title:"Platform",data:"platformType",type:"dropdown",include:"create"===d.pageMode,required:!0,source:Constants.platformTypes,getItemLabel:function(g){return g.key},getItemValue:Utils.array.getName},{title:"Platform",data:"platformType",include:"create"!==d.pageMode,
type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.platformType),Constants.platformTypes).key}},{title:"Multi-Sequence Indices",data:"fakeSequence",type:"checkbox",disabled:"create"!==d.pageMode,description:'Indicates that there are multiple sequences belonging to each index, and all of those sequences should be treated as the same index. These indices can be given an additional "demultiplexing name" to be used by downstream analysis for demultiplexing.'},
{title:"Unique Dual Indices",data:"uniqueDualIndex",type:"checkbox",description:"For dual-index families, indicates that indices are usually added to libraries in the same pairs, as opposed to mixing any index 1 with any index 2. When selecting the first index for a library, the second will be selected automatically. For this to work, both indices in a pair must have the same name."},{title:"Archived",data:"archived",type:"checkbox",description:"Archived index families will not show up in the options list when creating new libraries"}]}
function c(d,e){a("#save").remove();return[{title:"Index Family ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Name",data:"name",type:"read-only"},{title:"Platform",data:"platformType",type:"read-only",getDisplayValue:function(g){return Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.platformType),Constants.platformTypes).key}},{title:"Multi-Sequence Indices",data:"fakeSequence",type:"checkbox",disabled:!0},{title:"Unique Dual Indices",data:"uniqueDualIndex",
type:"checkbox",disabled:!0},{title:"Archived",data:"archived",type:"checkbox",disabled:!0}]}return{getUserManualUrl:function(){return Urls.external.userManual("type_data","indices")},getSaveUrl:function(d){return d.id?Urls.rest.libraryIndexFamilies.update(d.id):Urls.rest.libraryIndexFamilies.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.libraryIndexFamilies.edit(d.id)},getSections:function(d,e){return[{title:"Library Index Family Information",fields:d.isAdmin?
b(d,e):c(d,e)}]}}}(jQuery);FormTarget=FormTarget||{};
FormTarget.librarytemplate=function(a){function b(f,h,k,l){h?l.updateField(f,{value:h[k],disabled:!0}):l.updateField(f,{disabled:!1})}function c(f){return f?Utils.array.findUniqueOrThrow(Utils.array.namePredicate(f),Constants.platformTypes):null}function d(f,h){return f?Constants.libraryTypes.filter(function(k){return k.platform===f.name&&(!k.archived||h.libraryTypeId===k.id)}):[]}function e(f,h){return f?Constants.kitDescriptors.filter(function(k){return k.platformType==f.key&&"Library"==k.kitType&&
(!k.archived||k.id===h)}):[]}function g(f,h){return f?Constants.libraryIndexFamilies.filter(function(k){return k.platformType==f.name&&(!k.archived||k.id===h.indexFamilyId)}):[]}return{getUserManualUrl:function(){return Urls.external.userManual("libraries","library-templates")},getSaveUrl:function(f){return f.id?Urls.rest.libraryTemplates.update(f.id):Urls.rest.libraryTemplates.create},getSaveMethod:function(f){return f.id?"PUT":"POST"},getEditUrl:function(f){return Urls.ui.libraryTemplates.edit(f.id)},
getSections:function(f,h){return[{title:"Template Information",fields:[{title:"Template ID",data:"id",type:"read-only",getDisplayValue:function(k){return k.id||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Design",data:"designId",type:"dropdown",include:Constants.isDetailedSample,source:Constants.libraryDesigns,getItemLabel:function(k){return k.name+" - "+Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k.sampleClassId),Constants.sampleClasses).alias},
getItemValue:Utils.array.getId,nullLabel:"Unspecified",onChange:function(k,l){k=k?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k),Constants.libraryDesigns):null;b("designCodeId",k,"designCodeId",l);b("selectionId",k,"selectionId",l);b("strategyId",k,"strategyId",l)}},{title:"Code",data:"designCodeId",type:"dropdown",include:Constants.isDetailedSample,source:Constants.libraryDesignCodes,getItemLabel:function(k){return k.code},getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Platform",
data:"platformType",type:"dropdown",source:Constants.platformTypes.filter(function(k){return k.active||h.platformType===k.name}),getItemLabel:function(k){return k.key},getItemValue:Utils.array.getName,nullLabel:"Unspecified",onChange:function(k,l){k=c(k);l.updateField("libraryTypeId",{source:d(k,h)});l.updateField("kitDescriptorId",{source:e(k,h.kitDescriptorId)});l.updateField("indexFamilyId",{source:g(k,h)})}},{title:"Type",data:"libraryTypeId",type:"dropdown",source:d(c(h.platformType),h),getItemLabel:function(k){return k.description},
getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Selection",data:"selectionId",type:"dropdown",source:Constants.librarySelections,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Strategy",data:"strategyId",type:"dropdown",source:Constants.libraryStrategies,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Kit",data:"kitDescriptorId",type:"dropdown",source:e(c(h.platformType),h.kitDescriptorId),
getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Index Kit",data:"indexFamilyId",type:"dropdown",source:g(c(h.platformType),h),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Default Volume",data:"defaultVolume",type:"decimal",precision:14,scale:10,min:0},{title:"Volume Units",data:"volumeUnits",type:"dropdown",source:Constants.volumeUnits,getItemLabel:function(k){return Utils.decodeHtmlString(k.units)},
getItemValue:Utils.array.getName,nullLabel:"Unspecified"}]}]},confirmSave:function(f){LibraryTemplate.applyIndices(f);LibraryTemplate.applyProjects(f)}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.pool=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("pools")},getSaveUrl:function(b){return b.id?Urls.rest.pools.update(b.id):Urls.rest.pools.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.pools.edit(b.id)},getSections:function(b,c){return[{title:"Pool Information",fields:[{title:"Pool ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Name",data:"name",type:"read-only",
getDisplayValue:function(d){return d.name||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Matrix Barcode",data:"identificationBarcode",type:"text",maxLength:255},{title:"Platform Type",data:"platformType",type:"dropdown",include:!c.platformType,required:!0,source:Constants.platformTypes.filter(function(d){return d.active}),sortSource:Utils.sorting.standardSort("key"),getItemLabel:function(d){return d.key},
getItemValue:function(d){return d.name}},{title:"Platform Type",data:"platformType",type:"read-only",include:!!c.platformType,getDisplayValue:function(d){return Utils.array.findUniqueOrThrow(Utils.array.namePredicate(d.platformType),Constants.platformTypes).key}},{title:"Concentration",data:"concentration",type:"decimal"},FormUtils.makeUnitsField(c,"concentration"),{title:"Creation Date",data:"creationDate",type:"date",required:!0,initial:Utils.getCurrentDate()},FormUtils.makeQcPassedField(),FormUtils.makeDnaSizeField(),
{title:"Volume",data:"volume",type:"decimal",precision:16,scale:10,min:0},FormUtils.makeUnitsField(c,"volume"),{title:"Discarded",data:"discarded",type:"checkbox",onChange:function(d,e){e.updateField("volume",{disabled:d})}},FormUtils.makeBoxLocationField(!0)]}]},confirmSave:function(b,c){c||(b.pooledElements=Pool.getAliquots());if(!b.id&&!b.identificationBarcode&&!Constants.automaticBarcodes)return b=a.Deferred(),Utils.showConfirmDialog("Missing Barcode","Save",["Pools should usually have barcodes. Are you sure you wish to save without one?"],
b.resolve,b.reject),b.promise()}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.poolorder=function(a){function b(q){var t=null;q.parametersId?(q=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.parametersId),Constants.sequencingParameters),t=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.instrumentModelId),Constants.instrumentModels).platformType):q.libraries&&q.libraries.length&&(t=q.libraries[0].library.platformType);return null==t?null:Utils.array.findUniqueOrThrow(Utils.array.namePredicate(t),Constants.platformTypes)}function c(q,t,z){var x={source:q?
Constants.instrumentModels.filter(function(F){return F.platformType===q.name&&"SEQUENCER"===F.instrumentType}):[]};z&&source.some(Utils.array.idPredicate(z.id))&&(x.value=z.id);t("instrumentModel",x)}function d(q){return function(t){var z=[];q.poolId?q.sequencingOrderId?z.push(e("Unlink Sequencing Order",v,t)):(z.push(e("Unlink Pool",p,t)),"Fulfilled"!==q.status&&z.push(e("Create Sequencing Order",w,t),e("Link Sequencing Order",r,t))):z.push(e("Create Pool",f,t),e("Link Pool",h,t));return z}}function e(q,
t,z){return a("\x3cbutton\x3e").addClass("ui-state-default").attr("type","button").text(q).click(g(z,t)).after(" ")}function g(q,t){return function(){q.isChanged()?Utils.showOkDialog("Error",["Please save your changes first"]):t(q)}}function f(q){var t=PoolOrder.getAliquots();t&&t.length?Utils.showConfirmDialog("Create Pool","Yes",["Pool will contain the following aliquots and proportions."].concat(t.map(function(z){return"*"+z.aliquot.alias+" ("+z.proportion+")"})).concat(["Is this correct?"]),function(){var z=
t[0].aliquot.libraryPlatformType,x={platformType:Utils.array.findUniqueOrThrow(function(F){return F.key===z},Constants.platformTypes).name,pooledElements:t.map(function(F){var n=F.aliquot;n.proportion=F.proportion;return n})};FormUtils.createFormDialog("Create Pool",x,"pool",{},function(F){k(q,F)})}):Utils.showOkDialog("Error",["Please add aliquots before creating a pool"])}function h(q){Utils.showDialog("Fulfil Pool Order","Search",[{label:"Pool name, alias, or barcode",required:!0,type:"text",property:"query"}],
function(t){Utils.ajaxWithDialog("Searching...","GET",Urls.rest.pools.search+"?"+Utils.page.param({q:t.query}),null,function(z){z&&z.length?1===z.length?k(q,z[0]):Utils.showWizardDialog("Choose Pool",z.map(function(x){return{name:x.name+" ("+x.alias+")",handler:function(){k(q,x)}}})):Utils.showOkDialog("Results",["No pools found"])})})}function k(q,t){var z=[],x=[];PoolOrder.getAliquots().forEach(function(F){var n=Utils.array.findFirstOrNull(function(m){return m.id===F.aliquot.id||m.parentAliquotIds&&
-1!==m.parentAliquotIds.indexOf(F.aliquot.id)},t.pooledElements);n?n.proportion!==n.proportion&&x.push(n):z.push(F)});z.length?Utils.showOkDialog("Error",["Selected pool does not contain the following library aliquots"].concat(z.map(function(F){return"* "+F.aliquot.name+" ("+F.aliquot.alias+")"}))):x.length?Utils.showConfirmDialog("Confirm Proportions","Confirm",["Selected pool contains all of the required library aliquots, "+"but the following are at different proportions".concat(x.map(function(F){return"* "+
F.name+" ("+F.alias+"): "+F.proportion})).concat(["Are you sure you wish to use this pool?"])],l(q,t)):l(q,t)}function l(q,t){t&&(t.duplicateIndices||t.nearDuplicateIndices)?Utils.showOkDialog("Error",["Selected pool contains duplicate or near duplicate indices."]):(q.updateField("poolId",{value:t?t.id:null,label:t?t.alias:"not linked",link:t?Urls.ui.pools.edit(t.id):null}),q.save())}function p(q){Utils.showConfirmDialog("Unlink Pool","Yes",["Are you sure you wish to unlink the pool from this order? The order will be unfulfilled."],
function(){l(q,null)})}function r(q){Utils.ajaxWithDialog("Finding Sequencing Orders","GET",Urls.rest.sequencingOrders.search+"?"+Utils.page.param({poolId:q.get("poolId"),purposeId:q.get("purposeId"),containerModelId:q.get("containerModelId"),parametersId:q.get("parametersId"),partitions:q.get("partitions")}),null,function(t){switch(t.length){case 0:Utils.showOkDialog("Link Sequencing Order",["No matching sequencing orders found"]);break;case 1:Utils.showConfirmDialog("Link Sequencing Order","Link",
["1 matching sequencing order found. Link to pool order?"],function(){E(q,t[0])});break;default:Utils.showWizardDialog("Link Sequencing Order",t.map(function(z){return{name:"Sequencing order "+z.id+(z.description?" - "+z.description:""),handler:function(){E(q,z)}}}))}})}function w(q){var t=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.get("purposeId")),Constants.runPurposes);t={purposeId:t.id,purposeAlias:t.alias,containerModelId:q.get("containerModelId"),parameters:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.get("parametersId")),
Constants.sequencingParameters),partitions:q.get("partitions"),pool:{id:q.get("poolId")}};FormUtils.createFormDialog("Create Sequencing Order",t,"sequencingorder",{},function(z){E(q,z)})}function v(q){Utils.showConfirmDialog("Unlink Sequencing Order","Yes",["Are you sure you wish to unlink the sequencing order from this pool order? The order will be unfulfilled."],function(){E(q,null)})}function E(q,t){q.updateField("sequencingOrderId",{value:t?t.id:null,label:t?"linked":"not linked"});q.save()}return{getUserManualUrl:function(){return Urls.external.userManual("pool_orders")},
getSaveUrl:function(q){return q.id?Urls.rest.poolOrders.update(q.id):Urls.rest.poolOrders.create},getSaveMethod:function(q){return q.id?"PUT":"POST"},getEditUrl:function(q){return Urls.ui.poolOrders.edit(q.id)},getSections:function(q,t){var z=b(t);q=null;t.parametersId&&(q=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(t.parametersId),Constants.sequencingParameters),q=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q.instrumentModelId),Constants.instrumentModels));return[{title:"Order Information",
fields:[{title:"Pool Order ID",data:"id",type:"read-only",getDisplayValue:function(x){return x.id||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Purpose",data:"purposeId",type:"dropdown",required:!0,source:Constants.runPurposes,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias")},{title:"Specify sequencing requirements?",data:"sequencingRequirements",
type:"checkbox",omit:!0,initial:!!t.partitions,onChange:function(x,F){var n={disabled:!x,required:x};x||(n.value=null);["platform","instrumentModel","parametersId","partitions"].forEach(function(m){F.updateField(m,n)});F.updateField("containerModelId",{disabled:!x,required:x&&(!t.id||!!t.containerModelId)})}},{title:"Platform",data:"platform",omit:!0,type:"dropdown",source:Constants.platformTypes.filter(function(x){return x.active}),getItemLabel:function(x){return x.key},getItemValue:Utils.array.getName,
nullLabel:"Unspecified",include:!z,onChange:function(x,F){x=x?Utils.array.findUniqueOrThrow(Utils.array.namePredicate(x),Constants.platformTypes):null;c(x,F.updateField)}},{title:"Platform",data:"platform",omit:!0,type:"read-only",initial:z?z.key:null,include:!!z},{title:"Instrument Model",data:"instrumentModel",omit:!0,type:"dropdown",initial:q?q.id:null,source:z?Constants.instrumentModels.filter(function(x){return x.platformType===z.name&&"SEQUENCER"===x.instrumentType}):[],sortSource:Utils.sorting.standardSort("alias"),
getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,nullLabel:"Unspecified",onChange:function(x,F){if(x){var n=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(x),Constants.instrumentModels),m={source:n.containerModels};t.containerModelId&&n.containerModels.find(Utils.array.idPredicate(t.containerModelId))&&(m.value=t.containerModelId);F.updateField("containerModelId",m);n=Constants.sequencingParameters.filter(function(u){return u.instrumentModelId==x});m={source:n};t.parametersId&&
n.find(Utils.array.idPredicate(t.parametersId))&&(m.value=t.parametersId);F.updateField("parametersId",m)}else F.updateField("parametersId",{source:[]}),F.updateField("containerModelId",{source:[]})}},{title:"Container Model",data:"containerModelId",type:"dropdown",source:[],sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,nullLabel:t.containerModelId?void 0:"Unspecified"},{title:"Sequencing Parameters",data:"parametersId",type:"dropdown",
source:[],sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,nullLabel:"Unspecified"},{title:"Partitions Required",data:"partitions",type:"int",min:1},{title:"Draft",data:"draft",type:"checkbox"},{title:"Status",data:"status",type:"read-only",include:!!t.id},{title:"Pool",data:"poolId",type:"read-only",include:!!t.id,getDisplayValue:function(x){return x.poolId?x.poolAlias:"not linked"},getLink:function(x){return x.poolId?Urls.ui.pools.edit(x.poolId):
null}},{title:"Sequencing Order",data:"sequencingOrderId",type:"read-only",include:!!t.id,getDisplayValue:function(x){return x.partitions?x.sequencingOrderId?"linked":"not linked":"n/a"}},{title:"Fulfillment",type:"special",include:!!t.id&&!t.draft,makeControls:d(t)}]}]},confirmSave:function(q){q.orderAliquots=PoolOrder.getAliquots()}}}(jQuery);FormTarget=FormTarget||{};
FormTarget.project=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("projects")},getSaveUrl:function(b){return b.id?Urls.rest.projects.update(b.id):Urls.rest.projects.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.projects.edit(b.id)},getSections:function(b,c){return[{title:"Project Information",fields:[{title:"Project ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Name",data:"name",
type:"read-only",getDisplayValue:function(d){return d.name||"Unsaved"}},{title:"Creation Date",data:"creationDate",type:"read-only"},{title:"Title",data:"title",type:"text",required:!0,maxLength:100},{title:"Use Secondary Naming Scheme",data:"secondaryNaming",type:"checkbox",include:!!b.naming.secondary&&!c.id,onChange:function(d,e){d=b.naming[d?"secondary":"primary"];e.updateField("code",{required:Constants.isDetailedSample||d.codeRequired,disabled:!d.codeModifiable})}},{title:"Use Secondary Naming Scheme",
data:"secondaryNaming",type:"read-only",include:!!b.naming.secondary&&c.id,getDisplayValue:function(d){return d.secondaryNaming?"Yes (Secondary)":"No (Primary)"}},{title:"Code",data:"code",type:"text",maxLength:255,required:Constants.isDetailedSample||b.naming.primary.codeRequired,disabled:!b.naming.primary.codeModifiable},{title:"REB Number",description:"Research ethics board approval number",data:"rebNumber",type:"text",maxLength:50},{title:"REB Expiry",description:"Expiry date of research ethics board approval",
data:"rebExpiry",type:"date"},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Additional Details",data:"additionalDetails",type:"textarea",description:"Long text field, can be more in-depth than the 'Description' field",regex:"^[^\x3c\x3e]*$",maxLength:65535},{title:"Status",data:"status",type:"dropdown",required:!0,source:b.statusOptions},{title:"Reference Genome",data:"referenceGenomeId",type:"dropdown",required:"true",source:Constants.referenceGenomes,sortSource:Utils.sorting.standardSortWithException("alias",
"Unknown",!0),getItemLabel:function(d){return d.alias},getItemValue:function(d){return d.id}},{title:"Default Targeted Sequencing",data:"defaultTargetedSequencingId",type:"dropdown",source:Constants.targetedSequencings,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:function(d){return d.alias},getItemValue:function(d){return d.id}},{title:"Pipeline",data:"pipelineId",type:"dropdown",source:Constants.pipelines,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias"),
required:!0,nullLabel:"(Choose)"},{title:"Samples Expected",data:"samplesExpected",type:"int",min:1}]}]},confirmSave:function(b,c,d){b.assayIds=Project.getAssays().map(Utils.array.getId);b.deliverableIds=Project.getDeliverables().map(Utils.array.getId);b.contacts=Project.getContacts()}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.qctype=function(a){function b(e,g){a("#save").remove();return[{title:"QC Type ID",data:"id",type:"read-only"},{title:"Name",data:"name",type:"read-only"},{title:"Description",data:"description",type:"read-only"},{title:"Target",data:"qcTarget",type:"read-only"},{title:"Units",data:"units",type:"read-only"},{title:"Results Format",data:"resultsFormat",omit:!0,type:"read-only",getDisplayValue:function(f){return-1===f.precisionAfterDecimal?"Yes/No":"Numbers"}},{title:"Precision After Decimal",
data:"precisionAfterDecimal",type:"read-only",include:-1!==g.precisionAfterDecimal},{title:"Corresponding Field",data:"correspondingField",type:"read-only"},{title:"Auto Update Field",data:"autoUpdateField",type:"checkbox",disabled:!0},{title:"Instrument Model",data:"instrumentModelId",type:"read-only",getDisplayValue:function(f){return f.instrumentModelId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.instrumentModelId),Constants.instrumentModels).alias:"n/a"}},{title:"Archived",data:"archived",
type:"checkbox",disabled:!0}]}function c(e,g){return[{title:"QC Type ID",data:"id",type:"read-only",getDisplayValue:function(f){return f.id||"Unsaved"}},{title:"Name",data:"name",type:"text",required:!0,maxLength:255},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Target",data:"qcTarget",type:"dropdown",required:!0,source:Constants.qcTargets,getItemLabel:function(f){return f.qcTarget},getItemValue:function(f){return f.qcTarget},onChange:function(f,h){h.updateField("correspondingField",
{source:d(f)})}},{title:"Units",data:"units",type:"text",maxLength:20},{title:"Results Format",data:"resultsFormat",omit:!0,type:"dropdown",required:!0,source:[{label:"Numbers",value:0},{label:"Yes/No",value:-1}],getItemLabel:function(f){return f.label},getItemValue:function(f){return f.value},onChange:function(f,h){var k={disabled:"-1"===f};"-1"===f?k.value=-1:-1===h.get("precisionAfterDecimal")&&(k.value="");h.updateField("precisionAfterDecimal",k)},initial:-1===g.precisionAfterDecimal?-1:0},{title:"Precision After Decimal",
data:"precisionAfterDecimal",type:"int",required:!0,min:-1,max:10},{title:"Corresponding Field",data:"correspondingField",type:"dropdown",required:!0,source:g.qcTarget?d(g.qcTarget):[]},{title:"Auto Update Field",data:"autoUpdateField",type:"checkbox"},{title:"Instrument Model",data:"instrumentModelId",type:"dropdown",source:Constants.instrumentModels.filter(function(f){return f.active||f.id===g.instrumentModelId}),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("alias")},
{title:"Archived",data:"archived",type:"checkbox"}]}function d(e){return Utils.array.findUniqueOrThrow(function(g){return g.qcTarget===e},Constants.qcTargets).correspondingFields}return{getUserManualUrl:function(){return Urls.external.userManual("type_data","qc-types")},getSaveUrl:function(e){return e.id?Urls.rest.qcTypes.update(e.id):Urls.rest.qcTypes.create},getSaveMethod:function(e){return e.id?"PUT":"POST"},getEditUrl:function(e){return Urls.ui.qcTypes.edit(e.id)},getSections:function(e,g){return[{title:"QC Type Information",
fields:e.isAdmin?c(e,g):b(e,g)}]},confirmSave:function(e){e.controls=QcType.getControls();e.kitDescriptors=QcType.getKits()}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.requisition=function(){return{getUserManualUrl:function(){return Urls.external.userManual("requisitions")},getSaveUrl:function(a){return a.id?Urls.rest.requisitions.update(a.id):Urls.rest.requisitions.create},getSaveMethod:function(a){return a.id?"PUT":"POST"},getEditUrl:function(a){return Urls.ui.requisitions.edit(a.id)},getSections:function(a,b){b=[];if(void 0!==a.potentialAssayIds)for(var c=0;c<a.potentialAssayIds.length;c++){var d=Constants.assays.find(function(e){return e.id===a.potentialAssayIds[c]});
b.push(d)}return[{title:"Requisition Information",fields:[FormUtils.makeIdField("Requisition"),{title:"Alias",type:"text",data:"alias",required:!0,maxLength:150,description:"Should usually match the identifier of a requisition form stored in a separate system"},{title:"Stopped",type:"checkbox",data:"stopped",onChange:function(e,g){var f={disabled:!e,required:e};e||(f.value=null);g.updateField("stopReason",f)}},{title:"Stop Reason",type:"text",data:"stopReason"}]}]},confirmSave:function(a,b,c){a.assayIds=
Requisition.getAssays().map(Utils.array.getId);a.pauses=Requisition.getPauses()}}}();"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.run=function(a){function b(c){return Utils.array.findUniqueOrThrow(function(d){return d.label===c},Constants.healthTypes)}return{getUserManualUrl:function(){return Urls.external.userManual("sequencing_runs")},getSaveUrl:function(c){return c.id?Urls.rest.runs.update(c.id):Urls.rest.runs.create},getSaveMethod:function(c){return c.id?"PUT":"POST"},getEditUrl:function(c){return Urls.ui.runs.edit(c.id)},getSections:function(c,d){var e=Utils.array.findUniqueOrThrow(function(g){return g.key===
d.platformType},Constants.platformTypes);return[{title:"Run Information",fields:[{title:"Run ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Name",data:"name",type:"read-only",getDisplayValue:function(g){return g.name||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Accession",data:"accession",type:"read-only",getLink:function(g){return Urls.external.enaAccession(g.accession)},include:d.accession},{title:"Platform",
data:"platformType",type:"read-only"},{title:"Sequencer",data:"instrumentId",type:"read-only",getDisplayValue:function(g){return g.instrumentName+" - "+g.instrumentModelAlias},getLink:function(g){return Urls.ui.instruments.edit(g.instrumentId)}}].concat(FormUtils.makeSopFields(d,c.sops)).concat([{title:"Sequencing Parameters",data:"sequencingParametersId",type:"dropdown",nullLabel:"SELECT",source:Constants.sequencingParameters.filter(function(g){return g.instrumentModelId===d.instrumentModelId}),
getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,include:!e.containerLevelParameters,required:!0},{title:"Sequencing Kit",data:"sequencingKitId",type:"dropdown",nullLabel:"N/A",source:Constants.kitDescriptors.filter(function(g){return"Sequencing"===g.kitType&&g.platformType===d.platformType&&(!g.archived||g.id===d.sequencingKitId)}),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,onChange:function(g,f){var h={disabled:!g};g||(h.value=null);f.updateField("sequencingKitLot",
h)}},{title:"Sequencing Kit Lot",data:"sequencingKitLot",type:"text",maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Run Path",data:"runPath",type:"text",maxLength:255},{title:"Workflow Type",include:"Illumina"===d.platformType,data:"workflowType",type:"dropdown",nullLabel:"N/A",source:Constants.illuminaWorkflowTypes,getItemLabel:function(g){return g.label},getItemValue:function(g){return g.value}},{title:"Index Sequencing",data:"dataManglingPolicy",type:"dropdown",
source:Constants.dataManglingPolicies,getItemLabel:function(g){return g.label},getItemValue:function(g){return g.value},nullLabel:"Instrument Default"},{title:"Number of Cycles",include:"Illumina"===d.platformType,data:"numCycles",type:"int",min:"0"},{title:"Called Cycles",include:"Illumina"===d.platformType,data:"calledCycles",type:"int",min:"0"},{title:"Imaged Cycles",include:"Illumina"===d.platformType,data:"imagedCycles",type:"int",min:"0"},{title:"Scored Cycles",include:"Illumina"===d.platformType,
data:"scoredCycles",type:"int",min:"0"},{title:"Cycles",include:"LS454"===d.platformType,data:"cycles",type:"int",min:"0"},{title:"Paired End",include:-1!==["Illumina","Solid","LS454"].indexOf(d.platformType),data:"pairedEnd",type:"checkbox"},{title:"MinKNOW Version",include:"Oxford Nanopore"===d.platformType,data:"minKnowVersion",type:"text",maxLength:100},{title:"Protocol Version",include:"Oxford Nanopore"===d.platformType,data:"protocolVersion",type:"text",maxLength:100},{title:"Status",data:"status",
type:"dropdown",source:Constants.healthTypes.filter(function(g){return g.allowedFromSequencer}),getItemLabel:function(g){return g.label},getItemValue:function(g){return g.label},onChange:function(g,f){g=b(g);var h={required:g.isDone,disabled:!g.isDone||f.get("endDate")&&!c.isAdmin};g.isDone||(h.value=null);f.updateField("endDate",h)},required:!0,disabled:d.status?b(d.status).isDone&&!c.isAdmin:!1},{title:"Start Date",data:"startDate",type:"date",required:!0,disabled:d.startDate&&!c.isAdmin},{title:"Completion Date",
data:"endDate",type:"date"},function(){var g=FormUtils.makeQcPassedField();g.onChange=function(f,h){c.isRunReviewer?h.updateField("dataReview",{disabled:null===f,value:null!==f&&f===d.qcPassed?void 0:null}):(null===f||f!==d.qcPassed)&&h.updateField("dataReview",{label:"Pending"});if(null===f||f!==d.qcPassed)h.updateField("dataReviewer",{label:"n/a"}),h.updateField("dataReviewDate",{label:"n/a"})};return g}(),FormUtils.makeQcUserField(),FormUtils.makeQcDateField(),{title:"Data Review",data:"dataReview",
type:"dropdown",include:c.isRunReviewer,source:[{label:"Pass",value:!0},{label:"Fail",value:!1}],convertToBoolean:!0,getItemLabel:function(g){return g.label},getItemValue:function(g){return g.value},nullLabel:"Pending"},{title:"Data Review",data:"dataReview",type:"read-only",getDisplayValue:function(g){return!0===g.dataReview?"Pass":!1===g.dataReview?"Fail":"Pending"},include:!c.isRunReviewer},{title:"Data Reviewer",data:"dataReviewer",type:"read-only",getDisplayValue:function(g){return g.dataReviewer||
"n/a"}},{title:"Data Review Date",data:"dataReviewDate",type:"read-only",getDisplayValue:function(g){return g.dataReviewDate||"n/a"}}])}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.sample=function(a){function b(d){return FormUtils.makeAssaysFieldWithButtons(d.requisitionAssayIds,function(e){d.requisitionId?Assay.utils.showMetrics(e,"RECEIPT"):"Stock"===d.sampleCategory?Assay.utils.showMetrics(e,"EXTRACTION"):Utils.showOkDialog("Error",["No metrics applicable to "+d.sampleCategory])})}function c(d){return[{title:"Index Family",data:"indexFamilyId",type:"dropdown",include:Constants.sampleIndexFamilies&&Constants.sampleIndexFamilies.length,nullLabel:"No indices",source:Constants.sampleIndexFamilies,
sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,onChange:function(e,g){var f={disabled:!e,required:!!e};e?(e=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e),Constants.sampleIndexFamilies),f.source=e.indices):f.source=[];g.updateField("indexId",f)}},{title:"Index",data:"indexId",type:"dropdown",include:Constants.sampleIndexFamilies&&Constants.sampleIndexFamilies.length,source:d.indexFamilyId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.indexFamilyId),
Constants.sampleIndexFamilies).indices:[],sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId}]}return{getUserManualUrl:function(){return Urls.external.userManual("samples")},getSaveUrl:function(d){if(d.id)return Urls.rest.samples.update(d.id);throw Error("Page not intended for new sample creation");},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.samples.edit(d.id)},getSections:function(d,e){return[{title:"Sample Information",
fields:[{title:"Sample ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id}},{title:"Project",data:"projectId",type:"dropdown",required:!0,source:d.projects.filter(function(g){return"Active"===g.status||g.id===e.projectId}),getItemLabel:function(g){return Constants.isDetailedSample?g.code:g.name},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort(Constants.isDetailedSample?"code":"id"),onChange:function(g,f){Constants.isDetailedSample&&f.updateField("subprojectId",
{source:Constants.subprojects.filter(function(h){return h.parentProjectId===parseInt(g)})})}},{title:"Name",data:"name",type:"read-only",getDisplayValue:function(g){return g.name}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100,note:d.detailedSample&&e.nonStandardAlias?"Double-check this alias -- it will be saved even if it is duplicated or does not follow the naming standard!":null},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Matrix Barcode",data:"identificationBarcode",
type:"text",maxLength:255},FormUtils.makeRequisitionField(e),FormUtils.makeEffectiveRequisitionField(e),{title:"Assays",data:"requisitionAssayIds",type:"special",makeControls:function(){return b(e)}},{title:"Scientific Name",data:"scientificNameId",type:"dropdown",required:!0,source:Constants.scientificNames,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Accession",data:"accession",type:"read-only",getLink:function(g){return Urls.external.enaAccession(g.accession)},
include:e.accession},{title:"Sample Type",data:"sampleType",type:"dropdown",source:Constants.sampleTypes.sort(),getItemLabel:function(g){return g},getItemValue:function(g){return g},required:!0}].concat(FormUtils.makeDetailedQcStatusFields(e)).concat([{title:"Discarded",data:"discarded",type:"checkbox",onChange:function(g,f){f.updateField("volume",{disabled:g})}},{title:"Initial Volume",data:"initialVolume",type:"decimal",precision:16,scale:10,min:0,onChange:function(g,f){f.updateField("volume",{required:g})}},
{title:"Volume",data:"volume",type:"decimal",precision:16,scale:10},FormUtils.makeUnitsField(e,"volume"),{title:"Parent ng Used",data:"ngUsed",type:"decimal",precision:14,scale:10,include:d.detailedSample&&("Stock"===e.sampleCategory||"Aliquot"===e.sampleCategory)},{title:"Parent Volume Used",data:"volumeUsed",type:"decimal",precision:16,scale:10,min:0,include:d.detailedSample&&("Stock"===e.sampleCategory||"Aliquot"===e.sampleCategory)},{title:"Concentration",data:"concentration",type:"decimal",precision:14,
scale:10},FormUtils.makeUnitsField(e,"concentration"),FormUtils.makeBoxLocationField(),{title:"Location Note",data:"locationBarcode",type:"text",maxLength:255},{title:"Sequencing Control Type",data:"sequencingControlTypeId",type:"dropdown",source:Constants.sequencingControlTypes,sortSource:Utils.sorting.standardSort("alias"),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,nullLabel:"n/a",include:!Constants.isDetailedSample||"Aliquot"===e.sampleCategory}]).concat(!Constants.isDetailedSample||
"Identity"!==e.sampleCategory&&"Tissue"!==e.sampleCategory?FormUtils.makeSopFields(e,d.sops):[])},{title:"Identity",include:d.detailedSample&&"Identity"===e.sampleCategory,fields:[{title:"External Names (comma separated)",data:"externalName",type:"text",required:!0,maxLength:255,description:"Name or other identifier for the donor or organism in an external system"},{title:"Sex",data:"donorSex",type:"dropdown",required:!0,source:Constants.donorSexes,initial:"Unknown"},{title:"Consent",data:"consentLevel",
type:"dropdown",required:!0,source:Constants.consentLevels,initial:"This Project"}]},{title:"Details",include:d.detailedSample,fields:[{title:"Parent",data:"parentId",type:"read-only",getDisplayValue:function(g){return g.parentAlias||"n/a"},getLink:function(g){return g.parentId?Urls.ui.samples.edit(g.parentId):null}},{title:"Sample Class",data:"sampleClassId",type:"read-only",getDisplayValue:function(g){return g.sampleClassAlias}},{title:"Sub-project",data:"subprojectId",type:"dropdown",source:Constants.subprojects.filter(function(g){return g.parentProjectId===
e.projectId}),sortSource:Utils.sorting.standardSort("alias"),getItemLabel:function(g){return g.alias},getItemValue:function(g){return g.id}},{title:"Effective External Names",data:"effectiveExternalNames",type:"read-only",include:"Identity"!==e.sampleCategory},{title:"Tissue Origin",data:"effectiveTissueOriginAlias",getDisplayValue:function(g){return g.effectiveTissueOriginAlias+" ("+g.effectiveTissueOriginDescription+")"},type:"read-only",include:!["Identity","Tissue"].includes(e.sampleCategory)},
{title:"Tissue Type",data:"effectiveTissueTypeAlias",getDisplayValue:function(g){return g.effectiveTissueTypeAlias+" ("+g.effectiveTissueTypeDescription+")"},type:"read-only",include:!["Identity","Tissue"].includes(e.sampleCategory)},{title:"Effective Group ID",data:"effectiveGroupId",type:"read-only",getDisplayValue:function(g){return g.hasOwnProperty("effectiveGroupId")&&null!==g.effectiveGroupId?g.effectiveGroupId+" ("+g.effectiveGroupIdSample+")":"None"},include:"Identity"!==e.sampleCategory},
{title:"Group ID",data:"groupId",type:"text",maxLength:100,regex:Utils.validation.alphanumRegex},{title:"Group Description",data:"groupDescription",type:"text",maxLength:255},{title:"Date of Creation",data:"creationDate",type:"date"}]},{title:"Tissue",include:d.detailedSample&&"Tissue"===e.sampleCategory,fields:[{title:"Tissue Origin",data:"tissueOriginId",type:"dropdown",source:Constants.tissueOrigins.sort(Utils.sorting.standardSortWithException("alias","nn")),getItemLabel:function(g){return g.alias+
" ("+g.description+")"},getItemValue:function(g){return g.id},required:!0},{title:"Tissue Type",data:"tissueTypeId",type:"dropdown",source:Constants.tissueTypes.sort(Utils.sorting.standardSortWithException("alias","n")),getItemLabel:function(g){return g.label},getItemValue:function(g){return g.id},required:!0},{title:"Passage Number",data:"passageNumber",type:"int",min:1},{title:"Times Received",data:"timesReceived",type:"int",min:1,max:1E9},{title:"Tube Number",data:"tubeNumber",type:"int",min:1,
max:1E9},{title:"Tissue Material",data:"tissueMaterialId",type:"dropdown",nullLabel:"Unknown",source:Constants.tissueMaterials,getItemLabel:function(g){return g.alias},getItemValue:function(g){return g.id}},{title:"Region",data:"region",type:"text",maxLength:255},{title:"Secondary Identifier",data:"secondaryIdentifier",type:"text",maxLength:255,description:"Identifier for the tissue sample in an external system"},{title:"Lab",data:"labId",type:"dropdown",nullLabel:"n/a",source:Constants.labs.sort(Utils.sorting.standardSort("alias")),
getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,include:!!e.lab,description:"The external lab that a tissue came from. This field is intended for historical data only as the lab should normally be recorded in a receipt transfer instead"},{title:"Timepoint",data:"timepoint",type:"text",maxLength:50,description:"When the sample was taken"}]},{title:"Tissue Processing",include:d.detailedSample&&"Tissue Processing"===e.sampleCategory,fields:c(e)},{title:"Slide",include:d.detailedSample&&
"Slide"===e.sampleSubcategory,fields:[{title:"Initial Slides",data:"initialSlides",type:"int",min:0,required:!0},{title:"Slides",data:"slides",type:"int",min:0,required:!0},{title:"Thickness (\u00b5m)",data:"thickness",type:"int",min:1},{title:"Stain",data:"stainId",type:"dropdown",source:Constants.stains.sort(Utils.sorting.standardSort("name")),getItemLabel:function(g){return g.name},getItemValue:function(g){return g.id}},{title:"% Tumour",data:"percentTumour",type:"decimal",precision:11,scale:8,
min:0,max:100},{title:"% Necrosis",data:"percentNecrosis",type:"decimal",precision:11,scale:8,min:0,max:100},{title:"Marked Area (mm\u00b2)",data:"markedArea",type:"decimal",precision:11,scale:8,min:0},{title:"Marked Area % Tumour",data:"markedAreaPercentTumour",type:"decimal",precision:11,scale:8,min:0,max:100}]},{title:"Tissue Piece",include:d.detailedSample&&"Tissue Piece"===e.sampleSubcategory,fields:[{title:"Piece Type",type:"dropdown",data:"tissuePieceTypeId",required:!0,source:Constants.tissuePieceTypes,
sortSource:Utils.sorting.standardSort("name"),getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId},{title:"Slides Consumed",data:"slidesConsumed",type:"int",min:0,required:!0},{title:"Reference Slide",data:"referenceSlideId",type:"dropdown",source:e.relatedSlides,getItemLabel:function(g){return g.name+" ("+g.alias+")"},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("id"),description:"Indicates a slide whose attributes such as marked area and % tumour are relevant to this sample. May be used for calculating extraction input per yield, for example."}]},
{title:"Single Cell",include:d.detailedSample&&"Single Cell"===e.sampleSubcategory,fields:[{title:"Initial Cell Concentration",data:"initialCellConcentration",type:"decimal",precision:14,scale:10,description:"Initial concentration of cells in the sample at the time of receipt"},{title:"Target Cell Recovery",data:"targetCellRecovery",type:"int",min:0},{title:"Loading Cell Concentration",data:"loadingCellConcentration",type:"decimal",precision:14,scale:10,description:"Concentration of cells prepared for loading into the instrument"},
{title:"Digestion",data:"digestion",type:"text",maxLength:255,required:!0}]},{title:"Stock",include:d.detailedSample&&"Stock"===e.sampleCategory,fields:c(e).concat([{title:"STR Status",data:"strStatus",type:"dropdown",source:Constants.strStatuses,required:!0,description:"Status of short tandem repeat analysis"},{title:"DNAse Treated",data:"dnaseTreated",type:"checkbox",include:"RNA (stock)"===e.sampleSubcategory,required:!0},{title:"Slides Consumed",data:"slidesConsumed",type:"int",min:0},{title:"Reference Slide",
data:"referenceSlideId",type:"dropdown",source:e.relatedSlides,getItemLabel:function(g){return g.name+" ("+g.alias+")"},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("id")},{title:"Target Cell Recovery",data:"targetCellRecovery",type:"int",min:0,include:"Single Cell (stock)"===e.sampleSubcategory},{title:"Cell Viability",data:"cellViability",type:"decimal",precision:14,scale:10,include:"Single Cell (stock)"===e.sampleSubcategory},{title:"Loading Cell Concentration",data:"loadingCellConcentration",
type:"decimal",precision:14,scale:10,include:"Single Cell (stock)"===e.sampleSubcategory}])},{title:"Aliquot",include:d.detailedSample&&"Aliquot"===e.sampleCategory,fields:[{title:"Purpose",data:"samplePurposeId",type:"dropdown",source:Constants.samplePurposes.sort(Utils.sorting.standardSort("alias")),getItemLabel:function(g){return g.alias},getItemValue:function(g){return g.id}},{title:"Input into Library",data:"inputIntoLibrary",type:"decimal",precision:14,scale:10,include:"Single Cell (aliquot)"===
e.sampleSubcategory}]}]},confirmSave:function(d,e,g){if(g.isChanged("projectId")&&(e=[],d.identityConsentLevel&&"All Projects"!==d.identityConsentLevel&&e.push("\u2022 Identity consent level is set to "+d.identityConsentLevel),0<d.libraryCount&&e.push("\u2022 "+d.libraryCount+" existing librar"+(1<d.libraryCount?"ies":"y")+" will be affected"),e.length))return d=a.Deferred(),e.unshift("Are you sure you wish to transfer the sample to a different project?"),Utils.showConfirmDialog("Confirm","Save",
e,d.resolve,d.reject),d.promise()}}}(jQuery);FormTarget=FormTarget||{};
FormTarget.sampleclass=function(a){function b(e,g){a("#save").remove();return[{title:"Sample Class ID",data:"id",type:"read-only",getDisplayValue:function(f){return f.id||"Unsaved"}},{title:"Alias",data:"alias",type:"read-only"},{title:"Category",data:"sampleCategory",type:"read-only"},{title:"Subcategory",data:"sampleSubcategory",getDisplayValue:function(f){return f.sampleSubcategory||"n/a"},type:"read-only"},{title:"Default Sample Type",data:"defaultSampleType",getDisplayValue:function(f){return f.defaultSampleType||
"n/a"},type:"read-only"},{title:"Suffix",data:"suffix",getDisplayValue:function(f){return f.suffix||"n/a"},type:"read-only",description:d.suffix},{title:"V2 Naming Code",data:"v2NamingCode",getDisplayValue:function(f){return f.v2NamingCode||"n/a"},type:"read-only",description:d.v2NamingCode},{title:"Direct Creation Allowed?",data:"directCreationAllowed",type:"checkbox",disabled:!0,description:d.directCreationAllowed},{title:"Archived",data:"archived",type:"checkbox",disabled:!0}]}function c(e,g){return[{title:"Sample Class ID",
data:"id",type:"read-only",getDisplayValue:function(f){return f.id||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:255},{title:"Category",data:"sampleCategory",type:"dropdown",required:!0,source:Constants.sampleCategories,onChange:function(f,h){h.updateField("sampleSubcategory",{source:f?Constants.sampleSubcategories[f]:[]});(SampleClass.getParents()&&SampleClass.getParents().length||SampleClass.getChildren()&&SampleClass.getChildren().length)&&Utils.showOkDialog("Warning",
["Changing sample category may invalidate existing relationships"])}},{title:"Subcategory",data:"sampleSubcategory",type:"dropdown",source:g.sampleCategory?Constants.sampleSubcategories[g.sampleCategory]:[],nullLabel:"n/a"},{title:"Default Sample Type",data:"defaultSampleType",type:"dropdown",source:Constants.sampleTypes,nullLabel:"n/a"},{title:"Suffix",data:"suffix",type:"text",maxLength:5,description:d.suffix},{title:"V2 Naming Code",data:"v2NamingCode",type:"text",maxLength:2,description:d.v2NamingCode},
{title:"Direct Creation Allowed?",data:"directCreationAllowed",type:"checkbox",description:d.directCreationAllowed},{title:"Archived",data:"archived",type:"checkbox"}]}var d={suffix:"Code to include as part of the alias if using the OICR naming scheme.",v2NamingCode:"Code to include as part of the alias if using the V2 naming scheme. Only used for stock and tissue processing classes. Exception: V2 naming codes for tissue piece types are defined in the individual tissue piece type.",directCreationAllowed:"If checked, this sample class can be used for receipt and propagation; otherwise, the class can only be used as part of the hierarchy when receiving libraries."};
return{getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-classes-and-categories")},getSaveUrl:function(e){return e.id?Urls.rest.sampleClasses.update(e.id):Urls.rest.sampleClasses.create},getSaveMethod:function(e){return e.id?"PUT":"POST"},getEditUrl:function(e){return Urls.ui.sampleClasses.edit(e.id)},getSections:function(e,g){return[{title:"Sample Class Information",fields:e.isAdmin?c(e,g):b(e,g)}]},confirmSave:function(e){e.parentRelationships=SampleClass.getParents();
e.childRelationships=SampleClass.getChildren()}}}(jQuery);FormTarget=FormTarget||{};
FormTarget.sampleindexfamily=function(a){function b(d,e){return[{title:"Index Family ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Name",data:"name",type:"text",required:!0,maxLength:255}]}function c(d,e){a("#save").remove();return[{title:"Index Family ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Name",data:"name",type:"read-only"}]}return{getUserManualUrl:function(){return Urls.external.userManual("type_data",
"indices")},getSaveUrl:function(d){return d.id?Urls.rest.sampleIndexFamilies.update(d.id):Urls.rest.sampleIndexFamilies.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.sampleIndexFamilies.edit(d.id)},getSections:function(d,e){return[{title:"Sample Index Family Information",fields:d.isAdmin?b(d,e):c(d,e)}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.sequencingorder=function(a){return{getSaveUrl:function(b){return b.id?Urls.rest.sequencingOrders.update(b.id):Urls.rest.sequencingOrders.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){throw Error("Sequencing orders do not have an edit page");},getSections:function(b,c){return[{title:"Sequencing Order Information",fields:[{title:"Purpose",data:"purposeId",type:"read-only",getDisplayValue:function(d){return d.purposeAlias}},{title:"Description",data:"description",
type:"text",maxLength:255},{title:"Sequencing Parameters",data:"parameters",omit:!0,type:"read-only",getDisplayValue:function(d){return d.parameters.name+" ("+d.parameters.instrumentModelAlias+")"}},{title:"Container Model",data:"containerModelId",omit:!0,type:"read-only",getDisplayValue:function(d){return d.containerModelId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.containerModelId),Constants.containerModels).alias:"Unspecified"}},{title:"Partitions Required",data:"partitions",type:"read-only"}]}]}}}(jQuery);
"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.servicerecord=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("instruments","service-records")},getSaveUrl:function(b,c){return c.instrumentId?b.id?Urls.rest.serviceRecords.update(b.id):Urls.rest.instruments.createRecord(c.instrumentId):b.id?Urls.rest.serviceRecords.update(b.id):Urls.rest.storageLocations.createRecord(c.freezerId)},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b,c){return c.instrumentId?Urls.ui.instruments.editRecord(c.instrumentId,
b.id):Urls.ui.freezers.editRecord(c.freezerId,b.id)},getSections:function(b,c){return[{title:"Service Record Information",fields:[{title:"Service Record ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Title",data:"title",type:"text",required:!0,maxLength:255},{title:"Details",data:"details",type:"textarea",regex:"^[^\x3c\x3e]*$",maxLength:65535},{title:"Position Affected",data:"positionId",type:"dropdown",include:b.instrumentId,source:b.instrumentPositions,
sortSource:Utils.sorting.standardSort("alias"),getItemLabel:function(d){return d.alias},getItemValue:function(d){return d.id},nullLabel:"N/A"},{title:"Serviced By",data:"servicedBy",type:"text",maxLength:30},{title:"Reference Number",data:"referenceNumber",type:"text",maxLength:30},{title:"Service Date",data:"serviceDate",type:"date",required:!0,initial:Utils.getCurrentDate()},{title:"Issue Start Time",data:"startTime",type:"datetime"},{title:"Out of service?",data:"outOfService",type:"checkbox"},
{title:"Issue End Time",data:"endTime",type:"datetime"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.study=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","studies")},getSaveUrl:function(b){return b.id?Urls.rest.studies.update(b.id):Urls.rest.studies.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.studies.edit(b.id)},getSections:function(b,c){return[{title:"Study Information",fields:[{title:"Study ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||
"Unsaved"}},{title:"Project",data:"projectId",type:"dropdown",include:!c.id,required:!0,source:b.projects,getItemLabel:function(d){return b.detailedSample?d.code:d.title},getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort(b.detailedSample?"code":"title")},{title:"Project",data:"projectId",type:"read-only",include:!!c.id,getDisplayValue:function(d){d=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d.projectId),b.projects);return b.detailedSample?d.code:d.title},getLink:function(d){return Urls.ui.projects.edit(d.projectId)}},
{title:"Name",data:"name",type:"read-only",getDisplayValue:function(d){return d.name||"Unsaved"}},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Accession",data:"accession",type:"read-only",getLink:function(d){return Urls.external.enaAccession(d.accession)},include:!!c.accession},{title:"Study Type",data:"studyTypeId",type:"dropdown",source:Constants.studyTypes,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,
sortSource:Utils.sorting.standardSort("name"),required:!0}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.submission=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","submissions")},getSaveUrl:function(b){return b.id?Urls.rest.submissions.update(b.id):Urls.rest.submissions.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.submissions.edit(b.id)},getSections:function(b,c){return[{title:"Submission Information",fields:[{title:"Submission ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||
"Unsaved"}},{title:"Title",data:"title",type:"text",required:!0,maxLength:255},{title:"Alias",data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Accession",data:"accession",type:"read-only",getLink:function(d){return Urls.external.enaAccession(d.accession)},include:c.accession},{title:"Completed?",data:"completed",type:"checkbox"},{title:"Verified?",data:"verified",type:"checkbox"},{title:"Submission Date",data:"submittedDate",
type:"date"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.transfer=function(a){function b(d){var e=d.get("senderLabId"),g=d.get("senderGroupId"),f=d.get("recipient"),h=d.get("recipientGroupId");e?(c(d,"senderGroupId",!0),c(d,"recipient",!0),c(d,"recipientGroupId",!1)):f?(c(d,"senderLabId",!0),c(d,"senderGroupId",!1),c(d,"recipientGroupId",!0)):g&&h?(c(d,"senderLabId",!0),c(d,"recipient",!0)):g?(c(d,"senderLabId",!0),c(d,"recipient",!1),c(d,"recipientGroupId",!1)):h?(c(d,"senderLabId",!1),c(d,"senderGroupId",!1),c(d,"recipient",!0)):(c(d,"senderLabId",
!1),c(d,"senderGroupId",!1),c(d,"recipient",!1),c(d,"recipientGroupId",!1))}function c(d,e,g){d.updateField(e,{disabled:g})}return{getUserManualUrl:function(){return Urls.external.userManual("transfers")},getSaveUrl:function(d){return d.id?Urls.rest.transfers.update(d.id):Urls.rest.transfers.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d){return Urls.ui.transfers.edit(d.id)},getSections:function(d,e){return[{title:"Transfer Information",fields:[{title:"Transfer ID",
data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Transfer Request Name",data:"transferRequestName",type:"text",maxLength:100,description:"Name or ID of a transfer request stored in a separate system"},{title:"Transfer Time",data:"transferTime",type:"datetime",required:!0,include:d.editSend||d.editReceipt,initial:Utils.getCurrentDatetime()},{title:"Transfer Time",data:"transferTime",type:"read-only",include:!d.editSend&&!d.editReceipt},{title:"Sender Lab (External)",
data:"senderLabId",type:"dropdown",source:Constants.labs.filter(function(g){return g.id===e.senderLabId||!g.archived}),getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("label"),include:d.editSend&&("create"===d.pageMode||e.senderLabId),required:!!e.senderLabId,onChange:function(g,f){"create"==d.pageMode&&b(f)},description:"External lab from which the items were received. Applicable to receipt transfers."},{title:"Sender Lab (External)",data:"senderLabLabel",
type:"read-only",include:!d.editSend&&e.senderLabLabel,description:"External lab from which the items were received. Applicable to receipt transfers."},{title:"Sender Group (Internal)",data:"senderGroupId",type:"dropdown",source:d.senderGroups,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("name"),include:d.editSend&&("create"===d.pageMode||e.senderGroupId),required:!!e.senderGroupId,onChange:function(g,f){"create"==d.pageMode&&b(f)},description:"Internal group from whom the items are being sent. Applicable to internal and distribution transfers."},
{title:"Sender Group (Internal)",data:"senderGroupName",type:"read-only",include:!d.editSend&&e.senderGroupName,description:"Internal group from whom the items are being sent. Applicable to internal and distribution transfers."},{title:"Recipient (External)",data:"recipient",type:"text",maxLength:255,include:d.editSend&&("create"===d.pageMode||e.recipient),required:!!e.recipient,onChange:function(g,f){"create"==d.pageMode&&b(f)},description:"External entity who is receiving the items. Applicable to distribution transfers."},
{title:"Recipient (External)",data:"recipient",type:"read-only",include:!d.editSend&&e.recipient,description:"External entity who is receiving the items. Applicable to distribution transfers."},{title:"Recipient Group (Internal)",data:"recipientGroupId",type:"dropdown",source:d.recipientGroups,getItemLabel:Utils.array.getName,getItemValue:Utils.array.getId,sortSource:Utils.sorting.standardSort("name"),include:d.editSend&&("create"===d.pageMode||e.recipientGroupId),required:e.recipientGroupId,onChange:function(g,
f){"create"==d.pageMode&&b(f)},description:"Internal group that is receiving the items. Applicable to receipt and internal transfers."},{title:"Recipient Group (Internal)",data:"recipientGroupName",type:"read-only",include:!d.editSend&&e.recipientGroupName,description:"Internal group that is receiving the items. Applicable to receipt and internal transfers."}]}]},confirmSave:function(d){d.items=Transfer.getItems()}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.user=function(a){function b(d,e){return[{title:"User ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||"Unsaved"}},{title:"Full Name",data:"fullName",type:"text",required:!0,maxLength:255},{title:"Login Name",data:"loginName",type:"text",required:!0,maxLength:255,disabled:!d.isAdmin},{title:"Password",data:"password",type:"password",required:!0,maxLength:100,include:!e.id},{title:"Confirm Password",data:"passwordConfirm",omit:!0,type:"password",required:!0,maxLength:100,
include:!e.id,match:"password"},{title:"Email Address",data:"email",type:"text",required:!0,maxLength:255,regex:"email"},{title:"Admin?",data:"admin",type:"checkbox",disabled:!d.isAdmin||d.isSelf},{title:"Internal?",description:"Only internal users can log into MISO",data:"internal",type:"checkbox",disabled:!d.isAdmin},{title:"Active?",data:"active",type:"checkbox",disabled:!d.isAdmin||d.isSelf}]}function c(d,e){a("#save").remove();return[{title:"User ID",data:"id",type:"read-only",getDisplayValue:function(g){return g.id||
"Unsaved"}},{title:"Full Name",data:"fullName",type:"read-only"},{title:"Login Name",data:"loginName",type:"read-only"},{title:"Email Address",data:"email",type:"read-only"},{title:"Admin?",data:"admin",type:"checkbox",disabled:!0},{title:"Internal?",data:"internal",type:"checkbox",disabled:!0},{title:"Active?",data:"active",type:"checkbox",disabled:!0}]}return{getUserManualUrl:function(){return Urls.external.userManual("users_and_groups","users")},getSaveUrl:function(d){return d.id?Urls.rest.users.update(d.id):
Urls.rest.users.create},getSaveMethod:function(d){return d.id?"PUT":"POST"},getEditUrl:function(d,e){return e.isAdmin?Urls.ui.users.edit(d.id):Urls.ui.users.editSelf(d.id)},getSections:function(d,e){return[{title:"User Information",fields:d.usersEditable?b(d,e):c(d,e)}]}}}(jQuery);
FormTarget.passwordreset=function(a){return{getSaveUrl:function(b,c){return Urls.rest.users.resetPassword(c.userId)},getSaveMethod:function(){return"POST"},getEditUrl:function(b,c){return c.isAdmin?Urls.ui.users.edit(b.id):Urls.ui.users.editSelf(b.id)},getSections:function(b,c){return[{title:"Reset Password",fields:[{title:"Old Password",data:"oldPassword",type:"password",required:!0,maxLength:100,include:!b.isAdmin||b.isSelf},{title:"New Password",data:"newPassword",type:"password",required:!0,maxLength:100},
{title:"Confirm Password",data:"passwordConfirm",omit:!0,type:"password",required:!0,maxLength:100,match:"newPassword"}]}]}}}(jQuery);"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.workset=function(a){return{getUserManualUrl:function(){return Urls.external.userManual("worksets")},getSaveUrl:function(b){return b.id?Urls.rest.worksets.update(b.id):Urls.rest.worksets.create},getSaveMethod:function(b){return b.id?"PUT":"POST"},getEditUrl:function(b){return Urls.ui.worksets.edit(b.id)},getSections:function(b,c){return[{title:"Workset Information",fields:[{title:"Workset ID",data:"id",type:"read-only",getDisplayValue:function(d){return d.id||"Unsaved"}},{title:"Alias",
data:"alias",type:"text",required:!0,maxLength:100},{title:"Description",data:"description",type:"text",maxLength:255},{title:"Category",data:"categoryId",type:"dropdown",source:Constants.worksetCategories,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Stage",data:"stageId",type:"dropdown",source:Constants.worksetStages,getItemLabel:Utils.array.getAlias,getItemValue:Utils.array.getId},{title:"Created By",data:"creator",type:"read-only",include:!!c.creator}]}]}}}(jQuery);
"undefined"===typeof FormTarget&&(FormTarget={});
FormTarget.workstation=function(){return{getUserManualUrl:function(){return Urls.external.userManual("workstations")},getSaveUrl:function(a){return Urls.rest.workstations.update(a.id)},getSaveMethod:function(a){return"PUT"},getEditUrl:function(a){return Urls.ui.workstations.edit(a.id)},getSections:function(a,b){return[{title:"Workstation Information",fields:a.isAdmin?[{title:"Workstation ID",data:"id",type:"read-only"},BulkUtils.columns.simpleAlias(50),BulkUtils.columns.description,{title:"Identification Barcode",
data:"identificationBarcode",type:"text",maxLength:255}]:[{title:"Workstation ID",data:"id",type:"read-only"},{title:"Alias",data:"alias",type:"read-only"},{title:"Description",data:"description",type:"read-only"},{title:"Identification Barcode",data:"identificationBarcode",type:"read-only"}]}]}}}(jQuery);
var Freezer=function(a){function b(m,u,A,G){return{name:m,handler:function(){Utils.showDialog("Add "+m,"OK",u,function(D){var N={};u.forEach(function(W){N[W.property]=D[W.property]});var L=A+"?"+Utils.page.param(N),O=[],S=function(){Utils.ajaxWithDialog("Adding Storage","POST",L,O,Utils.page.pageReload)};if(G){for(var T=G(D),P=[],V=0;V<T.length;V++)P.push({type:"text",label:T[V]+" barcode",property:"childBarcode"+V,required:!1});Utils.showDialog("Add "+m+" - Barcodes","OK",P,function(W){for(var Y in W)O.push(W[Y]);
S()})}else S()})}}}function c(m){for(var u=[],A=1;A<=m.height;A++){var G="Slot "+A;1===A?G+=" (bottom)":A===m.height&&(G+=" (top)");u.push(G)}return u}function d(m){for(var u=[],A=1;A<=m.depth;A++)for(var G=1;G<=m.height;G++){var D="Stack "+A+", Slot "+G;1===A&&1===G?D+=" (front bottom)":A===m.depth&&G===m.height&&(D+=" (back top)");u.push(D)}return u}function e(m){for(var u=[],A=1;A<=m.height;A++){var G="Tray "+A;1===A?G+=" (top)":A===m.height&&(G+=" (bottom)");u.push(G)}return u}function g(){if(t.childLocations){var m=
a("#freezerLayout"),u=t.childLocations.filter(function(D){return"SHELF"===D.locationUnit}),A=t.childLocations.filter(function(D){return"STACK"===D.locationUnit});if(u.length+A.length!=t.childLocations.length)throw Error("Unexpected location units");u.sort(f).forEach(function(D){h(D,m)});if(A.length){u=a("\x3ctr\x3e");var G=a("\x3ctd\x3e");A.sort(f).forEach(function(D){k(D,G)});u.append(G);m.append(u)}a("#editStorageComponentContainer").hide();a("#levelTwoStorageContainer").hide()}}function f(m,u){m=
m.alias;u=u.alias;Utils.isIntegerString(m)&&Utils.isIntegerString(u)&&(m=parseInt(m),u=parseInt(u));return m<u?-1:m>u?1:0}function h(m,u){var A=a("\x3ctr\x3e"),G=a("\x3ctd\x3e");G.append('\x3cspan class\x3d"storageComponentLabel"\x3e'+m.displayLocation+"\x3c/span\x3e");var D=a('\x3cbutton type\x3d"button" class\x3d"ui-state-default storageComponentButton"\x3eAdd Storage\x3c/button\x3e');D.click(function(N){Freezer.addShelfStorage(m);N.stopPropagation()});G.append(D);G.append('\x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e');
if(m.childLocations){D=m.childLocations.filter(function(N){return"TRAY_RACK"===N.locationUnit}).sort(f).concat(m.childLocations.filter(function(N){return"RACK"===N.locationUnit}).sort(f)).concat(m.childLocations.filter(function(N){return"STACK"===N.locationUnit}).sort(f)).concat(m.childLocations.filter(function(N){return"LOOSE_STORAGE"===N.locationUnit}).sort(f));if(D.length!=m.childLocations.length)throw Error("Unexpected location units");D.forEach(function(N){k(N,G)})}G.click(function(N){a("#freezerLayoutContainer .selected").removeClass("selected");
z=m;G.addClass("selected");a("#levelTwoStorageContainer").hide();l(m)});A.append(G);u.append(A)}function k(m,u){var A=a("\x3cdiv\x3e").addClass("storageNode").text(m.displayLocation);A.click(function(G){a("#freezerLayoutContainer .selected").removeClass("selected");z=m;A.addClass("selected");a("#levelTwoStorageAlias").text(m.displayLocation);a("#levelTwoStorageLayout").empty();switch(m.locationUnit){case "RACK":v(m);l(m);break;case "STACK":E(m);l(m);break;case "LOOSE_STORAGE":var D=a("#levelTwoStorageLayout"),
N=a("\x3ctr\x3e"),L=a("\x3ctd\x3e"),O;for(O in m.boxes)L.append(document.createTextNode(m.boxes[O].alias)).append("\x3cbr/\x3e");L.append(document.createTextNode("(Unorganized Space)"));L.item=m;L.click(p(L));N.append(L);D.append(N);l(m);break;case "TRAY_RACK":w(m);l(m);break;default:throw Error("Unexpected location unit");}a("#levelTwoStorageContainer").show();G.stopPropagation()});u.append(A)}function l(m){a("#storageComponentAlias").text(m.displayLocation);a("#storageComponentId").text(m.id);a("#storageComponentBarcode").val(m.identificationBarcode);
a("#storageComponentLabel").val(m.labelId);a("#editStorageComponentContainer").show();a("#saveStorageComponent").show();a("#deleteStorageComponent").show();a("#storageComponentBarcodeRow").show()}function p(m){function u(){Utils.showDialog("Search for Box to Assign","Search",[{type:"text",label:"Search",property:"query",value:""}],function(A){Utils.ajaxWithDialog("Searching for Boxes","GET",Urls.rest.boxes.searchPartial+"?"+Utils.page.param({q:A.query,b:!0}),null,function(G){Utils.showWizardDialog("Select Box to Assign",
G.map(function(D){return{name:D.alias,handler:function(){Utils.ajaxWithDialog("Moving Box","POST",Urls.rest.boxes.setLocation(D.id)+"?"+Utils.page.param({storageId:m.item.id}),{},Utils.page.pageReload,function(N){Utils.showOkDialog("Error Moving Box",[N.error])})}}}))})})}switch(m.item.locationUnit){case "STACK_POSITION":return function(){u();a("#levelTwoStorageContainer .selected").removeClass("selected");z=m.item;m.addClass("selected");l(m.item);a("#deleteStorageComponent").hide()};case "LOOSE_STORAGE":return r(m,
!0,!0,u);case "TRAY":return r(m,!0,!1,u);default:throw Error("Unexpected box location");}}function r(m,u,A,G){return function(){var D=m.item.boxes.map(function(N){return{name:"View "+N.alias,handler:function(){window.location=Urls.ui.boxes.edit(N.id)}}});D.unshift({name:"Add Box to Storage",handler:G});Utils.showWizardDialog("Boxes in "+m.item.displayLocation,D);a("#levelTwoStorageContainer .selected").removeClass("selected");z=m.item;m.addClass("selected");l(m.item);A||a("#deleteStorageComponent").hide();
u||(a("#saveStorageComponent").hide(),a("#storageComponentBarcodeRow").hide())}}function w(m){var u=a("#levelTwoStorageLayout");m.childLocations.sort(f).forEach(function(A){if("TRAY"!=A.locationUnit)throw Error("Unexpected location unit");var G=a("\x3ctr\x3e"),D=a("\x3ctd\x3e");D.append(document.createTextNode(A.displayLocation)).append("\x3cbr/\x3e");for(var N in A.boxes)D.append(document.createTextNode(A.boxes[N].alias)).append("\x3cbr/\x3e");D.append(document.createTextNode("(Unorganized Space)"));
D.item=A;D.click(p(D));G.append(D);u.append(G)})}function v(m){var u=a("#levelTwoStorageLayout"),A=m.childLocations.length,G=m.childLocations[0].childLocations.length;m.childLocations.sort(f).forEach(function(T){if("STACK"!=T.locationUnit)throw Error("Unexpected location unit");if(T.childLocations.length!=G)throw Error("Uneven stack heights within rack");T.childLocations.sort(f).reverse().forEach(function(P){if("STACK_POSITION"!=P.locationUnit)throw Error("Unexpected location unit");})});for(var D=
0;D<G;D++){for(var N=a("\x3ctr\x3e"),L=[],O=0;O<A;O++){var S=a("\x3ctd\x3e").text(m.childLocations[O].displayLocation+", "+m.childLocations[O].childLocations[D].displayLocation+" ("+(m.childLocations[O].childLocations[D].boxes[0]?m.childLocations[O].childLocations[D].boxes[0].alias:"empty")+")");S.item=m.childLocations[O].childLocations[D];S.click(p(S));L.unshift(S)}0===D&&(L.unshift('\x3ctd rowspan\x3d"'+G+'"\x3e\x3cstrong\x3eB\x3cbr/\x3eA\x3cbr/\x3eC\x3cbr/\x3eK\x3c/strong\x3e\x3c/td\x3e'),L.push('\x3ctd rowspan\x3d"'+
G+'"\x3e\x3cstrong\x3eF\x3cbr/\x3eR\x3cbr/\x3eO\x3cbr/\x3eN\x3cbr/\x3eT\x3c/strong\x3e\x3c/td\x3e'));N.append(L);u.append(N)}}function E(m){var u=a("#levelTwoStorageLayout");m.childLocations.sort(f).reverse().forEach(function(A){if("STACK_POSITION"!=A.locationUnit)throw Error("Unexpected location unit");var G=a("\x3ctr\x3e"),D=a("\x3ctd\x3e").text(A.displayLocation+" ("+(A.boxes[0]?A.boxes[0].alias:"empty")+")");D.item=A;D.click(p(D));G.append(D);u.append(G)})}function q(){var m={},u;for(u in z)m[u]=
z[u];m.identificationBarcode=a("#storageComponentBarcode").val();m.labelId=parseInt(a("#storageComponentLabel").val())||null;a.ajax({url:Urls.rest.storageLocations.updateComponent(m.id),type:"PUT",dataType:"json",contentType:"application/json; charset\x3dutf8",data:JSON.stringify(m)}).done(Utils.page.pageReload).fail(function(A,G,D){Validate.displayErrors(JSON.parse(A.responseText),"freezerComponent-form")})}var t=null,z=null,x={type:"int",label:"Height (rows)",property:"height",required:!0},F={type:"int",
label:"Depth (stacks)",property:"depth",required:!0},n={type:"text",label:"Barcode",property:"identificationBarcode",required:!1};return{setFreezerJson:function(m){t=m;g()},validateAndSaveComponent:function(){Validate.cleanFields("#freezerComponent-form");Validate.clearErrors("#freezerComponent-form");a("#storageComponentBarcode").attr("class","form-control");a("#storageComponentBarcode").attr("data-parsley-maxlength","255");a("#storageComponentBarcode").attr("data-parsley-pattern",Utils.validation.sanitizeRegex);
a("#storageComponentBarcode").attr("data-parsley-errors-container","#storageComponentBarcodeError");a("#freezerComponent-form").parsley();a("#freezerComponent-form").parsley().validate();Validate.updateWarningOrSubmit("#freezerComponent-form",null,function(){q()})},deleteComponent:function(){var m=a("#storageComponentAlias").text();Utils.showConfirmDialog("Delete Storage","Delete",["Are you sure you wish to delete "+m+"?"],function(){var u=parseInt(a("#storageComponentId").text());Utils.ajaxWithDialog("Deleting Storage",
"DELETE",Urls.rest.storageLocations.deleteComponent(u),null,function(){Utils.showOkDialog("Storage Deleted",[m+" has been deleted."],function(){Utils.page.pageReload()})})})},addRoom:function(){Freezer.addRoomWithCallback(function(){Utils.showOkDialog("Room created",[])})},addRoomWithCallback:function(m){var u=[{type:"text",label:"Alias",property:"alias",required:!0},{type:"text",label:"Barcode",property:"identificationBarcode",required:!1}];Utils.showDialog("Add Room","Add",u,function(A){var G={};
u.forEach(function(N){G[N.property]=A[N.property]});var D=Urls.rest.storageLocations.createRoom+"?"+Utils.page.param(G);Utils.ajaxWithDialog("Adding Room","POST",D,{},function(N){m()})})},addFreezerStorage:function(){Utils.showWizardDialog("Add Freezer Storage",[b("Shelf",[n],Urls.rest.storageLocations.createShelf(t.id)),b("Stack",[x,n],Urls.rest.storageLocations.createStack(t.id),c)])},addShelfStorage:function(m){Utils.showWizardDialog("Add Shelf Storage",[b("Rack",[F,x,n],Urls.rest.storageLocations.createRack(t.id,
m.id),d),b("Stack",[x,n],Urls.rest.storageLocations.createStack(t.id,m.id),c),b("Tray Rack",[x,n],Urls.rest.storageLocations.createTrayRack(t.id,m.id),e),{name:"Loose Storage",handler:function(){var u=Urls.rest.storageLocations.createLooseStorage(t.id,m.id);Utils.ajaxWithDialog("Adding Storage","POST",u,{},Utils.page.pageReload)}}])}}}(jQuery);
(function(a,b,c){function d(g){FormUtils.setTableData(ListTarget.identitysearch,{identitySearch:!0},"listResults",g)}function e(){return b("#externalNames").val().split("\n").filter(function(g){return g})}a.lookup=function(g){var f=e();f&&0!=f.length?(a.clearResults(),jQuery("#searchButton").prop("disabled",!0),jQuery("#ajaxLoaderDiv").empty(),jQuery("#ajaxLoaderDiv").html('\x3cimg src\x3d"/styles/images/ajax-loader.gif"/\x3e'),b.ajax({url:Urls.rest.samples.identitiesLookup+"?"+Utils.page.param({exactMatch:g}),
type:"POST",dataType:"json",contentType:"application/json; charset\x3dutf8",data:JSON.stringify({identitiesSearches:f,project:b("#projectTitle").val()})}).done(function(h){d(h);jQuery("#searchButton").prop("disabled",!1);jQuery("#ajaxLoaderDiv").empty()}).fail(function(h){jQuery("#searchButton").prop("disabled",!1);jQuery("#ajaxLoaderDiv").empty();jQuery("#ajaxLoaderDiv").html("Error getting samples: "+h)})):Utils.showOkDialog("Search error",["Enter at least one external name"])};a.clearForm=function(){b("#externalNames").val("");
a.clearResults()};a.clearResults=function(){d([])}})(window.IdentitySearch=window.IdentitySearch||{},jQuery);
(function(a,b,c){function d(){return b("#indices").val().split("\n").filter(function(g){return g})}function e(g){b("#results").css("color","red");b("#results").val(g)}a.getBulkIndexActions=function(){return[{name:"Add",action:function(g){var f=d();b.each(g,function(h,k){f.push(k.sequence)});b("#indices").val(f.join("\n"))}}]};a.calculate=function(){var g=d(),f=b("#minDistance").val();!g.length||2>g.length?e("Enter at least two indices"):!/^\d$/.test(f)||1>f||4<f?e("Enter a minimum distance between 1 and 4"):
(b("#results").val(""),b.ajax({url:Urls.rest.indexDistance.check,type:"POST",dataType:"json",contentType:"application/json; charset\x3dutf8",data:JSON.stringify({indices:g,minimumDistance:f})}).done(function(h){var k="";Constants.warningEditDistance>Constants.errorEditDistance&&(k+="Indices with "+Constants.warningEditDistance+" or fewer mismatches are considered near-matches.\n");k+="Indices with "+Constants.errorEditDistance+" or fewer mismatches are considered DUPLICATES.\n\n";k+="Indices were compared at the length of the shortest index, which is "+
h.shortestIndexLength+" bp.\n\n";h.collisions&&h.collisions.length?(b.each(h.collisions,function(l,p){k+=0===p.editDistance?"Duplicate":"Near match ("+p.editDistance+")";k+=': "'+p.indices.join('", "')+'"\n'}),e(k)):(k+="All sequences are at least "+f+" edits apart",b("#results").css("color","green"),b("#results").val(k))}).fail(function(h,k,l){k="Error: ";k=h&&h.responseText&&h.responseText.detail?k+h.responseText.detail:k+"Calculation failed";e(k)}))};a.clearForm=function(){b("#indices").val("");
b("#minDistance").val(Math.max(Constants.errorEditDistance,Constants.warningEditDistance)+1);b("#results").val("")}})(window.IndexDistance=window.IndexDistance||{},jQuery);
(function(a,b,c){function d(g){return b("#indices"+g).val().split("\n").filter(function(f){return f})}function e(g){b("#results").css("color","red");b("#results").val(g)}a.search=function(){var g={};g.position1Indices=d(1);g.position2Indices=d(2);g.position1Indices.length||g.position2Indices.length?(b("#results").val(""),Utils.ajaxWithDialog("Index Search","POST",Urls.rest.libraryIndices.search,g,function(f){var h="";if(f&&f.length){var k=g.position1Indices.length+g.position2Indices.length;f.sort(function(l,
p){return p.position1Matches+p.position2Matches-(l.position1Matches+l.position2Matches)}).forEach(function(l){h+=l.indexFamily+": "+(l.position1Matches+l.position2Matches)+"/"+k+"\n"})}else h+="No input sequences found in any index families";b("#results").css("color","black");b("#results").val(h)},function(f,h,k){h="Error: ";h=f&&f.responseText&&f.responseText.detail?h+f.responseText.detail:h+"Search failed";e(h)})):e("No index sequences entered")};a.clearForm=function(){b("#indices").val("");b("#results").val("")}})(window.IndexSearch=
window.IndexSearch||{},jQuery);
var InstrumentModel=function(a){var b=!1,c=!1,d=null,e=!1,g=0;return{setForm:function(f){d=f},setAdmin:function(f){e=f},getInstrumentPositions:function(){return b?a("#listInstrumentPositions").dataTable().fnGetData().map(function(f){0>f.id&&(f.id=null);return f}):null},setInstrumentPositions:function(f){b&&(d.markOtherChanges(),a("#listInstrumentPositions").dataTable().fnDestroy(),a("#listInstrumentPositionsContainer").empty(),ListState.listInstrumentPositions=null);f.forEach(function(h){h.id||(g--,
h.id=g)});a("#listInstrumentPositionsContainer").append(a("\x3ctable\x3e").attr("id","listInstrumentPositions").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listInstrumentPositions",ListTarget.instrumentposition,{isAdmin:e},f);b=!0},addInstrumentPosition:function(f){var h=InstrumentModel.getInstrumentPositions();h.push({alias:f});InstrumentModel.setInstrumentPositions(h)},removeInstrumentPositions:function(f){var h=InstrumentModel.getInstrumentPositions().filter(function(k){return-1===
f.indexOf(k.alias)});InstrumentModel.setInstrumentPositions(h)},getContainerModels:function(){return c?a("#listContainerModels").dataTable().fnGetData():null},setContainerModels:function(f){c&&(d.markOtherChanges(),a("#listContainerModels").dataTable().fnDestroy(),a("#listContainerModelsContainer").empty(),ListState.listContainerModels=null);a("#listContainerModelsContainer").append(a("\x3ctable\x3e").attr("id","listContainerModels").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listContainerModels",
ListTarget.containermodel,{isAdmin:e,isInstrumentModelPage:!0},f);c=!0},addContainerModel:function(f){var h=InstrumentModel.getContainerModels();h.push(f);InstrumentModel.setContainerModels(h)},removeContainerModels:function(f){var h=InstrumentModel.getContainerModels().filter(function(k){return-1===f.indexOf(k.id)});InstrumentModel.setContainerModels(h)}}}(jQuery);
function printerLabelEditor(a,b,c,d){function e(){for(;E.hasChildNodes();)E.removeChild(E.lastChild);p.forEach(function(x,F){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttributeNS(null,"x",x.x*f);n.setAttributeNS(null,"y",x.y*f);n.setAttribute("stroke","#000");n.setAttribute("stroke-width","1px");switch(x.element){case "1dbarcode":n.setAttributeNS(null,"height",x.height*f);n.setAttributeNS(null,"width",100*x.moduleWidth*f);n.setAttribute("fill","#ff000080");break;case "2dbarcode":n.setAttributeNS(null,
"height",144*x.moduleSize*f);n.setAttributeNS(null,"width",144*x.moduleSize*f);n.setAttribute("fill","#0000ff80");break;case "textblock":var m=x.direction.startsWith("VERTICAL");n.setAttributeNS(null,m?"width":"height",x.height*x.rowLimit*f);n.setAttributeNS(null,m?"height":"width",x.lineLimit*x.height/2*f);n.setAttribute("fill","#d0d0d080");break;case "text":m=x.direction.startsWith("VERTICAL"),n.setAttributeNS(null,m?"width":"height",x.height*f),n.setAttributeNS(null,m?"height":"width",x.lineLimit*
x.height/2*f),n.setAttribute("fill","#a0a0a080")}E.appendChild(n);n.addEventListener("click",function(u){for(u.stopPropagation();q.hasChildNodes();)q.removeChild(q.lastChild);if(t)p.splice(F,1),e(),t=!1;else if(u.ctrlKey||u.metaKey){u=[{type:"float",label:"X Position (mm)",property:"x",value:x.x},{type:"float",label:"Y Position (mm)",property:"y",value:x.y}];x.element.startsWith("text")&&(u.push({type:"float",label:"Height (mm)",property:"height",value:x.height}),u.push({type:"int",label:"Max Line Length (characters)",
property:"lineLimit",value:x.lineLimit}),u.push({type:"select",label:"Direction",property:"direction",values:["NORMAL","UPSIDEDOWN","VERTICAL_DOWN","VERTICAL_UP"],value:x.direction}),u.push({type:"select",label:"Style",property:"style",values:["REGULAR","BOLD"],value:x.style}));switch(x.element){case "1dbarcode":u.push({type:"float",label:"Module Width (mm) [width of each stripe]",property:"moduleWidth",value:x.moduleWidth});u.push({type:"float",label:"Barcode Height (mm)",property:"height",value:x.height});
break;case "2dbarcode":u.push({type:"float",label:"Module Size (mm) [width/height of each square]",property:"moduleSize",value:x.moduleSize});break;case "textblock":u.push({type:"int",label:"Max Number of Rows",property:"rowLimit",value:x.rowLimit});break;case "text":u.push({type:"select",label:"Justification",property:"justification",values:["LEFT","RIGHT"],value:x.justification})}Utils.showDialog("Edit Element","Update",u,function(N){Object.assign(x,N);e()})}else if("textblock"==x.element){var A=
Array.isArray(x.contents)?x.contents:[x.contents];x.contents=A;var G=document.createElement("table");q.appendChild(G);var D=function(){for(;G.hasChildNodes();)G.removeChild(G.lastChild);A.forEach(function(O,S){var T=document.createElement("tr");G.appendChild(T);var P=document.createElement("th");T.appendChild(P);jQuery(P).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"+",class:"btn-styled"}).click(function(){A.splice(S,0,["new row"]);D()}));P.appendChild(document.createTextNode("Row "+
(S+1)));jQuery(P).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"-",class:"btn-styled"}).click(function(){A.splice(S,1);D()}));P=document.createElement("th");T.appendChild(P);g(P,O,!0,function(V){x.contents[S]=V})});var N=document.createElement("tr");G.appendChild(N);var L=document.createElement("th");N.appendChild(L);jQuery(L).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"+",class:"btn-styled"}).click(function(){A.splice(A.length,0,
["new row"]);D()}))};D()}else u=document.createElement("div"),q.appendChild(u),g(u,x.contents,!0,function(N){x.contents=N})})})}function g(x,F,n,m){function u(){for(;x.hasChildNodes();)x.removeChild(x.lastChild);jQuery(x).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"+",class:"btn-styled"}).click(function(){A(0,n)}));G.forEach(function(D,N){x.appendChild(document.createElement("br"));if("string"==typeof D){var L=document.createElement("input");L.type="text";L.value=
D;x.appendChild(L);L.addEventListener("keyup",function(){G[N]=L.value;m(G)})}else if(D.hasOwnProperty("use")){var O=document.createElement("select");O.addEventListener("change",function(){G[N]={use:O.value};m(G)});Constants.printableFields.forEach(function(T){var P=document.createElement("option");P.text=T;P.value=T;O.appendChild(P);D.use==P.text&&(O.value=T)});x.appendChild(O)}else{var S=document.createElement("table");S.classList.add("dataTable");Object.entries(D).forEach(function(T,P){var V=document.createElement("tr");
1==P%2&&V.classList.add("odd");S.appendChild(V);P=document.createElement("th");P.innerText=T[0];V.appendChild(P);P=document.createElement("td");P.style.border="1px solid black";V.appendChild(P);g(P,T[1],!1,function(W){D[T[0]]=W})});x.appendChild(S)}jQuery(x).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"-",class:"btn-styled"}).click(function(){G.splice(N,1);u();m(G)}));jQuery(x).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"+",class:"btn-styled"}).click(function(){A(N+
1,n)}))})}function A(D,N){var L=[{name:"Text",value:"abc"},{name:"Field",value:{use:"ALIAS"}}];N&&L.push({name:"Alternate",value:{LIBRARY_ALIQUOT:"library aliquot",POOL:"pool",SAMPLE:"sample",LIBRARY:"library",BOX:"box",CONTAINER:"container",CONTAINER_MODEL:"container model",KIT:"kit"}});Utils.showWizardDialog("Add",L.map(function(O){return{name:O.name,handler:function(){G.splice(D,0,O.value);m(G);u()}}}))}var G=[F].flat(Number.MAX_VALUE).filter(function(D){return null!==D});u()}var f=Math.min(Math.max(b,
200)/b,Math.max(c,200)/c),h=.25*Math.max(b,c)*f,k=b*f+2*h,l=c*f+2*h,p=JSON.parse(JSON.stringify(a)),r=document.createElement("div");document.body.appendChild(r);var w=document.createElementNS("http://www.w3.org/2000/svg","svg");r.appendChild(w);r.appendChild(document.createElement("br"));w.setAttributeNS(null,"width",k);w.setAttributeNS(null,"height",l);var v=document.createElementNS("http://www.w3.org/2000/svg","rect");v.setAttributeNS(null,"x",h);v.setAttributeNS(null,"y",h);v.setAttributeNS(null,
"width",b*f);v.setAttributeNS(null,"height",c*f);v.setAttribute("fill","#FFF27A");w.appendChild(v);for(grid=15;grid<k;grid+=15)b=document.createElementNS("http://www.w3.org/2000/svg","line"),b.setAttributeNS(null,"x1",grid),b.setAttributeNS(null,"x2",grid),b.setAttributeNS(null,"y1","0"),b.setAttributeNS(null,"y2",l),b.setAttributeNS(null,"stroke","#00000040"),b.setAttributeNS(null,"stroke-dasharray","1 1"),w.appendChild(b);for(grid=15;grid<l;grid+=15)b=document.createElementNS("http://www.w3.org/2000/svg",
"line"),b.setAttributeNS(null,"x1","0"),b.setAttributeNS(null,"x2",k),b.setAttributeNS(null,"y1",grid),b.setAttributeNS(null,"y2",grid),b.setAttributeNS(null,"stroke","#00000040"),b.setAttributeNS(null,"stroke-dasharray","1 1"),w.appendChild(b);var E=document.createElementNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate("+h+","+h+")");w.appendChild(E);jQuery(r).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"Add",class:"btn-styled"}).click(function(){Utils.showWizardDialog("Add Element",
[{name:"Single Line of Text",handler:function(){p.push({element:"text",x:0,y:0,direction:"NORMAL",height:5,justification:"LEFT",lineLimit:30,style:"REGULAR",contents:[{use:"ALIAS"}]});e()}},{name:"Block of Text",handler:function(){p.push({element:"textblock",x:0,y:0,direction:"NORMAL",height:5,lineLimit:30,rowLimit:5,contents:[{use:"ALIAS"}]});e()}},{name:"1D Barcode",handler:function(){p.push({element:"1dbarcode",x:0,y:0,height:5,moduleWidth:.3,contents:[{use:"BARCODE"}]});e()}},{name:"2D Barcode",
handler:function(){p.push({element:"2dbarcode",x:0,y:0,moduleSize:.3,contents:[{use:"BARCODE"}]});e()}}])})).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"Revert",class:"btn-styled"}).click(function(){p=JSON.parse(JSON.stringify(a));e()})).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"Delete",class:"btn-styled"}).click(function(){t=!0})).append(jQuery(document.createElement("button")).prop({type:"button",innerHTML:"Delete All",class:"btn-styled"}).click(function(){p=
[];e()}));r.appendChild(document.createElement("br"));r.appendChild(document.createTextNode("Click to edit contents. Control-Click to edit position and properties."));r.appendChild(document.createElement("br"));var q=document.createElement("div");r.appendChild(q);var t=!1;w.addEventListener("click",function(x){x.stopPropagation();t=!1});e();var z=jQuery(r).dialog({autoOpen:!0,height:600,width:350,title:"Edit Label Layout",modal:!1,resizable:!0,buttons:{Save:function(){d(p)},"Save and Close":function(){d(p);
z.dialog("close")}},closeOnEscape:!1})}
var LibraryIndexFamily=function(a){var b=!1;return{setAdmin:function(c){b=c},setIndices:function(c){a("#listIndicesContainer").append(a("\x3ctable\x3e").attr("id","listIndices").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listIndices",ListTarget.libraryindex,{isAdmin:b,indexFamilyId:a("#indexFamilyForm_id").val()},c)}}}(jQuery),LibraryTemplate=function(a){function b(l,p,r,w){var v=Utils.array.findFirstOrNull(function(E){return E.boxPosition===l},w);v||(v={boxPosition:l},
w.push(v));p=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(r),p.indices);if(1===p.position)v.index1=p;else if(2===p.position)v.index2=p;else throw Error("Unexpected index position: "+p.position);}function c(l,p){return l.filter(function(r){return r["index"+p]}).reduce(function(r,w){r[w.boxPosition]=w["index"+p].id;return r},{})}function d(){return g?a("#listProjects").dataTable().fnGetData():null}var e=!1,g=!1,f=null,h=null,k=0;return{setForm:function(l){f=l},setIndicesFromTemplate:function(l){h=
l.id;var p=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(l.indexFamilyId),Constants.libraryIndexFamilies),r=[];if(l.indexOneIds)for(var w in l.indexOneIds)b(w,p,l.indexOneIds[w],r);if(l.indexTwoIds)for(w in l.indexTwoIds)b(w,p,l.indexTwoIds[w],r);LibraryTemplate.setIndices(r)},setIndices:function(l){e&&(f.markOtherChanges(),a("#listIndices").dataTable().fnDestroy(),a("#listIndicesContainer").empty(),ListState.listIndices=null);l.forEach(function(p){p.id||(k++,p.id=k)});a("#listIndicesContainer").append(a("\x3ctable\x3e").attr("id",
"listIndices").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listIndices",ListTarget.libraryTemplate_index,{libraryTemplateId:h},l);e=!0},removeIndices:function(l){var p=l.map(function(r){return r.boxPosition});LibraryTemplate.setIndices((e?a("#listIndices").dataTable().fnGetData():null).filter(function(r){return-1===p.indexOf(r.boxPosition)}))},applyIndices:function(l){if(e){var p=e?a("#listIndices").dataTable().fnGetData():null;l.indexOneIds=c(p,1);l.indexTwoIds=
c(p,2)}},setProjects:function(l){g&&(f.markOtherChanges(),a("#listProjects").dataTable().fnDestroy(),a("#listProjectsContainer").empty(),ListState.listProjects=null);a("#listProjectsContainer").append(a("\x3ctable\x3e").attr("id","listProjects").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listProjects",ListTarget.project,{forLibraryTemplate:!0},l);g=!0},addProject:function(l){var p=d();p.push(l);LibraryTemplate.setProjects(p)},removeProjects:function(l){var p=l.map(Utils.array.getId);
LibraryTemplate.setProjects(d().filter(function(r){return-1===p.indexOf(r.id)}))},applyProjects:function(l){l.projectIds=d().map(Utils.array.getId)}}}(jQuery);jQuery.ajaxSetup({cache:!1});
var Utils=Utils||{copyText:function(a){var b=document.createElement("textarea");b.value=a;document.body.appendChild(b);b.select();document.execCommand("Copy");b.remove()},decodeHtmlString:function(a){var b=document.createElement("textarea");b.innerHTML=a;return b.value},mappifyForm:function(a){var b={};jQuery.each(jQuery("#"+a).serializeArray(),function(c,d){b[d.name]=d.value});return b},mappifyInputs:function(a){var b={};jQuery.each(jQuery("#"+a).find(":input").serializeArray(),function(c,d){b[d.name]=
d.value});return b},mappifyTable:function(a){var b=[];jQuery.each(jQuery("#"+a).find("tr:gt(0)"),function(){var c={};jQuery.each(jQuery(this).find("td"),function(){var d=jQuery(this);Utils.validation.isNullCheck(d.attr("name"))||(c[d.attr("name")]=d.html())});b.push(c)});return b},checkCommonSampleClasses:function(a,b,c,d){a=a.aaData.filter(function(e){return-1!=c.indexOf(e.id)}).map(b);for(b=1;b<a.length;b++)if(a[b]!=a[0])return alert(d),!1;return!0},createToggleColumn:function(a){var b=eval(a),
c=a.replace(/\./g,"");return{sTitle:"",mData:"id",include:!0,mRender:function(d,e,g){e=-1<b.indexOf(d);return'\x3cinput id\x3d"'+d+"_"+c+'" class\x3d"'+c+' bulkCheckbox" elementId\x3d"'+d+'" type\x3d"checkbox" onclick\x3d"Utils.toggleListRange(this.checked, event, '+d+", "+a+", '"+c+"')\""+(e?' checked\x3d"checked"':"")+"\x3e"}}},toggleListRange:function(a,b,c,d,e){if(b.shiftKey){a=c+"_"+e;var g=[];jQuery("input."+e).each(function(){g.push(jQuery(this))});b=function(f){return g.findIndex(function(h){return h.attr("id")===
f})};e=b(d.lastSingleSelect);-1===e&&(d.lastSingleSelect=0);a=b(a);(function(f,h){var k=Math.min(f,h),l=Math.max(f,h);g.forEach(function(p,r){var w=Number(p.attr("elementid"));r>=k&&r<=l&&(p.prop("checked",!0),Utils.toggleListItem(!0,w,d))})})(e,a)}else a&&(d.lastSingleSelect=c+"_"+e),Utils.toggleListItem(a,c,d)},toggleListItem:function(a,b,c){a?(a=c.indexOf(b),-1===a&&c.push(b)):(a=c.indexOf(b),-1<a&&c.splice(a,1))},showOkDialog:function(a,b,c){for(var d=document.getElementById("dialog");d.hasChildNodes();)d.removeChild(d.lastChild);
b.forEach(function(g){var f=document.createElement("P");f.textContent=g;d.appendChild(f)});var e=jQuery("#dialog").dialog({autoOpen:!0,width:500,title:a,modal:!0,buttons:{OK:{id:"ok",text:"OK",click:function(){e.dialog("close");"function"==typeof c&&c()}}},open:function(g,f){c?jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide():jQuery(this).parent().children().children(".ui-dialog-titlebar-close").show()}})},showConfirmDialog:function(a,b,c,d,e,g){for(var f=document.getElementById("dialog");f.hasChildNodes();)f.removeChild(f.lastChild);
c.forEach(function(k){var l=document.createElement("P");l.textContent=k;f.appendChild(l)});c={};c[b]={id:"ok",text:b,click:function(){h.dialog("close");d()}};c[g||"Cancel"]={id:"cancel",text:g||"Cancel",click:function(){h.dialog("close");"function"==typeof e&&e()}};var h=jQuery("#dialog").dialog({autoOpen:!0,width:500,title:a,modal:!0,buttons:c,open:function(k,l){e?jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide():jQuery(this).parent().children().children(".ui-dialog-titlebar-close").show()}})},
showDialog:function(a,b,c,d,e,g){for(var f=document.getElementById("dialog");f.hasChildNodes();)f.removeChild(f.lastChild);var h={};c.forEach(function(p){var r=document.createElement("P");r.appendChild(document.createTextNode(p.label+(p.required?"*":"")+": "));switch(p.type){case "select":if(0==p.values.length)return;var w=document.createElement("SELECT");p.values.forEach(function(z,x){var F=document.createElement("OPTION");F.text=p.getLabel?p.getLabel(z):z;F.value=x;w.appendChild(F);p.value==F.text&&
(w.value=x,h[p.property]=z)});w.onchange=function(){h[p.property]=p.values[parseInt(w.value)]};p.value||(h[p.property]=p.values[0]);break;case "text":w=document.createElement("INPUT");w.setAttribute("type","text");w.value=p.value||"";h[p.property]=p.value||"";w.onchange=function(){h[p.property]=w.value};break;case "textarea":w=document.createElement("TEXTAREA");w.setAttribute("rows",p.rows||10);w.setAttribute("cols",p.cols||40);w.value=p.value||"";h[p.property]=p.value||"";w.onchange=function(){h[p.property]=
w.value};break;case "int":w=document.createElement("INPUT");w.setAttribute("type","text");w.value=p.hasOwnProperty("value")?p.value:0;h[p.property]=p.hasOwnProperty("value")?p.value:0;w.onchange=function(){h[p.property]=parseInt(w.value)};break;case "float":w=document.createElement("INPUT");w.setAttribute("type","text");w.value=p.hasOwnProperty("value")?p.value:0;h[p.property]=p.hasOwnProperty("value")?p.value:0;w.onchange=function(){h[p.property]=parseFloat(w.value)};break;case "date":w=document.createElement("INPUT");
w.setAttribute("type","text");w.onchange=function(){h[p.property]=w.value};jQuery(w).datepicker({dateFormat:"yy-mm-dd",showButtonPanel:!0});break;case "checkbox":w=document.createElement("INPUT");w.setAttribute("type","checkbox");w.checked=p.value;h[p.property]=w.checked;w.onchange=function(){h[p.property]=w.checked};break;case "compare":w=document.createElement("DIV");var v=document.createElement("SELECT"),E=[{label:"ignore",comparator:function(z,x){return!0}},{label:"\x3e",comparator:function(z,
x){return z>x}},{label:"\x3e\x3d",comparator:function(z,x){return z>=x}},{label:"\x3d",comparator:function(z,x){return z==x}},{label:"\x3c\x3d",comparator:function(z,x){return z<=x}},{label:"\x3c",comparator:function(z,x){return z<x}}];E.forEach(function(z,x){var F=document.createElement("OPTION");F.text=p.getLabel?p.getLabel(z.label):z.label;F.value=x;v.appendChild(F)});v.value=0;var q=document.createElement("INPUT");q.setAttribute("type","text");q.value=0;var t=function(){var z=parseFloat(q.value);
h[p.property]=isNaN(z)?function(x){return!0}:function(x){return E[parseInt(v.value)].comparator(x,z)}};v.onchange=t;q.onchange=t;t();w.appendChild(v);w.appendChild(q);break;default:throw Error("Unknown field type: "+p.type);}r.appendChild(w);f.appendChild(r)});var k={};k[b]={id:"ok",text:b,click:function(){var p=c.filter(function(r){return r.required&&!h[r.property]}).map(function(r){return r.label});p.length?alert("You must fill out the following fields: "+p.join(", ")):(p=c.filter(function(r){var w=
h[r.property],v=r.regex;v||"text"!==r.type||(v=Utils.validation.sanitizeRegex);return v&&w&&!(new RegExp(v)).test(w)}).map(function(r){return r.label}),p.length?alert("The following fields are invalid: "+p.join(", ")):(l.dialog("close"),d(h)))}};e&&(k.Back={id:"back",text:"Back",click:function(){l.dialog("close");e()}});k.Cancel={id:"cancel",text:"Cancel",click:function(){l.dialog("close");g&&g()}};var l=jQuery("#dialog").dialog({autoOpen:!0,height:Math.min(600,c.reduce(function(p,r){return p+("textarea"==
r.type?20*r.rows:40)},200)),width:500,title:a,modal:!0,buttons:k,open:function(p,r){g?jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide():jQuery(this).parent().children().children(".ui-dialog-titlebar-close").show()}})},showWizardDialog:function(a,b,c,d){for(var e=document.getElementById("dialog");e.hasChildNodes();)e.removeChild(e.lastChild);if(c){var g=document.createElement("P");g.appendChild(document.createTextNode(c));e.appendChild(g)}b.forEach(function(h){var k=document.createElement("P"),
l=document.createElement("A"),p=document.createElement("IMG");p.src="/styles/images/arrow.svg";l.appendChild(p);l.appendChild(document.createTextNode(h.name));l.href="#";l.onclick=function(){f.dialog("close");h.handler();return!1};k.appendChild(l);e.appendChild(k)});var f=jQuery("#dialog").dialog({autoOpen:!0,height:40*b.length+200,width:450,position:{my:"center",at:"center"},title:a,modal:!0,buttons:{Cancel:{id:"cancel",text:d||"Cancel",click:function(){f.dialog("close")}}},open:function(h,k){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").show()}})},
showAjaxErrorDialog:function(a,b,c,d){var e=[c];try{var g=JSON.parse(a.responseText);g.detail&&(e=e.concat(g.detail.split("\n")),"validation"===g.dataFormat&&jQuery.each(g.data,function(f,h){h=h.split("\n");jQuery.each(h,function(k,l){e.push("* "+("GENERAL"===f?l:f+": "+l))})}),g.data&&g.data.uiHelp&&e.push(g.data.uiHelp))}catch(f){}Utils.showOkDialog("Error",e,d)},showWorkingDialog:function(a,b){for(var c=document.getElementById("dialog");c.hasChildNodes();)c.removeChild(c.lastChild);var d=document.createElement("P");
d.appendChild(document.createTextNode("Working..."));c.appendChild(d);var e=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:a,modal:!0,buttons:{},closeOnEscape:!1,open:function(g,f){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});setTimeout(function(){b()||e.dialog("close")},100)},ajaxWithDialog:function(a,b,c,d,e,g,f){for(var h=document.getElementById("dialog");h.hasChildNodes();)h.removeChild(h.lastChild);var k=document.createElement("P");k.appendChild(document.createTextNode("Working..."));
h.appendChild(k);var l=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:a,modal:!0,buttons:{},closeOnEscape:!1,open:function(p,r){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});jQuery.ajax({dataType:"json",type:b,url:c,data:null==d?void 0:JSON.stringify(d),contentType:"application/json; charset\x3dutf8",success:function(p,r,w){l.dialog("close");e(p,r,w)},error:function(p,r,w){l.dialog("close");f?g(p,r,w):Utils.showAjaxErrorDialog(p,r,w,g)}})},ajaxDownloadWithDialog:function(a,
b){for(var c=document.getElementById("dialog");c.hasChildNodes();)c.removeChild(c.lastChild);var d=document.createElement("P");d.appendChild(document.createTextNode("Preparing and downloading..."));c.appendChild(d);var e=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Generating spreadsheet",modal:!0,buttons:{},closeOnEscape:!1,open:function(f,h){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}}),g=new XMLHttpRequest;g.open(b?"POST":"GET",a);g.responseType=
"blob";g.setRequestHeader("Content-Type","application/json; charset\x3dutf8");g.setRequestHeader("Accept","application/octet-stream");g.onreadystatechange=function(){if(4===g.readyState)if(e.dialog("close"),200===g.status){var f=/filename=(.*)$/.exec(g.getResponseHeader("Content-Disposition"))[1];download(g.response,f,g.getResponseHeader("Content-Type"))}else Utils.showOkDialog("Error",["Download failed."])};b?g.send(JSON.stringify(b)):g.send()},printSelectDialog:function(a,b){Utils.ajaxWithDialog("Getting Printers",
"GET",Urls.rest.printers.list,null,function(c){c=[{property:"printer",label:"Printer",required:!0,type:"select",value:window.localStorage.getItem("miso-printer"),values:c.filter(function(d){return d.available}),getLabel:Utils.array.getName},{property:"copies",label:"Copies",required:!0,type:"int",value:1}];b&&(c=c.concat(b));Utils.showDialog("Select Printer","Print",c,function(d){window.localStorage.setItem("miso-printer",d.printer.name);a(d.printer.id,Math.max(1,d.copies),d)},null)})},printDialog:function(a,
b){Utils.printSelectDialog(function(c,d){Utils.ajaxWithDialog("Printing","POST",Urls.rest.printers.print(c),{type:a,ids:b,copies:d},function(e){Utils.showOkDialog("Printing",[e==b.length?"Barcodes sent to printer.":e+" of "+b.length+" sent to printer."])})})},showSearchByNamesDialog:function(a,b,c,d){Utils.showDialog(a,"Search",[{label:d||"Names, Aliases, or Barcodes",type:"textarea",property:"names",rows:15,cols:40}],function(e){var g=e.names.split(/[ \t\r\n]+/).filter(function(f){return 0<f.length});
0!=g.length&&Utils.ajaxWithDialog("Searching","POST",b,g,function(f,h,k){c(f,h,k,g)})})},showSomeNotFoundError:function(a,b){a=a.length-b.length;Utils.showOkDialog("Error",[a+" of the items "+(1===a?"was":"were")+" not found"])},saveWithProgressDialog:function(a,b,c,d,e,g){g=g||function(h,k,l,p){Utils.showAjaxErrorDialog(h,k,p?"Failed to check operation status. The save may still be in progress or completed.":"Save Failed.")};var f=$("#dialog");f.empty();f.append($("\x3cp\x3e").text("Processed ").append($("\x3cspan\x3e").attr("id",
"dialogProgressText").text("0/"+c.length)));f.append(Utils.ui.makeProgressBar("dialogProgressBar"));$("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Adding",modal:!0,buttons:{},closeOnEscape:!1,open:function(h,k){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});$.ajax({dataType:"json",type:a,url:b,data:JSON.stringify(c),contentType:"application/json; charset\x3dutf8"}).done(function(h){var k=function(l){$("#dialogProgressText").text(l.completedUnits+"/"+
l.totalUnits);Utils.ui.setProgressBarProgress("dialogProgressBar",100*l.completedUnits/l.totalUnits);"running"===l.status?window.setTimeout(function(){$.ajax({dataType:"json",type:"GET",url:d(l.operationId),contentType:"application/json; charset\x3dutf8"}).done(function(p){k(p)}).fail(function(p,r,w){g(p,r,w,!1)})},2E3):e(l)};k(h)}).fail(function(h,k,l){g(h,k,l,!0)})},asyncSaveErrorsDialog:function(a,b,c,d){if("failed"!==a.status)throw Error("Unexpected update status");var e=["Save failed:"];"Validation failed"===
a.detail&&a.data&&a.data.forEach(function(g){e.push(c(b[g.row])+":");g.fields.forEach(function(f){e.push("* "+f.field+": "+f.errors.join("; "))})});Utils.showOkDialog("Error",e,d)},warnIfConsentRevoked:function(a,b,c){a=a.filter(function(e){return"Revoked"===e.identityConsentLevel});if(a.length){var d=["Donor has revoked consent for the following item"+(1<a.length?"s":"")+"."];jQuery.each(a,function(e,g){d.push("* "+("function"===typeof c?c(g):g.name+" ("+g.alias+")"))});Utils.showConfirmDialog("Warning",
"Proceed anyway",d,b)}else b()},getBoxPositionAsIntArray:function(a){var b=/.*([A-Z])(\d{2})$/.exec(a);a=b[1].charCodeAt(0);b=parseInt(b[2]);return{row:a,col:b}},valOrNull:function(a){return 0===a?0:a||null},getCurrentDate:function(){var a=new Date;return a.getFullYear()+"-"+Utils.zeroPad(a.getMonth()+1,2)+"-"+Utils.zeroPad(a.getDate(),2)},getCurrentTime:function(){var a=new Date;return Utils.formatTwelveHourTime(a.getHours(),a.getMinutes())},getCurrentDatetime:function(){var a=new Date;return a.getFullYear()+
"-"+Utils.zeroPad(a.getMonth()+1,2)+"-"+Utils.zeroPad(a.getDate(),2)+" "+Utils.zeroPad(a.getHours(),2)+":"+Utils.zeroPad(a.getMinutes(),2)+":"+Utils.zeroPad(a.getSeconds(),2)},toTwelveHourTime:function(a){timeParts=a.split(":");return Utils.formatTwelveHourTime(timeParts[0],timeParts[1])},formatTwelveHourTime:function(a,b){if(11<a){var c="pm";12<a&&(a-=12)}else c="am";return a+":"+Utils.zeroPad(b,2)+" "+c},formatTwentyFourHourTime:function(a){a=a.split(" ");var b=a[0].split(":"),c=parseInt(b[0]);
"pm"===a[1]&&12>c&&(c+=12);return Utils.zeroPad(c,2)+":"+Utils.zeroPad(b[1])+":"+(2<b.length?Utils.zeroPad(b[2]):"00")},zeroPad:function(a,b){a=a.toString();return a.length>=b?a:"0".repeat(b-a.length)+a},createBoxDialog:function(a,b,c){var d=[{property:"alias",type:"text",label:"Alias",value:"",required:!0},{property:"use",type:"select",label:"Box Use",values:Constants.boxUses,getLabel:Utils.array.getAlias,required:!0},{property:"size",type:"select",label:"Box Size",values:Constants.boxSizes,getLabel:Utils.array.get("label"),
required:!0},{property:"matrixBarcode",type:"text",label:"Matrix Barcode",value:""}],e=function(g){var f={};f.alias=g.alias;f.description=g.description||"";f.sizeId=g.size.id;f.useId=g.use.id;f.identificationBarcode=g.matrixBarcode;f.locationBarcode=g.locationBarcode;f.tubeCount=0;f.storageLocationBarcode=g.storageLocationBarcode;return f};Utils.showDialog("Create Box","Create",d,function(g){var f=e(g);g=Utils.array.findFirstOrNull(function(h){return h.id==f.sizeId},Constants.boxSizes);b(a)>g.rows*
g.columns?Utils.showOkDialog("Error",["The box is too small for the number of items.","If this is intended, please create the box manually before entering the data."]):Utils.ajaxWithDialog("Creating Box","POST",Urls.rest.boxes.create,f,c)})},getEmptyBoxPositions:function(a){for(var b=a.items.map(function(f){return f.coordinates}),c=[],d=0;d<a.rows;d++)for(var e=0;e<a.cols;e++){var g=String.fromCharCode(65+d)+(9>e?"0":"")+(e+1);-1===b.indexOf(g)&&c.push(g)}return c},getObjectField:function(a,b){return b.split(".").reduce(function(c,
d){return c&&c.hasOwnProperty(d)?c[d]:null},a)},setObjectField:function(a,b,c){b.split(".").reduce(function(d,e,g,f){g===f.length-1?d[e]=c:d[e]||(f.length>g+1&&Utils.isIntegerString(f[g+1])?d[e]=[]:d[e]={});return d[e]},a)},isIntegerString:function(a){return/^-?\d+$/.test(a)}};
Utils.ui={toggleElement:function(a){a=$("#"+a);a.is(":animated")||a.slideToggle({duration:500})},toggleRightInfo:function(a,b){jQuery(a).hasClass("toggleRight")?jQuery(a).removeClass("toggleRight").addClass("toggleRightDown"):jQuery(a).removeClass("toggleRightDown").addClass("toggleRight");Utils.ui.toggleElement(b)},toggleLeftInfo:function(a,b){jQuery(a).hasClass("toggleLeft")?jQuery(a).removeClass("toggleLeft").addClass("toggleLeftDown"):jQuery(a).removeClass("toggleLeftDown").addClass("toggleLeft");
Utils.ui.toggleElement(b)},collapseClass:function(a){jQuery("."+a).slideUp({duration:500})},collapse:function(a,b){jQuery(a).slideUp({duration:500});b&&(a=jQuery(b),a.removeClass("toggleLeftDown"),a.addClass("toggleLeft"))},goodDateFormat:"yy-mm-dd",addDatePicker:function(a){jQuery("#"+a).datepicker({dateFormat:Utils.ui.goodDateFormat,showButtonPanel:!0})},addDateTimePicker:function(a){jQuery("#"+a).datetimepicker({controlType:"select",oneLine:!0,dateFormat:Utils.ui.goodDateFormat,timeFormat:"HH:mm:ss"})},
setDisabled:function(a,b){a="string"===typeof a?jQuery(a):a;a.prop("disabled",b);b?a.addClass("disabled"):a.removeClass("disabled")},filterTable:function(a,b,c){b=(b?b+":":"")+'"'+c+'"';jQuery("#"+a).dataTable().fnFilter(b);jQuery("#"+a+"_filter input").val(b)},makeBulkActionButton:function(a,b){var c=jQuery("\x3ca /\x3e",{class:"ui-button ui-state-default",title:a.title||"",text:a.name});c.click(function(){var d=b();d&&d.length?a.action(b()):Utils.showOkDialog(a.title,["Nothing selected."])});return c},
updateHelpLink:function(a){jQuery("#userManualLink").attr("href",a?a:Urls.external.userManual())},makeProgressBar:function(a){return jQuery("\x3cdiv\x3e").addClass("progress-bar").append(jQuery("\x3cdiv\x3e").attr("id",a).addClass("progress-bar-progress"))},setProgressBarProgress:function(a,b){jQuery("#"+a).css("width",b+"%")}};
Utils.validation={dateRegex:"^(19|20)[0-9]{2}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$",dateTimeRegex:"^(19|20)[0-9]{2}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$",sanitizeRegex:"^[^\x3c\x3e\x26\\t\\n\\r]*$",uriComponentRegex:"^[^\x3c\x3e\x26%;/\\t\\n\\r\\\\]*$",uriRegex:"^[^\x3c\x3e\\t\\n\\r\\\\]*$",alphanumRegex:"^[-_\\w]*$",unicodeWordRegex:"^[\\p{L}0-9_\\^\\-\\.\\s]+$",emailRegex:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,isNullCheck:function(a){return""===
a||" "===a||"undefined"===a||"\x26nbsp;"===a||void 0===a},clean_input_field:function(a){var b=a.val();a.val(b.trim(b))},isEmpty:function(a){return void 0===a||null===a||""===a},hasNoSpecialChars:function(a){return(new RegExp(Utils.validation.sanitizeRegex)).test(a)}};
Utils.page={pageReload:function(){window.location.reload(!0)},newWindow:function(a){newwindow=window.open(a,"name","height\x3d500,width\x3d500,menubar\x3dyes,status\x3dyes,scrollbars\x3dyes");window.focus&&newwindow.focus();return!1},pageRedirect:function(a){window.location=a},reloadWithParams:function(a){window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+Utils.page.param(a)},post:function(a,b){var c=jQuery("\x3cform\x3e").attr("action",a).attr("method",
"POST").css("display","none");Object.keys(b).forEach(function(d){c.append(jQuery("\x3cinput\x3e").attr({type:"hidden",id:d,name:d,value:b[d]}))});c.appendTo(document.body);c.submit()},getBaseUrl:function(){return window.location.protocol+"//"+window.location.host},param:function(a){return jQuery.param(a).replaceAll("%20","+")}};
Utils.array={getAlias:function(a){if(a.alias)return a.alias},getId:function(a){return a.id},getName:function(a){if(a.name)return a.name},get:function(a){return function(b){return b[a]}},getValues:function(a,b){return b.map(function(c){return c[a]})},findFirstOrNull:function(a,b){a=b.filter(a);return 0<a.length?a[0]:null},findUniqueOrThrow:function(a,b){a=b.filter(a);if(1!=a.length)throw Utils.showOkDialog("Error",["An unexpected JavaSript error has occurred.","Please file a ticket letting us know what you were trying to do when this happened."]),
Error("unique element not found");return a[0]},maybeGetProperty:function(a,b){return a?a[b]:null},aliasPredicate:function(a){return function(b){return b.alias==a}},idPredicate:function(a){return function(b){return b.id==a}},namePredicate:function(a){return function(b){return b.name==a}},descriptionPredicate:function(a){return function(b){return b.description==a}},getObjById:function(a,b){return Utils.array.findFirstOrNull(Utils.array.idPredicate(a),b)},getIdFromAlias:function(a,b){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.aliasPredicate(a),
b),"id")},getAliasFromId:function(a,b){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.idPredicate(a),b),"alias")},deduplicateNumeric:function(a){return a.sort(function(b,c){return b-c}).filter(function(b,c,d){return 0==c||b!==d[c-1]})},deduplicateString:function(a){return a.sort(function(b,c){return b.localeCompare(c)}).filter(function(b,c,d){return 0==c||b!==d[c-1]})},deduplicateById:function(a){return a.sort(function(b,c){return b.id-c.id}).filter(function(b,c,d){return 0==
c||b.id!=d[c-1].id})},removeArchived:function(a){return a.filter(function(b){return!b.archived})},list:function(a){if(!Array.isArray(a))return a;switch(a.length){case 1:return a[0];case 2:return a[0]+" and "+a[1];default:return a.slice(0,-1).join(", ")+", and "+a[a.length-1]}}};
Utils.sorting={standardSort:function(a){return function(b,c){return Utils.sorting.standardSortItems(b[a],c[a])}},standardSortItems:function(a,b){if("number"==typeof a&&"number"==typeof b)return a>b?1:b>a?-1:0;if("string"==typeof a&&"string"==typeof b)return a.localeCompare(b);if("function"==typeof a||"function"==typeof b)throw Error("Cannot compare function definitions; both are special in their own way");return(""+a).localeCompare(""+b)},standardSortWithException:function(a,b,c){var d=Utils.sorting.standardSort(a);
return function(e,g){var f=g[a];return e[a]===b?c?-1:1:f===b?c?1:-1:d(e,g)}},standardSortByCallback:function(a){return function(b,c){return Utils.sorting.standardSortItems(a(b),a(c))}},twoByTwoComparator:function(a,b,c,d){return a-b||c-d},sortBoxPositions:function(a,b,c){var d=Utils.getBoxPositionAsIntArray(a),e=d.row;d=d.col;var g=Utils.getBoxPositionAsIntArray(b),f=g.row;g=g.col;return e&&f&&d&&g?c?Utils.sorting.twoByTwoComparator(e,f,d,g):Utils.sorting.twoByTwoComparator(d,g,e,f):a.localeCompare(b)},
sampleClassComparator:function(a,b){return Constants.sampleCategories.indexOf(a.sampleCategory)-Constants.sampleCategories.indexOf(b.sampleCategory)||a.alias.localeCompare(b.alias)},detailedQcStatusSort:function(a,b){var c=function(d){return"Not Ready"===d.description?0:!0===d.status?1:!1===d.status?2:3};return c(a)-c(b)||a.description.localeCompare(b.description)}};
Utils.notes={showNoteDialog:function(a,b){Utils.showDialog("Create New Note","Add Note",[{label:"Internal Only?",property:"internalOnly",type:"checkbox",value:!0},{label:"Text",property:"text",type:"textarea",rows:3,required:!0}],function(c){Utils.notes.addNote(a,b,c.internalOnly,c.text)})},addNote:function(a,b,c,d){Utils.ajaxWithDialog("Adding Note","POST",Urls.rest.notes.create(a,b),{internalOnly:"on"==c,text:d},Utils.page.pageReload)},deleteNote:function(a,b,c){Utils.showConfirmDialog("Delete Note",
"Delete",["Are you sure you wish to delete this note?"],function(){Utils.ajaxWithDialog("Deleting Note","DELETE",Urls.rest.notes.remove(a,b,c),null,Utils.page.pageReload)})}};
Utils.decimalStrings=function(){function a(c,d,e){if(e<d)throw Error("Bad value for decimalShift");return parseInt(c.replace(".","")+"0".repeat(e-d))}function b(c,d){if(0===d)return c.toString();if(!d||0>d)throw Error("Bad value for decimalShift");var e=0>c;c=Math.abs(c).toString();d>=c.length&&(c="0".repeat(d-c.length+1)+c);d=c.length-d;c=c.substring(0,d)+"."+c.substring(d);d=c.match(/\.(\d*[1-9])?(0+)?$/);d[2]&&(c=d[1]?c.substring(0,c.length-d[2].length):c.substring(0,c.length-(d[2].length-1)));
c.endsWith(".")&&(c+="0");e&&(c="-"+c);return c}return{add:function(c,d){var e=Utils.decimalStrings.getDecimalPlaces(c),g=Utils.decimalStrings.getDecimalPlaces(d),f=Math.max(e,g);c=a(c,e,f)+a(d,g,f);return b(c,f)},subtract:function(c,d){var e=Utils.decimalStrings.getDecimalPlaces(c),g=Utils.decimalStrings.getDecimalPlaces(d),f=Math.max(e,g);c=a(c,e,f)-a(d,g,f);return b(c,f)},getDecimalPlaces:function(c){"string"!==typeof c&&(c=c.toString());var d=c.indexOf(".");return-1===d?0:c.length-(d+1)},truncateDecimal:function(c,
d){"string"!==typeof c&&(c=c.toString());var e=c.indexOf(".");-1<e&&(c=c.substring(0,e+d+1));return c}}}();ListState={};ListTarget={};
ListUtils=function(a){function b(q,t,z){Utils.showWizardDialog("Move to Another Requisition",[{name:"Stop",handler:function(){c(t.id,t.alias+" - STOPPED",t.assayIds?t.assayIds[0]:null,!0,q,z)}},{name:"Change Assay",handler:function(){var x=[g(t.assayIds?t.assayIds[0]:null)];Utils.showDialog("Choose assay","Continue",x,function(F){c(t.id,t.alias+" - "+F.assay.alias,F.assay.id,!1,q,z)})}},{name:"Other",handler:function(){Utils.showDialog("Move to Another Requisition","Continue",[{label:"Requisition Alias",
property:"alias",type:"text",required:!0,value:t.alias+" - "}],function(x){c(t.id,x.alias,t.assayIds?t.assayIds[0]:null,!1,q,z)})}}],"Purpose of move:")}function c(q,t,z,x,F,n){var m=Urls.rest.requisitions.search+"?"+Utils.page.param({q:t});Utils.ajaxWithDialog("Checking for existing requisition","GET",m,null,function(u){u.length?(u=u.map(function(A){return{name:A.alias,handler:function(){e(A.alias,A.assayIds?A.assayIds[0]:null,A.stopped,A.stopReason,F,A.id,n)}}}),u.push({name:"New Requisition",handler:function(){d(q,
t,z,x,F,n)}}),Utils.showWizardDialog("Move to Another Requisition",u)):d(t,z,x,F,n)})}function d(q,t,z,x,F){q=[{label:"Alias",property:"alias",type:"text",required:!0,value:q},g(t),{label:"Stopped",property:"stopped",type:"checkbox",value:z},{label:"Stop Reason",property:"stopReason",type:"text"}];Utils.showDialog("Move to New Requisition","Create and Move",q,function(n){e(n.alias,n.assay.id,n.stopped,n.stopReason,x,null,F)})}function e(q,t,z,x,F,n,m){q={requisitionId:n,requisitionAlias:q,assayId:t,
stopped:z,stopReason:x,itemIds:F.map(Utils.array.getId)};Utils.ajaxWithDialog("Moving Items","POST",m,q,function(u){Utils.page.pageRedirect(Urls.ui.requisitions.edit(u.id))})}function g(q){var t=q?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q),Constants.assays):null;return{label:"Assay",property:"assay",type:"select",required:!1,values:Constants.assays.filter(function(z){return!z.archived||z.id===q}),getLabel:function(z){return z.alias+" v"+z.version},value:t?t.alias+" v"+t.version:void 0}}
var f=function(q){var t=q.selected.reduce(function(z,x){return z+(q.data.every(function(F){return F.id!=x.id})?1:0)},0);q.element.innerText=(q.selected.length?" "+q.selected.length+" selected":"")+(t?" ("+t+" on other pages)":"")},h={id:{term:"id:#",help:"Checks for an item with the specified ID. Multiple IDs can be separated by commas."},fulfilled:{term:"is:fulfilled",help:"Check if there are no outstanding orders (remaining \x3d 0)."},active:{term:"is:active",help:"Check if there are outstanding orders (remaining \x3e 0)."},
runstatus:{term:"is:RUNSTATUS",help:'Match based on a run\'s "health".  RUNSTATUS may be one of: fulfilled, active, unknown, started, running, stopped, incomplete, failed, or completed.  For order completions, this means that the order includes at least one run with this status.  "incomplete" matches when a run\'s health (or an order completion with a run of this health) is any of running, started, or stopped'},created:{term:"created:DATE",help:"Checks when this item was created in the lab. For rules about dates, see below."},
entered:{term:"entered:DATE",help:"Checks when this item was entered into MISO. For rules about dates, see below."},received:{term:"received:DATE",help:"Checks whether this item has a received date that matches the provided date. For rules about dates, see below."},changed:{term:"changed:DATE",help:"Checks when any person last edited this item. For rules about dates, see below."},creator:{term:"creator:USER",help:"Check for items entered into MISO by a particular user. For the rules about users, see below."},
changedby:{term:"changedby:USER",help:"Checks for the last person to edit this item in MISO. For the rules about users, see below."},platform:{term:"platform:PLATFORM",help:"Check if this item is meant for a particular platform type: ILLUMINA, LS454, SOLID, IONTORRENT, PACBIO, OXFORDNANOPORE."},index:{term:"index:TEXT",help:"Checks if this item has the index provided. Both the index name and sequence are checked."},class:{term:"class:TEXT",help:"Check if the item belong to the sample class provided."},
lab:{term:"lab:TEXT",help:"Check if an item came from the specified lab."},external:{term:"external:TEXT",help:"Checks whether an item has the specified external name or secondary identifier."},box:{term:"box:TEXT",help:"Checks if an item is located in a particular box by alias or name."},boxType:{term:"boxType:NAME",help:"Checks whether the box is of the specified type - 'storage' or 'plate'."},freezer:{term:"freezer:TEXT",help:"Checks if an item is located in a particular freezer. This is a partial match."},
kitname:{term:"kitname:TEXT",help:"Checks if an item uses a library, clustering, or multiplexing kit of the specified name."},subproject:{term:"subproject:TEXT",help:"Checks whether the item involves the specified subproject"},parameters:{term:"parameters:TEXT",help:"Checks if an item has the specified sequencing parameters."},groupid:{term:"groupid:TEXT",help:"Checks if an item has the specified group ID."},design:{term:"design:TEXT",help:"Checks whether an item has the specified library design code"},
distributed:{term:"distributed:DATE",help:"Checks whether this item has a distribution date that matches the provided date. For rules about dates, see below. If empty, checks whether an item has been distributed at any time."},distributedto:{term:"distributedto:TEXT",help:"Checks if the item has been distributed to the specified recipient."},ghost:{term:"is:GHOST?",help:"Match based on whether a sample is real or a ghost/synthetic sample created for hierarchy purposes. 'GHOST?' may be either 'ghost' or 'real'. 'is:ghost' matches ghost/synthetic samples, and 'is:real' matches NON-ghost/synthetic samples."},
requisition:{term:"req:TEXT",help:"Checks whether an item has the specified requisition ID"},stage:{term:"stage:TEXT",help:"Checks whether an item is in the specified stage"},tissueOrigin:{term:"origin:TEXT",help:"Checks whether an item has the specified tissue origin"},tissueType:{term:"tissuetype:TEXT",help:"Checks whether an item has the specified tissue type"},timepoint:{term:"timepoint:TEXT",help:"Checks whether the item's timepoint matches."},model:{term:"model:TEXT",help:"Checks whether the item's model matches"},
archived:{term:"is:archived OR not:archived",help:"Checks whether the item is archived/retired"},workstation:{term:"workstation:TEXT",help:"Checks whether the item belongs to or was prepared at the specified workstation. May specify the workstation alias or barcode"},barcode:{term:"barcode:TEXT",help:"Checks whether the item's barcode matches"},project:{term:"project:TEXT",help:"Checks whether the item involves the specified project (name or code)"},pipeline:{term:"pipeline:TEXT",help:"Checks whether the pipeline matches"},
rebexpiry:{term:"rebexpiry:DATE",help:"Checks whether this item's REB expires on the specified date. For rules about dates, see below."},rebnumber:{term:"rebnumber:TEXT",help:"Checks whether this item's REB number matches"},status:{term:"status:STATUS",help:"Checks whether the status matches. STATUS must be a valid status value"},requisitionStatus:{term:"status:STATUS",help:"Checks whether the status matches. STATUS may be 'stopped', 'paused', or 'ongoing'"}},k=function(q){q=q.searchTermSelector(h).map(function(t){return t.term});
q.unshift("TEXT");return"Search syntax: \x3cbr/\x3e\x3cbr/\x3e"+q.join("\x3cbr/\x3e")},l=function(q,t,z){q+="_searchHelpTooltip";a("#"+t).append('\x3cdiv id\x3d"'+q+'" class\x3d"tooltip tooltipIcon"\x3e\x3cimg id\x3d"searchHelpQuestionMark" src\x3d"/styles/images/question_mark.png"\x3e\x3cspan class\x3d"tooltiptext"\x3e'+k(z)+"\x3c/span\x3e\x3c/div\x3e");return q},p=function(q){var t="";q=q.searchTermSelector(h);q.unshift({term:"TEXT",help:"If no term is specified, the text is taken as a general query and matched against identifying fields such as name, alias, or barcode, depending on the item type. This termless criterion can only be entered as the first criterion in a search."});
for(var z=0;z<q.length;++z)t+="\x3ctr\x3e\x3ctd\x3e"+q[z].term+"\x3c/td\x3e\x3ctd\x3e"+q[z].help+"\x3c/td\x3e\x3c/tr\x3e";return t},r=function(q,t){a("#"+q).click(function(){var z=a("#dialog");z.empty();z.append('\x3cp\x3e  This search box supports case-insensitive search syntax. Multiple criteria may be entered as one search, and an item must match all criteria to be included in the results.  Most criteria are entered in the format "term:phrase" where the term specifies the type of criterion, and the phrase specifies what to match.\x3c/p\x3e\x3cbr/\x3e\x3ctable class\x3d"searchHelpTable"\x3e  \x3ccaption\x3e\x3ch2\x3eSearch Terms\x3c/h2\x3e\x3c/caption\x3e  \x3cthead\x3e    \x3ctr\x3e\x3cth\x3eSyntax\x3c/th\x3e\x3cth\x3eMeaning\x3c/th\x3e\x3c/tr\x3e  \x3c/thead\x3e'+
(p(t)+'\x3c/table\x3e\x3cbr/\x3e\x3ctable class\x3d"searchHelpTable"\x3e  \x3ccaption\x3e\x3ch2\x3eTEXT Format\x3c/h2\x3e\x3c/caption\x3e  \x3cthead\x3e    \x3ctr\x3e\x3cth\x3eFormat\x3c/th\x3e\x3cth\x3eBehaviour\x3c/th\x3e\x3c/tr\x3e  \x3c/thead\x3e  \x3ctr\x3e\x3ctd\x3emytext\x3c/td\x3e\x3ctd\x3eFind items containing "mytext" anywhere (partial matching).\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e"mytext"\x3c/td\x3e\x3ctd\x3eFind items matching "mytext" exactly.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3emytext*\x3c/td\x3e\x3ctd\x3eFind items beginning with "mytext". Asterisks may be used as wildcards anywhere in the text\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e*\x3c/td\x3e\x3ctd\x3eFind items with any value specified.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e(Enter nothing to find items with no value specified.)\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\\*\\"\\:\x3c/td\x3e\x3ctd\x3eAsterisk, colon, and quotation marks are normally treated as special characters. If you wish to search for text containing these characters, they must be escaped by preceding them with a backslash.\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3cbr/\x3e\x3ctable class\x3d"searchHelpTable"\x3e  \x3ccaption\x3e\x3ch2\x3eDATE Format\x3c/h2\x3e\x3c/caption\x3e  \x3cthead\x3e    \x3ctr\x3e\x3cth\x3eFormat\x3c/th\x3e\x3cth\x3eBehaviour\x3c/th\x3e\x3c/tr\x3e  \x3c/thead\x3e  \x3ctr\x3e\x3ctd\x3elasthour\x3c/td\x3e\x3ctd\x3eFilter from 1 hour ago to the current time.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3etoday\x3c/td\x3e\x3ctd\x3eAnything that happened on the current calendar day.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eyesterday\x3c/td\x3e\x3ctd\x3eFilter for anything on the last calendar day.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3ethisweek\x3c/td\x3e\x3ctd\x3eFilter from Monday 00:00:00 of the current week to the present time.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3elastweek\x3c/td\x3e\x3ctd\x3eFilter from Monday 00:00:00 of the previous week to Sunday 23:59:59 of the previous week.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3ci\x3eN\x3c/i\x3ehours\x3c/td\x3e\x3ctd\x3eFilter for anything from the current time to \x3ci\x3eN\x3c/i\x3e hours ago.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3ci\x3eN\x3c/i\x3edays\x3c/td\x3e\x3ctd\x3eFilter for anything from the current time to \x3ci\x3eN\x3c/i\x3e*24 hours ago.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3ci\x3eYYYY\x3c/i\x3e-\x3ci\x3eMM\x3c/i\x3e-\x3ci\x3eDD\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eSearch from YYYY-MM-DD 00:00:00 to YYYY-MM-DD 23:59:59\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3ci\x3eYYYY\x3c/i\x3e-\x3ci\x3eMM\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything within the specified year and month\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3e\x3ci\x3eYYYY\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything within the specified year\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eFY\x3ci\x3eYYYY\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything within the specified fiscal year. e.g. "FY2019"\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eQ\x3ci\x3e#\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything within the specified fiscal quarter of this year. e.g. "Q3"\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eFY\x3ci\x3eYYYY\x3c/i\x3e Q\x3ci\x3e#\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything within the specified fiscal year and quarter. e.g. "FY2019 Q3"\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3ebefore \x3ci\x3eRANGE\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything before the specified range, where the range is one of the above options. e.g. "before lastweek" \x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eafter \x3ci\x3eRANGE\x3c/i\x3e\x3c/td\x3e\x3ctd\x3eFilter for anything after the specified range, where the range is one of the above options. e.g. "after 2019-02"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3cbr/\x3e\x3ctable class\x3d"searchHelpTable"\x3e  \x3ccaption\x3e\x3ch2\x3eUSER Format\x3c/h2\x3e\x3c/caption\x3e  \x3cthead\x3e    \x3ctr\x3e\x3cth\x3eFormat\x3c/th\x3e\x3cth\x3eBehaviour\x3c/th\x3e\x3c/tr\x3e  \x3c/thead\x3e  \x3ctr\x3e\x3ctd\x3eme\x3c/td\x3e\x3ctd\x3eSearches for the current user.\x3c/td\x3e\x3c/tr\x3e  \x3ctr\x3e\x3ctd\x3eAnything else\x3c/td\x3e\x3ctd\x3eAssumed to be the user\'s login name (not their human name), or the name of a group.    This starts searching from the beginning, so \u201cjrh\u201d will match \u201cjrhacker\u201d, but \u201chacker\u201d will not match \u201cjrhacker\u201d.\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'));
var x=jQuery("#dialog").dialog({autoOpen:!0,width:800,title:"Search Syntax",modal:!0,buttons:{OK:{id:"ok",text:"Close",click:function(){x.dialog("close")}}}})})},w=function(q){a("#headerMessages").empty();var t=[];q.headerMessage&&t.push(a("\x3cp\x3e").addClass("big big-"+(q.headerMessage.level||"info")).text(q.headerMessage.text));q.showNewOptionSop&&Constants.newOptionSopUrl&&t.push(a("\x3cp\x3e").addClass("big big-important").append(a("\x3ca\x3e").attr("href",Constants.newOptionSopUrl).attr("target",
"_blank").attr("rel","noopener noreferrer").text("Click to see the SOP for adding new options")));t.length&&(t[0].css("margin-top",".25em"),a("#headerMessages").append(t))},v=function(q){var t=q.aoColumns.reduce(function(z,x,F){return!x.hasOwnProperty("iSortPriority")||z.iSortPriority>x.iSortPriority?z:{iSortPriority:x.iSortPriority,bSortDirection:!!x.bSortDirection,iPos:F}},{iSortPriority:0});0<t.iSortPriority&&(q.aaSorting=[[t.iPos,t.bSortDirection?"asc":"desc"]]);return q},E=function(q,t,z,x,F,
n){var m=t.createStaticActions(x,z),u=t.createBulkActions(x,z),A=t.createColumns(x,z).filter(function(L){return!L.hasOwnProperty("include")||L.include});ListState[q]={selected:[],data:[],lastId:-1,element:document.createElement("SPAN")};var G=a("#"+q).html("");0<u.length&&(A.unshift({sTitle:"",mData:"id",include:!0,bSortable:!1,sClass:"noPrint",mRender:function(L,O,S){O=ListState[q].selected.some(function(T){return T.id==L})?' checked\x3d"checked"':"";return'\x3cinput type\x3d"checkbox" id\x3d"'+
q+"_toggle"+L+"\" onclick\x3d'ListUtils._checkEventHandler(this.checked, event, "+JSON.stringify(L)+', "'+q+"\")'"+O+"\x3e"}}),A.forEach(function(L){L.hasOwnProperty("iDataSort")&&(L.iDataSort+=1)}),0<m.length&&m.push(null),m.push({name:"\u2611",title:"Select all",handler:function(){var L=ListState[q];L.lastId=-1;L.selected=Utils.array.deduplicateById(L.selected.concat(L.data));L.data.forEach(function(O){if(O=document.getElementById(q+"_toggle"+O.id))O.checked=!0});f(L)}}),m.push({name:"\u2610",title:"Deselect all",
handler:function(){var L=ListState[q];L.lastId=-1;L.selected=[];L.data.forEach(function(O){if(O=document.getElementById(q+"_toggle"+O.id))O.checked=!1});f(L)}}),m.push({name:"\u2611 All",title:"Select all on all pages",handler:function(){if(1E4<G.fnSettings().fnRecordsDisplay())Utils.showOkDialog("Select all",["Too many items selected.","Please use stricter filtering to limit to 10\u00ad000."]);else{var L=a("#"+q+"_filter :input");n(D,L.val(),function(O){var S=ListState[q];S.lastId=-1;S.selected=
O;S.data.forEach(function(T){if(T=document.getElementById(q+"_toggle"+T.id))T.checked=0<O.length});f(S)})}}}),!z&&t.getQueryUrl&&m.push({name:"\ud83d\udccb",title:"Select by names",handler:function(){var L=function(O){Utils.showDialog("Select by Names","Select",[{label:"Names, Aliases, or Barcodes",type:"textarea",property:"names",rows:15,cols:40,value:O,required:!0}],function(S){var T=S.names.split(/[ \t\r\n]+/).filter(function(P){return 0<P.length});0!=T.length&&Utils.ajaxWithDialog("Searching",
"POST",t.getQueryUrl(),T,function(P){var V=P.length+" "+t.name+" found for "+T.length+" names",W=u.filter(function(X){return!!X}).map(function(X){return{name:X.name,handler:function(){X.action(P)}}}),Y=function(){Utils.showWizardDialog(V,W)};W.unshift({name:"View Selected",handler:function(){Utils.showOkDialog(V,P.map(function(X){return X.name+" ("+X.alias+")"}),Y)}});W.push({name:"Show in list",handler:function(){var X=P.map(Utils.array.getId).join(",");G.dataTable().fnFilter("id:"+X)}});Y()},function(){L(T.join("\n"))})},
null)};L("")}}));var D=document.createElement("DIV");z=v({aoColumns:A,aLengthMenu:[10,25,50,100,200,400,1E3],bJQueryUI:!0,bAutoWidth:!1,iDisplayLength:25,iDisplayStart:0,sDom:'\x3c"ui-toolbar clearfix"lfr\x3e\x3c"datatable-scroll"t\x3e\x3c"ui-toolbar ui-corner-bl ui-corner-br clearfix"ip\x3e',sPaginationType:"full_numbers",bStateSave:!0,bProcessing:!0,fnDrawCallback:function(L){G.removeClass("disabled");a("#"+q+"_paginate").find(".fg-button").removeClass("fg-button");f(ListState[q])},fnPreDrawCallback:function(L){ListState[q].data=
[]},fnRowCallback:function(L,O,S,T){ListState[q].data.push(O)}});t.onFirstLoad&&(z.fnInitComplete=function(L,O){t.onFirstLoad(O&&O.aaData?O.aaData:[],x)});F(z,G,D,A);G.dataTable(z);w(t);z.sAjaxSource&&t.hasOwnProperty("searchTermSelector")&&(F=l(q,q+"_filter",t),r(F,t));F=a("#"+q+"_filter :input");F.unbind();F.bind("keyup",function(L){13==L.keyCode&&G.fnFilter(this.value)});F=document.getElementById(q+"_wrapper");D.setAttribute("class","parsley-error");F.parentNode.insertBefore(D,F);if(0<u.length||
0<m.length){var N=document.createElement("DIV");N.setAttribute("class","ui-toolbar ui-corner-tl ui-corner-tr ui-helper-clearfix paging_full_numbers");F.parentNode.insertBefore(N,F);0<m.length&&0<u.length&&m.push(null);m.concat(u.map(function(L){return L?{name:L.name,handler:function(){0==ListState[q].selected.length?Utils.showOkDialog(L.name,["Nothing selected."]):L.action(ListState[q].selected.map(function(O){return O.isTemporaryId?O.original:O}))}}:null})).forEach(function(L){if(L){var O=document.createElement("A");
O.appendChild(document.createTextNode(L.name));O.href="#";O.setAttribute("class","ui-button ui-state-default");O.setAttribute("title",L.title||"");O.onclick=function(){L.handler();return!1}}else O=document.createElement("SPAN"),O.setAttribute("class","ui-state-default");N.appendChild(O)});0<u.length&&N.appendChild(ListState[q].element)}};return{createTable:function(q,t,z,x){E(q,t,z,x,function(F,n,m,u){F.bServerSide=!0;F.sAjaxSource=t.createUrl(x,z);F.fnServerData=function(A,G,D){n.addClass("disabled");
var N=a("#"+q+"_filter :input");N.prop("disabled",!0);a.ajax({dataType:"json",type:"GET",url:A,data:G,success:function(L,O,S){m.innerText=L.sError;m.style.visibility=L.sError?"visible":"hidden";u.forEach(function(T,P){T.visibilityFilter&&n.fnSetColumnVis(P,T.visibilityFilter(L.aaData.map(function(V){return V[T.mData]})),!1)});f(ListState[q]);D(L,O,S);N.prop("disabled",!1)},error:function(L,O,S){m.style.visibility="visible";m.innerText=S;f(ListState[q]);D({iTotalRecords:0,iTotalDisplayRecords:0,sEcho:G.sEcho,
aaData:[]});N.prop("disabled",!1)}})}},function(F,n,m){Utils.ajaxWithDialog("Selecting","GET",t.createUrl(x,z)+"?"+Utils.page.param({iDisplayStart:0,iDisplayLength:1E4,sSearch:n,sSortDir_0:"asc",iSortCol_0:0,mDataProp_0:"id",sEcho:0}),null,function(u){F.innerText=u.sError;F.style.visibility=u.sError?"visible":"hidden";m(u.aaData)},function(){m([])})})},createStaticTable:function(q,t,z,x){E(q,t,null,z,function(F,n,m,u){F.aaData=x;m.style.visibility="hidden"},function(F,n,m){var u=[];a("#"+q).dataTable().$("tr",
{filter:"applied"}).each(function(A,G){u.push(parseInt(G.children[0].children[0].id.match("^"+q+"_toggle(\\d+)$")[1]))});m(x.filter(function(A){return-1!==u.indexOf(A.id)}))})},_checkEventHandler:function(q,t,z,x){var F=ListState[x];if(t.shiftKey){q=F.data.findIndex(function(n){return n.id==z});t=-1==F.lastId?0:F.data.findIndex(function(n){return n.id==F.lastId});if(-1==q||-1==t)return;q=F.data.slice(Math.min(q,t),Math.max(q,t)+1);q.forEach(function(n){if(n=document.getElementById(x+"_toggle"+n.id))n.checked=
!0});F.selected=Utils.array.deduplicateById(F.selected.concat(q))}else q?(F.lastId=z,F.selected.some(function(n){return n.id==z})||Array.prototype.push.apply(F.selected,F.data.filter(function(n){return n.id==z}))):(q=F.selected.findIndex(function(n){return n.id==z}),-1<q&&F.selected.splice(q,1));f(F)},idHyperlinkColumn:function(q,t,z,x,F,n,m){return{sTitle:q,mData:z,include:n,iSortPriority:F,bSortable:0<=F,sClass:m,mRender:function(u,A,G){return"display"===A?u?'\x3ca href\x3d"'+t(u)+'"\x3e'+x(G)+
"\x3c/a\x3e":"":"filter"===A?x(G):u}}},labelHyperlinkColumn:function(q,t,z,x,F,n,m){return{sTitle:q,mData:x,include:n,iSortPriority:F,bSortDirection:!0,bSortable:0<=F,sClass:m,mRender:function(u,A,G){return"display"===A?u?'\x3ca href\x3d"'+t(z(G))+'"\x3e'+u+"\x3c/a\x3e":"":u}}},columns:{project:function(q){return ListUtils.labelHyperlinkColumn("Project",Urls.ui.projects.edit,Utils.array.get("projectId"),Constants.isDetailedSample?"projectCode":"projectName",0,!q)},detailedQcStatus:{sTitle:"QC",mData:"detailedQcStatusId",
sDefaultContent:"",mRender:function(q,t,z){return q&&(q=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(q),Constants.detailedQcStatuses),"boolean"===typeof q.status)?q.status?"\u2714":"\u2718":"?"},bSortable:!1}},render:{archived:function(q,t,z){return q?"\ud83d\uddc4":""},booleanChecks:function(q,t,z){return"boolean"==typeof q?q?"\u2714":"\u2718":"?"},dataReview:function(q,t,z){if(void 0===q||null===q)return"?";q=q?"\u2714":"\u2718";return"display"!==t?q:'\x3cdiv class\x3d"tooltip"\x3e\x3cspan\x3e'+
q+'\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3eSet by '+z.dataReviewer+", "+z.dataReviewDate+"\x3c/span\x3e\x3c/div\x3e"},platformType:function(q,t,z){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.namePredicate(q),Constants.platformTypes),"key")||"Unknown"},textFromId:function(q,t,z){return function(x,F,n){if(null==z||void 0==z)z="Unknown";return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.idPredicate(x),q),t)||z}},naIfNull:function(q,t,z){return"display"===
t&&null===q?"n/a":q},textWithHoverTitle:function(q,t,z){return function(x,F,n){if("display"!==F)return x;x=n[q];if(null===x)return z||"n/a";n=n[t];return null===n?x:'\x3cspan title\x3d"'+n+'"\x3e'+x+"\x3c/span\x3e"}},measureWithUnits:function(q,t){return function(z,x,F){return"display"===x&&z&&(x=q.find(function(n){return n.name==F[t]}))?z+" "+x.units:z}},dateWithTimeTooltip:function(q,t,z){return"display"===t&&q?'\x3cdiv class\x3d"tooltip"\x3e\x3cspan\x3e'+q.split(" ")[0]+'\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3e'+
q+"\x3c/span\x3e\x3c/div\x3e":q}},createBoxField:{property:"createBox",type:"checkbox",label:"Create New Box",value:!1},createStaticAddAction:function(q,t,z){return{name:"Add",handler:function(){Utils.showDialog("Create "+q,"Create",[{property:"quantity",type:"int",label:"Quantity",required:!0,value:1}],function(x){1>x.quantity?Utils.showOkDialog("Create "+q,["Quantity must be 1 or more."]):(x={quantity:x.quantity},z?window.location=t+"?"+Utils.page.param(x):Utils.page.post(t,x))})}}},createStaticAddBySearchAction:function(q,
t,z,x,F){var n="Add "+q;return{name:"Add",handler:function(){Utils.showDialog(n,"Search",[{label:t,type:"text",property:"query",required:!0}],function(m){x.q=m.query;Utils.ajaxWithDialog("Searching...","GET",z+"?"+Utils.page.param(x),null,function(u,A,G){u&&u.length?Utils.showWizardDialog(n,u.map(function(D){return{name:D.name,handler:function(){F(D)}}})):Utils.showOkDialog(n,[q+" not found."])})})}}},createStaticAddAliquotsAction:function(q,t){return{name:"Add",handler:function(){Utils.showDialog("Add Aliquots",
"Search",[{label:"Names, Aliases, or Barcodes",type:"textarea",property:"names",rows:15,cols:40,required:!0}],function(z){z=z.names.split(/[ \t\r\n]+/).filter(function(x){return 0<x.length});0!=z.length&&Utils.ajaxWithDialog("Searching","POST",Urls.rest.libraryAliquots.query,z,function(x){if(x&&x.length){var F=x.map(function(n){return{label:n.name+" ("+n.alias+")",property:"include"+n.id,type:"checkbox",value:!0}});Utils.showDialog("Select Aliquots","Next",F,function(n){var m=x.filter(function(A){return n["include"+
A.id]});if(m.length){var u=[];q().forEach(function(A){-1!==m.map(Utils.array.getId).indexOf(A.id)&&u.push(A)});u.length?Utils.showOkDialog("Error",["The following aliquots are already included in this pool:"].concat(u.map(function(A){return"* "+A.name+" ("+A.alias+")"}))):Utils.showDialog("Edit Proportions","Add",m.map(function(A){return{label:A.name+" ("+A.alias+")",type:"int",property:"aliquot"+A.id+"Proportion",required:!0,value:1}}),function(A){t(m,A)})}else Utils.showOkDialog("Error",["No aliquots selected"])})}else Utils.showOkDialog("Error",
["No aliquots found"])})})}}},createBulkDeleteAction:function(q,t,z){return{name:"Delete",action:function(x){var F=["Are you sure you wish to delete the following items? This cannot be undone."],n=[];jQuery.each(x,function(m,u){F.push("* "+z(u));n.push(u.id)});Utils.showConfirmDialog("Delete "+q,"Delete",F,function(){Utils.ajaxWithDialog("Deleting "+q,"POST","/rest/"+t+"/bulk-delete",n,function(){Utils.page.pageReload()})})}}},createMoveToRequisitionAction:function(q,t){return{name:"Move to Req.",
action:function(z){b(z,q,t)}}}}}(jQuery);
ListTarget.apikey=function(){return{name:"API Keys",getUserManualUrl:function(){return Urls.external.userManual("qc_integration","rest-api")},createUrl:function(a,b){throw Error("Must be provided statically");},createBulkActions:function(a,b){return[ListUtils.createBulkDeleteAction("API Keys","apikeys",function(c){return c.user.fullName})]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.showDialog("Create API Key","Create",[{label:"Name",property:"name",type:"text",
required:!0}],function(c){Utils.ajaxWithDialog("Creating API Key","POST",Urls.rest.apiKeys.create,{name:c.name},function(d){Utils.showOkDialog("New API Key",["New API key created. Make sure to save the key below, as it cannot be retrieved later.","Name: "+d.user.fullName,"Key: "+d.key],Utils.page.pageReload)})})}}]},createColumns:function(a,b){return[{sTitle:"Key",mData:"key"},{sTitle:"Name",mData:"user",mRender:function(c,d,e){return c.fullName}},{sTitle:"Creator",mData:"creatorName"},{sTitle:"Created",
mData:"created",mRender:ListUtils.render.dateWithTimeTooltip}]},searchTermSelector:function(a){return[a.id,a.requisitionStatus,a.entered,a.creator,a.changed,a.changedby]}}}();
ListTarget.array={name:"Arrays",getUserManualUrl:function(){return Urls.external.userManual("arrays")},createUrl:function(a,b){return Urls.rest.arrays.datatable},createBulkActions:function(a,b){return[ListUtils.createBulkDeleteAction("Arrays","arrays",function(c){return c.alias})]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location=Urls.ui.arrays.create}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",Urls.ui.arrays.edit,"id",Utils.array.getId,
0,!0),ListUtils.idHyperlinkColumn("Alias",Urls.ui.arrays.edit,"id",Utils.array.getAlias,0,!0),ListUtils.idHyperlinkColumn("Serial Number",Urls.ui.arrays.edit,"id",function(c){return c.serialNumber},0,!0),{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:2,bVisible:Constants.isDetailedSample}]}};
ListTarget.arraymodel={name:"Array Models",getUserManualUrl:function(){return Urls.external.userManual("type_data","array-models")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.arraymodel.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Array Models","arraymodels",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Array Models",
Urls.ui.arrayModels.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Rows",mData:"rows",include:!0,iSortPriority:0},{sTitle:"Columns",mData:"columns",include:!0,iSortPriority:0}]}};
ListTarget.arrayrun={name:"Array Runs",getUserManualUrl:function(){return Urls.external.userManual("array_runs")},createUrl:function(a,b){return b?Urls.rest.arrayRuns.projectDatatable(b):a.requisitionId?Urls.rest.arrayRuns.requisitionDatatable(a.requisitionId):Urls.rest.arrayRuns.datatable},createBulkActions:function(a,b){return[ListUtils.createBulkDeleteAction("Array Runs","arrayruns",function(c){return c.alias})]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location=
Urls.ui.arrayRuns.create}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",Urls.ui.arrayRuns.edit,"id",Utils.array.getId,0,!0),ListUtils.idHyperlinkColumn("Alias",Urls.ui.arrayRuns.edit,"id",Utils.array.getAlias,0,!0),{sTitle:"Status",mData:"status",mRender:function(c,d,e){return c||""},include:!0,iSortPriority:0},{sTitle:"Start Date",mData:"startDate",mRender:function(c,d,e){return c||""},include:!0,iSortPriority:2},{sTitle:"End Date",mData:"completionDate",mRender:function(c,
d,e){return c||""},include:!0,iSortPriority:0},{sTitle:"Modified",mData:"lastModified",include:Constants.isDetailedSample,iSortPriority:0}]},onFirstLoad:function(a,b){b.collapseId&&!a.length&&Utils.ui.collapse("#"+b.collapseId,"#"+b.collapseId+"_arrowclick")}};
ListTarget.assay=function(a){function b(){var d=Constants.assays.filter(function(e){return!e.archived});Utils.showWizardDialog("Add Assay",d.map(function(e){return{name:Assay.utils.makeLabel(e),handler:function(){Project.addAssay(e)}}}))}function c(d){var e=[];e=d.numberOfRequisitionedItems?d.potentialAssayIds.map(function(g){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g),Constants.assays)}):Constants.assays;e=e.filter(function(g){return!g.archived&&!Requisition.getAssays().some(function(f){return f.id===
g.id})});e.length?Utils.showWizardDialog("Add assay",e.map(function(g){return{name:g.alias+" v"+g.version,handler:function(){Requisition.addAssay(g)}}})):Utils.showOkDialog("Error",["No potential assays to add. An assay must be assigned to all projects associated with the requisition, and must not be archived."])}return{name:"Assays",getUserManualUrl:function(){return Urls.external.userManual("requisitions","assays")},createUrl:function(d,e){throw Error("Must be provided statically");},getQueryUrl:null,
showNewOptionSop:!0,createBulkActions:function(d,e){return null!=d.projectId&&0<=d.projectId?[{name:"Remove",action:Project.removeAssays}]:null!=d.requisitionId?[{name:"Remove",action:Requisition.removeAssays}]:d.isAdmin?[{name:"Copy",action:function(g){1<g.length?Utils.showOkDialog("Error",["Select an individual assay to copy"]):window.location=Urls.ui.assays.create+"?"+a.param({baseId:g[0].id})}},ListUtils.createBulkDeleteAction("Assays","assays",function(g){return g.alias+" v"+g.version})]:[]},
createStaticActions:function(d,e){return null!=d.projectId&&0<=d.projectId?[{name:"Add",handler:b}]:null!=d.requisitionId?[{name:"Add",handler:function(){c(d)}}]:d.isAdmin?[{name:"Add",handler:function(){Utils.page.pageRedirect(Urls.ui.assays.create)}}]:[]},createColumns:function(d,e){return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.assays.edit,Utils.array.getId,"alias",1,!0),{sTitle:"Version",mData:"version"},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]}}}(jQuery);
ListTarget.assaymetric=function(){function a(e){return function(g){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g.id),Constants.metrics)[e]}}function b(){Utils.showWizardDialog("Add Metric",Constants.metricCategories.map(function(e){return{name:e.label,handler:function(){var g=Constants.metrics.filter(function(h){return h.category===e.value}).sort(Utils.sorting.standardSort("alias"));if(g.length){var f=[];g.forEach(function(h){-1===f.indexOf(h.subcategoryId)&&f.push(h.subcategoryId)});
1<f.length?Utils.showWizardDialog("Add "+e.label+" Metric",f.map(function(h){var k=null;k=h?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(h),Constants.metricSubcategories):{id:null,alias:"No subcategory"};return{name:k.alias,handler:function(){g=g.filter(function(l){return l.subcategoryId===k.id});c(g,k.id?k.alias:e.label)}}})):c(g,e.label)}else Utils.showOkDialog("Error",["No metrics found. Metrics must be created from the Metrics list page before they can be added to assays."])}}}))}function c(e,
g){Utils.showWizardDialog("Add "+g+" Metric",e.map(function(f){var h=f.label+" (";f.units&&(h+=f.units+" ");var k=Utils.array.findUniqueOrThrow(function(l){return l.value===f.thresholdType},Constants.thresholdTypes);h+=Utils.decodeHtmlString(k.sign)+")";return{name:h,handler:function(){d(f)}}}))}function d(e){var g=Utils.array.findUniqueOrThrow(function(k){return k.value===e.thresholdType},Constants.thresholdTypes),f=[],h=e.units?" ("+e.units+")":"";g.lowerBound&&f.push({label:"Lower Bound"+h,type:"float",
required:!0,property:"lowerBound"});g.upperBound&&f.push({label:"Upper Bound"+h,type:"float",required:!0,property:"upperBound"});f.length?Utils.showDialog("Add Metric","Add",f,function(k){Assay.addMetric({id:e.id,minimumThreshold:k.lowerBound||null,maximumThreshold:k.upperBound||null})}):Assay.addMetric({id:e.id,minimumThreshold:null,maximumThreshold:null})}return{name:"Metrics",createBulkActions:function(e,g){return e.isAdmin&&"view"!=e.pageMode?[{name:"Remove",action:Assay.removeMetrics}]:[]},createStaticActions:function(e,
g){return e.isAdmin&&"view"!=e.pageMode?[{name:"Add",handler:b}]:[]},createColumns:function(e,g){return[{sTitle:"Metric",mData:a("label")},{sTitle:"Category Sort",mData:function(f){f=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f.id),Constants.metrics);return Assay.utils.getSortPriority(f)},bVisible:!1},{sTitle:"Category",mData:a("category"),mRender:function(f,h,k){return Utils.array.findUniqueOrThrow(function(l){return l.value===f},Constants.metricCategories).label},iDataSort:1,iSortPriority:1,
bSortDirection:!0},{sTitle:"Subcategory",mData:a("subcategoryId"),mRender:ListUtils.render.textFromId(Constants.metricSubcategories,"alias","")},{sTitle:"Threshold Type",mData:a("thresholdType"),mRender:function(f,h,k){return Utils.array.findUniqueOrThrow(function(l){return l.value===f},Constants.thresholdTypes).sign}},{sTitle:"Minimum",mData:"minimumThreshold",mRender:function(f,h,k){return f||"n/a"}},{sTitle:"Maximum",mData:"maximumThreshold",mRender:function(f,h,k){return f||"n/a"}},{sTitle:"Units",
mData:a("units"),mRender:function(f,h,k){return f||"n/a"}}]}}}();
ListTarget.assaytest=function(){function a(){Utils.showWizardDialog("Add Assay Test",Constants.assayTests.map(function(b){return{name:b.alias,handler:function(){Assay.addTest(b)}}}))}return{name:"Assay Tests",getUserManualUrl:function(){return Urls.external.userManual("type_data","assay-tests")},createUrl:function(b,c){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(b,c){c=[];b.isAdmin&&(null==b.assayId?(c=BulkTarget.assaytest.getBulkActions(b),
c.push(ListUtils.createBulkDeleteAction("Assay Tests","assaytests",Utils.array.getAlias))):"edit"!==b.pageMode&&"create"!==b.pageMode||c.push({name:"Remove",action:Assay.removeTests}));return c},createStaticActions:function(b,c){c=[];b.isAdmin&&("edit"===b.pageMode||"create"===b.pageMode?c.push({name:"Add",handler:a}):b.assayId||c.push(ListUtils.createStaticAddAction("Assay Tests",Urls.ui.assayTests.bulkCreate,!0)));return c},createColumns:function(b,c){return[{sTitle:"Alias",mData:"alias",iSortPriority:1},
{sTitle:"Tissue Origin",mData:"tissueOriginId",mRender:function(d,e,g){return d?(d=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d),Constants.tissueOrigins),g=(g.negateTissueOrigin?"NOT ":"")+d.alias,"display"===e?'\x3cspan title\x3d"'+d.description+'"\x3e'+g+"\x3c/span\x3e":g):null},include:Constants.isDetailedSample},{sTitle:"Tissue Type",mData:"tissueTypeId",mRender:function(d,e,g){return d?(d=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d),Constants.tissueTypes),g=(g.negateTissueType?
"NOT ":"")+d.alias,"display"===e?'\x3cspan title\x3d"'+d.description+'"\x3e'+g+"\x3c/span\x3e":g):null},include:Constants.isDetailedSample},{sTitle:"Extraction Class",mData:"extractionClassId",mRender:ListUtils.render.textFromId(Constants.sampleClasses,"alias"),include:Constants.isDetailedSample},{sTitle:"Library Design Code",mData:"libraryDesignCodeId",mRender:function(d,e,g){d=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d),Constants.libraryDesignCodes);return"display"===e?'\x3cspan title\x3d"'+
d.description+'"\x3e'+d.code+"\x3c/span\x3e":d.code},include:Constants.isDetailedSample},{sTitle:"Library Qualification Method",mData:"libraryQualificationMethod",mRender:function(d,e,g){if("display"!==e)return d;e=Utils.array.findUniqueOrThrow(function(f){return f.value===d},b.libraryQualificationMethods);return"ALIQUOT"===d?(g=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g.libraryQualificationDesignCodeId),Constants.libraryDesignCodes),e.label+" ("+g.code+")"):e.label},include:Constants.isDetailedSample},
{sTitle:"Permitted Samples",mData:"permittedSamples",mRender:function(d,e,g){return Utils.array.findUniqueOrThrow(function(f){return f.value===d},Constants.permittedSamples).label}},{sTitle:"Repeat",mData:"repeatPerTimepoint",mRender:ListUtils.render.booleanChecks}]}}}();
ListTarget.attachment=function(){return{name:"Attachments",createUrl:function(a,b){throw Error("Static data only");},createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[{name:"Upload",handler:a.projectId?function(){Utils.showWizardDialog("Attach Files",[{name:"Upload new files",handler:function(){ListTarget.attachment.showUploadDialog(a.entityType,a.entityId,!0)}},{name:"Link project file",handler:function(){ListTarget.attachment.showLinkDialog(a.entityType,a.entityId,
a.projectId,!0)}}])}:function(){ListTarget.attachment.showUploadDialog(a.entityType,a.entityId,!0)}}]},createColumns:function(a){return[{sTitle:"Filename",mData:"filename",include:!0,iSortPriority:1,mRender:function(b,c,d){return"display"===c?'\x3ca href\x3d"'+Urls.download.attachment(a.entityType,a.entityId,d.id)+'"\x3e'+b+"\x3c/a\x3e":b}},{sTitle:"Category",mData:"category",include:!0,iSortPriority:0,mRender:function(b,c,d){return b?b:"Misc."}},{sTitle:"Uploaded By",mData:"creator",include:!0,iSortPriority:0},
{sTitle:"Upload Date",mData:"created",include:!0,iSortPriority:0},{sTitle:"Delete",mData:null,include:!0,iSortPriority:0,mRender:function(b,c,d){return"display"===c?'\x3cdiv class\x3d"misoicon" onclick\x3d"ListTarget.attachment.deleteFile(\''+a.entityType+"', "+a.entityId+", "+d.id+", '"+d.filename+'\')"\x3e\x3cspan class\x3d"ui-icon ui-icon-trash"\x3e\x3c/span\x3e\x3c/div\x3e':""}}]},onFirstLoad:function(a,b){b.collapseId&&!a.length&&Utils.ui.collapse("#"+b.collapseId,"#"+b.collapseId+"_arrowclick")},
deleteFile:function(a,b,c,d){Utils.showConfirmDialog("Delete file","Delete",["Are you sure you wish to delete "+d+"? This cannot be undone."],function(){var e=Urls.rest.attachments.delete(a,b,c);Utils.ajaxWithDialog("Deleting file","DELETE",e,null,function(){Utils.page.pageReload()})})},showUploadDialog:function(a,b,c,d){var e=jQuery("#dialog");e.empty();var g=jQuery('\x3cform id\x3d"uploadForm"\x3e');g.append(jQuery('\x3cp\x3e\x3cinput id\x3d"fileInput" type\x3d"file" name\x3d"files" multiple\x3d"multiple"\x3e\x3c/p\x3e'));
var f=jQuery('\x3cselect id\x3d"attachmentCategory" type\x3d"text" name\x3d"attachmentCategory"\x3e');[{id:0,alias:"Misc."}].concat(Constants.attachmentCategories).forEach(function(l){f.append(jQuery('\x3coption value\x3d"'+l.id+'"\x3e'+l.alias+"\x3c/option\x3e"))});var h=jQuery("\x3cp\x3e").append(jQuery('\x3clabel for\x3d"attachmentCategory"\x3eCategory:\x3c/label\x3e')).append(f);g.append(h);e.append(g);var k=e.dialog({autoOpen:!0,width:500,title:"Attach Files",modal:!0,buttons:{upload:{id:"upload",
text:"Upload",click:function(){if(jQuery("#fileInput").val()){var l={};0<jQuery("#attachmentCategory").val()&&(l.categoryId=jQuery("#attachmentCategory").val());d&&(l.entityIds=d);l=Urls.upload.attachment(a,b)+"?"+Utils.page.param(l);var p=new FormData(jQuery("#uploadForm")[0]);k.dialog("close");e.empty();e.append(jQuery("\x3cp\x3eUploading...\x3c/p\x3e"));k=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Uploading File",modal:!0,buttons:{},closeOnEscape:!1,open:function(r,w){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});
jQuery.ajax({url:l,type:"POST",data:p,cache:!1,contentType:!1,processData:!1}).done(function(r){Utils.showOkDialog("Attach Files",["File upload successful"],c?Utils.page.pageReload:null)}).fail(function(r,w,v){k.dialog("close");Utils.showAjaxErrorDialog(r,w,v)})}else alert("No file selected!")}},cancel:{id:"cancel",text:"Cancel",click:function(){k.dialog("close")}}}})},showLinkDialog:function(a,b,c,d,e){var g=Urls.rest.projects.attachments(c);Utils.ajaxWithDialog("Retrieving Project Files","GET",
g,null,function(f){if(f.length){var h=f.map(Utils.array.getId);Utils.showDialog("Link Project File","Link",[{label:"File",type:"select",required:!0,values:h,getLabel:function(k){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(k),f).filename},property:"attachmentId"}],function(k){k={fromEntityType:"project",fromEntityId:c,attachmentId:k.attachmentId};e&&(k.entityIds=e);k=Urls.rest.attachments.link(a,b)+"?"+Utils.page.param(k);Utils.ajaxWithDialog("Linking File","POST",k,null,function(){Utils.showOkDialog("Link Project File",
["File link successful"],d?Utils.page.pageReload:null)})})}else Utils.showOkDialog("Link Project File",["Project has no attachments to link."])})}}}();
ListTarget.attachmentcategory={name:"Attachment Categories",getUserManualUrl:function(){return Urls.external.userManual("type_data","attachment-categories")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.attachmentcategory.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Attachment Categories","attachmentcategories",Utils.array.getAlias));return b},createStaticActions:function(a,
b){return[{name:"Add",handler:function(){Utils.showDialog("Create Attachment Categories","Create",[{property:"quantity",type:"int",label:"Quantity",value:1,required:!0}],function(c){1>c.quantity?Utils.showOkDialog("Create Attachment Categories",["That's a peculiar number of attachment categories to create."]):window.location=Urls.ui.attachmentCategories.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:0}]}};
ListTarget.box={name:"Boxes",getUserManualUrl:function(){return Urls.external.userManual("boxes")},createUrl:function(a,b){return a.boxUse?Urls.rest.boxes.useDatatable(a.boxUse):Urls.rest.boxes.datatable},getQueryUrl:null,createBulkActions:function(a,b){return BulkTarget.box.getBulkActions(a).concat([BulkUtils.actions.print("box"),{name:"Print Contents",action:function(c){Utils.printSelectDialog(function(d,e){Utils.ajaxWithDialog("Printing","POST",Urls.rest.printers.printBoxContents(d),{boxes:c.map(Utils.array.getId),
copies:e},function(g){Utils.showOkDialog("Printing",["Printed "+g+" labels."])})})}},{name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following boxes? This cannot be undone.","Note: a Box may only be deleted by its creator or an admin."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.name+" ("+f.alias+")");e.push(f.id)});Utils.showConfirmDialog("Delete Boxes","Delete",d,function(){Utils.ajaxWithDialog("Deleting Boxes","POST",Urls.rest.boxes.bulkDelete,e,function(){Utils.page.pageReload()})})}}])},
createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.showDialog("Create Boxes","Create",[{property:"quantity",type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Boxes",["That's a peculiar number of boxes to create."]):window.location=1==c.quantity?Urls.ui.boxes.create:Urls.ui.boxes.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("Name",Urls.ui.boxes.edit,"id",
Utils.array.getName,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.boxes.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Freezer Location",mData:"freezerDisplayLocation",include:a.showFreezerLocation,bSortable:!1,iSortPriority:0},{sTitle:"Freezer Location",mData:"storageDisplayLocation",include:a.showStorageLocation,bSortable:!1,iSortPriority:0},{sTitle:"Location Note",mData:"locationBarcode",include:!0,iSortPriority:0},{sTitle:"Items/Capacity",
mData:"tubeCount",include:!0,iSortPriority:0,bSortable:!1,mRender:function(c,d,e){return e.tubeCount+"/"+e.rows*e.cols}},{sTitle:"Size",mData:"sizeId",include:!0,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.boxSizes,"label")},{sTitle:"Use",mData:"useId",include:!a.boxUse,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.boxUses,"alias")}]},searchTermSelector:function(a){return[a.id,a.barcode,a.entered,a.changed,a.creator,a.changedby,a.boxType,a.freezer]}};
ListTarget.boxsize={name:"Box Sizes",getUserManualUrl:function(){return Urls.external.userManual("type_data","box-sizes")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.boxsize.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Box Sizes","boxsizes",function(c){return c.rows+" \u00d7 "+c.columns+(c.scannable?" scannable":"")}));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Box Sizes",Urls.ui.boxSizes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Rows",mData:"rows"},{sTitle:"Columns",mData:"columns"},{sTitle:"Type",mData:"boxTypeLabel"},{sTitle:"Scannable",mData:"scannable",mRender:ListUtils.render.booleanChecks}]}};
ListTarget.boxuse={name:"Box Uses",getUserManualUrl:function(){return Urls.external.userManual("type_data","box-uses")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.boxuse.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Box Uses","boxuses",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Box Uses",Urls.ui.boxUses.bulkCreate,
!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1}]}};
ListTarget.changelog={name:"Changes",createUrl:function(a,b){throw Error("Static data only");},getQueryUrl:null,createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"userName",include:!0,iSortPriority:0},{sTitle:"Summary",mData:"summary",include:!0,iSortPriority:0,mRender:function(c,d,e){if("display"===d&&-1<c.indexOf("\n")){var g='\x3cul class\x3d"unformatted-list"\x3e';c.split("\n").forEach(function(f){g+="\x3cli\x3e"+
f+"\x3c/li\x3e"});return g+="\x3c/ul\x3e"}return c}},{sTitle:"Time",mData:"time",include:!0,iSortPriority:1}]}};
ListTarget.contact=function(a){function b(){Contacts.selectContactDialog(!1,!1,function(e){c(e)})}function c(e){var g=Utils.sorting.standardSort("name");g=Constants.contactRoles.sort(g);Utils.showWizardDialog("Select Contact Role",g.map(function(f){return{name:f.name,handler:function(){Project.addContact({contactId:e.id,contactName:e.name,contactEmail:e.email,contactRoleId:f.id,contactRole:f.name})}}}))}function d(e){return null!=e.projectId&&0<=e.projectId}return{name:"Contacts",getUserManualUrl:function(){return Urls.external.userManual("type_data",
"contacts")},createUrl:function(e,g){throw Error("Must be provided statically");},createBulkActions:function(e,g){g=BulkTarget.contact.getBulkActions(e);if(d(e))return[{name:"Remove",action:Project.removeContacts}];g.push(ListUtils.createBulkDeleteAction("Contacts","contacts",function(f){return f.name+" \x3c"+f.email+"\x3e"}));return g},createStaticActions:function(e,g){return d(e)?[{name:"Add",handler:b}]:[ListUtils.createStaticAddAction("Contacts",Urls.ui.contacts.bulkCreate,!0)]},createColumns:function(e,
g){g=[{sTitle:"Name",mData:d(e)?"contactName":"name"},{sTitle:"Email",mData:d(e)?"contactEmail":"email",mRender:function(f,h,k){return"display"===h?'\x3ca href\x3d"mailto:'+f+'"\x3e'+f+"\x3c/a\x3e":f}}];d(e)&&g.push({sTitle:"Contact Role",mData:"contactRole"});return g}}}(jQuery);
ListTarget.contactrole=function(a){return{name:"Contact Roles",getUserManualUrl:function(){return Urls.external.userManual("type_data","contact-roles")},createUrl:function(b,c){throw Error("Must be provided statically");},createBulkActions:function(b,c){c=BulkTarget.contactrole.getBulkActions(b);return b.isAdmin?(c.push(ListUtils.createBulkDeleteAction("Contact Roles","contactroles",function(d){return d.name})),c):[]},createStaticActions:function(b,c){return b.isAdmin?[ListUtils.createStaticAddAction("Contact Roles",
Urls.ui.contactRoles.bulkCreate,!0)]:[]},createColumns:function(b,c){return[{sTitle:"Name",mData:"name"}]}}}(jQuery);
ListTarget.container={name:"Sequencing Containers",getUserManualUrl:function(){return Urls.external.userManual("sequencing_containers")},createUrl:function(a,b){return a.platformType?Urls.rest.containers.platformDatatable(a.platformType):Urls.rest.containers.datatable},getQueryUrl:null,createBulkActions:function(a,b){b=BulkUtils.actions.qc("Container");a.runId?b.push({name:"Remove",action:function(c){Utils.ajaxWithDialog("Removing","POST",Urls.rest.runs.removeContainers(a.runId),c.map(Utils.array.getId),
Utils.page.pageReload)}}):b.push(BulkUtils.actions.print("container"));b.push(BulkUtils.actions.download(Urls.rest.containers.spreadsheet,Constants.partitionSpreadsheets,function(c,d){return[]}));b.push({name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following containers? This cannot be undone.","Note: a Container may only be deleted by its creator or an admin."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.id+" ("+f.identificationBarcode+")");e.push(f.id)});Utils.showConfirmDialog("Delete Containers",
"Delete",d,function(){Utils.ajaxWithDialog("Deleting Containers","POST",Urls.rest.containers.bulkDelete,e,function(){Utils.page.pageReload()})})}});return b},createStaticActions:function(a,b){var c=Utils.array.findFirstOrNull(function(d){return d.name==a.platformType},Constants.platformTypes);return a.runId?[{name:"Add "+c.containerName,handler:function(){a.isFull?Utils.showOkDialog("Run Full",["Cannot add another "+c.containerName+" to this run as it is full. Try removing one first."]):Utils.showDialog("Add "+
c.containerName,"Add",[{type:"text",label:"Serial Number",property:"barcode"}],function(d){Utils.ajaxWithDialog("Adding "+c.containerName,"POST",Urls.rest.runs.addContainer(a.runId)+"?"+Utils.page.param({barcode:d.barcode}),null,Utils.page.pageReload)})}}]:[{name:"Add "+c.containerName,handler:function(){var d=Constants.instrumentModels.filter(function(e){return e.platformType===a.platformType&&"SEQUENCER"===e.instrumentType&&e.active}).sort(Utils.sorting.standardSort("alias")).map(function(e){return{name:e.alias,
handler:function(){var g=Constants.containerModels.filter(function(f){return-1!==f.instrumentModelIds.indexOf(e.id)&&!f.archived}).sort(Utils.sorting.standardSort("alias")).map(function(f){return{name:f.alias,handler:function(){window.location=Urls.ui.containers.create(f.id)}}});Utils.showWizardDialog("Add "+c.containerName,g)}}});Utils.showWizardDialog("Add "+c.containerName,d)}}]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("ID",Urls.ui.containers.edit,Utils.array.getId,"id",
1,!0),ListUtils.labelHyperlinkColumn("Serial Number",Urls.ui.containers.edit,Utils.array.getId,"identificationBarcode",1,!0),{sTitle:"Platform",mData:"platform",include:!a.platformType,iSortPriority:0},ListUtils.idHyperlinkColumn("Last Run Name",Urls.ui.runs.edit,"lastRunId",function(c){return"RUN"+c.lastRunId},-1,!0),ListUtils.labelHyperlinkColumn("Last Run Alias",Urls.ui.runs.edit,function(c){return c.lastRunId},"lastRunAlias",-1,!0),ListUtils.labelHyperlinkColumn("Last Sequencer Used",Urls.ui.instruments.edit,
function(c){return c.lastSequencerId},"lastSequencerName",-1,!0),{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:2}]},searchTermSelector:function(a){return[a.id,a.entered,a.changed,a.creator,a.changedby,a.platform,a.index,a.kitname]}};
ListTarget.containermodel={name:"Container Models",getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-container-models")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){if(a.isInstrumentModelPage)return a.isAdmin?[{name:"Remove",action:function(c){InstrumentModel.removeContainerModels(c.map(Utils.array.getId))}}]:[];b=BulkTarget.containermodel.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Container Models",
"containermodels",function(c){var d=Utils.array.findUniqueOrThrow(Utils.array.namePredicate(c.platformType),Constants.platformTypes);return c.alias+" ("+d.key+")"}));return b},createStaticActions:function(a,b){return a.isInstrumentModelPage?a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Add Container Model","Search",[{label:"Alias or Barcode",type:"text",property:"query",required:!0}],function(c){Utils.ajaxWithDialog("Searching...","GET",Urls.rest.containerModels.search+"?"+Utils.page.param({platformType:jQuery("#instrumentModelForm_platformType").val(),
q:c.query}),null,function(d,e,g){d&&d.length?Utils.showWizardDialog("Add Container Model",d.map(function(f){return{name:f.alias,handler:function(){InstrumentModel.addContainerModel(f)}}})):Utils.showOkDialog("Add Container Model",["No container models found."])})})}}]:[]:a.isAdmin?[ListUtils.createStaticAddAction("Container Models",Urls.ui.containerModels.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Platform",mData:"platformType",
include:!0,iSortPriority:0},{sTitle:"Fallback",mData:"fallback",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.deletion={name:"Deletions",getUserManualUrl:function(){return Urls.external.userManual("deletions")},createUrl:function(a,b){return Urls.rest.deletions.datatable},createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[{sTitle:"Type",mData:"targetType",include:!0,iSortPriority:0},{sTitle:"ID",mData:"targetId",include:!0,iSortPriority:0},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Deleted By",
mData:"userName",include:!0,iSortPriority:0},{sTitle:"Time",mData:"changeTime",include:!0,iSortPriority:1}]}};
ListTarget.deliverable=function(a){function b(c){Utils.showWizardDialog("Add Deliverable",c.map(function(d){return{name:d.name,handler:function(){Project.addDeliverable(d)}}}))}return{name:"Deliverables",getUserManualUrl:function(){return Urls.external.userManual("type_data","deliverables")},createUrl:function(c,d){throw Error("Must be provided statically");},createBulkActions:function(c,d){if(null!=c.projectId&&0<=c.projectId)return[{name:"Remove",action:Project.removeDeliverables}];d=BulkTarget.deliverable.getBulkActions(c);
c.isAdmin&&d.push(ListUtils.createBulkDeleteAction("Deliverables","deliverables",function(e){return e.name}));return d},createStaticActions:function(c,d){return null!=c.projectId&&0<=c.projectId?[{name:"Add",handler:function(){b(c.deliverables)}}]:c.isAdmin?[ListUtils.createStaticAddAction("Deliverables",Urls.ui.deliverables.bulkCreate,!0)]:[]},createColumns:function(c,d){return[{sTitle:"Name",mData:"name"},{sTitle:"Category",mData:"categoryName"},{sTitle:"Analysis Review Required",mData:"analysisReviewRequired",
mRender:ListUtils.render.booleanChecks}]}}}(jQuery);
ListTarget.deliverablecategory=function(a){return{name:"Deliverable Categories",getUserManualUrl:function(){return Urls.external.userManual("type_data","deliverables")},createUrl:function(b,c){throw Error("Must be provided statically");},createBulkActions:function(b,c){c=BulkTarget.deliverablecategory.getBulkActions(b);b.isAdmin&&c.push(ListUtils.createBulkDeleteAction("Deliverable categories","deliverablecategories",Utils.array.getName));return c},createStaticActions:function(b,c){return b.isAdmin?
[ListUtils.createStaticAddAction("Deliverable Categories",Urls.ui.deliverableCategories.bulkCreate,!0)]:[]},createColumns:function(b,c){return[{sTitle:"Name",mData:"name"}]}}}(jQuery);
ListTarget.detailedqcstatus={name:"Detailed QC Statuses",getUserManualUrl:function(){return Urls.external.userManual("type_data","detailed-qc-status")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.detailedqcstatus.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Detailed QC Statuses","detailedqcstatuses",Utils.array.get("description")));return b},createStaticActions:function(a,
b){return a.isAdmin?[ListUtils.createStaticAddAction("Detailed QC Statuses",Urls.ui.detailedQcStatuses.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Description",mData:"description",include:!0,iSortPriority:1},{sTitle:"QC Passed",mData:"status",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Note Required",mData:"noteRequired",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,
mRender:ListUtils.render.booleanChecks}]}};
ListTarget.experiment_run_partition={name:"Run + Partition",createUrl:function(a,b){throw Error("Must be created statically.");},getQueryUrl:null,createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("Run Name",Urls.ui.runs.edit,"run.id",function(c){return c.run.name},1,!0),ListUtils.labelHyperlinkColumn("Run Alias",Urls.ui.runs.edit,function(c){return c.run.id},"run.alias",0,!0),{sTitle:"Status",mData:"run.status",
mRender:function(c,d,e){return c||""},include:!0,iSortPriority:0},ListUtils.labelHyperlinkColumn("Container",Urls.ui.containers.edit,function(c){return c.partition.containerId},"partition.containerName",0,!0),{sTitle:"Number",mData:"partition.partitionNumber",include:!0,iSortPriority:1,bSortDirection:!0},{sTitle:"Pool",mData:function(c,d){return c.partition.pool.name+" ("+c.partition.pool.alias+")"},include:!0,iSortPriority:0,mRender:Warning.tableWarningRenderer(WarningTarget.experiment_run_partition,
function(c){return Urls.ui.pools.edit(c.partition.pool.id)})}]}};
ListTarget.experiment={name:"Experiments",getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","experiments")},createUrl:function(a,b){throw Error("Experiments must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){if(a.inSubmission)return[];b=[{name:"Create Submission",action:function(c){window.location=Urls.ui.submissions.create+"?"+Utils.page.param({experimentIds:c.map(Utils.array.getId).join(",")})}}];a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Experiments",
"experiments",Utils.array.getAlias));return b},createStaticActions:function(a,b){b=[];a.runId&&b.push({name:"Create New",handler:function(){var c=Urls.rest.runs.potentialExperiments(a.runId);Utils.ajaxWithDialog("Finding potential experiments","GET",c,null,function(d){if(d&&d.length){var e=d.map(function(f){return{name:f.experiment.library.name+" ("+f.experiment.library.alias+")",handler:function(){Utils.showDialog("Create Experiment","Create",[{type:"select",required:!0,label:"Study",values:f.studies,
getLabel:function(h){return h.name+" ("+h.alias+")"},property:"study"},{type:"text",required:"true",label:"Title",property:"title"},{type:"text",required:"true",label:"Alias",property:"alias"}],function(h){f.experiment.alias=h.alias;f.experiment.study=h.study;f.experiment.title=h.title;Utils.ajaxWithDialog("Creating to Experiment","POST",Urls.rest.experiments.create,f.experiment,Utils.page.pageReload)},g)}}}),g=function(){Utils.showWizardDialog("Create Experiment",e)};g()}else Utils.showOkDialog("Error",
["No potential experiments found. At least one study must exist in the project that the desired library belongs to"])})}},{name:"Add to Existing",handler:function(){var c=Urls.rest.runs.potentialExperiments(a.runId);Utils.ajaxWithDialog("Finding potential experiments","GET",c,null,function(d){d&&d.length?Utils.showWizardDialog("Add to Experiment",d.map(function(e){return{name:e.partition.containerName+" "+e.partition.partitionNumber+" ("+e.partition.pool.name+") to "+e.experiment.name+" ("+e.experiment.alias+
")",handler:function(){Utils.ajaxWithDialog("Adding to Experiment","POST",Urls.rest.experiments.addRunPartition(e.experiment.id)+"?"+Utils.page.param({runId:a.runId,partitionId:e.partition.id}),null,Utils.page.pageReload)}}})):Utils.showOkDialog("Error",["No existing experiments found"])})}});a.addToExperiment&&a.addToExperiment.length&&b.push({name:"Add to Existing",handler:function(){Utils.showWizardDialog("Add to Experiment",a.addToExperiment.map(function(c){return{name:c.partition.containerName+
" "+c.partition.partitionNumber+" ("+c.partition.pool.name+") to "+c.experiment.name+" ("+c.experiment.alias+")",handler:function(){Utils.ajaxWithDialog("Adding to Experiment","POST",Urls.rest.experiments.addRunPartition(c.experiment.id)+"?"+Utils.page.param({runId:a.runId,partitionId:c.partition.id}),null,Utils.page.pageReload)}}}))}});return b},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("Name",Urls.ui.experiments.edit,"id",Utils.array.getName,1,!0),ListUtils.labelHyperlinkColumn("Alias",
Urls.ui.experiments.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Platform",mData:"instrumentModel.alias",include:!0,iSortPriority:0},ListUtils.labelHyperlinkColumn("Library Name",Urls.ui.libraries.edit,function(c){return c.library.id},"library.name",0,!a.libraryId),ListUtils.labelHyperlinkColumn("Library Alias",Urls.ui.libraries.edit,function(c){return c.library.id},"library.alias",0,!a.libraryId),ListUtils.labelHyperlinkColumn("Study Name",Urls.ui.studies.edit,function(c){return c.study.id},"study.name",
0,!a.studyId),ListUtils.labelHyperlinkColumn("Study Alias",Urls.ui.studies.edit,function(c){return c.study.id},"study.alias",0,!a.studyId)]}};
ListTarget.group={name:"Groups",getUserManualUrl:function(){return Urls.external.userManual("users_and_groups","groups")},createUrl:function(a,b){throw Error("Static data only");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin&&!a.userId?[ListUtils.createBulkDeleteAction("Groups","groups",Utils.array.getName)]:[]},createStaticActions:function(a,b){return a.isAdmin&&!a.userId?[{name:"Add",handler:function(){window.location=Urls.ui.groups.create}}]:[]},createColumns:function(a,b){return[{sTitle:"Name",
mData:"name",include:!0,iSortPriority:1,bSortDirection:!0,mRender:function(c,d,e){return a.isAdmin?'\x3ca href\x3d"'+Urls.ui.groups.edit(e.id)+'"\x3e'+c+"\x3c/a\x3e":c}},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.identitysearch=function(a){return{name:"Identity Results",createBulkActions:function(b,c){return[{name:"Filter Below",action:function(d){d=d.map(function(e){return e.id}).join(",");a("#list_samples").dataTable().fnFilter("identityId:"+d)}},BulkUtils.actions.children(Urls.rest.samples.children,BulkUtils.relations.categoriesForDetailed().concat([BulkUtils.relations.library(),BulkUtils.relations.libraryAliquot(),BulkUtils.relations.pool(),BulkUtils.relations.run()]))]},createStaticActions:function(b,
c){return[]},createColumns:function(b,c){return[ListUtils.idHyperlinkColumn("Alias",Urls.ui.samples.edit,"id",Utils.array.getAlias,0,!0),{sTitle:"External Name",mData:"externalName"}]}}}(jQuery);
ListTarget.instrument={name:"Instruments",getUserManualUrl:function(){return Urls.external.userManual("instruments")},createUrl:function(a,b){return a.instrumentType?Urls.rest.instruments.instrumentTypeDatatable(a.instrumentType):a.workstationId?Urls.rest.instruments.workstationDatatable(a.workstationId):Urls.rest.instruments.datatable},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Instruments","instruments",function(c){return c.name+
" ("+c.instrumentModelAlias+")"})]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=Urls.ui.instruments.create}}]:[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Instrument Name",Urls.ui.instruments.edit,Utils.array.getId,"name",1,!0),{sTitle:"Platform",mData:"platformType",include:!0,iSortPriority:0},{sTitle:"Instrument Model",mData:"instrumentModelAlias",include:!0,iSortPriority:0},{sTitle:"Status",mData:"status",include:!0,
bSortable:!1,mRender:function(c,d,e){return e.outOfService?"Out of Service":c}},{sTitle:"Workstation",mData:"workstationAlias",sDefaultContent:""},{sTitle:"Serial Number",mData:"serialNumber",include:!0,iSortPriority:0}]},searchTermSelector:function(a){return[a.id,a.platform,a.model,a.workstation,a.archived]}};
ListTarget.instrumentmodel={name:"Instrument Models",getUserManualUrl:function(){return Urls.external.userManual("type_data","instrument-models")},createUrl:function(a,b){return Urls.rest.instrumentModels.datatable},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Instrument Models","instrumentmodels",function(c){return c.platformType+" - "+c.alias})]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=
Urls.ui.instrumentModels.create}}]:[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.instrumentModels.edit,Utils.array.getId,"alias",2,!0),{sTitle:"Platform",mData:"platformType",include:!0,iSortPriority:1},{sTitle:"Instrument Type",mData:"instrumentType",include:!0,iSortPriority:0}]}};
ListTarget.instrumentposition={name:"Instrument Positions",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[{name:"Remove",action:function(c){InstrumentModel.removeInstrumentPositions(c.map(Utils.array.getAlias))}}]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Add Instrument Position","Add",[{label:"Alias",property:"alias",type:"text",required:!0}],function(c){/^[-_\w]{1,10}$/g.test(c.alias)?
InstrumentModel.addInstrumentPosition(c.alias):Utils.showOkDialog("Error",["Position alias must consist of 1-10 letters, numbers, and symbols [ _- ]"])})}}]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1}]}};
ListTarget.issue={name:"Issues",createUrl:function(a,b){throw Error("Static data only");},createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[{sTitle:"Key",mData:"key",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d?'\x3ca href\x3d"'+e.url+'"\x3e'+c+"\x3c/a\x3e":c}},{sTitle:"Summary",mData:"summary",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d?'\x3ca href\x3d"'+e.url+'"\x3e'+c+"\x3c/a\x3e":
c}},{sTitle:"Status",mData:"status",include:!0,iSortPriority:0},{sTitle:"Assignee",mData:"assignee",include:!0,iSortPriority:0},{sTitle:"Last Updated",mData:"lastUpdated",include:!0,iSortPriority:1}]}};
ListTarget.itemtransfer=function(){function a(b,c){var d=b.items.length,e=b.items.filter(function(g){return!0===g[c]}).length;b=b.items.filter(function(g){return"boolean"!==typeof g[c]}).length;return e+"/"+d+" ("+b+" pending)"}return{name:"Transfers",createUrl:function(b,c){throw Error("Must be provided statically");},createBulkActions:function(b,c){return[]},createStaticActions:function(b,c){return[{name:"Add",handler:function(){var d={};b.sampleId?d.sampleIds=b.sampleId:b.libraryId?d.libraryIds=
b.libraryId:b.libraryAliquotId?d.libraryAliquotIds=b.libraryAliquotId:b.poolId&&(d.poolIds=b.poolId);window.location=Urls.ui.transfers.create+"?"+Utils.page.param(d)}}]},createColumns:function(b,c){return[ListUtils.idHyperlinkColumn("ID",Urls.ui.transfers.edit,"id",Utils.array.getId,0,!0),{sTitle:"Items",mData:"items.length",include:!0,bSortable:!1},{sTitle:"Sender",mData:function(d,e){return d.senderLabLabel||d.senderGroupName},include:!0,bSortable:!1},{sTitle:"Recipient",mData:function(d,e){return d.recipient||
d.recipientGroupName},include:!0,bSortable:!1},{sTitle:"Transfer Time",mData:"transferTime",include:!0,iSortPriority:1},{sTitle:"Received",mData:function(d,e){return a(d,"received")},include:!0,bSortable:!1},{sTitle:"QC Passed",mData:function(d,e){return a(d,"qcPassed")},include:!0,bSortable:!1}]}}}();
ListTarget.kit_consumable={name:"Kits",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return a.allowedDescriptors?[{name:"Add",handler:function(){Utils.showDialog("Add Kit","Add",[{property:"descriptor",type:"select",label:"Kit Type",values:a.allowedDescriptors,getLabel:Utils.array.getName},{property:"lotNumber",type:"text",label:"Lot Number",required:!0},{property:"date",type:"date",
label:"Date",required:!0}],function(c){Utils.ajaxWithDialog("Adding Kit","POST",Urls.rest.experiments.addKit(a.experimentId),c,Utils.page.pageReload)})}}]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"descriptor.name",include:!0,iSortPriority:0},{sTitle:"Part Number",mData:"descriptor.partNumber",include:!0,iSortPriority:0},{sTitle:"Lot Number",mData:"lotNumber",include:!0,iSortPriority:0},{sTitle:"Date",mData:"date",include:!0,iSortPriority:1}]}};
ListTarget.kit={name:"Kits",getUserManualUrl:function(){return Urls.external.userManual("type_data","kit-descriptors")},createUrl:function(a,b){return a.kitType?Urls.rest.kitDescriptors.typeDatatable(a.kitType):Urls.rest.kitDescriptors.datatable},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isUserAdmin?a.isQcTypePage?[{name:"Remove",action:function(c){QcType.removeKits(c)}}]:[ListUtils.createBulkDeleteAction("Kits","kitdescriptors",function(c){return c.name+" ("+c.kitType+
")"})]:[]},createStaticActions:function(a,b){b=[];a.isUserAdmin&&(a.isQcTypePage?b.push(ListUtils.createStaticAddBySearchAction("Kit","Name or Part Number",Urls.rest.kitDescriptors.search,{kitType:"QC"},function(c){QcType.addKit(c)})):b.push({name:"Add",handler:function(){window.location=Urls.ui.kitDescriptors.create}}));return b},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Kit Name",Urls.ui.kitDescriptors.edit,Utils.array.getId,"name",1,!0),{sTitle:"Version",include:!0,mData:function(c){return c.hasOwnProperty("version")?
c.version:null},bSortable:!1},{sTitle:"Manufacturer",include:!0,iSortPriority:0,mData:"manufacturer"},{sTitle:"Part Number",include:!0,iSortPriority:0,mData:"partNumber"},{sTitle:"Type",include:!a.kitType,iSortPriority:0,mData:"kitType"},{sTitle:"Stock Level",include:!0,iSortPriority:0,mData:"stockLevel"},{sTitle:"Platform",include:!a.platformType,iSortPriority:0,mData:"platformType"},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]},searchTermSelector:function(a){return[a.id]}};
ListTarget.lab={name:"Labs",getUserManualUrl:function(){return Urls.external.userManual("type_data","labs")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.lab.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Labs","labs",Utils.array.getAlias));return b},createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.showDialog("Create Labs","Create",[{property:"quantity",
type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Labs",["That's a peculiar number of labs to create."]):window.location=Urls.ui.labs.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",iSortPriority:1,bSortDirection:!0},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]}};
ListTarget.library=function(){function a(k){return function(l){Utils.saveWithProgressDialog("POST",k,l.map(Utils.array.getId),Urls.rest.requisitions.librariesUpdateProgress,function(p){switch(p.status){case "completed":Utils.page.pageReload();break;case "failed":Utils.asyncSaveErrorsDialog(p,l,function(r){return r.alias+" ("+r.name+")"});break;default:Utils.showOkDialog("Error",["Unexpected operation status. The save may still be in progress or completed."])}})}}function b(k){Utils.showWizardDialog("Add Supplemental Libraries",
[{name:"Search by names",handler:function(){c(k)}},{name:"Find related",handler:function(){e(k)}}],"Choose addition method")}function c(k){Utils.showSearchByNamesDialog("Add Supplemental Libraries",Urls.rest.libraries.query,function(l,p,r,w){l.length!==w.length?Utils.showSomeNotFoundError(w,l):d(k,l.map(Utils.array.getId))})}function d(k,l){Utils.ajaxWithDialog("Adding Supplemental Libraries","POST",Urls.rest.requisitions.addSupplementalLibraries(k.requisitionId),l,Utils.page.pageReload)}function e(k){var l=
k.identities.map(function(p){return{name:p.alias+" ("+p.externalName+")",handler:function(){g(k,[p])}}});l.unshift({name:"All identities",handler:function(){g(k,k.identities)}});Utils.showWizardDialog("Find Related Libraries",l,"Which identity would you like to supplement?")}function g(k,l){var p=Constants.libraryDesignCodes.sort(Utils.sorting.standardSort("code")).map(function(r){return{name:r.code,handler:function(){f(k,l,r)}}});Utils.showWizardDialog("Find Related Libraries",p,"Which library design code would you like to search?")}
function f(k,l,p){Utils.ajaxWithDialog("Finding Related Libraries...","POST",Urls.rest.libraries.findRelated,{identityIds:l.map(function(r){return r.id}),libraryDesignCodeId:p.id,excludeRequisitionId:k.requisitionId},function(r){r&&r.length?h(k,r):Utils.showOkDialog("Add Supplemental Libraries",["No matching libraries found. Note that libraries already associated with this requisition are omitted."])})}function h(k,l){l=l.map(function(p){return{label:p.alias+" (Req: "+(p.requisitionAlias||"None")+
"; "+(p.sequenced?"":"NOT ")+"Sequenced)",property:p.id,type:"checkbox"}});Utils.showDialog("Add Supplemental Libraries","Add",l,function(p){libraryIds=[];for(var r in p)p[r]&&libraryIds.push(r);libraryIds.length?d(k,libraryIds):Utils.showOkDialog("Add Supplemental Libraries",["No libraries selected."])})}return{name:"Libraries",getUserManualUrl:function(){return Urls.external.userManual("libraries")},createUrl:function(k,l){if(l)return Urls.rest.libraries.projectDatatable(l);if(k.worksetId)return Urls.rest.libraries.worksetDatatable(k.worksetId);
if(k.batchId)return Urls.rest.libraries.batchDatatable(k.batchId);if(k.requisitionId)switch(k.relation){case "requisitioned":return Urls.rest.libraries.requisitionDatatable(k.requisitionId);case "supplemental":return Urls.rest.libraries.requisitionSupplementalDatatable(k.requisitionId);case "indirect":return Urls.rest.libraries.requisitionRelatedDatatable(k.requisitionId);default:throw Error("Unexpected requisition relation: "+k.relation);}else if(k.workstationId)return Urls.rest.libraries.workstationDatatable(k.workstationId);
return Urls.rest.libraries.datatable},getQueryUrl:function(){return Urls.rest.libraries.query},createBulkActions:function(k,l){l=BulkTarget.library.getBulkActions(k);k.requisitionId&&("supplemental"==k.relation?l.unshift({name:"Remove",action:function(p){Utils.ajaxWithDialog("Removing Supplemental Libraries","POST",Urls.rest.requisitions.removeSupplementalLibraries(k.requisitionId),p.map(Utils.array.getId),Utils.page.pageReload)}}):"requisitioned"==k.relation&&l.unshift({name:"Remove",action:a(Urls.rest.requisitions.removeLibraries(k.requisitionId))},
ListUtils.createMoveToRequisitionAction(k.requisition,Urls.rest.requisitions.moveLibraries(k.requisitionId))));k.worksetId&&l.push(BulkUtils.actions.moveFromWorkset("libraries",Urls.rest.worksets.moveLibraries(k.worksetId)));l.push({name:"Delete",action:function(p){var r=["Are you sure you wish to delete the following libraries? This cannot be undone.","Note: a Library may only be deleted by its creator or an admin."],w=[];jQuery.each(p,function(v,E){r.push("* "+E.name+" ("+E.alias+")");w.push(E.id)});
Utils.showConfirmDialog("Delete Libraries","Delete",r,function(){Utils.ajaxWithDialog("Deleting Libraries","POST",Urls.rest.libraries.bulkDelete,w,function(){Utils.page.pageReload()})})}});return l},createStaticActions:function(k,l){var p=[];k.requisitionId&&("supplemental"==k.relation?p.push({name:"Add",handler:function(){Constants.isDetailedSample?b(k):c(k)}}):"requisitioned"==k.relation&&p.push({name:"Add",handler:function(){Utils.showSearchByNamesDialog("Add Libraries",Urls.rest.libraries.query,
function(r,w,v,E){r.length!==E.length?Utils.showSomeNotFoundError(E,r):a(Urls.rest.requisitions.addLibraries(k.requisitionId))(r)})}}));p.push({name:"Receive",include:!0,handler:function(){var r=[{property:"quantity",type:"int",label:"Quantity",value:1}];if(Constants.isDetailedSample){var w=Utils.array.removeArchived(Constants.sampleClasses).filter(function(v){return"Aliquot"===v.sampleCategory}).sort(Utils.sorting.sampleClassComparator);if(!w.length){Utils.showOkDialog("Error",["An aliquot sample class is required to create libraries, but none were found."]);
return}r.unshift({property:"sampleClass",type:"select",label:"Aliquot Class",values:w,getLabel:Utils.array.getAlias})}BulkUtils.actions.showDialogForBoxCreation("Receive Libraries","Receive",r,Urls.ui.libraries.bulkReceive,function(v){if(1>v.quantity)Utils.showOkDialog("Receive Libraries",["That's a peculiar number of libraries to receive."]);else return{quantity:v.quantity,projectId:l,sampleClassId:Constants.isDetailedSample?v.sampleClass.id:null}},function(v){return v.quantity})}});return p},createColumns:function(k,
l){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"name",include:!0,iSortPriority:1,iDataSort:0,mRender:Warning.tableWarningRenderer(WarningTarget.library,function(p){return Urls.ui.libraries.edit(p.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Alias",Urls.ui.libraries.edit,Utils.array.getId,"alias",0,!0),ListUtils.columns.project(l),{sTitle:"Tissue Origin",mData:"effectiveTissueOriginAlias",include:Constants.isDetailedSample,mRender:ListUtils.render.textWithHoverTitle("effectiveTissueOriginAlias",
"effectiveTissueOriginDescription"),iSortPriority:0},{sTitle:"Tissue Type",mData:"effectiveTissueTypeAlias",include:Constants.isDetailedSample,mRender:ListUtils.render.textWithHoverTitle("effectiveTissueTypeAlias","effectiveTissueTypeDescription"),iSortPriority:0},ListUtils.columns.detailedQcStatus,{sTitle:"Design",mData:"libraryDesignCodeId",include:Constants.isDetailedSample,mRender:ListUtils.render.textFromId(Constants.libraryDesignCodes,"code"),bSortable:!1},{sTitle:"Size (bp)",mData:"dnaSize",
sDefaultContent:"",include:!0,iSortPriority:0},{sTitle:"Indices",mData:"index1Label",mRender:function(p,r,w){return p?w.index2Label?p+", "+w.index2Label:p:"None"},include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Location",mData:"locationLabel",include:!0,iSortPriority:0,mRender:function(p,r,w){return w.boxId?"\x3ca href\x3d'"+Urls.ui.boxes.edit(w.boxId)+"'\x3e"+p+"\x3c/a\x3e":p},bSortable:!1},{sTitle:"Volume",mData:"volume",sDefaultContent:"",include:!0,mRender:ListUtils.render.measureWithUnits(Constants.volumeUnits,
"volumeUnits")},{sTitle:"Concentration",mData:"concentration",sDefaultContent:"",include:!0,mRender:ListUtils.render.measureWithUnits(Constants.concentrationUnits,"concentrationUnits")},{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:2},{sTitle:"Added",mData:"worksetAddedTime",sDefaultContent:"n/a",mRender:ListUtils.render.naIfNull,include:k.worksetId,bSortable:!1}]},searchTermSelector:function(k){var l=[k.id,k.barcode,k.created,k.entered,k.changed,k.creator,k.changedby,k.platform,
k.index,k.box,k.freezer,k.kitname,k.distributed,k.distributedto,k.workstation];k=[k.tissueOrigin,k.tissueType,k.design,k.groupid];return Constants.isDetailedSample?l.concat(k):l},onFirstLoad:function(k,l){l.collapseId&&!k.length&&Utils.ui.collapse("#"+l.collapseId,"#"+l.collapseId+"_arrowclick")}}}();
ListTarget.library_template={name:"Library Templates",getUserManualUrl:function(){return Urls.external.userManual("libraries","library-templates")},createUrl:function(a,b){a=Urls.rest.libraryTemplates;return b?a.projectDatatable(b):a.datatable},getQueryUrl:function(){return Urls.rest.libraryTemplates.query},createBulkActions:function(a,b){a=BulkTarget.librarytemplate.getBulkActions(a);a.push(ListUtils.createBulkDeleteAction("Library Templates","librarytemplates",Utils.array.getAlias));b||(a.push({name:"Add Project",
action:function(c){Utils.showDialog("Search for Project to Add","Search",[{type:"text",label:"Search",property:"query",value:""}],function(d){Utils.ajaxWithDialog("Getting Projects","GET",Urls.rest.projects.search+"?"+Utils.page.param({q:d.query}),null,function(e){var g=[];e.forEach(function(f){g.push({name:f.name+": "+f.title+(f.code?" ("+f.code+")":""),handler:function(){var h=c.map(function(k){return k.id});Utils.ajaxWithDialog("Adding Library Template"+(1<c.length?"s":"")+" to Project","POST",
Urls.rest.libraryTemplates.addProject+"?"+Utils.page.param({projectId:f.id}),h,function(){Utils.showOkDialog("Add Project",["Successfully added Library Template"+(1<c.length?"s":"")+" to Project "+f.title],Utils.page.pageReload)})}})});Utils.showWizardDialog("Add Project",g)})})}}),a.push({name:"Remove Project",action:function(c){var d=[],e={};c.forEach(function(g){g.projectIds.forEach(function(f){e.hasOwnProperty(f)||(e[f]=!0,jQuery.ajax({url:Urls.rest.projects.get(f),type:"GET",contentType:"application/json; charset\x3dutf8"}).done(function(h){d.push({name:h.title,
handler:function(){var k=c.map(function(l){return l.id});Utils.ajaxWithDialog("Removing Library Template "+(1<c.length?"s":"")+" from Project","POST",Urls.rest.libraryTemplates.removeProject+"?"+Utils.page.param({projectId:f}),k,function(){Utils.showOkDialog("Add Project",["Successfully removed Library Template"+(1<c.length?"s":"")+" from Project "+h.title],Utils.page.pageReload)})}});Utils.showWizardDialog("Remove Project",d)}))})})}}));return a},createStaticActions:function(a,b){return[{name:"Add",
handler:function(){Utils.showDialog("Create Library Templates","Create",[{property:"quantity",type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Error",["Quantity must be 1 or more"]):1==c.quantity?window.location=Urls.ui.libraryTemplates.create+(b?"?"+Utils.page.param({projectId:b}):""):(c={quantity:c.quantity},b&&(c.projectId=b),window.location=Urls.ui.libraryTemplates.bulkCreate+"?"+Utils.page.param(c))})}}]},createColumns:function(a,b){var c=function(d){return function(e){return!Utils.validation.isEmpty(d)&&
e.id==d}};return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.libraryTemplates.edit,Utils.array.getId,"alias",1,!0),{sTitle:"Library Design",mData:"designId",include:Constants.isDetailedSample,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.libraryDesigns),"name")||""},bSortable:!1},{sTitle:"Design Code",mData:"designCodeId",include:Constants.isDetailedSample,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),
Constants.libraryDesignCodes),"code")||""},bSortable:!1},{sTitle:"Library Type",mData:"libraryTypeId",include:!0,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.libraryTypes),"description")||""},bSortable:!1},{sTitle:"Selection",mData:"selectionId",include:!0,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.librarySelections),"name")||""},bSortable:!1},{sTitle:"Strategy",
mData:"strategyId",include:!0,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.libraryStrategies),"name")||""},bSortable:!1},{sTitle:"Kit Name",mData:"kitDescriptorId",include:!0,iSortPriority:0,mRender:function(d,e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.kitDescriptors),"name")||""},bSortable:!1},{sTitle:"Index Family",mData:"indexFamilyId",include:!0,iSortPriority:0,mRender:function(d,
e,g){return Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(c(d),Constants.libraryIndexFamilies),"name")||""},bSortable:!1},{sTitle:"Platform",mData:"platformType",include:!0,iSortPriority:0,bSortable:!1,mRender:function(d,e,g){return d||""}},{sTitle:"Default Volume",mData:"defaultVolume",include:!0,iSortPriority:0,bSortable:!1,mRender:function(d,e,g){return(d||"")+" "+(g.volumeUnits?Utils.array.findUniqueOrThrow(Utils.array.namePredicate(g.volumeUnits),Constants.volumeUnits).units:"")}}]}};
ListTarget.libraryTemplate_index={name:"Indices",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return[{name:"Edit",action:function(c){window.location=Urls.ui.libraryTemplates.editIndices(a.libraryTemplateId)+"?"+Utils.page.param({positions:c.map(function(d){return d.boxPosition}).join(",")})}},{name:"Remove",action:function(c){LibraryTemplate.removeIndices(c)}}]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.showDialog("Add Indices",
"Add",[{property:"quantity",type:"int",label:"Quantity",required:!0,value:1}],function(c){1>c.quantity?Utils.showOkDialog("Add Indices",["Quantity must be 1 or more."]):window.location=Urls.ui.libraryTemplates.addIndices(a.libraryTemplateId)+"?"+Utils.page.param({quantity:c.quantity})})}}]},createColumns:function(a,b){return[{sTitle:"Box Position",mData:"boxPosition",include:!0,iSortPriority:1},{sTitle:"Index 1",mData:function(c,d,e){return c.index1?c.index1.label:"Unspecified"},include:!0,iSortPriority:0},
{sTitle:"Index 2",mData:function(c,d,e){return c.index2?c.index2.label:"Unspecified"},include:!0,iSortPriority:0}]}};
ListTarget.libraryaliquot={name:"Library Aliquots",getUserManualUrl:function(){return Urls.external.userManual("library_aliquots")},createUrl:function(a,b){return b?Urls.rest.libraryAliquots.projectDatatable(b):a.worksetId?Urls.rest.libraryAliquots.worksetDatatable(a.worksetId):Urls.rest.libraryAliquots.datatable},getQueryUrl:function(){return Urls.rest.libraryAliquots.query},createBulkActions:function(a,b){b=a.library?BulkTarget.libraryaliquot.getBulkActions(a).filter(function(c){return c.allowOnLibraryPage}):
BulkTarget.libraryaliquot.getBulkActions(a);a.worksetId&&b.push(BulkUtils.actions.moveFromWorkset("library aliquots",Urls.rest.worksets.moveLibraryAliquots(a.worksetId)));b.push({name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following library aliquots? This cannot be undone.","Note: a library aliquot may only be deleted by its creator or an admin."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.name+" ("+f.alias+")");e.push(f.id)});Utils.showConfirmDialog("Delete Library Aliquots",
"Delete",d,function(){Utils.ajaxWithDialog("Deleting Library Aliquots","POST",Urls.rest.libraryAliquots.bulkDelete,e,function(){Utils.page.pageReload()})})}});return b},createStaticActions:function(a,b){return a.library?[{name:"Create",handler:function(){Utils.warnIfConsentRevoked([a.library],function(){Utils.showDialog("Make Library Aliquot","Create",[ListUtils.createBoxField],function(c){var d={ids:a.library.id},e=function(){window.location=Urls.ui.libraryAliquots.bulkPropagate+"?"+Utils.page.param(d)};
c.createBox?Utils.createBoxDialog(c,function(g){return 1},function(g){d.boxId=g.id;e()}):e()})})}}]:[]},createColumns:function(a,b){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"name",include:!0,iSortPriority:1,iDataSort:0,mRender:Warning.tableWarningRenderer(WarningTarget.libraryaliquot,function(c){return Urls.ui.libraryAliquots.edit(c.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Alias",Urls.ui.libraryAliquots.edit,Utils.array.getId,"alias",0,!0),ListUtils.columns.project(b),
{sTitle:"Tissue Origin",mData:"effectiveTissueOriginAlias",include:Constants.isDetailedSample,mRender:ListUtils.render.textWithHoverTitle("effectiveTissueOriginAlias","effectiveTissueOriginDescription"),iSortPriority:0},{sTitle:"Tissue Type",mData:"effectiveTissueTypeAlias",include:Constants.isDetailedSample,mRender:ListUtils.render.textWithHoverTitle("effectiveTissueTypeAlias","effectiveTissueTypeDescription"),iSortPriority:0},ListUtils.columns.detailedQcStatus,{sTitle:"Design",mData:"libraryDesignCodeId",
include:Constants.isDetailedSample,mRender:ListUtils.render.textFromId(Constants.libraryDesignCodes,"code"),bSortable:!1},{sTitle:"Size (bp)",mData:"dnaSize",sDefaultContent:"",include:!0,iSortPriority:0},{sTitle:"Indices",mData:"indexLabels",mRender:function(c,d,e){return c?c.join(", "):"None"},include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Location",mData:"locationLabel",include:!0,iSortPriority:0,mRender:function(c,d,e){return e.boxId?"\x3ca href\x3d'"+Urls.ui.boxes.edit(e.boxId)+"'\x3e"+c+
"\x3c/a\x3e":c},bSortable:!1},{sTitle:"Volume",mData:"volume",include:!0,iSortPriority:0,mRender:ListUtils.render.measureWithUnits(Constants.volumeUnits,"volumeUnits")},{sTitle:"Concentration",mData:"concentration",include:!0,iSortPriority:0,mRender:ListUtils.render.measureWithUnits(Constants.concentrationUnits,"concentrationUnits")},{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:2},{sTitle:"Added",mData:"worksetAddedTime",sDefaultContent:"n/a",mRender:ListUtils.render.naIfNull,
include:a.worksetId,bSortable:!1}]},searchTermSelector:function(a){var b=[a.id,a.barcode,a.created,a.entered,a.changed,a.creator,a.changedby,a.platform,a.index,a.box,a.freezer,a.distributed,a.distributedto];a=[a.tissueOrigin,a.tissueType,a.design,a.groupid];return Constants.isDetailedSample?b.concat(a):b}};
ListTarget.librarydesign={name:"Library Designs",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-designs")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.librarydesign.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Library Designs","librarydesigns",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Library Designs",
Urls.ui.libraryDesigns.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:1},{sTitle:"Sample Class",mData:"sampleClassAlias",include:!0,iSortPriority:0},{sTitle:"Selection",mData:"selectionName",include:!0,iSortPriority:0},{sTitle:"Strategy",mData:"strategyName",include:!0,iSortPriority:0},{sTitle:"Design Code",mData:"designCodeLabel",include:!0,iSortPriority:0}]}};
ListTarget.librarydesigncode={name:"Library Design Codes",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-designs")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.librarydesigncode.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Library Design Codes","librarydesigncodes",function(c){return c.code}));return b},createStaticActions:function(a,
b){return a.isAdmin?[ListUtils.createStaticAddAction("Library Design Codes",Urls.ui.libraryDesignCodes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Code",mData:"code",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Targeted Sequencing Required",mData:"targetedSequencingRequired",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks}]}};
ListTarget.libraryindex={name:"Library Indices",createUrl:function(a,b){return a.platformType?Urls.rest.libraryIndices.platformDatatable(a.platformType):Urls.rest.libraryIndices.datatable},getQueryUrl:null,createBulkActions:function(a,b){b=[];a.indexFamilyId&&a.isAdmin&&b.push(BulkUtils.actions.edit(Urls.ui.libraryIndices.bulkEdit),ListUtils.createBulkDeleteAction("Library Indices","libraryindices",function(c){return c.name+" ("+c.sequence+")"}));a.additionalBulkActions&&(b=b.concat(a.additionalBulkActions));
return b},createStaticActions:function(a,b){return a.indexFamilyId&&a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Create Indices","Create",[{property:"quantity",type:"int",label:"Quantity",required:!0,value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Indices",["Quantity must be 1 or more."]):window.location=Urls.ui.libraryIndices.bulkCreate+"?"+Utils.page.param({indexFamilyId:a.indexFamilyId,quantity:c.quantity})})}}]:[]},createColumns:function(a,b){return[{sTitle:"Platform",
include:!a.platformType&&!a.indexFamilyId,iSortPriority:3,mData:"family.platformType",mRender:ListUtils.render.platformType},{sTitle:"Family",include:!a.indexFamilyId,iSortPriority:2,mData:"family.name"},{sTitle:"Index Name",include:!0,iSortPriority:1,mData:"name"},{sTitle:"Sequence(s)",include:!0,iSortPriority:0,bSortable:!1,mData:"sequence",mRender:function(c,d,e){return"display"===d&&e.family.fakeSequence?e.realSequences.join(", "):c}},{sTitle:"Position",include:!0,iSortPriority:1,mData:"position"}]}};
ListTarget.libraryindexfamily={name:"Library Index Families",getUserManualUrl:function(){return Urls.external.userManual("type_data","indices")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Library Index Families","libraryindexfamilies",Utils.array.getName)]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=
Urls.ui.libraryIndexFamilies.create}}]:[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Name",Urls.ui.libraryIndexFamilies.edit,Utils.array.getId,"name",1,!0),{sTitle:"Platform",mData:"platformType",include:!0,iSortPriority:0,mRender:ListUtils.render.platformType},{sTitle:"Multi-Sequence Indices",mData:"fakeSequence",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Unique Dual Indices",mData:"uniqueDualIndex",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},
{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.libraryselection={name:"Library Selection Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-selection-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,headerMessage:{text:"WARNING: Adding or modifying library selection types may cause your data to be invalid for ENA submission",level:"important"},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.libraryselection.getBulkActions(a);a.isAdmin&&
b.push(ListUtils.createBulkDeleteAction("Library Selection Types","libraryselections",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Library Selection Types",Urls.ui.librarySelections.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.libraryspikein={name:"Library Spike-Ins",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-spike-ins")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.libraryspikein.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Library Spike-Ins","libraryspikeins",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Library Spike-Ins",Urls.ui.librarySpikeIns.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1}]}};
ListTarget.librarystrategy={name:"Library Strategy Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-strategy-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,headerMessage:{text:"WARNING: Adding or modifying library strategy types may cause your data to be invalid for ENA submission",level:"important"},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.librarystrategy.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Library Strategy Types",
"librarystrategies",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Library Strategy Types",Urls.ui.libraryStrategies.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.librarytype={name:"Library Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","library-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.librarytype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Library Types","librarytypes",function(c){return c.description}));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Library Types",
Urls.ui.libraryTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Description",mData:"description",include:!0,iSortPriority:2},{sTitle:"Platform",mData:"platform",include:!0,iSortPriority:1},{sTitle:"Abbreviation",mData:"abbreviation",include:!0,iSortPriority:0},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.linkedpoolorder={name:"Pool Orders",createUrl:function(a,b){return Urls.rest.poolOrders.statusDatatable(a.status)},queryUrl:null,createBulkActions:function(a,b){return[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",Urls.ui.poolOrders.edit,"id",Utils.array.getId,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.poolOrders.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Purpose",mData:"purposeAlias",include:!0,iSortPriority:0},
{sTitle:"Description",mData:"description",mRender:Warning.tableWarningRenderer(WarningTarget.poolorder),include:!0,iSortPriority:0},{sTitle:"Library Aliquots",mData:"orderAliquots",include:!0,bSortable:!1,mRender:function(c,d,e){return c?c.length:0}},{sTitle:"Longest Index",mData:"longestIndex",bSortable:!1,iSortPriority:0,include:!a.poolId},{sTitle:"Instrument Model",mData:"parametersName",include:!0,bSortable:!1,mRender:function(c,d,e){return c?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e.parametersId),
Constants.sequencingParameters).instrumentModelAlias:"n/a"}},{sTitle:"Sequencing Parameters",mData:"parametersName",include:!0,bSortable:!1,mRender:function(c,d,e){return"display"===d?c||"n/a":c}},{sTitle:"Partitions",mData:"partitions",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d?c||"n/a":c}}]}};
ListTarget.locationmap={name:"Location Maps",getUserManualUrl:function(){return Urls.external.userManual("freezers_and_rooms")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Location Maps","locationmaps",function(c){return c.filename})]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Upload",handler:function(){var c=jQuery("#dialog");c.empty();var d=jQuery('\x3cform id\x3d"uploadForm"\x3e');
d.append(jQuery('\x3cp\x3e\x3cinput id\x3d"fileInput" type\x3d"file" name\x3d"file"\x3e\x3c/p\x3e'));d.append(jQuery("\x3cp\x3e").append(jQuery('\x3clabel for\x3d"description"\x3eDescription:\x3c/label\x3e')).append(jQuery('\x3cinput id\x3d"description" type\x3d"text" name\x3d"description"\x3e')));c.append(d);var e=c.dialog({autoOpen:!0,width:500,title:"Upload Location Map",modal:!0,buttons:{upload:{id:"upload",text:"Upload",click:function(){if(jQuery("#fileInput").val()){var g=new FormData(jQuery("#uploadForm")[0]);
e.dialog("close");c.empty();c.append(jQuery("\x3cp\x3eUploading...\x3c/p\x3e"));e=jQuery("#dialog").dialog({autoOpen:!0,height:400,width:350,title:"Uploading File",modal:!0,buttons:{},closeOnEscape:!1,open:function(f,h){jQuery(this).parent().children().children(".ui-dialog-titlebar-close").hide()}});jQuery.ajax({url:Urls.rest.locationMaps.create,type:"POST",data:g,cache:!1,contentType:!1,processData:!1}).done(function(f){Utils.showOkDialog("Upload Location Map",["File upload successful"],Utils.page.pageReload)}).fail(function(f,
h,k){e.dialog("close");Utils.showAjaxErrorDialog(f,h,k)})}else alert("No file selected!")}},cancel:{id:"cancel",text:"Cancel",click:function(){e.dialog("close")}}}})}}]:[]},createColumns:function(a,b){return[{sTitle:"Filename",mData:"filename",include:!0,iSortPriority:0,mRender:function(c,d,e){return'\x3ca href\x3d"'+Urls.ui.freezerMaps.view(c)+'"\x3e'+c+"\x3c/a\x3e"}},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.metric=function(){return{name:"Metrics",getUserManualUrl:function(){return Urls.external.userManual("type_data","metrics")},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.metric.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Metrics","metrics",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Metrics",Urls.ui.metrics.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",
mData:"label",iSortPriority:1,bSortDirection:!0},{sTitle:"Category",mData:"category",mRender:function(c,d,e){return Utils.array.findUniqueOrThrow(function(g){return g.value===c},Constants.metricCategories).label}},{sTitle:"Subcategory",mData:"subcategoryId",mRender:ListUtils.render.textFromId(Constants.metricSubcategories,"alias","")},{sTitle:"Threshold Type",mData:"thresholdType",mRender:function(c,d,e){return Utils.array.findUniqueOrThrow(function(g){return g.value===c},Constants.thresholdTypes).sign},
bSortable:!1},{sTitle:"Units",mData:"units",sDefaultContent:"n/a"}]}}}();
ListTarget.metricsubcategory=function(){function a(b){var c=Utils.array.findUniqueOrThrow(Utils.array.get("value"),Constants.metricCategories);return b.alias+" ("+c.label+")"}return{name:"Metric Subcategories",getUserManualUrl:function(){return Urls.external.userManual("type_data","metric-subcategories")},showNewOptionSop:!0,createBulkActions:function(b){var c=BulkTarget.metricsubcategory.getBulkActions(b);b.isAdmin&&c.push(ListUtils.createBulkDeleteAction("Metric Subcategories","metricsubcategories",
a));return c},createStaticActions:function(b){return b.isAdmin?[ListUtils.createStaticAddAction("Metric Subcategories",Urls.ui.metricSubcategories.bulkCreate,!0)]:[]},createColumns:function(b){return[{sTitle:"Alias",mData:"alias"},{sTitle:"Category",mData:"category",mRender:function(c,d,e){return Utils.array.findUniqueOrThrow(function(g){return g.value===c},Constants.metricCategories).label},iSortPriority:1,bSortDirection:!0},{sTitle:"Design Code",mData:"libraryDesignCodeId",mRender:ListUtils.render.textFromId(Constants.libraryDesignCodes,
"code","n/a"),include:Constants.isDetailedSample},{sTitle:"Sort Priority",mData:"sortPriority",sDefaultContent:"n/a",iSortPriority:2,bSortDirection:!0}]}}}();
ListTarget.note=function(){function a(b){if(!b.entityId||!b.entityType)throw Error("List config missing entity type or ID");}return{name:"Notes",createUrl:function(b){throw Error("Must be provided statically");},createBulkActions:function(b){return[{name:"Delete",action:function(c){a(b);if(c.some(function(g){return g.entityType!==b.entityType||g.entityId!==b.entityId}))Utils.showOkDialog("Error",["Cannot delete notes from parent entities."]);else{var d=["Are you sure you want to delete these notes? This cannot be undone.",
"Note: a note may only be deleted by its creator or an admin."],e=[];c.forEach(function(g){d.push("* "+g.text);e.push(g.id)});Utils.showConfirmDialog("Delete Notes","Delete",d,function(){Utils.ajaxWithDialog("Deleting Notes","POST",Urls.rest.notes.bulkDelete,{entityType:b.entityType,entityId:b.entityId,noteIds:e},Utils.page.pageReload)})}}}]},createStaticActions:function(b){return[{name:"Add Note",handler:function(){a(b);Utils.notes.showNoteDialog(b.entityType,b.entityId)}}]},createColumns:function(b,
c){return[{sTitle:"Name",mData:"entityName",include:!0},{sTitle:"Alias",mData:"entityAlias",include:!0},{sTitle:"Note",mData:"text",include:!0},{sTitle:"Owner",mData:"ownerName",include:!0},{sTitle:"Created",mData:"creationDate",include:!0}]}}}();
ListTarget.orderaliquot={name:"Library Aliquots",createUrl:function(a,b){throw Error("Can only be created statically");},queryUrl:null,createBulkActions:function(a,b){return[{name:"Remove",action:function(c){PoolOrder.removeAliquots(c.map(Utils.array.getId))}},{name:"Edit Proportions",action:function(c){var d=[];c.forEach(function(e){d.push({type:"int",label:e.aliquot.name+" ("+e.aliquot.alias+")",value:e.proportion,property:"aliquot"+e.aliquot.id+"Proportion",required:!0})});Utils.showDialog("Edit Proportions",
"OK",d,function(e){var g=PoolOrder.getAliquots();g.forEach(function(f){e["aliquot"+f.aliquot.id+"Proportion"]&&(f.proportion=e["aliquot"+f.aliquot.id+"Proportion"])});PoolOrder.setAliquots(g)})}}]},createStaticActions:function(a,b){return[ListUtils.createStaticAddAliquotsAction(PoolOrder.getAliquots,function(c,d){PoolOrder.addAliquots(c.map(function(e){return{id:e.id,aliquot:e,proportion:d["aliquot"+e.id+"Proportion"]}}))})]},createColumns:function(a,b){b=ListUtils.columns.detailedQcStatus;b.mData=
"aliquot.detailedQcStatusId";return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"aliquot.name",iSortPriority:1,iDataSort:1,mRender:Warning.tableWarningRenderer(WarningTarget.orderaliquot.makeTarget(a.duplicateSequences,a.nearDuplicateIndices),function(c){return Urls.ui.libraryAliquots.edit(c.aliquot.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Alias",Urls.ui.libraryAliquots.edit,function(c){return c.aliquot.id},"aliquot.alias",0,!0),{sTitle:"Proportion",sType:"numeric",mData:"proportion",
include:!a.add,iSortPriority:0},ListUtils.idHyperlinkColumn("Sample Name",Urls.ui.samples.edit,"aliquot.sampleId",function(c){return c.aliquot.sampleId},0,!0,"noPrint"),ListUtils.labelHyperlinkColumn("Sample Alias",Urls.ui.samples.edit,function(c){return c.aliquot.sampleId},"aliquot.sampleAlias",0,!0),{sTitle:"Indices",mData:"aliquot.indexIds",include:!0,bSortable:!1,iSortPriority:0,mRender:function(c,d,e){return c&&c.length?Constants.libraryIndexFamilies.reduce(function(g,f){return g.concat(f.indices.filter(function(h){return-1!=
c.indexOf(h.id)}))},[]).sort(function(g,f){return g.position-f.position}).map(function(g){return g.label}).join(", "):"(none)"}},{sTitle:"Modified",mData:"aliquot.lastModified",include:!0,iSortPriority:0},b]}};
ListTarget.partition={name:"Partition",createUrl:function(a,b){throw Error("Can only be created statically");},getQueryUrl:null,createBulkActions:function(a,b){if(!a.showPool)return[];var c=Utils.array.findFirstOrNull(function(g){return g.name==a.platformType},Constants.platformTypes),d=function(g,f,h){for(var k=document.getElementById("dialog");k.hasChildNodes();)k.removeChild(k.lastChild);g.errors.forEach(function(r){r=document.createElement("P");r.setAttribute("class","parsley-error");r.innerText=
"... "+(g.numMatches-g.items.length)+" more";k.appendChild(r)});g.items.forEach(function(r){var w=r.pool.pooledElements.filter(function(q,t,z){return 5>z.length||4>t}).map(function(q){return q.name+" ("+q.alias+")"});5<=r.pool.pooledElements.length&&w.push("...and "+(r.pool.pooledElements.length-5+1)+" more aliquots");var v=r.orders.filter(function(q){return 0<q.remaining}).map(function(q){return q.parameters.instrumentModelAlias+" "+q.parameters.name+": "+q.remaining+" "+(1==q.remaining?c.partitionName:
c.pluralPartitionName)+" remaining"}),E=[Tile.titleAndStatus(r.pool.name+" ("+r.pool.alias+")",Warning.hasTileWarnings(WarningTarget.pool,r.pool)?Tile.statusBad("Warning"):null)].concat(Warning.generateTileWarnings(WarningTarget.pool,r.pool));E.push(Tile.lines(w,!1));E.push(Tile.lines(v,!0));k.appendChild(Tile.make(E,function(){p.dialog("close");f(r.pool,function(){d(g,f,h)});return!1}))});if(g.numMatches>g.items.length){var l=document.createElement("P");l.innerText="...and "+(g.numMatches-g.items.length)+
" more pools not shown";k.appendChild(l)}0==g.items.length&&(l=document.createElement("P"),l.innerText="No pools found.",k.appendChild(l));var p=jQuery("#dialog").dialog({autoOpen:!0,height:500,width:600,title:"Select Pool",modal:!0,buttons:{Back:{id:"back",text:"Back",click:function(){p.dialog("close");h()}},Cancel:{id:"cancel",text:"Cancel",click:function(){p.dialog("close")}}}})},e=function(g,f,h,k){return{name:f,handler:function(){Utils.ajaxWithDialog("Getting Pools","GET",g,null,function(l){d(l,
h,k)})}}};b=[{name:"Assign Pool",action:function(g){var f=function(r,w,v){var E=function(){var q={partitionIds:g.map(Utils.array.getId)};w&&(q.concentration=w,q.units=v);Utils.ajaxWithDialog("Assigning Pool","POST",Urls.rest.pools.assign(r?r.id:0),q,Utils.page.pageReload)};r?Utils.warnIfConsentRevoked(r.pooledElements,function(){E()},function(q){return q.name+" ("+q.alias+")"}):E()},h=function(r,w){Utils.showDialog("Set Loading Concentration","OK",[{label:"Loading Concentration",property:"loadingConcentration",
type:"float",value:""},{label:"Units",property:"loadingConcentrationUnits",type:"select",value:"nM",values:Constants.concentrationUnits,getLabel:function(v){return v.units.replace("\x26#181;","\u00b5")}}],function(v){var E=v.loadingConcentration;E?(v=v.loadingConcentrationUnits.name,f(r,E,v)):f(r,null,null)},w)},k=function(r,w){return function(){Utils.showDialog("Search for Pool to Assign","Search",[{type:"text",label:"Search",property:"query",value:r}],function(v){Utils.ajaxWithDialog("Getting Pools",
"GET",Urls.rest.pools.picker.search+"?"+Utils.page.param({platform:c.name,query:v.query}),null,function(E){d(E,h,k(v.query,w))})},w)}},l=function(){Utils.showWizardDialog("Assign Pool",p)};var p=[{name:"No Pool",handler:function(){f(0)}},{name:"Search",handler:k("",l)},a.sequencingParametersId?e(Urls.rest.sequencingOrders.picker.chemistry+"?"+Utils.page.param({platform:c.name,seqParamsId:a.sequencingParametersId,fulfilled:!1}),"Outstanding Orders (Matched Chemistry)",h,l):null,e(Urls.rest.sequencingOrders.picker.active+
"?"+Utils.page.param({platform:c.name}),"Outstanding Orders (All)",h,l),e(Urls.rest.pools.picker.recent+"?"+Utils.page.param({platform:c.name}),"Recently Modified",h,l)].filter(function(r){return r});l()}}];a.runId&&(b.push({name:"Set QC",action:function(g){var f=function(h,k){Utils.ajaxWithDialog("Setting QC","POST",Urls.rest.runs.setPartitionQcs(a.runId),{partitionIds:g.map(Utils.array.getId),qcTypeId:h,notes:k},Utils.page.pageReload)};Utils.showWizardDialog("Set QC",Constants.partitionQcTypes.map(function(h){return{name:h.detailedLabel,
handler:function(){h.noteRequired?Utils.showDialog(h.description+" Notes","Set",[{type:"text",label:"Notes",property:"notes"}],function(k){f(h.id,k.notes)}):f(h.id,null)}}}))}}),b.push({name:"Set Purpose",action:function(g){Utils.showWizardDialog("Set Purpose",Constants.runPurposes.sort(Utils.sorting.standardSort("alias")).map(function(f){return{name:f.alias,handler:function(){Utils.ajaxWithDialog("Setting Purpose","PUT",Urls.rest.runs.setPartitionPurposes(a.runId),{partitionIds:g.map(Utils.array.getId),
runPurposeId:f.id},Utils.page.pageReload)}}}))}}));return b},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[{sTitle:"Position",mData:"runPositionAlias",mRender:function(c,d,e){return c||"n/a"},iSortPriority:2,bSortDirection:!0},ListUtils.labelHyperlinkColumn("Container",Urls.ui.containers.edit,function(c){return c.containerId},"containerName",0,a.showContainer),{sTitle:"Number",mData:"partitionNumber",include:!0,iSortPriority:1,bSortDirection:!0},{sTitle:"Pool",mData:function(c){return c.pool?
c.pool.name+" ("+c.pool.alias+")":"(none)"},include:a.showPool,iSortPriority:0,mRender:Warning.tableWarningRenderer(WarningTarget.partition,function(c){return c.pool?Urls.ui.pools.edit(c.pool.id):null})},{sTitle:"Library Aliquots",mData:"pool",include:!0,iSortPriority:0,bSortable:!1,mRender:function(c,d,e){return c?c.libraryAliquotCount:"display"===d?"(None)":""}},{sTitle:"Loading Conc.",mData:"loadingConcentration",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d&&c&&(d=Constants.concentrationUnits.find(function(g){return g.name==
e.loadingConcentrationUnits}))?c+" "+d.units:c}},{sTitle:"QC Status",mData:"qcType",include:a.runId,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.partitionQcTypes,"detailedLabel","(Unset)")},{sTitle:"QC Note",mData:"qcNotes",iSortPriority:0,include:a.runId},{sTitle:"Purpose",mData:"runPurposeId",include:a.runId,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.runPurposes,"alias")}]}};
ListTarget.partitionqctype={name:"PartitionQC Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","partition-qc-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.partitionqctype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Partition QC Types","partitionqctypes",function(c){return c.description}));return b},createStaticActions:function(a,
b){return a.isAdmin?[ListUtils.createStaticAddAction("Partition QC Types",Urls.ui.partitionQcTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Note Required",mData:"noteRequired",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Order Fulfilled",mData:"orderFulfilled",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Disable Pipeline",mData:"analysisSkipped",
include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks}]}};
ListTarget.pipeline={name:"Pipelines",getUserManualUrl:function(){return Urls.external.userManual("type_data","pipelines")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.pipeline.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Pipelines","pipelines",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Pipelines",
Urls.ui.pipelines.bulkCreate)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",iSortPriority:1,bSortDirection:!0}]}};
ListTarget.pool={name:"Pools",getUserManualUrl:function(){return Urls.external.userManual("pools")},createUrl:function(a,b){return b?Urls.rest.pools.projectDatatable(b):Urls.rest.pools.platformDatatable(a.platformType)},getQueryUrl:function(){return Urls.rest.pools.query},createBulkActions:function(a,b){a=BulkTarget.pool.getBulkActions(a);a.push({name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following pools? This cannot be undone.","Any associated orders will also be deleted.",
"Note: a pool may only be deleted by its creator or an admin."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.name+" ("+f.alias+")");e.push(f.id)});Utils.showConfirmDialog("Delete Pools","Delete",d,function(){Utils.ajaxWithDialog("Deleting Pools","POST",Urls.rest.pools.bulkDelete,e,function(){Utils.page.pageReload()})})}});a.push({name:"Merge",action:function(c){var d=c.map(function(e){return{type:"int",label:e.alias+" ("+e.name+")",value:1,property:"pool"+e.id,required:!0}});BulkUtils.actions.showDialogForBoxCreation("Merge Proportions",
"Merge",d,Urls.ui.pools.bulkMerge,function(e){var g=c.map(Utils.array.getId),f=g.map(function(h){return e["pool"+h]});return{ids:g.join(","),proportions:f.join(",")}},function(e){return 1})}});return a},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location=Urls.ui.pools.create}}]},createColumns:function(a,b){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"name",include:!0,iSortPriority:1,iDataSort:0,mRender:Warning.tableWarningRenderer(WarningTarget.pool,
function(c){return Urls.ui.pools.edit(c.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Alias",Urls.ui.pools.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Date Created",mData:"creationDate",include:!0,iSortPriority:0},{sTitle:"Library Aliquots",mData:"libraryAliquotCount",include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Concentration",mData:"concentration",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===
d&&c&&(d=Constants.concentrationUnits.find(function(g){return g.name==e.concentrationUnits}))?c+" "+d.units:c}},{sTitle:"Location",mData:"locationLabel",bSortable:!1,mRender:function(c,d,e){return e.box?"\x3ca href\x3d'"+Urls.ui.boxes.edit(e.box.id)+"'\x3e"+c+"\x3c/a\x3e":c},include:!0,iSortPriority:0},{sTitle:"Average Insert Size",mData:"dnaSize",bSortable:!1,mRender:function(c,d,e){return c||"N/A"},include:!0,iSortPriority:0},{sTitle:"Modified",mData:"lastModified",include:Constants.isDetailedSample,
iSortPriority:2}]},searchTermSelector:function(a){return[a.id,a.barcode,a.created,a.entered,a.changed,a.creator,a.changedby,a.platform,a.index,a.box,a.freezer,a.distributed,a.distributedto]}};
ListTarget.poolelement={name:"Library Aliquots",createUrl:function(a,b){throw Error("Can only be created statically");},getQueryUrl:null,createBulkActions:function(a,b){return[{name:"Remove",action:function(c){Pool.removeAliquots(c.map(Utils.array.getId))}},{name:"Edit Proportions",action:function(c){var d=[];c.forEach(function(e){d.push({type:"int",label:e.name+" ("+e.alias+")",value:e.proportion,property:"aliquot"+e.id+"Proportion",required:!0})});Utils.showDialog("Edit Proportions","OK",d,function(e){var g=
Pool.getAliquots();g.forEach(function(f){e["aliquot"+f.id+"Proportion"]&&(f.proportion=e["aliquot"+f.id+"Proportion"])});Pool.setAliquots(g)})}}]},createStaticActions:function(a,b){return[ListUtils.createStaticAddAliquotsAction(Pool.getAliquots,function(c,d){Pool.addAliquots(c.map(function(e){e.proportion=d["aliquot"+e.id+"Proportion"];return e}))})]},createColumns:function(a,b){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Library Aliquot Name",mData:"name",include:!0,iSortPriority:1,iDataSort:1,
mRender:Warning.tableWarningRenderer(WarningTarget.poolelement.makeTarget(a.duplicateIndicesSequences,a.nearDuplicateIndicesSequences),function(c){return Urls.ui.libraryAliquots.edit(c.id)}),sClass:"nowrap"},{sTitle:"Library Aliquot Alias",mData:"alias",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d?'\x3ca href\x3d"'+Urls.ui.libraryAliquots.edit(e.id)+'"\x3e'+e.alias+"\x3c/a\x3e":c}},{sTitle:"Proportion",sType:"numeric",mData:"proportion",include:!a.add,iSortPriority:0},ListUtils.idHyperlinkColumn("Library Name",
Urls.ui.libraries.edit,"libraryId",function(c){return c.libraryName},0,!0,"noPrint"),ListUtils.labelHyperlinkColumn("Library Alias",Urls.ui.libraries.edit,function(c){return c.libraryId},"libraryAlias",0,!0),ListUtils.idHyperlinkColumn("Sample Name",Urls.ui.samples.edit,"sampleId",function(c){return c.sampleName},0,!0,"noPrint"),ListUtils.labelHyperlinkColumn("Sample Alias",Urls.ui.samples.edit,function(c){return c.sampleId},"sampleAlias",0,!0,"noPrint"),{sTitle:"Conc.",sType:"numeric",mData:"concentration",
include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d&&c&&(d=Constants.concentrationUnits.find(function(g){return g.name==e.concentrationUnits}))?c+" "+d.units:c}},{sTitle:"Targeted Sequencing",mData:"targetedSequencingId",include:Constants.isDetailedSample,mRender:ListUtils.render.textFromId(Constants.targetedSequencings,"alias","(None)"),iSortPriority:0,bSortable:!1},{sTitle:"Indices",mData:"indexIds",include:!0,bSortable:!1,iSortPriority:0,mRender:function(c,d,e){return null===
c?"None":Constants.libraryIndexFamilies.reduce(function(g,f){return g.concat(f.indices.filter(function(h){return-1!=c.indexOf(h.id)}))},[]).sort(function(g,f){return g.position-f.position}).map(function(g){return g.label}).join(", ")}},{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:0,sClass:"noPrint"},ListUtils.columns.detailedQcStatus]}};
ListTarget.poolorder={name:"Pool Orders",getUserManualUrl:function(){return Urls.external.userManual("pool_orders")},createUrl:function(a,b){return Urls.rest.poolOrders.statusDatatable(a.status)},queryUrl:null,createBulkActions:function(a,b){return[ListUtils.createBulkDeleteAction("Pool Orders","poolorders",Utils.array.getAlias)]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location.href=Urls.ui.poolOrders.create}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",
Urls.ui.poolOrders.edit,"id",Utils.array.getId,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.poolOrders.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Purpose",mData:"purposeAlias",include:!0,iSortPriority:0},{sTitle:"Description",mData:"description",mRender:Warning.tableWarningRenderer(WarningTarget.poolorder),include:!0,iSortPriority:0},{sTitle:"Library Aliquots",mData:"orderAliquots",include:!0,bSortable:!1,mRender:function(c,d,e){return c?c.length:0}},{sTitle:"Longest Index",mData:"longestIndex",
bSortable:!1,iSortPriority:0,include:!a.poolId},{sTitle:"Instrument Model",mData:"parametersName",include:!0,bSortable:!1,mRender:function(c,d,e){return c?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(e.parametersId),Constants.sequencingParameters).instrumentModelAlias:"n/a"}},{sTitle:"Sequencing Parameters",mData:"parametersName",include:!0,bSortable:!1,mRender:function(c,d,e){return"display"===d?c||"n/a":c}},{sTitle:"Partitions",mData:"partitions",include:!0,iSortPriority:0,mRender:function(c,
d,e){return"display"===d?c||"n/a":c}}]},searchTermSelector:function(a){return[a.id,a.fulfilled,a.active]}};
ListTarget.printer={name:"Printers",getUserManualUrl:function(){return Urls.external.userManual("barcode_label_printers")},createUrl:function(a,b){return Urls.rest.printers.datatable},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[{name:"Enable",action:function(c){Utils.ajaxWithDialog("Enabling Printer","PUT",Urls.rest.printers.enable,c.map(Utils.array.getId),Utils.page.pageReload)}},{name:"Disable",action:function(c){Utils.ajaxWithDialog("Disabling Printer",
"PUT",Urls.rest.printers.disable,c.map(Utils.array.getId),Utils.page.pageReload)}},{name:"Duplicate",action:function(c){1<c.length&&Utils.showOkDialog("Duplicate Printer",["One at a time please."]);Utils.showDialog("Duplicate Printer","Duplicate",[{type:"text",label:"New Name",required:!0,property:"name"},{type:"float",label:"Width (mm)",property:"width",required:!0,value:c[0].width},{type:"float",label:"Height (mm)",property:"height",required:!0,value:c[0].height}],function(d){d.name?Utils.ajaxWithDialog("Saving Printer",
"POST",Urls.rest.printers.duplicate(c[0].id),{height:d.height,name:d.name,width:d.width},Utils.page.pageReload):Utils.showOkDialog("Create Printer",["A printer needs a name."])})}},ListUtils.createBulkDeleteAction("Printers","printers",Utils.array.getName),{name:"Edit Label Design",action:function(c){function d(e){Utils.ajaxWithDialog("Getting Label Layout","GET",Urls.rest.printers.layout(e),null,function(g){for(var f=c[0].width,h=c[0].height,k=1;k<c.length;k++)f=Math.min(c[k].width,f),h=Math.min(c[k].height,
h);printerLabelEditor(g,f,h,function(l){c.forEach(function(p){Utils.ajaxWithDialog("Saving Label Layout","PUT",Urls.rest.printers.layout(p.id),l,function(){})})})})}1==c.length?d(c[0].id):Utils.showWizardDialog("Start with label",c.map(function(e){return{name:"Use Label from "+e.name,handler:function(){d(e.id)}}}))}}]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Add Printer","Next",[{type:"text",label:"Name",required:!0,property:"name"},
{type:"select",label:"Driver",property:"driver",values:Constants.printerDrivers.map(Utils.array.getName)},{type:"float",label:"Width (mm)",required:!0,property:"width"},{type:"float",label:"Height (mm)",required:!0,property:"height"},{type:"select",label:"Backend",property:"backend",values:Constants.printerBackends,getLabel:function(c){return c.name}}],function(c){if(c.name){var d=function(e){Utils.ajaxWithDialog("Saving Printer","POST",Urls.rest.printers.create,{id:0,available:!0,backend:c.backend.name,
configuration:e,driver:c.driver,height:c.height,layout:[],name:c.name,width:c.width},Utils.page.pageReload)};0==c.backend.configurationKeys.length?d({}):Utils.showDialog("Add Printer","Save",c.backend.configurationKeys.map(function(e){return{type:"text",label:e,property:e}}),d)}else Utils.showOkDialog("Create Printer",["A printer needs a name."])})}}]:[]},createColumns:function(a,b){return[{sTitle:"Printer",include:!0,iSortPriority:1,mData:"name"},{sTitle:"Driver",include:!0,iSortPriority:0,mData:"driver"},
{sTitle:"Backend",include:!0,iSortPriority:0,mData:"backend"},{sTitle:"Available",include:!0,iSortPriority:0,mData:"available",mRender:ListUtils.render.booleanChecks}]}};
ListTarget.project={name:"Projects",getUserManualUrl:function(){return Urls.external.userManual("projects")},createUrl:function(a,b){return Urls.rest.projects.datatable},createBulkActions:function(a,b){return a.forLibraryTemplate?[{name:"Remove",action:function(c){LibraryTemplate.removeProjects(c)}}]:[ListUtils.createBulkDeleteAction("Projects","projects",function(c){return c.title?c.code?c.title+" ("+c.code+")":c.title:c.code})]},createStaticActions:function(a,b){return a.forLibraryTemplate?[{name:"Add",
handler:function(){Utils.showDialog("Search for Project to Add","Search",[{type:"text",label:"Search",property:"query",value:""}],function(c){Utils.ajaxWithDialog("Getting Projects","GET",Urls.rest.projects.search+"?"+Utils.page.param({q:c.query}),null,function(d){Utils.showWizardDialog("Add Project",d.map(function(e){return{name:e.name+": "+e.title+(e.code?" ("+e.code+")":""),handler:function(){LibraryTemplate.addProject(e)}}}))})})}}]:[{name:"Add",handler:function(){window.location.href=Urls.ui.projects.create}}]},
createColumns:function(a,b){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"name",iSortPriority:0,iDataSort:0,mRender:Warning.tableWarningRenderer(WarningTarget.project,function(c){return Urls.ui.projects.edit(c.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Title",Urls.ui.projects.edit,Utils.array.getId,"title",1,!0),ListUtils.labelHyperlinkColumn("Code",Urls.ui.projects.edit,Utils.array.getId,"code",0,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},
{sTitle:"Status",mData:"status",include:!0,iSortPriority:0}]},searchTermSelector:function(a){return[a.status,a.pipeline,a.id,a.created,a.entered,a.changed,a.creator,a.changedby,a.rebnumber,a.rebexpiry]}};
ListTarget.qc=function(a){return{name:a+" QCs",createUrl:function(b,c){throw Error("QCs can only be generated statically");},getQueryUrl:null,createBulkActions:function(b,c){b=BulkTarget.qc.getBulkActions({qcTarget:a});b.push({name:"Delete",action:function(d){var e=["Are you sure you wish to delete the following items? This cannot be undone."],g=[];jQuery.each(d,function(f,h){f=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(h.qcTypeId),Constants.qcTypes);e.push("* "+f.name+" ("+h.date+")");
g.push(h.id)});Utils.showConfirmDialog("Delete QCs","Delete",e,function(){var f=Urls.rest.qcs.bulkDelete+"?"+Utils.page.param({qcTarget:a});Utils.ajaxWithDialog("Deleting QCs","POST",f,g,function(){Utils.page.pageReload()})})}});return b},createStaticActions:function(b,c){return b.entityId?[{name:"Add QCs",handler:function(){Utils.showDialog("Add QCs","Add",[{property:"copies",type:"int",label:"QCs per "+a,value:1},{property:"controls",type:"int",label:"Controls per QC",value:1}],function(d){!Number.isInteger(d.copies)||
1>d.copies?Utils.showOkDialog("Error",["Invalid number of QCs entered"]):!Number.isInteger(d.controls)||0>d.controls?Utils.showOkDialog("Error",["Invalid number of controls entered"]):Utils.page.post(Urls.ui.qcs.bulkAddFrom(a),{entityIds:b.entityId,copies:d.copies,controls:d.controls})})}}]:[]},createColumns:function(b,c){return[{sTitle:"Method",mData:"qcTypeId",mRender:function(d,e,g){return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(d),Constants.qcTypes).name}},{sTitle:"Creator",mData:"creator"},
{sTitle:"Date",mData:"date",iSortPriority:1},{sTitle:"Results",mData:"results",mRender:function(d,e,g){if("display"===e){var f=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g.qcTypeId),Constants.qcTypes);return 0>f.precisionAfterDecimal?ListUtils.render.booleanChecks(0<d,e,g):d+"\u2009"+f.units}return d}},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}}};
ListTarget.qccontrol={name:"QC Controls",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[{name:"Remove",action:function(c){QcType.removeControls(c.map(Utils.array.getAlias))}}]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Add Control","Add",[{label:"Alias",property:"alias",type:"text",required:!0}],function(c){RegExp(Utils.validation.sanitizeRegex).test(c.alias)?
QcType.addControl(c.alias):Utils.showOkDialog("Error",["Control alias cannot contain these characters: \x3c\x3e\x26"])})}}]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1}]}};
ListTarget.qctype={name:"QC Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","qc-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("QC Types","qctypes",function(c){return c.name+" ("+c.qcTarget+" QC)"})]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=Urls.ui.qcTypes.create}}]:
[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Name",Urls.ui.qcTypes.edit,Utils.array.getId,"name",0,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Target",mData:"qcTarget",include:!0,iSortPriority:0},{sTitle:"Units",mData:"units",include:!0,iSortPriority:0,bSortable:!1},{sTitle:"Corresponding Field",mData:"correspondingField",include:!0,iSortPriority:0,bSortable:!0},{sTitle:"Auto Update Field",mData:"autoUpdateField",include:!0,
iSortPriority:0,bSortable:!0},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]}};
ListTarget.referencegenome={name:"Reference Genomes",getUserManualUrl:function(){return Urls.external.userManual("type_data","reference-genomes")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.referencegenome.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Reference Genomes","referencegenomes",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Reference Genomes",Urls.ui.referenceGenomes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Default Scientific Name",mData:"defaultScientificNameId",include:!0,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.scientificNames,"alias","n/a")}]}};
ListTarget.requisition=function(){return{name:"Requisitions",getUserManualUrl:function(){return Urls.external.userManual("requisitions")},createUrl:function(a,b){return Urls.rest.requisitions.datatable},createBulkActions:function(a,b){a=BulkUtils.actions.qc("Requisition");a.push(ListUtils.createBulkDeleteAction("Requisitions","requisitions",Utils.array.getAlias));return a},createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.page.pageRedirect(Urls.ui.requisitions.create)}}]},
createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.requisitions.edit,Utils.array.getId,"alias",1,!0),{sTitle:"Assay",mData:"assayIds",bSortable:!1,mRender:function(c,d,e){return c&&c.length?c.map(function(g){return"\x3cdiv\x3e"+Utils.array.findUniqueOrThrow(Utils.array.idPredicate(g),Constants.assays).alias+"\x3c/div\x3e"}).join(""):"n/a"}},{sTitle:"Stopped",mData:"stopped",bSortable:!1,mRender:function(c,d,e){return"display"===d?c?"\x3cspan title\x3d'Stopped'\x3e\ud83d\uded1\x3c/span\x3e":
e.pauses&&e.pauses.some(function(g){return!g.endDate||g.endDate>Utils.getCurrentDate()})?"\x3cspan title\x3d'Paused'\x3e\u231b\x3c/span\x3e":"":c}},{sTitle:"Entered",mData:"creationTime",mRender:ListUtils.render.dateWithTimeTooltip},{sTitle:"Modified",mData:"lastModified",mRender:ListUtils.render.dateWithTimeTooltip,iSortPriority:1,bSortDirection:!1}]},searchTermSelector:function(a){return[a.id,a.requisitionStatus,a.entered,a.creator,a.changed,a.changedby]}}}();
ListTarget.requisitionpause={name:"Pauses",getUserManualUrl:function(){return Urls.external.userManual("requisitions")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return[{name:"Resume",action:function(c){1!==c.length?Utils.showOkDialog("Error",["You can only resume one pause at a time."]):c[0].endDate?Utils.showOkDialog("Error",["This pause has already been resumed."]):(pause=c[0],fields=[{label:"Resume Date",type:"date",property:"endDate",
required:!0,value:Utils.getCurrentDate()}],Utils.showDialog("Resume Requisition","Resume",fields,function(d){d.endDate<=pause.startDate?Utils.showOkDialog("Error",["Pause length must be at least one day"]):(pause.endDate=d.endDate,Requisition.updatePause(pause))}))}},{name:"Delete",action:function(c){Requisition.removePauses(c)}}]},createStaticActions:function(a,b){return[{name:"Pause",handler:function(){fields=[{label:"Pause Date",type:"date",property:"startDate",required:!0,value:Utils.getCurrentDate()},
{label:"Reason",type:"text",property:"reason",required:!0}];Utils.showDialog("Pause Requisition","Pause",fields,function(c){c.endDate=null;Requisition.addPause(c)})}}]},createColumns:function(a,b){return[{sTitle:"Start Date",mData:"startDate",iSortPriority:1,bSortDirection:!0},{sTitle:"End Date",mData:"endDate"},{sTitle:"Reason",mData:"reason"}]}};
ListTarget.run={name:"Runs",getUserManualUrl:function(){return Urls.external.userManual("sequencing_runs")},createUrl:function(a,b){return b?Urls.rest.runs.projectDatatable(b):a.sequencer?Urls.rest.runs.sequencerDatatable(a.sequencer):a.platformType?Urls.rest.runs.platformDatatable(a.platformType):Urls.rest.runs.datatable},getQueryUrl:null,createBulkActions:function(a,b){return[BulkUtils.actions.download(Urls.rest.runs.spreadsheet,Constants.runLibrarySpreadsheets),ListUtils.createBulkDeleteAction("Runs",
"runs",function(c){return c.alias}),BulkUtils.actions.parents(Urls.rest.runs.parents,BulkUtils.relations.categoriesForDetailed().concat([BulkUtils.relations.pool(),BulkUtils.relations.library(),BulkUtils.relations.libraryAliquot()]))]},createStaticActions:function(a,b){if(!b&&a.platformType){var c=Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.namePredicate(a.platformType),Constants.platformTypes),"key");return[{name:"Add "+c+" Run",handler:function(){Utils.ajaxWithDialog("Getting Sequencer",
"Get",Urls.rest.instruments.list,null,function(d){var e=Constants.instrumentModels.filter(function(g){return g.platformType===a.platformType&&"SEQUENCER"===g.instrumentType}).map(function(g){return g.id});Utils.showWizardDialog("Add "+c+" Run",d.filter(function(g){return-1!==e.indexOf(g.instrumentModelId)&&!g.dateDecommissioned}).sort(Utils.sorting.standardSort("name")).map(function(g){return{name:g.name+" ("+g.instrumentModelAlias+")",handler:function(){window.location=Urls.ui.runs.create(g.id)}}}))})}}]}return[]},
createColumns:function(a,b){b=null;a.platformType&&(b=Utils.array.findUniqueOrThrow(function(c){return c.name===a.platformType},Constants.platformTypes));return[ListUtils.idHyperlinkColumn("Name",Urls.ui.runs.edit,"id",Utils.array.getName,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.runs.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Projects",mData:"projectsLabel",include:!a.requisitionId,bSortable:!1},{sTitle:"Seq. Params.",mData:"sequencingParametersName",include:!b||!b.containerLevelParameters,
bSortable:!1,mRender:function(c,d,e){return c||"(None)"}},{sTitle:"Status",mData:"status",mRender:function(c,d,e){return c||""},include:!0,iSortPriority:0},{sTitle:"Start Date",mData:"startDate",mRender:function(c,d,e){return c||""},include:!a.requisitionId,iSortPriority:2},{sTitle:"End Date",mData:"endDate",mRender:function(c,d,e){return c||""},include:!a.requisitionId,iSortPriority:0},{sTitle:"Type",mData:"platformType",include:!a.platformType,iSortPriority:0,sClass:a.poolId?"noPrint":void 0},{sTitle:"QC",
mData:"qcPassed",mRender:ListUtils.render.booleanChecks,include:a.requisitionId},{sTitle:"Data Review",mData:"dataReview",mRender:ListUtils.render.dataReview,include:a.requisitionId},{sTitle:"Modified",mData:"lastModified",include:Constants.isDetailedSample,iSortPriority:0,sClass:a.poolId?"noPrint":void 0}]},searchTermSelector:function(a){return[a.id,a.runstatus,a.created,a.entered,a.changed,a.creator,a.changedby,a.platform,a.index,a.parameters]}};
ListTarget.run_position={name:"Sequencing Containers",createUrl:null,getQueryUrl:null,createBulkActions:function(a,b){b=BulkUtils.actions.qc("Container");b.push({name:"Remove",action:function(c){Utils.ajaxWithDialog("Removing","POST",Urls.rest.runs.removeContainers(a.runId),c.map(Utils.array.getId),Utils.page.pageReload)}});b.push(BulkUtils.actions.download(Urls.rest.containers.spreadsheet,Constants.partitionSpreadsheets,function(c,d){return[]}));return b},createStaticActions:function(a,b){var c=
Utils.array.findUniqueOrThrow(function(e){return e.name===a.platformType},Constants.platformTypes),d=function(){var e=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(a.instrumentModelId),Constants.instrumentModels);return e.positions&&e.positions.length?e.positions.map(Utils.array.getAlias).sort():[null]};return[{name:"Add "+c.containerName,handler:function(){if(a.isFull)Utils.showOkDialog("Run Full",["Cannot add another "+c.containerName+" to this run as it is full. Try removing one first."]);
else{var e=[{type:"select",label:"position",property:"position",values:d(),getLabel:function(g){return g?g:"n/a"}},{type:"text",label:"Serial Number",property:"barcode"}];c.containerLevelParameters&&e.push({type:"select",label:"Sequencing Parameters",property:"sequencingParameters",values:Constants.sequencingParameters.filter(function(g){return g.instrumentModelId===a.instrumentModelId}),getLabel:Utils.array.getName,required:!0});Utils.showDialog("Add "+c.containerName,"Add",e,function(g){Utils.ajaxWithDialog("Adding "+
c.containerName,"POST",Urls.rest.runs.addContainer(a.runId)+"?"+Utils.page.param({position:g.position,barcode:g.barcode,sequencingParametersId:g.sequencingParameters?g.sequencingParameters.id:null}),null,Utils.page.pageReload)})}}}]},createColumns:function(a,b){return[{sTitle:"Position",mData:"positionAlias",include:!0,mRender:function(c,d,e){return c||"n/a"}},{sTitle:"Seq. Params.",mData:"sequencingParametersId",include:Utils.array.findUniqueOrThrow(function(c){return c.name===a.platformType},Constants.platformTypes).containerLevelParameters,
bSortable:!1,mRender:ListUtils.render.textFromId(Constants.sequencingParameters,"name")},ListUtils.labelHyperlinkColumn("ID",Urls.ui.containers.edit,Utils.array.getId,"id",1,!0),ListUtils.labelHyperlinkColumn("Serial Number",Urls.ui.containers.edit,Utils.array.getId,"identificationBarcode",1,!0),{sTitle:"Model",mData:"containerModel.alias",include:!0},{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:2}]},searchTermSelector:function(a){return[a.created,a.changed,a.creator,a.changedby,
a.platform,a.index,a.kitname]}};
ListTarget.runaliquot={name:"Library Aliquots",createUrl:function(a,b){throw Error("Can only be created statically");},getQueryUrl:null,createBulkActions:function(a,b){return[{name:"Set QC",action:function(c){function d(){var e=[{label:"Status",type:"select",property:"status",values:[{id:null,description:"Pending"}].concat(Constants.runLibraryQcStatuses),getLabel:Utils.array.get("description")},{label:"Note",type:"text",property:"qcNote"}];Utils.showDialog("Set QC","OK",e,function(g){c.forEach(function(f){f.qcStatusId=
g.status.id;f.qcNote=g.qcNote?g.qcNote:null});Utils.ajaxWithDialog("Setting QC","PUT",Urls.rest.runs.updateAliquots(a.runId),c,Utils.page.pageReload)})}c.some(function(e){return null!==e.dataReview})?Utils.showConfirmDialog("Warning","OK",["Changing QC status will reset the data review. Do you wish to proceed?"],d):d()}},{name:"Data Review",action:function(c){if(c.some(function(e){return!e.qcStatusId}))Utils.showOkDialog("Error",["Cannot set data review before QC status"]);else{var d=[{label:"Data Review",
type:"select",property:"dataReview",values:[{value:null,label:"Pending"},{value:!0,label:"Pass"},{value:!1,label:"Fail"}],getLabel:Utils.array.get("label")}];Utils.showDialog("Set Data Review","OK",d,function(e){c.forEach(function(g){g.dataReview=e.dataReview.value});Utils.ajaxWithDialog("Setting Data Review","PUT",Urls.rest.runs.updateAliquots(a.runId),c,Utils.page.pageReload)})}}},{name:"Set Purpose",action:function(c){Utils.showWizardDialog("Set Purpose",Constants.runPurposes.sort(Utils.sorting.standardSort("alias")).map(function(d){return{name:d.alias,
handler:function(){c.forEach(function(e){e.runPurposeId=d.id});Utils.ajaxWithDialog("Setting Purpose","PUT",Urls.rest.runs.updateAliquots(a.runId),c,Utils.page.pageReload)}}}))}}]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Run",Urls.ui.runs.edit,function(c){return c.runId},"runAlias",3,a.requisitionId),ListUtils.labelHyperlinkColumn("Container",Urls.ui.containers.edit,function(c){return c.containerId},"containerIdentificationBarcode",
2,!0),{sTitle:"Partition",mData:"partitionNumber",include:!0,iSortPriority:1,bSortDirection:!0},ListUtils.labelHyperlinkColumn("Name",Urls.ui.libraryAliquots.edit,function(c){return c.aliquotId},"aliquotName",0,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.libraryAliquots.edit,function(c){return c.aliquotId},"aliquotAlias",0,!0),{sTitle:"Tissue Attributes",mData:"tissueOriginAlias",include:Constants.isDetailedSample,mRender:function(c,d,e){return"display"!==d?c:c?'\x3cdiv class\x3d"tooltip" style\x3d"width: 100%;"\x3e\x3cspan\x3e'+
e.tissueOriginAlias+" "+e.tissueTypeAlias+'\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3eTissue origin: '+e.tissueOriginAlias+" ("+e.tissueOriginDescription+")\x3cbr/\x3eTissue type: "+e.tissueTypeAlias+" ("+e.tissueTypeDescription+")\x3cbr/\x3e\x3c/span\x3e\x3c/div\x3e":"n/a"}},{sTitle:"Design",mData:"libraryDesignCode",include:Constants.isDetailedSample},{sTitle:"QC Status",mData:"qcStatusId",mRender:function(c,d,e){if(void 0===c||null===c)return"Pending";c=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(c),
Constants.runLibraryQcStatuses);return"display"!==d?c.description:'\x3cdiv class\x3d"tooltip"\x3e\x3cspan\x3e'+c.description+'\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3eSet by '+e.qcUserName+", "+e.qcDate+"\x3c/span\x3e\x3c/div\x3e"}},{sTitle:"QC Note",mData:"qcNote",sDefaultContent:""},{sTitle:"Data Review",mData:"dataReview",mRender:ListUtils.render.dataReview},{sTitle:"Hierarchy",mData:function(c){return c.runId+"-"+c.partitionId+"-"+c.aliquotId},mRender:function(c,d,e){return"display"===
d?'\x3ca href\x3d"'+Urls.ui.runLibraries.qcHierarchy(c)+'"\x3eView\x3c/a\x3e':c},include:!a.requisitionId},{sTitle:"Purpose",mData:"runPurposeId",include:!a.requisitionId,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.runPurposes,"alias","(Unset)")}]}};
ListTarget.runlibraryqcstatus=function(){return{name:"Run-Library QC Statuses",getUserManualUrl:function(){return Urls.external.userManual("type_data","run-library-qc-statuses")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.runlibraryqcstatus.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Run-Library QC Statuses","runlibraryqcstatuses",Utils.array.get("description")));return b},
createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Run-Library QC Statuses",Urls.ui.runLibraryQcStatuses.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Description",mData:"description",iSortPriority:1},{sTitle:"QC Passed",mData:"qcPassed",mRender:ListUtils.render.booleanChecks}]}}}();
ListTarget.runpurpose={name:"Run Purposes",getUserManualUrl:function(){return Urls.external.userManual("type_data","run-purposes")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.runpurpose.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Run Purposes","runpurposes",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Run Purposes",
Urls.ui.runPurposes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1}]}};
ListTarget.sampleclass={name:"Sample Classes",getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-classes-and-categories")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Sample Classes","sampleclasses",Utils.array.getAlias)]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=Urls.ui.sampleClasses.create}}]:
[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.sampleClasses.edit,Utils.array.getId,"alias",1,!0),{sTitle:"Category",mData:"sampleCategory",include:!0,iSortPriority:0},{sTitle:"Subcategory",mData:function(c,d,e){return c.sampleSubcategory||""},include:!0,iSortPriority:0},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.sampleindex={name:"Sample Indices",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){b=[];a.indexFamilyId&&a.isAdmin&&b.push(BulkUtils.actions.edit(Urls.ui.sampleIndices.bulkEdit),ListUtils.createBulkDeleteAction("Sample Indices","sampleindices",Utils.array.getName));return b},createStaticActions:function(a,b){return a.indexFamilyId&&a.isAdmin?[{name:"Add",handler:function(){Utils.showDialog("Create Indices","Create",[{property:"quantity",
type:"int",label:"Quantity",required:!0,value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Indices",["Quantity must be 1 or more."]):window.location=Urls.ui.sampleIndices.bulkCreate+"?"+Utils.page.param({indexFamilyId:a.indexFamilyId,quantity:c.quantity})})}}]:[]},createColumns:function(a,b){return[{sTitle:"Index Name",include:!0,iSortPriority:1,bSortDirection:!1,mData:"name"}]}};
ListTarget.sampleindexfamily={name:"Sample Index Families",getUserManualUrl:function(){return Urls.external.userManual("type_data","indices")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Sample Index Families","sampleindexfamilies",Utils.array.getName)]:[]},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",handler:function(){window.location=
Urls.ui.sampleIndexFamilies.create}}]:[]},createColumns:function(a,b){return[ListUtils.labelHyperlinkColumn("Name",Urls.ui.sampleIndexFamilies.edit,Utils.array.getId,"name",1,!0)]}};
ListTarget.samplepurpose={name:"Sample Purposes",getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-purposes")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.samplepurpose.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Sample Purposes","samplepurposes",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Sample Purposes",
Urls.ui.samplePurposes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias"},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]}};
ListTarget.sample=function(){function a(){return["Identity","Tissue","Tissue Processing","Stock","Aliquot"].filter(function(r){return Constants.sampleClasses.some(function(w){return!w.archived&&w.directCreationAllowed&&w.sampleCategory===r})})}function b(r){return function(w){Utils.saveWithProgressDialog("POST",r,w.map(Utils.array.getId),Urls.rest.requisitions.samplesUpdateProgress,function(v){switch(v.status){case "completed":Utils.page.pageReload();break;case "failed":Utils.asyncSaveErrorsDialog(v,
w,function(E){return E.alias+" ("+E.name+")"});break;default:Utils.showOkDialog("Error",["Unexpected operation status. The save may still be in progress or completed."])}})}}function c(r){Utils.showWizardDialog("Add Supplemental Samples",[{name:"Search by names",handler:function(){d(r)}},{name:"Find related",handler:function(){f(r)}}],"Choose addition method")}function d(r){Utils.showSearchByNamesDialog("Add Supplemental Samples",Urls.rest.samples.query,function(w,v,E,q){w.length!==q.length?Utils.showSomeNotFoundError(q,
w):e(w)&&g(r,w.map(Utils.array.getId))})}function e(r){return r.some(function(w){return w.synthetic})?(Utils.showOkDialog("Error",["Ghost samples cannot be added to a requisition"]),!1):r.some(function(w){return"Identity"===w.sampleCategory})?(Utils.showOkDialog("Error",["Identity samples cannot be added to a requisition"]),!1):!0}function g(r,w){Utils.ajaxWithDialog("Adding Supplemental Samples","POST",Urls.rest.requisitions.addSupplementalSamples(r.requisitionId),w,Utils.page.pageReload)}function f(r){var w=
r.identities.map(function(v){return{name:v.alias+" ("+v.externalName+")",handler:function(){h(r,[v])}}});w.unshift({name:"All identities",handler:function(){h(r,r.identities)}});Utils.showWizardDialog("Find Related Samples",w,"Which identity would you like to supplement?")}function h(r,w){var v=Constants.sampleCategories.filter(function(E){return"Identity"!==E}).map(function(E){return{name:E,handler:function(){k(r,w,E)}}});Utils.showWizardDialog("Find Related Samples",v,"Which sample category would you like to search?")}
function k(r,w,v){var E=Constants.sampleClasses.filter(function(q){return q.sampleCategory===v&&!q.archived}).map(function(q){return{name:q.alias,handler:function(){l(r,w,q)}}});Utils.showWizardDialog("Find Related Samples",E,"Which sample class would you like to search?")}function l(r,w,v){Utils.ajaxWithDialog("Finding Related Samples...","POST",Urls.rest.samples.findRelated,{identityIds:w.map(function(E){return E.id}),sampleClassId:v.id,excludeRequisitionId:r.requisitionId,excludeSynthetic:!0},
function(E){E&&E.length?p(r,E):Utils.showOkDialog("Add Supplemental Samples",["No matching samples found. Note that ghost samples and those already associated with this requisition are omitted."])})}function p(r,w){w=w.map(function(v){return{label:v.alias+" (Req: "+(v.requisitionAlias||"None")+"; "+(v.sequenced?"":"NOT ")+"Sequenced)",property:v.id,type:"checkbox"}});Utils.showDialog("Add Supplemental Samples","Add",w,function(v){sampleIds=[];for(var E in v)v[E]&&sampleIds.push(E);sampleIds.length?
g(r,sampleIds):Utils.showOkDialog("Add Supplemental Samples",["No samples selected."])})}return{name:"Samples",getUserManualUrl:function(){return Urls.external.userManual("samples")},createUrl:function(r,w){if(w)return r.arrayed?Urls.rest.samples.projectArrayedDatatable(w):Urls.rest.samples.projectDatatable(w);if(r.worksetId)return Urls.rest.samples.worksetDatatable(r.worksetId);if(r.requisitionId)switch(r.relation){case "requisitioned":return Urls.rest.samples.requisitionDatatable(r.requisitionId);
case "supplemental":return Urls.rest.samples.requisitionSupplementalDatatable(r.requisitionId);case "indirect":return Urls.rest.samples.samplesPreparedDatatable(r.requisitionId);default:throw Error("Unexpected requisition relation: "+r.relation);}return Urls.rest.samples.datatable},getQueryUrl:function(){return Urls.rest.samples.query},createBulkActions:function(r,w){w=BulkTarget.sample.getBulkActions(r);r.requisitionId&&("supplemental"===r.relation?w.unshift({name:"Remove",action:function(v){Utils.ajaxWithDialog("Removing Supplemental Samples",
"POST",Urls.rest.requisitions.removeSupplementalSamples(r.requisitionId),v.map(Utils.array.getId),Utils.page.pageReload)}}):"requisitioned"===r.relation&&w.unshift({name:"Remove",action:b(Urls.rest.requisitions.removeSamples(r.requisitionId))},ListUtils.createMoveToRequisitionAction(r.requisition,Urls.rest.requisitions.moveSamples(r.requisitionId))));r.worksetId&&w.push(BulkUtils.actions.moveFromWorkset("samples",Urls.rest.worksets.moveSamples(r.worksetId)));w.push({name:"Delete",action:function(v){var E=
["Are you sure you wish to delete the following samples? This cannot be undone.","Note: a Sample may only be deleted by its creator or an admin."],q=[];jQuery.each(v,function(t,z){E.push("* "+z.name+" ("+z.alias+")");q.push(z.id)});Utils.showConfirmDialog("Delete Samples","Delete",E,function(){Utils.ajaxWithDialog("Deleting Samples","POST",Urls.rest.samples.bulkDelete,q,function(){Utils.page.pageReload()})})}});return w},createStaticActions:function(r,w){var v=[];r.requisitionId&&("supplemental"===
r.relation?v.push({name:"Add",handler:function(){Constants.isDetailedSample?c(r):d()}}):"requisitioned"===r.relation&&v.push({name:"Add",handler:function(){Utils.showSearchByNamesDialog("Add Samples",Urls.rest.samples.query,function(E,q,t,z){E.length!==z.length?Utils.showSomeNotFoundError(z,E):e(E)&&b(Urls.rest.requisitions.addSamples(r.requisitionId))(E)})}}));v.push({name:"Create",handler:function(){var E=[{property:"quantity",type:"int",label:"Quantity",value:1,required:!0}];Constants.isDetailedSample&&
E.unshift({property:"sampleCategory",type:"select",label:"Sample Category",values:a(),required:!0});BulkUtils.actions.showDialogForBoxCreation("Create Samples","Create",E,Urls.ui.samples.bulkCreate,function(q){if(1>q.quantity)Utils.showOkDialog("Create Samples",["That's a peculiar number of samples to create."]);else if(q.createBox&&Constants.isDetailedSample&&"Identity"==q.sampleCategory)Utils.showOkDialog("Error",["Identities cannot be placed in boxes"]);else return{quantity:q.quantity,projectId:w,
targetCategory:Constants.isDetailedSample?q.sampleCategory:null}},function(q){return q.quantity})}});return v},createColumns:function(r,w){return[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Name",mData:"name",include:!0,iSortPriority:1,iDataSort:0,mRender:Warning.tableWarningRenderer(WarningTarget.sample,function(v){return Urls.ui.samples.edit(v.id)}),sClass:"nowrap"},ListUtils.labelHyperlinkColumn("Alias",Urls.ui.samples.edit,Utils.array.getId,"alias",0,!0),{sTitle:"External Name",mData:"effectiveExternalNames",
include:Constants.isDetailedSample},ListUtils.columns.project(w),{sTitle:"Tissue Attributes",mData:"effectiveTissueTypeAlias",include:Constants.isDetailedSample,mRender:function(v,E,q){if("display"!==E)return v;if(!v)return"n/a";v=q.effectiveTissueOriginAlias+" "+q.effectiveTissueTypeAlias;q.effectiveTimepoint&&(v=12<q.effectiveTimepoint.length?v+(" "+q.effectiveTimepoint.substring(0,12)+"\x26#8230;"):v+(" "+q.effectiveTimepoint));return'\x3cdiv class\x3d"tooltip" style\x3d"width: 100%;"\x3e\x3cspan\x3e'+
v+'\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3eTissue origin: '+q.effectiveTissueOriginAlias+" ("+q.effectiveTissueOriginDescription+")\x3cbr/\x3eTissue type: "+q.effectiveTissueTypeAlias+" ("+q.effectiveTissueTypeDescription+")\x3cbr/\x3e"+(q.effectiveTimepoint?"Timepoint: "+q.effectiveTimepoint+"\x3cbr/\x3e":"")+"\x3c/span\x3e\x3c/div\x3e"}},{sTitle:"Sample Class",mData:"sampleClassId",include:Constants.isDetailedSample,mRender:ListUtils.render.textFromId(Constants.sampleClasses,"alias","Plain"),
iSortPriority:0},{sTitle:"Type",mData:"sampleType",include:!Constants.isDetailedSample,iSortPriority:0},ListUtils.columns.detailedQcStatus,{sTitle:"Location",mData:"locationLabel",bSortable:!1,mRender:function(v,E,q){return q.boxId?"\x3ca href\x3d'"+Urls.ui.boxes.edit(q.boxId)+"'\x3e"+v+"\x3c/a\x3e":v},include:!0,iSortPriority:0},{sTitle:"Created",mData:"creationDate",sDefaultContent:"",include:Constants.isDetailedSample,iSortPriority:0},{sTitle:"Modified",mData:"lastModified",mRender:ListUtils.render.dateWithTimeTooltip,
include:Constants.isDetailedSample,iSortPriority:2},{sTitle:"Added",mData:"worksetAddedTime",sDefaultContent:"n/a",mRender:ListUtils.render.naIfNull,include:r.worksetId,bSortable:!1}]},searchTermSelector:function(r){var w=[r.id,r.barcode,r.requisition,r.entered,r.changed,r.received,r.creator,r.changedby,r.box,r.freezer,r.requisition,r.distributed,r.distributedto];r=[r.created,r["class"],r.tissueOrigin,r.tissueType,r.timepoint,r.lab,r.external,r.subproject,r.groupid,r.ghost];return Constants.isDetailedSample?
w.concat(r):w},onFirstLoad:function(r,w){w.collapseId&&!r.length&&Utils.ui.collapse("#"+w.collapseId,"#"+w.collapseId+"_arrowclick")}}}();
ListTarget.sampletype={name:"Sample Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","sample-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,headerMessage:{text:"WARNING: Adding or modifying sample types may cause your data to be invalid for ENA submission",level:"important"},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.sampletype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Sample Types",
"sampletypes",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Sample Types",Urls.ui.sampleTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:0},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.samplevalidrelationship=function(a){function b(f){if("parent"!==f&&"child"!==f)throw Error("Unhandled showSide: "+f);}function c(f,h){h="parent"===h.showSide?"parentId":"childId";return Utils.array.findUniqueOrThrow(Utils.array.idPredicate(f[h]),Constants.sampleClasses)}function d(f){switch(f){case "Identity":return[];case "Tissue":return e(["Identity","Tissue"]);case "Tissue Processing":return e(["Tissue","Tissue Processing"]);case "Stock":return e(["Tissue","Tissue Processing","Stock"]);
case "Aliquot":return e(["Stock","Aliquot"]);default:throw Error("Unhandled sample category: "+f);}}function e(f){var h=[];f.forEach(function(k){h=h.concat(Constants.sampleClasses.filter(function(l){return l.sampleCategory===k&&!l.archived}).sort(Utils.sorting.standardSort("alias")))});return h}function g(f,h){var k=a("#"+h).dataTable().fnGetData().map(function(l){return l.parentId});return f.filter(function(l){return-1===k.indexOf(l.id)})}return{name:"Sample Class Relationships",createUrl:function(f,
h){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(f,h){return f.isAdmin&&"child"!==f.showSide?[{name:"Un/Archive Relationships",action:function(k){Utils.showDialog("Un/Archive Relationships","OK",[{label:"Archived",property:"archived",type:"checkbox"}],function(l){k.forEach(function(p){p.archived=l.archived});SampleClass.updateParents(k)})}},{name:"Remove",action:function(k){SampleClass.removeParents(k)}}]:[]},createStaticActions:function(f,h){return f.isAdmin&&
"child"!==f.showSide?[{name:"Add",handler:function(){var k=f.getSampleCategory();k=d(k);k=g(k,f.listId);k.length?Utils.showWizardDialog("Add Parent Relationship",k.map(function(l){return{name:l.alias,handler:function(){var p={archived:!1};p.parentId=l.id;SampleClass.addParent(p)}}})):Utils.showOkDialog("Error",["No potential classes for new relationship"])}}]:[]},createColumns:function(f,h){b(f.showSide);return[{sTitle:"Sample Class",mData:function(k,l,p){return c(k,f).alias},include:!0,iSortPriority:1},
{sTitle:"Category",mData:function(k,l,p){return c(k,f).sampleCategory},include:!0,bSortable:!1},{sTitle:"Class Archived",mData:function(k,l,p){return c(k,f).archived},include:!0,bSortable:!1,mRender:ListUtils.render.archived},{sTitle:"Relationship Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}}}(jQuery);
ListTarget.scientificname={name:"Scientific Names",getUserManualUrl:function(){return Urls.external.userManual("type_data","scientific-names")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.scientificname.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Scientific Names","scientificnames",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Scientific Names",
Urls.ui.scientificNames.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1,bSortDirection:!0}]}};
ListTarget.sequencingcontroltype={name:"Sequencing Control Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-control-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.sequencingcontroltype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Sequencing Control Types","sequencingcontroltypes",Utils.array.getAlias));return b},createStaticActions:function(a,
b){return a.isAdmin?[ListUtils.createStaticAddAction("Sequencing Control Types",Urls.ui.sequencingControlTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",iSortPriority:1,bSortDirection:!0}]}};
ListTarget.sequencingorder={name:"Sequencing Orders",getUserManualUrl:function(){return Urls.external.userManual("sequencing_orders")},createUrl:function(a,b){throw Error("Orders can only be shown statically.");},getQueryUrl:null,createBulkActions:function(a,b){var c=Utils.array.findFirstOrNull(function(d){return d.name==a.platformType},Constants.platformTypes);return[{name:"Order More",action:function(d){Utils.showDialog("Re-order","Update",[{type:"int",label:"Extra "+c.pluralPartitionName,property:"count",
value:1}],function(e){if(isNaN(e.count)||1>e.count)Utils.showOkDialog("Error",["Number to add must be 1 or greater."]);else{var g=function(f){if(f>=d.length)Utils.page.pageReload();else{var h=JSON.parse(JSON.stringify(d[f]));h.partitions+=e.count;Utils.ajaxWithDialog("Updating Order","PUT",Urls.rest.sequencingOrders.update(d[f].id),h,function(){g(f+1)})}};g(0)}})}},ListUtils.createBulkDeleteAction("Sequencing Orders","sequencingorders",function(d){return d.pool.alias+": "+d.partitions+" partitions"})]},
createStaticActions:function(a,b){return a.pool.id?(Utils.array.findFirstOrNull(function(c){return c.name==a.platformType},Constants.platformTypes),[{name:"Create",handler:function(){Utils.page.post(Urls.ui.sequencingOrders.bulkCreate,{poolIds:a.pool.id})}}]):[]},createColumns:function(a,b){b=Utils.array.findFirstOrNull(function(c){return c.name==a.platformType},Constants.platformTypes);return[{sTitle:"Purpose",mData:"purposeAlias",include:!0,iSortPriority:0},{sTitle:"Instrument Model",mData:"parameters.instrumentModelAlias",
include:!0,iSortPriority:1},{sTitle:"Container Model",mData:"containerModelId",mRender:ListUtils.render.textFromId(Constants.containerModels,"alias","n/a")},{sTitle:"Sequencing Parameters",mData:"parameters.id",include:!0,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.sequencingParameters,"name")},{sTitle:b.pluralPartitionName,mData:"partitions",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.sequencingordercompletion={name:"Sequencing Orders",getUserManualUrl:function(){return Urls.external.userManual("sequencing_orders")},createUrl:function(a,b){return a.poolId?Urls.rest.pools.completionsDatatable(a.poolId):Urls.rest.sequencingOrders.completionsDatatable(a.slug,a.platform)},getQueryUrl:null,createBulkActions:function(a,b){return a.poolId?[]:BulkTarget.pool.getBulkActions().filter(function(c){return!c||!c.excludeOnOrders}).map(function(c){return c?{name:c.name+" (Pool)",action:function(d){c.action(d.map(function(e){return e.pool}))}}:
null})},createStaticActions:function(a,b){return[]},createColumns:function(a,b){b=function(c){return c.some(function(d){return 0!=d})};return[ListUtils.idHyperlinkColumn("Name",Urls.ui.pools.edit,"pool.id",function(c){return c.pool.name},1,!a.poolId),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.pools.edit,function(c){return c.pool.id},"pool.alias",0,!a.poolId),{sTitle:"Purpose",mData:"purpose",bSortable:!0,iSortPriority:0,include:!0},{sTitle:"Order Description",mData:"description",bSortable:!1,
iSortPriority:0,include:!0},{sTitle:"Pool Description",mData:"pool.description",mRender:Warning.tableWarningRenderer(WarningTarget.completion),bSortable:!1,iSortPriority:0,include:!a.poolId},{sTitle:"Instrument Model",mData:"parameters.instrumentModelAlias",bSortable:!1,iSortPriority:0,include:!0},{sTitle:"Longest Index",mData:"pool.longestIndex",bSortable:!1,iSortPriority:0,include:!a.poolId},{sTitle:"Container Model",mData:"containerModelAlias",mRender:ListUtils.render.naIfNull},{sTitle:"Sequencing Parameters",
mData:"parameters.name",iSortPriority:0,include:!0},{sTitle:"Completed",mData:"completed",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Failed",mData:"failed",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Requested",mData:"requested",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Running",mData:"running",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Started",mData:"started",bSortable:!1,iSortPriority:0,include:!0,
visibilityFilter:b},{sTitle:"Stopped",mData:"stopped",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Unknown",mData:"unknown",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Pending",mData:"loaded",bSortable:!1,iSortPriority:0,include:!0,visibilityFilter:b},{sTitle:"Remaining",mData:"remaining",bSortable:!1,iSortPriority:0,include:!0,mRender:function(c,d,e){return"display"===d?Math.max(0,c-e.loaded)+(e.loaded?"*":""):c}},{sTitle:"Modified",mData:"lastUpdated",
iSortPriority:2,include:!0}]},searchTermSelector:function(a){return[a.fulfilled,a.active,a.runstatus,a.changed,a.platform,a.index]}};
ListTarget.sequencingparameters={name:"Sequencing Parameters",getUserManualUrl:function(){return Urls.external.userManual("type_data","sequencing-parameters")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.sequencingparameters.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Sequencing Parameters","sequencingparameters",function(c){return c.name+" ("+c.instrumentModelAlias+
")"}));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Sequencing Parameters",Urls.ui.sequencingParameters.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:2},{sTitle:"Instrument Model",mData:"instrumentModelAlias",include:!0,iSortPriority:1}]}};
ListTarget.servicerecord={name:"Service Records",createUrl:function(a,b){throw Error("Service records must be specified statically.");},createBulkActions:function(a,b){return a.userIsAdmin?[{name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following service records? This cannot be undone."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.title+(f.referenceNumber?" ("+f.referenceNumber+")":""));e.push(f.id)});Utils.showConfirmDialog("Delete Service Records","Delete",d,function(){Utils.ajaxWithDialog("Deleting Service Records",
"POST",Urls.rest.serviceRecords.bulkDelete,e,function(){Utils.page.pageReload()})})}}]:[]},createStaticActions:function(a,b){var c=a.instrumentId?Urls.ui.instruments.createRecord(a.instrumentId):Urls.ui.freezers.createRecord(a.freezerId);return a.retired?[]:[{name:"Add",handler:function(){window.location=c}}]},createColumns:function(a,b){return[{sTitle:"Service Date",mData:"serviceDate",include:!0,iSortPriority:1},{sTitle:"Title",mData:"title",include:!0,iSortPriority:0,bSortDirection:!0,bSortable:!0,
mRender:function(c,d,e){return"display"===d?(d=a.instrumentId?Urls.ui.instruments.editRecord(a.instrumentId,e.id):Urls.ui.freezers.editRecord(a.freezerId,e.id),c?'\x3ca href\x3d"'+d+'"\x3e'+c+"\x3c/a\x3e":""):c}},{sTitle:"Position",mData:"position",include:a.hasPositions,iSortPriority:0,mRender:function(c,d,e){return c||"n/a"}},{sTitle:"Reference Number",mData:"referenceNumber",include:!0,iSortPriority:0,mRender:function(c,d,e){return c||""}},{sTitle:"Files",mData:null,include:!0,iSortPriority:0,
bSortable:!1,mRender:function(c,d,e){if(e.attachments&&e.attachments.length){if("display"===d){var g='\x3cul class\x3d"unformatted-list"\x3e';e.attachments.forEach(function(f){g+='\x3cli\x3e\x3ca href\x3d"'+Urls.ui.attachments.serviceRecord(e.id,f.id)+'"\x3e'+f.filename+"\x3c/a\x3e\x3c/li\x3e"});return g+="\x3c/ul\x3e"}return e.attachments.map(function(f){return f.filename}).join(" ")}return null}},{sTitle:"Details",mData:"details",include:!0,bVisible:!1,iSortPriority:0}]}};
ListTarget.sop={name:"SOPs",getUserManualUrl:function(){return Urls.external.userManual("type_data","standard-operating-procedures")},createUrl:function(a,b){return Urls.rest.sops.categoryDatatable(a.category)},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.sop.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("SOPs","sops",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("SOPs",
Urls.ui.sops.bulkCreate)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",iSortPriority:1,bSortDirection:!0},{sTitle:"Version",mData:"version",iSortPriority:2,bSortDirection:!0},{sTitle:"SOP",mData:"url",mRender:function(c,d,e){return"display"===d&&c?'\x3ca href\x3d"'+c+'"\x3eView SOP\x3c/a\x3e':c||""}},{sTitle:"Archived",mData:"archived",mRender:ListUtils.render.archived}]},searchTermSelector:function(a){return[a.id]}};
ListTarget.stain={name:"Stains",getUserManualUrl:function(){return Urls.external.userManual("type_data","stains")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.stain.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Stains","stains",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Stains",Urls.ui.stains.bulkCreate,
!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:0},{sTitle:"Category",mData:"categoryName",include:!0,iSortPriority:0}]}};
ListTarget.staincategory={name:"Stain Categories",getUserManualUrl:function(){return Urls.external.userManual("type_data","stains")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.staincategory.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Stain Categories","staincategories",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Stain Categories",
Urls.ui.stainCategories.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:0}]}};
ListTarget.storage_location={name:"Storage Locations",getUserManualUrl:function(){return Urls.external.userManual("freezers_and_rooms")},createUrl:function(a,b){throw Error("Storage locations must be specified statically.");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction(a.slug[0].toUpperCase()+a.slug.slice(1),"storagelocations",function(c){return c.alias})]:[]},createStaticActions:function(a,b){switch(a.slug){case "rooms":return[{name:"Add",handler:function(){Freezer.addRoomWithCallback(Utils.page.pageReload)}}];
case "freezers":return[{name:"Add",handler:function(){window.location=Urls.ui.freezers.create}}];default:return[]}},createColumns:function(a,b){b=["freezers"==a.slug?ListUtils.labelHyperlinkColumn("Alias",Urls.ui.freezers.edit,Utils.array.getId,"alias",1,!0):{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Identification Barcode",mData:"identificationBarcode",include:!0,iSortPriority:0},{sTitle:"Probe ID",mData:"probeId",include:!0,iSortPriority:0}];"freezers"==a.slug&&(b.push({sTitle:"Status",
mData:"retired",include:!0,mRender:function(c,d,e){return e.outOfService?"Out of Service":c?"Retired":"Production"}}),b.push({sTitle:"Map",mData:"mapFilename",include:!0,iSortPriority:0,mRender:function(c,d,e){return"display"===d&&c?'\x3ca href\x3d"'+Urls.ui.freezerMaps.view(c,e.mapAnchor)+'"\x3eView Map\x3c/a\x3e':c||""}}));return b}};
ListTarget.storagelabel=function(){return{name:"Storage Labels",getUserManualUrl:function(){return Urls.external.userManual("type_data","storage-labels")},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.storagelabel.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Storage Labels","storagelabels",Utils.array.get("label")));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Storage Labels",Urls.ui.storageLabels.bulkCreate,
!0)]:[]},createColumns:function(a,b){return[{sTitle:"Label",mData:"label",include:!0,iSortPriority:1,bSortDirection:!0}]}}}();
ListTarget.study={name:"Studies",getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","studies")},createUrl:function(a,b){return b?Urls.rest.studies.projectDatatable(b):Urls.rest.studies.datatable},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Studies","studies",Utils.array.getAlias)]:[]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location=b?Urls.ui.studies.createInProject(b):
Urls.ui.studies.create}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("Name",Urls.ui.studies.edit,"id",Utils.array.getName,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.studies.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Type",mData:"studyTypeId",include:!0,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.studyTypes,"name")}]}};
ListTarget.studytype={name:"Study Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","study-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,headerMessage:{text:"WARNING: Adding or modifying study types may cause your data to be invalid for ENA submission",level:"important"},showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.studytype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Study Types",
"studytypes",Utils.array.getName));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Study Types",Urls.ui.studyTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:1}]}};
ListTarget.submission={name:"Submissions",getUserManualUrl:function(){return Urls.external.userManual("european_nucleotide_archive_support","submissions")},createUrl:function(a,b){throw Error("Submissions must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){return a.isAdmin?[ListUtils.createBulkDeleteAction("Submissions","submissions",Utils.array.getAlias)]:[]},createStaticActions:function(a,b){return[]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",
Urls.ui.submissions.edit,"id",Utils.array.getId,1,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.submissions.edit,Utils.array.getId,"alias",0,!0),{sTitle:"Created",mData:"creationDate",include:!0,iSortPriority:0},{sTitle:"Submission Date",mData:"submittedDate",include:!0,iSortPriority:0},{sTitle:"Verified",mData:"verified",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Completed",mData:"completed",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks}]}};
ListTarget.subproject={name:"Subprojects",getUserManualUrl:function(){return Urls.external.userManual("projects","subprojects")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,createBulkActions:function(a,b){b=BulkTarget.subproject.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Subprojects","subprojects",Utils.array.getAlias));return b},createStaticActions:function(a,b){return[{name:"Add",handler:function(){Utils.showDialog("Create Subprojects",
"Create",[{property:"quantity",type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Subprojects",["That's a peculiar number of subprojects to create."]):window.location=Urls.ui.subprojects.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Project",mData:"parentProjectId",include:!0,iSortPriority:0,mRender:function(c,d,e){e=Utils.array.maybeGetProperty(Utils.array.findFirstOrNull(Utils.array.idPredicate(c),
a.projects),"title")||"Unknown";return"display"===d?'\x3ca href\x3d"'+Urls.ui.projects.edit(c)+'"\x3e'+e+"\x3c/a\x3e":e}},{sTitle:"Priority",mData:"priority",include:!0,iSortPriority:0,mRender:ListUtils.render.booleanChecks},{sTitle:"Reference Genome",mData:"referenceGenomeId",include:!0,iSortPriority:0,mRender:ListUtils.render.textFromId(Constants.referenceGenomes,"alias")}]}};
var Subproject=Subproject||{filterSamples:function(a,b,c){var d=jQuery("#"+b).closest(".expandable_section");d.is(":hidden")&&jQuery("#"+a).closest(".sectionDivider").click();Utils.ui.filterTable(b,"subproject",c);d[0].scrollIntoView()}};
ListTarget.targetedsequencing={name:"Targeted Sequencing",getUserManualUrl:function(){return Urls.external.userManual("type_data","targeted-sequencing")},createUrl:function(a,b){return Urls.rest.targetedSequencings[a.add?"kitAvailableDatatable":"kitIncludedDatatable"](a.kitDescriptorId)},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a){if(a.kitDescriptorId)return a.isAdmin?[{name:a.add?"Associate":"Dissociate",action:function(c){var d={};d[a.add?"add":"remove"]=c.map(Utils.array.getId);
d[a.add?"remove":"add"]=[];Utils.ajaxWithDialog("Changing associated Targeted Sequencing panels","PUT",Urls.rest.kitDescriptors.updateTargetedSequencings(a.kitDescriptorId),d,Utils.page.pageReload)}}]:[];var b=BulkTarget.targetedsequencing.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Targeted Sequencings","targetedsequencings",Utils.array.getAlias));return b},createStaticActions:function(a){return a.isAdmin?[ListUtils.createStaticAddAction("Targeted Sequencings",Urls.ui.targetedSequencings.bulkCreate,
!0)]:[]},createColumns:function(a){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Archived",mData:"archived",mRender:function(b,c,d){return b?"Yes":"No"},include:!0,iSortPriority:0}]}};
ListTarget.tissuematerial={name:"Tissue Materials",getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-materials")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.tissuematerial.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Tissue Materials","tissuematerials",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",
handler:function(){Utils.showDialog("Create Tissue Materials","Create",[{property:"quantity",type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Tissue Materials",["That's a peculiar number of tissuematerials to create."]):window.location=Urls.ui.tissueMaterials.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:0}]}};
ListTarget.tissueorigin={name:"Tissue Origins",getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-origins")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.tissueorigin.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Tissue Origins","tissueorigins",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[{name:"Add",
handler:function(){Utils.showDialog("Create Tissue Origins","Create",[{property:"quantity",type:"int",label:"Quantity",value:1}],function(c){1>c.quantity?Utils.showOkDialog("Create Tissue Origins",["That's a peculiar number of tissueorigins to create."]):window.location=Urls.ui.tissueOrigins.bulkCreate+"?"+Utils.page.param({quantity:c.quantity})})}}]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:0},{sTitle:"Description",mData:"description",include:!0,
iSortPriority:0}]}};
ListTarget.tissuepiecetype={name:"Tissue Piece Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-piece-types")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.tissuepiecetype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Tissue Piece Types","tissuepiecetypes",function(c){return c.name}));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Tissue Piece Types",Urls.ui.tissuePieceTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Name",mData:"name",include:!0,iSortPriority:2},{sTitle:"Abbreviation",mData:"abbreviation",include:!0,iSortPriority:0},{sTitle:"Archived",mData:"archived",include:!0,iSortPriority:0,mRender:ListUtils.render.archived}]}};
ListTarget.tissuetype={name:"Tissue Types",getUserManualUrl:function(){return Urls.external.userManual("type_data","tissue-types")},createUrl:function(a,b){throw Error("Must be provided statically");},queryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.tissuetype.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Tissue Types","tissuetypes",function(c){return c.alias+" ("+c.description+")"}));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Tissue Types",Urls.ui.tissueTypes.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};
ListTarget.transfer=function(){function a(c){return c.senderLabLabel?b("Receipt",c.senderLabLabel,c.recipientGroupName,c.items):c.recipient?b("Distribution",c.senderGroupName,c.recipient,c.items):b("Internal",c.senderGroupName,c.recipientGroupName,c.items)}function b(c,d,e,g){return c+": "+d+" \u2192 "+e+" ("+g+" items)"}return{name:"Transfers",getUserManualUrl:function(){return Urls.external.userManual("transfers")},createUrl:function(c,d){return Urls.rest.transfers.datatable(c.tab)},createBulkActions:function(c,
d){return[ListUtils.createBulkDeleteAction("Transfers","transfers",a)]},createStaticActions:function(c,d){return[{name:"Add",handler:function(){var e={};if(c.sampleId)e.sampleIds=c.sampleId;else if(c.libraryId)e.libraryIds=c.libraryId;else if(c.libraryAliquotId)e.libraryAliquotIds=c.libraryAliquotId;else if(c.poolId)e.poolIds=c.poolId;else{window.location=Urls.ui.transfers.create;return}window.location=Urls.ui.transfers.create+"?"+Utils.page.param(e)}}]},createColumns:function(c,d){return[ListUtils.idHyperlinkColumn("ID",
Urls.ui.transfers.edit,"id",Utils.array.getId,0,!0),{sTitle:"Items",mData:"items",bSortable:!1},{sTitle:"Projects",mData:"projects",bSortable:!1},{sTitle:"Sender",mData:function(e,g){return e.senderLabLabel||e.senderGroupName},bSortable:!1},{sTitle:"Recipient",mData:function(e,g){return e.recipient||e.recipientGroupName},bSortable:!1},{sTitle:"Transfer Time",mData:"transferTime",mRender:ListUtils.render.dateWithTimeTooltip},{sTitle:"Received",mData:"received",mRender:function(e,g,f){return f.received+
"/"+f.items+" ("+f.receiptPending+" pending)"},bSortable:!1},{sTitle:"QC Passed",mData:"qcPassed",mRender:function(e,g,f){return f.qcPassed+"/"+f.items+" ("+f.qcPending+" pending)"},bSortable:!1},{sTitle:"Modified",mData:"lastModified",iSortPriority:1}]},searchTermSelector:function(c){return[c.id,c.project,c.subproject,c.entered,c.creator,c.changed,c.changedby]}}}();
ListTarget.transferitem=function(){function a(l){switch(l.type){case "Sample":return Urls.ui.samples.edit(l.id);case "Library":return Urls.ui.libraries.edit(l.id);case "Library Aliquot":return Urls.ui.libraryAliquots.edit(l.id);case "Pool":return Urls.ui.pools.edit(l.id);default:throw Error("Unhandled transfer item type: "+l.type);}}function b(l,p,r,w){return{name:l,handler:function(){Utils.showSearchByNamesDialog(p,r,function(v){var E=[];Transfer.getItems().forEach(function(q){-1!==v.map(Utils.array.getId).indexOf(q.id)&&
E.push(q)});E.length?Utils.showOkDialog("Error",["The following items are already included in this transfer:"].concat(E.map(function(q){return"* "+q.name+" ("+q.alias+")"}))):Transfer.addItems(v.map(function(q){w=w||c(q.entityType);return{type:w,id:q.id,name:q.name,alias:q.alias,boxId:q.box?q.box.id:null,boxAlias:q.box?q.box.alias:null,boxPosition:q.boxPosition,received:null,qcPassed:null,qcNote:null}}))})}}}function c(l){switch(l){case "SAMPLE":return"Sample";case "LIBRARY":return"Library";case "LIBRARY_ALIQUOT":return"Library Aliquot";
case "POOL":return"Pool";default:throw Error("Invalid entity type");}}function d(l,p,r,w){var v="qcPassed"===r;return function(E){var q=[e(p,"value")];v&&q.push({label:"QC Note",property:"qcNote",type:"text"});Utils.showDialog(l,"Update",q,function(t){if(v){if(!1===t.value&&!t.qcNote){Utils.showOkDialog("Error",["QC note is required when QC is failed"]);return}if(!(new RegExp(Utils.validation.sanitizeRegex)).test(t.qcNote)){Utils.showOkDialog("Error",["QC note contains invalid characters"]);return}}E.forEach(function(z){z[r]=
t.value;v&&(z.qcNote=t.qcNote)});Transfer.updateItems(E)})}}function e(l,p){return{label:l,property:p,type:"select",values:[!0,!1,null],getLabel:function(r){switch(r){case !0:return"Yes";case !1:return"No";case null:return"Unknown"}},value:"Yes"}}function g(l,p,r){Utils.showDialog("Box Search","Search",[{label:"Box Name, Alias, or Barcode",property:"query",type:"text"}],function(w){f(w.query,l,p,r)})}function f(l,p,r,w){Utils.ajaxWithDialog("Searching for Boxes","GET",Urls.rest.boxes.searchPartial+
"?"+Utils.page.param({q:l,b:!0}),null,function(v){Utils.showWizardDialog("Add to Box",v.map(function(E){return{name:E.name+" - "+E.alias,handler:function(){Utils.showDialog("Add to Box","Add",p.map(function(q){return{label:q.name+" - "+q.alias,property:q.name+"Position",type:"select",values:[null].concat(Utils.getEmptyBoxPositions(E)),getLabel:function(t){return t||"n/a"}}}),function(q){var t=function(){p.forEach(function(z){q[z.name+"Position"]?(z.boxId=E.id,z.boxAlias=E.alias,z.boxPosition=q[z.name+
"Position"]):(z.boxId=null,z.boxAlias=null,z.boxPosition=null)});w&&w()};r?h(p,t):(t(),Transfer.updateItems(p))})}}}))})}function h(l,p){Utils.ajaxWithDialog("Finding Storage","GET",Urls.rest.storageLocations.freezers,null,function(r){Utils.showDialog("Set Box Location","Next",[{label:"Barcode",property:"barcode",type:"text"},{label:"or Select",property:"freezer",type:"select",values:r,getLabel:function(w){return w.fullDisplayLocation}}],function(w){w.barcode?k(Urls.rest.storageLocations.queryByBarcode+
"?"+Utils.page.params({q:w.barcode}),l,p):w.freezer?k(Urls.rest.storageLocations.children(w.freezer.id),l,p):Utils.showOkDialog("Error",["Must select a freezer or location barcode"])})})}function k(l,p,r){Utils.ajaxWithDialog("Finding Storage","GET",l,null,function(w){!w||Array.isArray(w)&&!w.length?Utils.showOkDialog("Error",["No storage found"]):(Array.isArray(w)||(w=[w]),w.sort(Utils.sorting.standardSort("displayLocation")),Utils.showWizardDialog("Set Box Location",w.map(function(v){return{name:v.displayLocation+
(v.availableStorage?"*":""),handler:function(){v.availableStorage?(p.forEach(function(E){E.newBoxLocationId=v.id}),r(),Transfer.updateItems(p)):k(Urls.rest.storageLocations.children(v.id),p,r)}}})))})}return{name:"Items",createUrl:function(l,p){throw Error("Must be provided statically");},createBulkActions:function(l,p){p=[];l.editSend&&p.push({name:"Remove",action:function(r){Transfer.removeItems(r)}});l.editReceipt&&p.push({name:"Set Received",action:d("Mark Item Receipt","Received","received")},
{name:"Set QC",action:d("Mark Item QC","QC Passed","qcPassed")},{name:"Set Location",action:function(r){Utils.showDialog("Box Search","Search",[{label:"Name, Alias, or Barcode",property:"query",type:"text"}],function(w){w.query?f(w.query,r):Utils.showConfirmDialog("Remove from Box","Remove",["Remove selected items from their current box locations?"],function(){r.forEach(function(v){v.boxId=null;v.boxAlias=null;v.boxPosition=null});Transfer.updateItems(r)})})}},{name:"Receipt Wizard",action:function(r){Utils.showDialog("Receipt Wizard",
"OK",[e("Received","received"),e("QC Passed","qcPassed"),{label:"QC Note",property:"qcNote",type:"text"},{label:"Move items to another box",property:"moveItems",type:"checkbox"},{label:"Move box to another freezer",property:"moveBox",type:"checkbox"}],function(w){if(!1!==w.qcPassed||w.qcNote)if((new RegExp(Utils.validation.sanitizeRegex)).test(w.qcNote)){var v=function(){r.forEach(function(E){E.received=w.received;E.qcPassed=w.qcPassed;E.qcNote=w.qcNote})};w.moveItems?g(r,w.moveBox,v):w.moveBox?h(r,
v):(v(),Transfer.updateItems(r))}else Utils.showOkDialog("Error",["QC note contains invalid characters"]);else Utils.showOkDialog("Error",["QC note is required when QC is failed"])})}});0===p.length&&p.push(null);return p},createStaticActions:function(l,p){return l.editSend?[{name:"Add",handler:function(){Utils.showWizardDialog("Add Items",[b("Samples","Add Samples",Urls.rest.samples.query,"Sample"),b("Libraries","Add Libraries",Urls.rest.libraries.query,"Library"),b("Library Aliquots","Add Library Aliquots",
Urls.rest.libraryAliquots.query,"Library Aliquot"),b("Pools","Add Pools",Urls.rest.pools.query,"Pool"),b("Boxes","Add Items from Boxes",Urls.rest.boxables.queryByBox)])}}]:[]},createColumns:function(l,p){return[{sTitle:"Type",mData:"type",include:!0,iSortPriority:1},{sTitle:"Name",mData:"id",mRender:function(r,w,v){return"display"===w?r?'\x3ca href\x3d"'+a(v)+'"\x3e'+v.name+"\x3c/a\x3e":"":r},include:!0,iSortPriority:2},{sTitle:"Alias",mData:"alias",mRender:function(r,w,v){return"display"===w?r?'\x3ca href\x3d"'+
a(v)+'"\x3e'+r+"\x3c/a\x3e":"":r},include:!0,iSortPriority:0},{sTitle:"Received",mData:"received",mRender:ListUtils.render.booleanChecks,include:!0,iSortPriority:0},{sTitle:"Location",mData:"boxId",mRender:function(r,w,v){return"display"===w?r?"\x3ca href\x3d'"+Urls.ui.boxes.edit(r)+"'\x3e"+v.boxAlias+" "+v.boxPosition+"\x3c/a\x3e":v.boxAlias?v.boxAlias+" "+v.boxPosition:"Unknown":r},include:!0,bSortable:!1},{sTitle:"QC Passed",mData:"qcPassed",mRender:ListUtils.render.booleanChecks,include:!0,iSortPriority:0},
{sTitle:"QC Note",mData:"qcNote",include:!0,iSortPriority:0}]}}}();
ListTarget.transfernotification=function(a){function b(c,d){Utils.showConfirmDialog("Send Notification","Accept and send",["By choosing to proceed, you acknowledge that details of the items included in this transfer will be sent to "+Contacts.makeContactLabel(c.name,c.email)+", and accept responsibility for the transmission."],function(){var e={recipientName:c.name,recipientEmail:c.email},g=Urls.rest.transfers.addNotification(d.transferId)+"?"+Utils.page.param({saveContact:!!c.save});Utils.ajaxWithDialog("Adding Notification",
"POST",g,e,function(f){Transfer.addNotification(f)})})}return{name:"Transfer Notifications",createUrl:function(c,d){throw Error("Must be provided statically");},createBulkActions:function(c,d){return[{name:"Cancel",action:function(e){if(e.some(function(f){return"boolean"===typeof f.sendStatus}))Utils.showOkDialog("Error",["Cannot cancel notifications that have already been sent"]);else{var g=e.map(function(f){return f.id});Utils.ajaxWithDialog("Cancelling...","POST",Urls.rest.transfers.bulkDeleteNotifications(c.transferId),
g,function(){var f=Transfer.getNotifications().filter(function(h){return-1===g.indexOf(h.id)});Transfer.setNotifications(f);Utils.showOkDialog("Cancelled",["Notification"+(1<g.length?"s":"")+" cancelled."])})}}},{name:"Resend",action:function(e){1<e.length?Utils.showOkDialog("Error",["Only one notification can be resent at a time."]):Utils.ajaxWithDialog("Submitting...","POST",Urls.rest.transfers.resendNotification(c.transferId,e[0].id),null,function(g){Transfer.addNotification(g)})}}]},createStaticActions:function(c,
d){return[{name:"Add",handler:function(){Contacts.selectContactDialog(!0,!0,function(e){b(e,c)})}}]},createColumns:function(c,d){return[{sTitle:"Sender",mData:"senderName"},{sTitle:"Recipient",mData:"recipientName"},{sTitle:"Address",mData:"recipientEmail"},{sTitle:"Status",mData:"sendSuccess",mRender:function(e,g,f){return!0===e?"Sent":!1===e?"Failed":"Pending"}}]}}}(jQuery);
ListTarget.user={name:"Users",getUserManualUrl:function(){return Urls.external.userManual("users_and_groups","users")},createUrl:function(a,b){throw Error("Static data only");},getQueryUrl:null,createBulkActions:function(a,b){switch(a.listMode){case "list":return a.isAdmin?[ListUtils.createBulkDeleteAction("Users","users",function(c){return c.fullName})]:[];case "included":return[{name:"Remove",action:function(c){c.length?Utils.showConfirmDialog("Remove Users","Remove",["Remove "+(1==c.length?"selected user":
c.length+" selected users")+" from the group?"],function(){var d=Urls.rest.groups.removeUsers(a.groupId),e=c.map(Utils.array.getId);Utils.ajaxWithDialog("Removing Users","POST",d,e,Utils.page.pageReload)}):Utils.showOkDialog("Error","No users selected")}}];case "available":return[{name:"Add",action:function(c){if(c.length){var d=Urls.rest.groups.addUsers(a.groupId);c=c.map(Utils.array.getId);Utils.ajaxWithDialog("Adding Users","POST",d,c,Utils.page.pageReload)}else Utils.showOkDialog("Error","No users selected")}}];
default:throw Error("Unknown listMode: "+a.listMode);}},createStaticActions:function(a,b){return"list"===a.listMode&&a.isAdmin&&a.allowCreateUser?[{name:"Add",handler:function(){window.location=Urls.ui.users.create}}]:[]},createColumns:function(a,b){b=function(c,d,e,g){return{sTitle:c,mData:d,include:g,iSortPriority:e,mRender:function(f,h,k){return f?"\u2714":""}}};return[{sTitle:"Login Name",mData:"loginName",include:!0,iSortPriority:1,mRender:function(c,d,e){return a.isAdmin?'\x3ca href\x3d"'+Urls.ui.users.edit(e.id)+
'"\x3e'+c+"\x3c/a\x3e":c}},{sTitle:"Full Name",mData:"fullName",include:!0,iSortPriority:0},b("Active","active",0,!0),b("Admin","admin",0,!0),b("Internal","internal",0,!0),b("Logged In","loggedIn",2,"list"===a.listMode)]}};
ListTarget.worksetcategory={name:"Workset Categories",getUserManualUrl:function(){return Urls.external.userManual("type_data","workset-categories")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.worksetcategory.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Workset Categories","worksetcategories",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?
[ListUtils.createStaticAddAction("Workset Categories",Urls.ui.worksetCategories.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1,bSortDirection:!0}]}};
ListTarget.workset={name:"Worksets",getUserManualUrl:function(){return Urls.external.userManual("worksets")},createUrl:function(a,b){return Urls.rest.worksets.categoryDatatable(a.category)},createBulkActions:function(a,b){return[{name:"Merge",action:function(c){Utils.showDialog("New Workset","Create",[{label:"Alias",property:"alias",type:"text",required:!0},{label:"Description",property:"description",type:"textarea",rows:3,required:!1}],function(d){var e={ids:c.map(Utils.array.getId),alias:d.alias,
description:d.description};Utils.ajaxWithDialog("Merging Worksets","POST",Urls.rest.worksets.merge,e,function(g){Utils.showOkDialog("Merged Worksets",["New workset '"+d.alias+"' created."],function(){Utils.page.pageRedirect(Urls.ui.worksets.edit(g.id))})})})}},{name:"Delete",action:function(c){var d=["Are you sure you wish to delete the following Worksets? This cannot be undone.","Note: a Workset may only be deleted by its creator or an admin."],e=[];jQuery.each(c,function(g,f){d.push("* "+f.alias);
e.push(f.id)});Utils.showConfirmDialog("Delete Worksets","Delete",d,function(){Utils.ajaxWithDialog("Deleting Worksets","POST",Urls.rest.worksets.bulkDelete,e,Utils.page.pageReload)})}}]},createStaticActions:function(a,b){return[{name:"Add",handler:function(){window.location=Urls.ui.worksets.create}}]},createColumns:function(a,b){return[ListUtils.idHyperlinkColumn("ID",Urls.ui.worksets.edit,"id",Utils.array.getId,0,!0),ListUtils.labelHyperlinkColumn("Alias",Urls.ui.worksets.edit,Utils.array.getId,
"alias",0,!0),{sTitle:"Items",mData:"itemCount",include:!0,iSortPriority:0},{sTitle:"Stage",mData:"stage",sDefaultContent:""},{sTitle:"Description",mData:"description",include:!0,iSortPriority:0},{sTitle:"Creator",mData:"creator",include:"all"===a.creator,iSortPriority:0},{sTitle:"Modified",mData:"lastModified",include:!0,iSortPriority:1}]},searchTermSelector:function(a){return[a.id,a.stage,a.entered,a.changed,a.creator,a.changedby]}};
ListTarget.worksetstage={name:"Workset Stages",getUserManualUrl:function(){return Urls.external.userManual("type_data","workset-stages")},createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.worksetstage.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Workset Stages","worksetstages",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Workset Stages",
Urls.ui.worksetStages.bulkCreate,!0)]:[]},createColumns:function(a,b){return[{sTitle:"Alias",mData:"alias",include:!0,iSortPriority:1,bSortDirection:!0}]}};
ListTarget.workstation={name:"Workstations",createUrl:function(a,b){throw Error("Must be provided statically");},getQueryUrl:null,showNewOptionSop:!0,createBulkActions:function(a,b){b=BulkTarget.workstation.getBulkActions(a);a.isAdmin&&b.push(ListUtils.createBulkDeleteAction("Workstations","workstations",Utils.array.getAlias));return b},createStaticActions:function(a,b){return a.isAdmin?[ListUtils.createStaticAddAction("Workstations",Urls.ui.workstations.bulkCreate,!0)]:[]},createColumns:function(a,
b){return[ListUtils.labelHyperlinkColumn("Alias",Urls.ui.workstations.edit,Utils.array.getId,"alias",1,!0),{sTitle:"Description",mData:"description",include:!0,iSortPriority:0}]}};var timeout=500,closetimer=0,ddmenuitem=0;function mopen(a){mcancelclosetime();ddmenuitem&&(ddmenuitem.style.visibility="hidden");ddmenuitem=document.getElementById(a);ddmenuitem.style.visibility="visible"}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden")}
function mclosetime(){closetimer=window.setTimeout(mclose,timeout)}function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}document.onclick=mclose;
(function(a){a.fn.drag_drop_selectable=function(c){a.fn.captureKeys();var d=a.extend({},a.fn.drag_drop_selectable.defaults,c||{});return a(this).each(function(e){e=a(this);var g=a.fn.drag_drop_selectable.unique++;a.fn.drag_drop_selectable.stack[g]={selected:[],all:[]};e.attr("dds",g);a.fn.drag_drop_selectable.settings[g]=d;e.find("li").each(function(){var f=a(this),h=a.fn.drag_drop_selectable.unique++;f.attr("dds",h);a.fn.drag_drop_selectable.stack[g].all.push(h);a(this).bind("click.dds_select",function(k){a.fn.isPressed(b)||
1==a.fn.drag_drop_selectable.stack[a.fn.drag_drop_selectable.getListId(a(this).attr("dds"))].selected.length&&a(this).hasClass("dds_selected")?a.fn.drag_drop_selectable.toggle(h):a.fn.drag_drop_selectable.replace(h)}).bind("dds.select",function(){a(this).addClass("dds_selected").addClass(a.fn.drag_drop_selectable.settings[a.fn.drag_drop_selectable.getListId(a(this).attr("dds"))].selectClass)}).bind("dds.deselect",function(){a(this).removeClass("dds_selected").removeClass(a.fn.drag_drop_selectable.settings[a.fn.drag_drop_selectable.getListId(a(this).attr("dds"))].selectClass)}).css({cursor:"pointer"})}).draggable({helper:function(){jQueryclicked=
a(this);jQueryclicked.hasClass("dds_selected")||jQueryclicked.trigger("click.dds_select");var f=a.fn.drag_drop_selectable.getListId(jQueryclicked.attr("dds")),h=a('\x3cdiv dds_list\x3d"'+f+'"\x3e\x3cdiv style\x3d"margin-top:-'+a.fn.drag_drop_selectable.getMarginForDragging(jQueryclicked)+'px;" /\x3e\x3c/div\x3e').append(a.fn.drag_drop_selectable.getSelectedForDragging(jQueryclicked.attr("dds")));a.fn.drag_drop_selectable.getListItems(f).filter(".dds_selected").addClass(a.fn.drag_drop_selectable.settings[f].ghostClass);
return h},distance:5,revert:"invalid",cursor:"move",stop:function(f,h){f=a.fn.drag_drop_selectable.getListId(jQueryclicked.attr("dds"));a.fn.drag_drop_selectable.getListItems(f).filter(".dds_selected").removeClass(a.fn.drag_drop_selectable.settings[f].ghostClass)}});e.droppable({drop:function(f,h){var k=parseInt(h.helper.attr("dds_list"));h.helper.find("li.dds_selected").each(function(){var l=parseInt(a(this).attr("dds_drag"));a.fn.drag_drop_selectable.moveBetweenLists(l,k,g)});a.fn.drag_drop_selectable.settings[k]&&
"function"==typeof a.fn.drag_drop_selectable.settings[k].onListChange&&setTimeout(function(){a.fn.drag_drop_selectable.settings[k].onListChange(a("ul[dds\x3d"+k+"]"))},50);a.fn.drag_drop_selectable.settings[g]&&"function"==typeof a.fn.drag_drop_selectable.settings[g].onListChange&&setTimeout(function(){a.fn.drag_drop_selectable.settings[g].onListChange(a("ul[dds\x3d"+g+"]"))},50)},accept:function(f){return a.fn.drag_drop_selectable.getListId(f.attr("dds"))==a(this).attr("dds")?!1:!0},hoverClass:a.fn.drag_drop_selectable.settings[g].hoverClass,
tolerance:"pointer"})})};a.fn.drag_drop_selectable.moveBetweenLists=function(c,d,e){a.fn.drag_drop_selectable.deselect(parseInt(c));a.fn.drag_drop_selectable.stack[d].all.splice(a.inArray(parseInt(c),a.fn.drag_drop_selectable.stack[d].all),1);a.fn.drag_drop_selectable.stack[e].all.push(parseInt(c));a("ul[dds\x3d"+d+"]").find("li[dds\x3d"+c+"]").removeClass(a.fn.drag_drop_selectable.settings[d].ghostClass).appendTo(a("ul[dds\x3d"+e+"]"))};a.fn.drag_drop_selectable.getSelectedForDragging=function(c){var d=
a.fn.drag_drop_selectable.getListId(c);return a.fn.drag_drop_selectable.getListItems(d).clone().each(function(){a(this).not(".dds_selected").css({visibility:"hidden"});a(this).filter(".dds_selected").addClass(a.fn.drag_drop_selectable.settings[d].moveClass).css({opacity:a.fn.drag_drop_selectable.settings[d].moveOpacity});a(this).attr("dds_drag",a(this).attr("dds"));a(this).attr("dds","")})};a.fn.drag_drop_selectable.getMarginForDragging=function(c){var d=c.position().top;c=a.fn.drag_drop_selectable.getListItems(a.fn.drag_drop_selectable.getListId(c.attr("dds"))).eq(0).position().top;
return d-c};a.fn.drag_drop_selectable.toggle=function(c){a.fn.drag_drop_selectable.isSelected(c)?a.fn.drag_drop_selectable.deselect(c):a.fn.drag_drop_selectable.select(c)};a.fn.drag_drop_selectable.select=function(c){if(!a.fn.drag_drop_selectable.isSelected(c)){var d=a.fn.drag_drop_selectable.getListId(c);a.fn.drag_drop_selectable.stack[d].selected.push(c);a("[dds\x3d"+c+"]").trigger("dds.select")}};a.fn.drag_drop_selectable.deselect=function(c){if(a.fn.drag_drop_selectable.isSelected(c)){var d=a.fn.drag_drop_selectable.getListId(c);
a.fn.drag_drop_selectable.stack[d].selected.splice(a.inArray(c,a.fn.drag_drop_selectable.stack[d].selected),1);a("[dds\x3d"+c+"]").trigger("dds.deselect")}};a.fn.drag_drop_selectable.isSelected=function(c){return a("li[dds\x3d"+c+"]").hasClass("dds_selected")};a.fn.drag_drop_selectable.replace=function(c){var d=a.fn.drag_drop_selectable.getListId(c);a.fn.drag_drop_selectable.selectNone(d);a.fn.drag_drop_selectable.stack[d].selected.push(c);a("[dds\x3d"+c+"]").trigger("dds.select")};a.fn.drag_drop_selectable.selectNone=
function(c){a.fn.drag_drop_selectable.getListItems(c).each(function(){a.fn.drag_drop_selectable.deselect(a(this).attr("dds"))});return!1};a.fn.drag_drop_selectable.selectAll=function(c){a.fn.drag_drop_selectable.getListItems(c).each(function(){a.fn.drag_drop_selectable.select(a(this).attr("dds"))});return!1};a.fn.drag_drop_selectable.selectInvert=function(c){a.fn.drag_drop_selectable.getListItems(c).each(function(){a.fn.drag_drop_selectable.toggle(a(this).attr("dds"))});return!1};a.fn.drag_drop_selectable.getListItems=
function(c){return a("ul[dds\x3d"+c+"] li")};a.fn.drag_drop_selectable.getListId=function(c){return parseInt(a("li[dds\x3d"+c+"]").parent("ul").eq(0).attr("dds"))};a.fn.drag_drop_selectable.serializeArray=function(c){var d=[];a.fn.drag_drop_selectable.getListItems(c).each(function(){d.push(a(this).attr("id"))});return d};a.fn.drag_drop_selectable.serialize=function(c){return a.fn.drag_drop_selectable.serializeArray(c).join(", ")};a.fn.drag_drop_selectable.unique=0;a.fn.drag_drop_selectable.stack=
[];a.fn.drag_drop_selectable.defaults={moveOpacity:.8,ghostClass:"dds_ghost",hoverClass:"dds_hover",moveClass:"dds_move",selectedClass:"dds_selected",onListChange:function(c){console.log(c.attr("id"))}};a.fn.drag_drop_selectable.settings=[];a.extend({dds:{selectAll:function(c){return a.fn.drag_drop_selectable.selectAll(a("#"+c).attr("dds"))},selectNone:function(c){return a.fn.drag_drop_selectable.selectNone(a("#"+c).attr("dds"))},selectInvert:function(c){return a.fn.drag_drop_selectable.selectInvert(a("#"+
c).attr("dds"))},serialize:function(c){return a.fn.drag_drop_selectable.serialize(a("#"+c).attr("dds"))}}});var b=17;a.fn.captureKeys=function(){a.fn.captureKeys.capturing||a(document).keydown(function(c){c.keyCode==b&&(a.fn.captureKeys.stack.CTRL_KEY=!0);16==c.keyCode&&(a.fn.captureKeys.stack.SHIFT_KEY=!0);18==c.keyCode&&(a.fn.captureKeys.stack.ALT_KEY=!0);92==c.keyCode&&(a.fn.captureKeys.stack.META_KEY=!0)}).keyup(function(c){c.keyCode==b&&(a.fn.captureKeys.stack.CTRL_KEY=!1);16==c.keyCode&&(a.fn.captureKeys.stack.SHIFT_KEY=
!1);18==c.keyCode&&(a.fn.captureKeys.stack.ALT_KEY=!1);92==c.keyCode&&(a.fn.captureKeys.stack.META_KEY=!1)})};a.fn.captureKeys.stack={CTRL_KEY:!1,SHIFT_KEY:!1,ALT_KEY:!1,META_KEY:!1};a.fn.captureKeys.capturing=!1;a.fn.isPressed=function(c){switch(c){case b:return a.fn.captureKeys.stack.CTRL_KEY;case 18:return a.fn.captureKeys.stack.ALT_KEY;case 16:return a.fn.captureKeys.stack.SHIFT_KEY;case 92:return a.fn.captureKeys.stack.META_KEY;default:return!1}}})(jQuery);
jQuery(function(){mychange=function(a){jQuery("#"+a.attr("id")+"_serialised").html(jQuery.dds.serialize(a.attr("id")))};jQuery(".dd").find("ul").drag_drop_selectable({onListChange:mychange});jQuery("#list_1_serialised").html(jQuery.dds.serialize("list_1"));jQuery("#list_2_serialised").html(jQuery.dds.serialize("list_2"))});
var PaneTarget={},Pane=function(){var a=function(f){for(f.setAttribute("class","dashboard_widget");f.hasChildNodes();)f.removeChild(f.lastChild);return f},b=function(f){var h=document.createElement("DIV");h.setAttribute("class","widget_title ui-corner-top");h.innerText=f;return h},c=function(){var f=document.createElement("DIV");f.setAttribute("class","widget ui-corner-bottom");return f},d=function(f,h){for(;f.hasChildNodes();)f.removeChild(f.lastChild);f.appendChild(h)},e=function(f,h,k){var l=document.createElement("DIV");
f.map(h).forEach(function(p){p&&l.appendChild(p)});k.forEach(function(p){p&&l.appendChild(p)});return l},g=function(f,h,k,l,p){l=void 0===p?l:l+"?"+Utils.page.param({q:p});f();jQuery.ajax({dataType:"json",type:"GET",url:l,contentType:"application/json; charset\x3dutf8",success:function(r){h(r)},error:function(r,w,v){k(r,w,v)}})};return{updateDiv:d,setFocusOnReady:function(f){jQuery(document).ready(function(){f.focus()})},createSearchPane:function(f,h){h=b(h);var k=document.createElement("INPUT");
k.setAttribute("type","text");k.setAttribute("size","20");h.append(k);var l=c();f=a(document.getElementById(f));f.appendChild(h);f.appendChild(l);return{title:h,input:k,content:l}},createPane:function(f,h){h=b(h);var k=c();f=a(document.getElementById(f));f.appendChild(h);f.appendChild(k);return{title:h,content:k}},updateTiles:function(f,h,k,l,p,r){var w=null;if(r&&(w=Constants.workflows.find(function(v){return v.barcode==l}))){window.location=Urls.ui.workflows.create(w.workflowName);return}g(function(){var v=
document.createElement("IMG");v.src="/styles/images/ajax-loader.gif";d(f,v)},function(v){d(f,e(v,h,p))},function(v,E,q){E=document.createElement("P");try{var t=JSON.parse(v.responseText);t.detail&&(E.innerText=t.detail)}catch(z){E.innerText=q}d(f,E)},k,l)},registerSearchHandlers:function(f,h,k,l,p){var r=function(){Pane.updateTiles(l,h,k,f.value,[],p)};f.onpaste=function(){setTimeout(r,100)};f.onkeyup=function(w){13==w.which&&r()}}}}();
PaneTarget.barcode=function(){var a=Urls.rest.barcodables.search,b=function(c){return Tile.make([Tile.title(c.entityType),Tile.lines(["Name: "+(c.name||"n/a"),c.alias?"Alias: "+c.alias:null,c.identificationBarcode?"Barcode: "+c.identificationBarcode:null].filter(function(d){return!!d}))],function(){c.url?window.location=window.location.origin+c.url:Utils.showOkDialog("Error",["This item does not have its own page"])})};return{createPane:function(c){c=Pane.createSearchPane(c,"Search");var d=Pane,e=
d.updateDiv,g=c.content,f=document.createElement("P");f.innerText="Search barcodable items by name, alias, or barcode.  Alternatively, scan a barcode to see any matching items here.";e.call(d,g,f);Pane.registerSearchHandlers(c.input,b,a,c.content,!0);Pane.setFocusOnReady(c.input)}}}();
PaneTarget.instrument_status=function(){var a=Urls.rest.instrumentStatus,b=function(c){var d=c.positions.length,e=c.positions.filter(function(p){return p.run&&"Running"===p.run.status}).length,g=c.positions.filter(function(p){return p.outOfService}).length,f=null;if(0===e&&0===g){var h="Idle";var k=Tile.statusOk;c.positions.forEach(function(p){p.run&&p.run.endDate&&(!f||p.run.endDate<f)&&(f=p.run.endDate)})}else e+g<d?(h="Available",k=Tile.statusMaybe,c.positions.forEach(function(p){p.run&&p.run.endDate&&
!p.outOfService&&(!f||p.run.endDate<f)&&(f=p.run.endDate)})):g===d?(h="Out of Service",k=Tile.statusBad,f=c.positions.map(function(p){return p.outOfServiceTime}).filter(function(p){return null!=p}).sort().reverse()[0]):(h="Busy",k=Tile.statusBusy,c.positions.forEach(function(p){if(!f||p.run.startDate>f)f=p.run.startDate}));var l=[];switch(d){case 1:c.positions[0].run&&l.push(c.positions[0].run.status+" "+c.positions[0].run.name+" ("+c.positions[0].run.alias+")");break;case 2:c.positions.some(function(p){return!p.outOfService})&&
c.positions.sort(Utils.sorting.standardSort("position")).forEach(function(p){p.outOfService?l.push(p.position+": Out of service"):p.run&&l.push(p.position+": "+p.run.status+" "+p.run.name+" ("+p.run.alias+")")});break;default:g!=d&&l.push(e+"/"+d+" positions active"),0<g&&l.push(g+"/"+d+" positions out of service")}l.push(h+(f?" since "+f:""));return Tile.make([Tile.titleAndStatus(c.instrument.name,k(h)),Tile.lines(l,!1)],function(){var p=[{name:"View Instrument ("+c.instrument.name+")",handler:function(){window.location=
Urls.ui.instruments.edit(c.instrument.id)}}];c.positions.forEach(function(r){r.run&&(p.push({name:"View "+("Running"===r.run.status?"":"Last")+" Run ("+r.run.alias+")",handler:function(){window.location=Urls.ui.runs.edit(r.run.id)}}),r.pools&&r.pools.forEach(function(w){p.push({name:"View "+w.name+" ("+w.alias+")",handler:function(){window.location=Urls.ui.pools.edit(w.id)}})}))});Utils.showWizardDialog(c.instrument.name,p)})};return{createPane:function(c){c=Pane.createPane(c,"Instrument Status");
Pane.updateTiles(c.content,b,a,null,[])}}}();
PaneTarget.project=function(){var a=function(b){return Tile.make([Tile.title(b.code||b.title),Tile.lines(["Name: "+b.name,b.code?"Title: "+b.title:null].filter(function(c){return!!c}))],function(){window.location=Urls.ui.projects.edit(b.id)})};return{createPane:function(b){b=Pane.createSearchPane(b,"Project");var c=Pane,d=c.updateDiv,e=b.content,g=document.createElement("P");g.innerText="Search projects by name, title, code, or description.";d.call(c,e,g);Pane.registerSearchHandlers(b.input,a,Urls.rest.projects.search,
b.content,!0)}}}();PaneTarget.run=function(){var a=Urls.rest.runs.search,b=function(c){return Tile.make([Tile.title(c.alias),Tile.lines(["Name: "+c.name,"Status: "+c.status])],function(){window.location=Urls.ui.runs.edit(c.id)})};return{createPane:function(c){c=Pane.createSearchPane(c,"Run");Pane.updateTiles(c.content,b,Urls.rest.runs.recent,null,[]);Pane.registerSearchHandlers(c.input,b,a,c.content,!0)}}}();
PaneTarget.workflow=function(){var a=Urls.rest.workflows.list,b=function(c){return Tile.make([Tile.title(c.name),Tile.lines([c.complete?"Complete":"Step: "+c.stepNumber,c.message,"Last Modified: "+c.lastModified])],function(){window.location=Urls.ui.workflows.edit(c.workflowId)})};return{createPane:function(c){c=Pane.createPane(c,"Workflows");var d=favouriteWorkflows.map(function(e){return Tile.make([Tile.title("Begin New "+e.description)],function(){window.location=Urls.ui.workflows.create(e.workflowName)})});
d.push(Tile.make([Tile.title("Begin New Workflow")],function(){Utils.showWizardDialog("Begin New Workflow",Constants.workflows.map(function(e){return{name:e.description,handler:function(){window.location=Urls.ui.workflows.create(e.workflowName)}}}))}));d.push(Tile.make([Tile.title("Edit Favourite Workflows")],function(){Utils.showWizardDialog("Edit Favourite Workflows",Constants.workflows.map(function(e){return 0>favouriteWorkflows.map(function(g){return g.workflowName}).indexOf(e.workflowName)?{name:"Add "+
e.description+" to Favourites",handler:function(){Utils.ajaxWithDialog("Adding Workflow to Favourites","POST",Urls.rest.workflows.addFavourite(e.workflowName),null,Utils.page.pageReload)}}:{name:"Remove "+e.description+" from Favourites",handler:function(){Utils.ajaxWithDialog("Removing Workflow from Favourites","POST",Urls.rest.workflows.removeFavourite(e.workflowName),null,Utils.page.pageReload)}}}))}));Pane.updateTiles(c.content,b,a,null,d)}}}();
var Validate=Validate||{attachParsley:function(a){0<jQuery(a).length&&jQuery(a).parsley();window.Parsley.on("parsley:field:validate",function(){Validate.updateWarningorSubmit(a)})},cleanFields:function(a){jQuery(a).find("input:text").each(function(){Utils.validation.clean_input_field(jQuery(this))})},updateWarningOrSubmit:function(a,b,c,d){jQuery(a).parsley().whenValidate().done(function(){jQuery(a+" .bs-callout-warning").addClass("hidden");b?b(jQuery(a)):c?c():jQuery(a).submit()}).fail(function(){jQuery(a+
" .bs-callout-warning").removeClass("hidden");d&&d();return!1})},displayErrors:function(a,b){var c="#"+b;Validate.clearErrors(c);jQuery(c+" .bs-callout-warning").removeClass("hidden");a&&a.data?"validation"===a.dataFormat?jQuery.each(a.data,function(d,e){Validate.displayError(b,d,e)}):(Validate.displayError(b,"GENERAL",a.detail),a.data&&a.data.uiHelp&&Validate.displayError(b,"GENERAL",a.data.uiHelp)):Validate.displayError(b,"GENERAL","Something has gone terribly wrong. Please report this to your MISO administrator.")},
displayError:function(a,b,c){c=c.split("\n");var d=null;if("GENERAL"!==b){var e=jQuery("#"+a+"_"+b+"Error");e.length?d=e:c=c.map(function(f){return b+": "+f})}d||(d=jQuery("#"+a+" .generalErrors"));var g=d.find(".errorList");g.length||(g=jQuery('\x3cul class\x3d"parsley-errors-list filled"\x3e'),d.append(g));jQuery.each(c,function(f,h){g.append(jQuery("\x3cli\x3e"+h+"\x3c/li\x3e"))})},clearErrors:function(a){jQuery(a+" .bs-callout-warning").addClass("hidden");jQuery(a).parsley().destroy();jQuery(a+
" .generalErrors").empty();jQuery(a+" .errorContainer").empty();jQuery('[id^\x3d"'+a.substring(1)+'_"][id$\x3d"Error"]').empty()},makeDecimalField:function(a,b,c,d,e){jQuery(a).attr("class","form-control");jQuery(a).attr("data-parsley-type","number");jQuery(a).attr("data-parsley-maxlength",b+1);var g=Math.pow(10,b-c)-Math.pow(.1,c);e=e?-1*g:0;jQuery(a).attr("data-parsley-range","["+e+", "+g+"]");b="\\d{0,"+(b-c)+"}(?:\\.\\d{1,"+c+"})?";jQuery(a).attr("data-parsley-pattern",b);jQuery(a).attr("data-parsley-required",
d?"true":"false");jQuery(a).attr("data-parsley-error-message","Must be a number between "+e+" and "+g)},removeValidation:function(a){jQuery(a).removeAttr("data-parsley-type");jQuery(a).removeAttr("data-parsley-maxlength");jQuery(a).removeAttr("data-parsley-range");jQuery(a).removeAttr("data-parsley-pattern");jQuery(a).removeAttr("data-parsley-required");jQuery(a).removeAttr("data-parsley-error-message");jQuery(a).removeAttr("data-parsley-min");jQuery(a).removeAttr("data-parsley-max");jQuery(a).removeAttr("data-date-format")}},
Pool=function(a){function b(e){Utils.ajaxWithDialog("Checking duplicates","POST",Urls.rest.poolOrders.indexChecker,e.map(Utils.array.getId),function(g){Pool.setAliquots(e,g.duplicateIndices,g.nearDuplicateIndices)})}var c=!1,d=null;return{setForm:function(e){d=e},getAliquots:function(){return a("#listAliquots").dataTable().fnGetData()},setAliquots:function(e,g,f){c&&(d.markOtherChanges(),a("#listAliquots").dataTable().fnDestroy(),a("#listAliquotsContainer").empty(),ListState.listAliquots=null);a("#listAliquotsContainer").append(a("\x3ctable\x3e").attr("id",
"listAliquots").addClass("display no-border ui-widget-content"));ListUtils.createStaticTable("listAliquots",ListTarget.poolelement,{duplicateIndicesSequences:g||[],nearDuplicateIndicesSequences:f||[]},e||[]);c=!0},addAliquots:function(e){e=Pool.getAliquots().concat(e);b(e)},removeAliquots:function(e){var g=Pool.getAliquots().filter(function(f){return-1===e.indexOf(f.id)});b(g)}}}(jQuery),PoolOrder=function(a){function b(e){Utils.ajaxWithDialog("Checking duplicates","POST",Urls.rest.poolOrders.indexChecker,
e.map(Utils.array.getId),function(g){PoolOrder.setAliquots(e,g.duplicateIndices,g.nearDuplicateIndices)})}var c=!1,d=null;return{setForm:function(e){d=e},getAliquots:function(){return a("#listAliquots").dataTable().fnGetData()},setAliquots:function(e,g,f){c&&(d.markOtherChanges(),a("#listAliquots").dataTable().fnDestroy(),a("#listAliquotsContainer").empty(),ListState.listAliquots=null);a("#listAliquotsContainer").append(a("\x3ctable\x3e").attr("id","listAliquots").addClass("display no-border ui-widget-content"));
ListUtils.createStaticTable("listAliquots",ListTarget.orderaliquot,{duplicateSequences:g,nearDuplicateIndices:f},e);c=!0},addAliquots:function(e){e=PoolOrder.getAliquots().concat(e);b(e)},removeAliquots:function(e){var g=PoolOrder.getAliquots().filter(function(f){return-1===e.indexOf(f.aliquot.id)});b(g)}}}(jQuery),Project=function(){function a(e,g){return e.contactId===g.contactId&&e.contactRoleId===g.contactRoleId&&e.contactName===g.contactName&&e.contactEmail===g.contactEmail}var b=null,c={},d=
null;return{setForm:function(e){b=e},setListConfig:function(e){c=e},setProjectId:function(e){d=e},setAssays:function(e){FormUtils.setTableData(ListTarget.assay,c,"assays_section",e,b)},getAssays:function(){return FormUtils.getTableData("assays_section")},addAssay:function(e){var g=Project.getAssays();g.push(e);Project.setAssays(g)},removeAssays:function(e){var g=Project.getAssays().filter(function(f){return!e.some(function(h){return h.id===f.id})});Project.setAssays(g)},setContacts:function(e){FormUtils.setTableData(ListTarget.contact,
c,"contacts_section",e,b)},getContacts:function(){return FormUtils.getTableData("contacts_section")},addContact:function(e){var g=Project.getContacts();e.projectId=d;g.find(function(f){return a(f,e)})?Utils.showOkDialog("Error",["Duplicate: this contact and role combination is already included"]):(g.push(e),Project.setContacts(g))},removeContacts:function(e){var g=Project.getContacts().filter(function(f){return!e.some(function(h){return a(h,f)})});Project.setContacts(g)},setDeliverables:function(e){FormUtils.setTableData(ListTarget.deliverable,
c,"deliverables_section",e,b)},getDeliverables:function(){return FormUtils.getTableData("deliverables_section")},addDeliverable:function(e){var g=Project.getDeliverables();g.push(e);Project.setDeliverables(g)},removeDeliverables:function(e){var g=Project.getDeliverables().filter(function(f){return!e.some(function(h){return h.id===f.id})});Project.setDeliverables(g)}}}(),QcHierarchy=function(a){function b(n,m,u){var A=m||0,G=u||[];G[A]||(G[A]=0);G[A]++;n.children&&n.children.forEach(function(D){b(D,
A+1,G)});if(0===A)return Math.max.apply(this,G)}function c(n){var m=[];d(n,m);return m}function d(n,m){m.push(e(n));n.children&&n.children.length&&n.children.forEach(function(u){d(u,m)})}function e(n){return{id:g(n),width:300,item:n}}function g(n){return n.id?n.entityType+" "+n.id:n.entityType+" "+n.ids.join("-")}function f(n){var m=[];n.forEach(function(u){u.item.children&&(m=m.concat(u.item.children.map(function(A){return[u.id,g(A)]})))});return m}function h(n,m){var u=(m||0)+1;return n.children&&
n.children.length?Math.max(u,Math.max.apply(this,n.children.map(function(A){return h(A,u)}))):u}function k(){var n=this.point.item;switch(n.entityType){case "Sample":case "Library":case "Library Aliquot":var m=n.qcStatusId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(n.qcStatusId),Constants.detailedQcStatuses):null;return l(n,m?m.description:"Not Ready",n.qcNote);case "Pool":case "Run":return m=QcHierarchy.qcPassedOptions.find(function(u){return u.value===n.qcPassed}),l(n,m.label);case "Run-Partition":return m=
n.qcStatusId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(n.qcStatusId),Constants.partitionQcTypes):null,l(n,m?m.description:"Not Set");case "Run-Library":return m=n.qcStatusId?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(n.qcStatusId),Constants.runLibraryQcStatuses):null,l(n,m?m.description:"Pending",n.qcNote);default:throw Error("Unknown entity type: "+selectedItem.entityType);}}function l(n,m,u){u=p(n);var A="\x3cdiv\x3e\x3cstrong\x3e"+n.typeLabel+(n.name?": "+n.name:"")+"\x3c/strong\x3e";
!1===n.qcPassed&&(A+='\x3cspan class\x3d"warning-icon message-error" title\x3d"QC Failed"\x3e \u26a0\x3c/span\x3e');A=A+'\x3c/div\x3e\x3cdiv style\x3d"overflow: hidden;text-overflow: ellipsis;white-space: pre-wrap;" title\x3d"'+(n.label+'"\x3e');A=u?A+('\x3ca href\x3d"'+u+'"\x3e'+n.label+"\x3c/a\x3e"):A+n.label;return A+"\x3c/div\x3e\x3cdiv\x3eStatus: "+(m+"\x3c/div\x3e")}function p(n){switch(n.entityType){case "Sample":return Urls.ui.samples.edit(n.id);case "Library":return Urls.ui.libraries.edit(n.id);
case "Library Aliquot":return Urls.ui.libraryAliquots.edit(n.id);case "Pool":return Urls.ui.pools.edit(n.id);case "Run":return Urls.ui.runs.edit(n.id);default:return null}}function r(n){F&&F.select(!1);n.select(!0,!1);F=n;var m=n.item;a("#editContainer").css("margin-top",n.dataLabel.y);a("#selectedLabel").text(m.label);a("#selectedLabel").attr("title",m.label);a("#selectedType").text(m.typeLabel);a("#selectedStatus").empty().off("change");Utils.ui.setDisabled("#selectedNote",!0);a("#selectedNote").val(m.qcNote);
a("#selectedNote").attr("data-parsley-required",!1);a("#applySelected").off("click");switch(m.entityType){case "Sample":case "Library":case "Library Aliquot":w(m);break;case "Pool":case "Run":v(m);break;case "Run-Partition":E(m);break;case "Run-Library":q(m);break;default:throw Error("Unknown entity type: "+m.entityType);}}function w(n){a("#selectedStatus").append(z(0,"Not Ready",!n.qcStatusId)).append(Constants.detailedQcStatuses.map(function(m){return z(m.id,m.description,n.qcStatusId===m.id)})).change(function(){var m=
Number.parseInt(a(this).val()),u=m?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(m),Constants.detailedQcStatuses):null;Utils.ui.setDisabled("#selectedNote",!u||!u.noteRequired);a("#selectedNote").attr("data-parsley-required",u&&u.noteRequired);u&&u.noteRequired&&m===n.qcStatusId||a("#selectedNote").val(null)}).change();a("#applySelected").click(function(){t(n,function(){return{qcStatusId:Number.parseInt(a("#selectedStatus").val())||null,qcNote:a("#selectedNote").val()||null}})})}function v(n){a("#selectedStatus").append(QcHierarchy.qcPassedOptions.map(function(m,
u){return z(u,m.label,n.qcPassed===m.value)}));a("#applySelected").click(function(){t(n,function(){return{qcPassed:QcHierarchy.qcPassedOptions[a("#selectedStatus").val()].value}})})}function E(n){a("#selectedStatus").append(z(0,"Not Set",!n.qcStatusId));a("#selectedStatus").append(Constants.partitionQcTypes.map(function(m){return z(m.id,m.description,n.qcStatusId===m.id)})).change(function(){var m=Number.parseInt(a(this).val()),u=m?Utils.array.findUniqueOrThrow(Utils.array.idPredicate(m),Constants.partitionQcTypes):
null;Utils.ui.setDisabled("#selectedNote",!u||!u.noteRequired);a("#selectedNote").attr("data-parsley-required",u&&u.noteRequired);u&&u.noteRequired&&m===n.qcStatusId||a("#selectedNote").val(null)}).change();a("#applySelected").click(function(){t(n,function(){return{qcStatusId:Number.parseInt(a("#selectedStatus").val())||null,qcNote:a("#selectedNote").val()||null}})})}function q(n){a("#selectedStatus").append(z(0,"Pending",!n.qcStatusId));a("#selectedStatus").append(Constants.runLibraryQcStatuses.map(function(m){return z(m.id,
m.description,n.qcStatusId===m.id)}));Utils.ui.setDisabled("#selectedNote",!1);a("#applySelected").click(function(){t(n,function(){return{qcStatusId:Number.parseInt(a("#selectedStatus").val())||null,qcNote:a("#selectedNote").val()||null}})})}function t(n,m){Validate.cleanFields("#editForm");Validate.clearErrors("#editForm");a("#selectedNote").attr("data-parsley-pattern",Utils.validation.sanitizeRegex);a("#editForm").parsley().validate()&&(n=Object.assign(n,m()),Utils.ajaxWithDialog("Setting Status",
"PUT",Urls.rest.qcStatuses.update,n,Utils.page.pageReload))}function z(n,m,u){n=a("\x3coption\x3e").val(n).text(m);u&&n.attr("selected","selected");return n}var x=null,F=null;return{qcPassedOptions:[{value:null,label:"Not Ready"},{value:!0,label:"Ready"},{value:!1,label:"Failed"}],buildGraph:function(n,m,u){var A=b(n),G=c(n),D=f(G);n=h(n);A=310*A-10+22;a("#graphContainer").css({width:A+"px",minWidth:"322px"});x=Highcharts.chart("graphContainer",{chart:{height:122*n-30+22,width:A,inverted:!0},title:{text:""},
series:[{type:"organization",keys:["from","to"],data:D,nodes:G,colorByPoint:!1,color:"#F0F0FF",states:{select:{color:"#F0F0FF",borderColor:"#404087"}},dataLabels:{color:"black",nodeFormatter:k},borderColor:"#A9A9A9",nodeWidth:92,events:{click:function(N){N.point.item&&r(N.point)}}}],tooltip:{enabled:!1}});r(x.series[0].nodes.find(function(N){if(N.item.entityType!==m)return!1;if("Run-Library"===m){if(!Array.isArray(N.item.ids)||3!==N.item.ids.length||!Array.isArray(u)||3!==u.length)throw Error("Invalid ID");
for(var L=0;3>L;L++)if(N.item.ids[L]!==u[L])return!1;return!0}return N.item.id===u}));a("#graphScrollContainer").scrollLeft(F.dataLabel.x+150-a("#graphScrollContainer").width()/2);a("#graphScrollContainer").position().top+F.dataLabel.y+92>a(window).height()&&a("html").scrollTop(a("#graphScrollContainer").position().top+F.dataLabel.y+46-a(window).height()/2)}}}(jQuery),QcType=function(a){var b=null,c=!1;return{setForm:function(d){b=d},setAdmin:function(d){c=d},setControls:function(d){FormUtils.setTableData(ListTarget.qccontrol,
{isAdmin:c},"listControls",d,b)},getControls:function(){return FormUtils.getTableData("listControls")},addControl:function(d){var e=QcType.getControls();e.some(function(g){return g.alias===d})?Utils.showOkDialog("Error",["There is already a control with this alias"]):(e.push({alias:d}),QcType.setControls(e))},removeControls:function(d){var e=QcType.getControls().filter(function(g){return-1===d.indexOf(g.alias)});QcType.setControls(e)},setKits:function(d){FormUtils.setTableData(ListTarget.kit,{isUserAdmin:c,
isQcTypePage:!0},"listKits",d,b)},getKits:function(){return FormUtils.getTableData("listKits")},addKit:function(d){var e=QcType.getKits();e.some(function(g){return g.id==d.id})?Utils.showOkDialog("Error",["This kit has already been added"]):(e.push(d),QcType.setKits(e))},removeKits:function(d){var e=d.map(Utils.array.getId);d=QcType.getKits().filter(function(g){return-1===e.indexOf(g.id)});QcType.setKits(d)}}}(jQuery),Requisition=function(){var a=null,b={};return{setForm:function(c){a=c},setAssaysListConfig:function(c){b=
c},setAssays:function(c){FormUtils.setTableData(ListTarget.assay,b,"listAssays",c,a)},getAssays:function(){return FormUtils.getTableData("listAssays")},addAssay:function(c){var d=Requisition.getAssays();d.some(Utils.array.idPredicate(c.id))?Utils.showOkDialog("Error",["That assay is already included"]):(d.push(c),Requisition.setAssays(d))},removeAssays:function(c){var d=Requisition.getAssays().filter(function(e){return!c.some(function(g){return g.id==e.id})});Requisition.setAssays(d)},setPauses:function(c){FormUtils.setTableData(ListTarget.requisitionpause,
{},"listPauses",c,a)},getPauses:function(){return FormUtils.getTableData("listPauses")},addPause:function(c){var d=Requisition.getPauses();d.some(function(e){return e.startDate==c.startDate})?Utils.showOkDialog("Error",["Cannot have multiple pauses with the same start date"]):(d.push(c),Requisition.setPauses(d))},removePauses:function(c){var d=Requisition.getPauses().filter(function(e){return!c.some(function(g){return g.startDate==e.startDate})});Requisition.setPauses(d)},updatePause:function(c){var d=
Requisition.getPauses().filter(function(e){return e.startDate!=c.startDate});d.push(c);Requisition.setPauses(d)}}}(),RunLibraryMetrics=function(a){function b(n){switch(n.thresholdType){case "gt":return"\x3e "+n.threshold;case "ge":return"\x3e\x3d "+n.threshold;case "lt":return"\x3c "+n.threshold;case "le":return"\x3c\x3d "+n.threshold;case "between":return"between "+n.threshold+" and "+n.threshold2;default:throw Error("Unknown thresholdType: metric.thresholdType");}}function c(n){switch(n.thresholdType){case "gt":return n.value>
n.threshold;case "ge":return n.value>=n.threshold;case "lt":return n.value<n.threshold;case "le":return n.value<=n.threshold;case "between":return n.value>=n.threshold&&n.value<=n.threshold2;default:throw Error("Unknown thresholdType: metric.thresholdType");}}function d(n,m){m.removeClass("failed");for(var u="Pending",A=0;A<n.qcNodes.length;A++){var G=n.qcNodes[A];if(!1===G.qcPassed){u="Failed ("+G.typeLabel+")";m.addClass("failed");break}else A===n.qcNodes.length-1&&!0===G.qcPassed&&(u="Passed ("+
G.typeLabel+")")}return m.text(u)}function e(n,m){var u=a("\x3ctd\x3e"),A=a("\x3ctable\x3e"),G={effectiveQc:m,node:a("\x3cselect\x3e").addClass("nodeSelect").append(n.qcNodes.map(function(D,N){return g(N,D.typeLabel+" "+D.label)})).val(n.qcNodes.length-1),name:a("\x3cspan\x3e"),status:a("\x3cselect\x3e").addClass("statusSelect"),note:a("\x3cinput\x3e").addClass("noteInput"),dataReview:a("\x3cselect\x3e").addClass("dataReviewSelect"),apply:a("\x3cbutton\x3e").text("Apply")};G.node.change(function(){var D=
Number.parseInt(a(this).val());D=n.qcNodes[D];f(G,D,n);n.selectedNode=D}).change();r(A,"Item:",G.node);r(A,"Name:",G.name);r(A,"Status:",G.status);r(A,"Note:",G.note);r(A,"Data Review:",G.dataReview);r(A,"",G.apply);u.append(A);return u}function g(n,m,u){n=a("\x3coption\x3e").val(n).text(m);u&&n.attr("selected","selected");return n}function f(n,m,u){n.name.empty();m.name?n.name.append(a("\x3ca\x3e").attr("href",p(m)).text(m.name)):n.name.text("n/a");n.status.empty();n.status.off("change");Utils.ui.setDisabled(n.note,
!0);Utils.ui.setDisabled(n.dataReview,!0);n.dataReview.empty();n.apply.off("click");switch(m.entityType){case "Sample":case "Library":case "Library Aliquot":l(n,m,u);break;case "Pool":n.status.append(QcHierarchy.qcPassedOptions.map(function(D,N){return g(N,D.label,(void 0===m.qcPassed?null:m.qcPassed)===D.value)}));u.getUpdate=function(){return{qcPassed:QcHierarchy.qcPassedOptions[n.status.val()].value}};break;case "Run":var A=void 0===m.qcPassed?null:m.qcPassed;n.status.append(QcHierarchy.qcPassedOptions.map(function(D,
N){return g(N,D.label,A===D.value)}));n.status.change(function(){var D=QcHierarchy.qcPassedOptions[n.status.val()].value;D!==A&&n.dataReview.val("");Utils.ui.setDisabled(n.dataReview,!x||null===D||D!==A)}).change();n.dataReview.append(F.map(function(D){return g(D.value,D.label,t(D.value)===m.dataReview)}));u.getUpdate=function(){return{qcPassed:QcHierarchy.qcPassedOptions[n.status.val()].value,dataReview:t(n.dataReview.val())}};break;case "Run-Partition":n.status.append(g(0,"Not Set",!m.qcStatusId));
n.status.append(Constants.partitionQcTypes.map(function(D){return g(D.id,D.description,m.qcStatusId===D.id)})).change(function(){var D=Number.parseInt(a(this).val()),N=null;D?(N=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(D),Constants.partitionQcTypes),Utils.ui.setDisabled(n.note,!N.noteRequired)):Utils.ui.setDisabled(n.note,!0);N&&N.noteRequired&&D===m.qcStatusId||n.note.val(null)}).change();if(m.qcStatusId){var G=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(m.qcStatusId),Constants.partitionQcTypes);
Utils.ui.setDisabled(n.note,!G.noteRequired)}u.getUpdate=function(){return{qcStatusId:Number.parseInt(n.status.val())||null,qcNote:n.note.val()||null}};break;case "Run-Library":n.status.append(g(0,"Pending",!m.qcStatusId));n.status.append(Constants.runLibraryQcStatuses.map(function(D){return g(D.id,D.description,m.qcStatusId===D.id)}));n.status.change(function(){var D=Number.parseInt(n.status.val())||null;D!==m.qcStatusId&&n.dataReview.val("");Utils.ui.setDisabled(n.dataReview,!x||null===D||D!==m.qcStatusId)}).change();
Utils.ui.setDisabled(n.note,!1);n.dataReview.append(F.map(function(D){return g(D.value,D.label,t(D.value)===m.dataReview)}));u.getUpdate=function(){var D=Number.parseInt(n.status.val())||null,N=null;D&&(N=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(D),Constants.runLibraryQcStatuses).qcPassed);return{qcStatusId:D,qcPassed:N,qcNote:n.note.val()||null,dataReview:t(n.dataReview.val())}};break;default:throw Error("Unknown entity type: "+m.entityType);}n.note.val(m.qcNote);n.apply.click(function(){function D(){Utils.ajaxWithDialog("Setting Status",
"PUT",Urls.rest.qcStatuses.update,L,function(O){u.update(L);f(n,m,u)})}var N=u.getUpdate(),L=Object.assign({},u.selectedNode,N);h(u.selectedNode,N)&&null!==u.selectedNode.dataReview?k(D):D()})}function h(n,m){if(null===n.qcPassed||void 0===n.qcPassed){if(null!==m.qcPassed&&void 0!==m.qcPassed)return!0}else if(m.qcPassed!==n.qcPassed)return!0;if(null===n.qcStatusId||void 0===n.qcStatusId){if(null!==m.qcStatusId&&void 0!==m.qcStatusId)return!0}else if(m.qcStatusId!==n.qcStatusId)return!0;return!1}function k(n){Utils.showConfirmDialog("Warning",
"OK",["Changing QC status will reset the data review. Do you wish to proceed?"],n)}function l(n,m,u){n.status.append(g(0,"Not Ready",!m.qcStatusId));n.status.append(Constants.detailedQcStatuses.map(function(A){return g(A.id,A.description,m.qcStatusId===A.id)})).change(function(){var A=Number.parseInt(a(this).val()),G=null;A?(G=Utils.array.findUniqueOrThrow(Utils.array.idPredicate(A),Constants.detailedQcStatuses),Utils.ui.setDisabled(n.note,!G.noteRequired)):Utils.ui.setDisabled(n.note,!0);G&&G.noteRequired&&
A===m.qcStatusId||n.note.val(null)}).change();u.getUpdate=function(){var A={qcStatusId:Number.parseInt(n.status.val())||null,qcNote:n.note.val()||null};A.qcPassed=null===A.qcStatusId?null:Utils.array.findUniqueOrThrow(Utils.array.idPredicate(A.qcStatusId),Constants.detailedQcStatuses).status;return A}}function p(n){switch(n.entityType){case "Sample":return Urls.ui.samples.edit(n.id);case "Library":return Urls.ui.libraries.edit(n.id);case "Library Aliquot":return Urls.ui.libraryAliquots.edit(n.id);
case "Pool":return Urls.ui.pools.edit(n.id);case "Run":return Urls.ui.runs.edit(n.id);default:throw Error("Unexpected entity type: "+n.entityType);}}function r(n,m,u){n.append(a("\x3ctr\x3e").append(a("\x3ctd\x3e").text(m),a("\x3ctd\x3e").append(u)))}function w(n,m){a(".nodeSelect").each(function(){a(this).val(a(this).find("option").length-1);a(this).change()});a(".statusSelect").val(n).change();a(".noteInput").val(m)}function v(n){a(".nodeSelect").each(function(){a(this).val(a(this).find("option").length-
1);a(this).change()});a(".dataReviewSelect").val(n)}function E(){for(var n=0;n<z.length;n++)if(h(z[n].selectedNode,z[n].getUpdate()))return!0;return!1}function q(){return z.map(function(n){var m=n.getUpdate();return Object.keys(m).some(function(u){return n.selectedNode[u]!==m[u]})?{rowData:n,update:Object.assign({},n.selectedNode,m)}:null}).filter(function(n){return null!==n})}function t(n){switch(n){case "true":return!0;case "false":return!1;default:return null}}var z=null,x=null,F=[{label:"Pending",
value:""},{label:"Pass",value:"true"},{label:"Fail",value:"false"}];return{buildTable:function(n,m){z=n;x=m;m=a("#metricsTable");m.empty();var u=a("\x3ctr\x3e");u.append(a("\x3cth\x3e").text("Library Aliquot"));var A=new Set;n.forEach(function(D){D.metrics.forEach(function(N){A.has(N.title)||(u.append(a("\x3cth\x3e").text(N.title)),A.add(N.title))})});u.append(a("\x3cth\x3e").text("Effective QC Status"));u.append(a("\x3cth\x3e").text("QC Status"));m.append(a("\x3cthead\x3e").append(a(u)));var G=a("\x3ctbody\x3e");
n.forEach(function(D){var N=a("\x3ctr\x3e");N.append(a("\x3ctd\x3e").text(D.libraryAliquot.alias));A.forEach(function(O){var S=!1,T=a("\x3ctd\x3e");D.metrics.forEach(function(P){if(P.title===O){var V=T.append,W=a("\x3cdiv\x3e"),Y=W.text;var X=0;null!=P.threshold&&(X=Utils.decimalStrings.getDecimalPlaces(P.threshold));null!=P.threshold2&&(X=Math.max(X,Utils.decimalStrings.getDecimalPlaces(P.threshold2)));X=Utils.decimalStrings.truncateDecimal(P.value,X+1);W=Y.call(W,X);Y=a("\x3cdiv\x3e").text(" (threshold: "+
b(P)+")");V.call(T,W,Y);c(P)||T.addClass("failed");S=!0}});!1===S&&(T.append("N/A"),T.addClass("na"));N.append(T)});var L=a("\x3ctd\x3e");d(D,L);N.append(L);N.append(e(D,L));G.append(N);D.update=function(O){Object.assign(D.selectedNode,O);d(D,L)}});m.append(G)},showQcAllDialog:function(){var n=[{label:"Status",property:"option",type:"select",values:[{id:0,description:"Pending"}].concat(Constants.runLibraryQcStatuses),getLabel:Utils.array.get("description")},{label:"Note",property:"note",type:"text"}];
Utils.showDialog("QC All Run-Libraries","Apply",n,function(m){w(m.option.id,m.note)})},showReviewAllDialog:function(){var n=[{label:"Data Review",property:"option",type:"select",values:F,getLabel:Utils.array.get("label")}];Utils.showDialog("Review All Run-Libraries","Apply",n,function(m){v(m.option.value)})},saveAll:function(){function n(){Utils.ajaxWithDialog("Saving...","PUT",Urls.rest.qcStatuses.bulkUpdate,m.map(Utils.array.get("update")),function(){m.forEach(function(u){u.rowData.dataReview=null;
u.rowData.update(u.update)})})}var m=q();m.length?E()&&m.some(function(u){return null!==u.rowData.dataReview})?k(n):n():Utils.showOkDialog("Error",["No changes to save"])},hasUnsavedChanges:function(){return 0<q().length}}}(jQuery),RunGraph=function(){var a=function(c,d,e,g,f){return function(h,k,l){return h.filter(function(p){return p.type==c}).map(function(p){p.series.forEach(function(w){w.visible=!/{\d+}/.test(w.name);w.name=l(w.name,!0)});var r=document.createElement("DIV");return{dom:r,span:!1,
render:function(){new Highcharts.Chart({chart:{type:"line",renderTo:r,zoomType:"x",spacingRight:20,width:k},title:{text:d},xAxis:{allowDecimals:!1,floor:0,title:{text:g||null}},yAxis:{floor:0,title:{text:e}},plotOptions:{line:{lineWidth:1,marker:{enabled:!1},shadow:!1},series:{animation:!1,tooltip:{valueDecimals:2},pointStart:f}},series:p.series})}}})}},b=function(c,d,e,g,f){var h=document.createElement("DIV");return{dom:h,span:!1,render:function(){new Highcharts.Chart({chart:{type:"boxplot",renderTo:h,
zoomType:"x",spacingRight:20,width:f},title:{text:d},xAxis:{allowDecimals:!1,floor:0,title:{text:g||null}},yAxis:{min:1,title:{text:e}},plotOptions:{boxplot:{medianColor:"red"},series:{animation:!1,tooltip:{valueDecimals:2}}},series:c.series})}}};return{metricProcessors:[function(c,d){return c.filter(function(e){return"example"==e.type}).map(function(e){var g=document.createElement("P");return{dom:g,span:!1,render:function(){g.innerText="Look at me. I am gorgeous."}}})},function(c,d){return c.filter(function(e){return"link"==
e.type}).map(function(e){var g=document.createElement("A");g.innerText=e.name;g.href=e.href;g.target="_blank";return{dom:g,span:!1,render:function(){}}})},function(c,d){return c.filter(function(e){return"message"==e.type}).map(function(e){var g=document.createElement("P");g.setAttribute("class","parsley-error");g.innerText=e.message;return{dom:g,render:function(){}}})},function(c,d){return c.filter(function(e){return"chart"==e.type}).map(function(e){var g=document.createElement("TABLE");return{dom:g,
span:!1,render:function(){jQuery(g).dataTable({bJQueryUI:!0,bAutoWidth:!1,aoColumns:[{sTitle:"Name",mData:"name"},{sTitle:"Value",mData:"value"}],aaData:e.values,sDom:"t",fnDrawCallback:function(){jQuery(g).find("thead").remove()}})}}})},function(c,d,e){return c.filter(function(g){return"table"==g.type}).map(function(g){var f=document.createElement("TABLE");return{dom:f,span:!0,render:function(){jQuery(f).dataTable({bJQueryUI:!0,aoColumns:g.columns.map(function(h){return{sTitle:h.name,mData:h.property,
mRender:function(k){return e(k,!1)}}}),sDom:'\x3c"datatable-scroll"t\x3e\x3c"F"ip\x3e',aaData:g.rows}).parents("div.dataTables_wrapper").css("width",2*d+"px")}}})},function(c,d,e,g){return function(f,h,k){return f.filter(function(l){return l.type==c}).map(function(l){l.series.forEach(function(p){p.tooltip={headerFormat:"\x3cem\x3eCycle {point.key}\x3c/em\x3e\x3cbr/\x3e"};p.visible=!/{\d+}/.test(p.name);p.name=k(p.name,!0)});return b(l,d,e,g,h)})}}("illumina-q30-by-cycle","\x3e Q30 by Cycle","% Bases \x3eQ30",
"Cycle"),a("illumina-called-intensity-by-cycle","Called Intensity by Cycle","Average Intensity per Cycle","Cycle",0),a("illumina-base-percent-by-cycle","Base % by Cycle","Percentage","Cycle",0),function(c,d,e,g){return function(f,h,k){return f.filter(function(l){return l.type==c}).map(function(l){l.series.forEach(function(p){p.name=k(p.name,!0)});return b(l,d,e,g)})}}("illumina-cluster-density-by-lane","Cluster Density by Lane","Density (K/mm\u00b2)","Lane"),a("illumina-clusters-by-lane","Clusters by Lane",
"Clusters","Lane",1),function(c,d,e,g){return function(f,h,k){return f.filter(function(l){return l.type==c}).map(function(l){l.series.forEach(function(r){r.name=k(r.name,!0)});var p=document.createElement("DIV");return{dom:p,span:!1,render:function(){new Highcharts.Chart({chart:{type:"bar",renderTo:p,zoomType:"x",spacingRight:20,width:h},title:{text:d},xAxis:{categories:l.categories,title:{text:g||null}},yAxis:{title:{text:e}},plotOptions:{line:{lineWidth:1,marker:{enabled:!1},shadow:!1},series:{animation:!1,
tooltip:{valueDecimals:2}}},series:l.series})}}})}}("illumina-yield-by-read","Yields per Read","Yield (gb)")],renderMetrics:function(c,d){var e=document.getElementById("metricsdiv"),g=function(){for(;e.hasChildNodes();)e.removeChild(e.lastChild);var h=jQuery(e).width(),k=550>h,l=k?h:Math.round(.49*h);h=RunGraph.metricProcessors.map(function(v){return v(c,l,function(E,q){return(""+E).replace(/{(\d+)}/,function(t,z){t=parseInt(z)-1;return d[t]?(q?"Lane "+z+": ":"")+d[t]:q?"Lane "+z:"N/A"})})}).reduce(function(v,
E){return v.concat(E)});if(0==h.length)e.innerText="No graphs available.";else{var p="width: "+l+"px",r=document.createElement("TABLE");e.appendChild(r);var w=null;h.forEach(function(v){var E=document.createElement("TD");E.style.cssText=p;E.appendChild(v.dom);v.span||k?(E.colSpan=2,v=document.createElement("TR"),v.appendChild(E),r.appendChild(v)):null==w?(w=document.createElement("TR"),w.appendChild(E),r.appendChild(w)):(w.appendChild(E),w=null)});h.forEach(function(v){v.render()})}},f;jQuery(window).resize(function(){clearTimeout(f);
f=setTimeout(function(){g()},300)});g()}}}(),SampleClass=function(a){function b(l){l.forEach(function(p){p.id||(k--,p.id=k)})}function c(l,p,r){ListUtils.createStaticTable(l,ListTarget.samplevalidrelationship,{isAdmin:h,showSide:p,getSampleCategory:function(){return f.get("sampleCategory")},listId:l},r)}function d(l,p,r){var w=p.map(function(v){return v[r]});return l.filter(function(v){return-1===w.indexOf(v[r])})}var e=!1,g=!1,f=null,h=!1,k=0;return{setForm:function(l){f=l},setAdmin:function(l){h=
l},getParents:function(){return e?a("#listParents").dataTable().fnGetData().map(function(l){l=Object.assign({},l);0>l.id&&(l.id=null);return l}):null},setParents:function(l){e&&(f.markOtherChanges(),a("#listParents").dataTable().fnDestroy(),a("#listParentsContainer").empty(),ListState.listParents=null);b(l);a("#listParentsContainer").append(a("\x3ctable\x3e").attr("id","listParents").addClass("display no-border ui-widget-content"));c("listParents","parent",l);e=!0},addParent:function(l){var p=SampleClass.getParents();
p.push(l);SampleClass.setParents(p)},updateParents:function(l){var p=d(SampleClass.getParents(),l,"parentId");p=p.concat(l);SampleClass.setParents(p)},removeParents:function(l){l=d(SampleClass.getParents(),l,"parentId");SampleClass.setParents(l)},getChildren:function(){return g?a("#listChildren").dataTable().fnGetData():null},setChildren:function(l){a("#listChildrenContainer").append(a("\x3ctable\x3e").attr("id","listChildren").addClass("display no-border ui-widget-content"));c("listChildren","child",
l);g=!0}}}(jQuery),Submission={download:function(a){Utils.showDialog("Download XML","Download",[{type:"select",required:!0,label:"Action",values:Constants.submissionAction,property:"action"},{type:"text",required:"true",label:"Centre Name",property:"centerName"}],function(b){window.location=Urls.rest.submissions.download(a)+"?"+Utils.page.param(b)})}},Tile={title:function(a){var b=document.createElement("DIV");b.setAttribute("class","name");b.setAttribute("style","font-weight:bold");b.innerText=a;
return b},titleAndStatus:function(a,b){a=this.title(a);null!=b&&a.append(b);return a},lines:function(a,b){var c=document.createElement("P");b&&c.setAttribute("style","font-style:italic");a.filter(function(d){return!!d}).forEach(function(d,e,g){c.appendChild(document.createTextNode(d));e<g.length-1&&c.appendChild(document.createElement("BR"))});return c},statusOk:function(a){var b=document.createElement("IMG");b.setAttribute("src","/styles/images/tile-ok.svg");a&&b.setAttribute("title",a);return b},
statusMaybe:function(a){var b=document.createElement("IMG");b.setAttribute("src","/styles/images/tile-maybe.svg");a&&b.setAttribute("title",a);return b},statusBad:function(a){var b=document.createElement("IMG");b.setAttribute("src","/styles/images/tile-bad.svg");a&&b.setAttribute("title",a);return b},statusBusy:function(a){var b=document.createElement("IMG");b.setAttribute("src","/styles/images/tile-busy.svg");a&&b.setAttribute("title",a);return b},make:function(a,b){var c=document.createElement("DIV");
c.setAttribute("class","tile");a.forEach(function(d){c.appendChild(d)});c.onclick=b;return c}},Transfer=function(a){function b(k,l){return k.filter(function(p){return!l.some(function(r){return r.type===p.type&&r.id===p.id})})}function c(k){if(k&&k.length)if(k=Utils.array.deduplicateString(k.map(function(l){return l.type})),1<k.length)e(a("\x3cspan\x3e").text("Bulk actions not available for multi-type transfers."));else switch(k[0]){case "Sample":d(BulkTarget.sample.getBulkActions({}));break;case "Library":d(BulkTarget.library.getBulkActions({}));
break;case "Library Aliquot":d(BulkTarget.libraryaliquot.getBulkActions({}));break;case "Pool":d(BulkTarget.pool.getBulkActions({}));break;default:throw Error("Unexpected item type: "+k[0]);}else e(a("\x3cspan\x3e").text("Add items to transfer to see bulk actions."))}function d(k){var l=function(){return FormUtils.getSelectedTableData("listItems")};e(k.filter(function(p){return!!p}).map(function(p){return Utils.ui.makeBulkActionButton(p,l)}))}function e(k){a("#type-toolbar").remove();var l=a("\x3cdiv\x3e").prop("id",
"type-toolbar");l.append(k);a("#listItems \x3e .ui-toolbar").append(l)}var g=null,f={},h={};return{setForm:function(k){g=k},setItemsListConfig:function(k){f=k},setItems:function(k){FormUtils.setTableData(ListTarget.transferitem,f,"listItems",k,g);c(k)},getItems:function(){return FormUtils.getTableData("listItems")},addItems:function(k){k=Transfer.getItems().concat(k);Transfer.setItems(k)},removeItems:function(k){k=b(Transfer.getItems(),k);Transfer.setItems(k)},updateItems:function(k){k=b(Transfer.getItems(),
k).concat(k);Transfer.setItems(k)},setNotificationsListConfig:function(k){h=k},setNotifications:function(k){FormUtils.setTableData(ListTarget.transfernotification,h,"listNotifications",k,null)},getNotifications:function(){return FormUtils.getTableData("listNotifications")},addNotification:function(k){var l=Transfer.getNotifications();l.push(k);Transfer.setNotifications(l)}}}(jQuery),WarningTarget={},Warning=function(a){function b(c,d,e){return c.getWarnings(d).filter(function(g){return g.include&&
g.hasOwnProperty(e)})}return{generateHeaderWarnings:function(c,d,e){d=b(d,e,"headerMessage");if(0!=d.length){var g=a("#"+c);d.forEach(function(f){g.append(a("\x3cp\x3e").addClass("big big-"+(f.level||"error")).text(f.headerMessage))})}},tableWarningRenderer:function(c,d){return function(e,g,f){if("display"!==g)return e||"";g="";if(e){var h=d?d(f):null;h&&(g+='\x3ca href\x3d"'+h+'"\x3e');g+=e;h&&(g+="\x3c/a\x3e")}(e=b(c,f,"tableMessage"))&&e.length&&(f="info",e.some(function(k){return!k.level||"error"===
k.level})?f="error":e.some(function(k){return!k.level||"important"===k.level})&&(f="important"),g+=' \x3cdiv class\x3d"tooltip tooltipIcon"\x3e\x3cspan class\x3d"message-'+f+' warning-icon"\x3e\u26a0\x3c/span\x3e\x3cspan class\x3d"tooltiptext"\x3e'+e.map(function(k){return k.tableMessage}).join(";\x3cbr\x3e")+"\x3c/span\x3e\x3c/div\x3e");return g}},hasTileWarnings:function(c,d){return 0<b(c,d,"tileMessage").length},generateTileWarnings:function(c,d){return b(c,d,"tileMessage").map(function(e){var g=
document.createElement("P");g.setAttribute("class","message-"+(e.level||"error"));g.innerText="\u26a0 "+e.tileMessage;return g})},common:{qcFailure:function(c){return{include:!!c.detailedQcStatusId&&!1===Utils.array.findUniqueOrThrow(Utils.array.idPredicate(c.detailedQcStatusId),Constants.detailedQcStatuses).status,headerMessage:"QC failed",tableMessage:"QC failed",level:"error"}},effectiveQcFailure:function(c){return{include:!!c.effectiveQcFailureId,headerMessage:c.effectiveQcFailureId?c.effectiveQcFailureLevel+
" level QC status: "+Utils.array.findUniqueOrThrow(Utils.array.idPredicate(c.effectiveQcFailureId),Constants.detailedQcStatuses).description:null,tableMessage:c.effectiveQcFailureId?c.effectiveQcFailureLevel+" level QC failure":null,level:"error"}}}}}(jQuery);
WarningTarget.completion={getWarnings:function(a){a=a.pool;return[{include:a.prioritySubprojectAliases&&0<a.prioritySubprojectAliases.length,tableMessage:"PRIORITY ("+(1==a.prioritySubprojectAliases.length?a.prioritySubprojectAliases[0]:"MULTIPLE")+")",level:"important"},{include:a.duplicateIndices,tableMessage:Constants.warningMessages.duplicateIndices},{include:a.nearDuplicateIndices&&!a.duplicateIndices,tableMessage:Constants.warningMessages.nearDuplicateIndices},{include:a.hasEmptySequence,tableMessage:Constants.warningMessages.missingIndex},
{include:a.hasLowQualityLibraries,tableMessage:Constants.warningMessages.lowQualityLibraries},{include:a.pooledElements&&a.pooledElements.some(function(b){return"Revoked"===b.identityConsentLevel}),tableMessage:Constants.warningMessages.consentRevoked}]}};
WarningTarget.experiment_run_partition={getWarnings:function(a){a=a.partition.pool;return[{include:a.prioritySubprojectAliases&&0<a.prioritySubprojectAliases.length,tableMessage:"PRIORITY ("+(1==a.prioritySubprojectAliases.length?a.prioritySubprojectAliases[0]:"MULTIPLE")+")",level:"important"},{include:a.duplicateIndices,tableMessage:Constants.warningMessages.duplicateIndices},{include:a.nearDuplicateIndices&&!a.duplicateIndices,tableMessage:Constants.warningMessages.nearDuplicateIndices},{include:a.hasEmptySequence,
tableMessage:Constants.warningMessages.missingIndex},{include:a.hasLowQualityLibraries,tableMessage:Constants.warningMessages.lowQualityLibraries},{include:a.pooledElements&&a.pooledElements.some(function(b){return"Revoked"===b.identityConsentLevel}),tableMessage:Constants.warningMessages.consentRevoked}]}};
WarningTarget.library={getWarnings:function(a){return[{include:a.subprojectPriority,headerMessage:"Belongs to high priority subproject '"+a.subprojectAlias+"'",tableMessage:"PRIORITY ("+a.subprojectAlias+")",level:"important"},{include:0>parseFloat(a.volume),headerMessage:"This library has a negative volume!",tableMessage:Constants.warningMessages.negativeVolume},{include:"Revoked"===a.identityConsentLevel,headerMessage:"Donor has revoked consent",tableMessage:Constants.warningMessages.consentRevoked},
{include:a.lowQuality,headerMessage:"Low Quality Library",tableMessage:Constants.warningMessages.lowQualityLibraries},{include:!0===a.requisitionStopped,headerMessage:"Requisition has been stopped",tableMessage:"Requisition stopped",level:"error"},{include:!0===a.requisitionPaused,headerMessage:"Requisition has been paused",tableMessage:"Requisition paused",level:"error"},Warning.common.qcFailure(a),Warning.common.effectiveQcFailure(a)]}};
WarningTarget.libraryaliquot={getWarnings:function(a){return[{include:a.subprojectPriority,headerMessage:"Belongs to high priority subproject '"+a.subprojectAlias+"'",tableMessage:"PRIORITY ("+a.subprojectAlias+")",level:"important"},{include:"Revoked"===a.identityConsentLevel,headerMessage:"Donor has revoked consent",tableMessage:Constants.warningMessages.consentRevoked},{include:!0===a.requisitionStopped,headerMessage:"Requisition has been stopped",tableMessage:"Requisition stopped",level:"error"},
{include:!0===a.requisitionPaused,headerMessage:"Requisition has been paused",tableMessage:"Requisition paused",level:"error"},Warning.common.qcFailure(a),Warning.common.effectiveQcFailure(a)]}};
WarningTarget.orderaliquot={makeTarget:function(a,b){return{getWarnings:function(c){var d=(null===c.aliquot.indexIds?[]:Constants.libraryIndexFamilies.reduce(function(e,g){return e.concat(g.indices.filter(function(f){return-1!=c.aliquot.indexIds.indexOf(f.id)}))},[]).sort(function(e,g){return e.position-g.position})).map(function(e){return e.sequence}).join("-");return[{include:c.aliquot.subprojectPriority,tableMessage:"PRIORITY ("+c.aliquot.subprojectAlias+")",level:"important"},{include:c.aliquot.libraryLowQuality,
tableMessage:Constants.warningMessages.lowQualityLibraries+")"},{include:a&&-1!=a.indexOf(d),tableMessage:Constants.warningMessages.duplicateIndices},{include:b&&-1!=b.indexOf(d)&&!(a&&-1!=a.indexOf(d)),tableMessage:Constants.warningMessages.nearDuplicateIndices},{include:null===c.aliquot.indexIds,tableMessage:Constants.warningMessages.missingIndex},{include:"Revoked"===c.aliquot.identityConsentLevel,tableMessage:Constants.warningMessages.consentRevoked}]}}}};
WarningTarget.partition={getWarnings:function(a){return(a=a.pool)?[{include:a.prioritySubprojectAliases&&0<a.prioritySubprojectAliases.length,tableMessage:"PRIORITY ("+(a.prioritySubprojectAliases&&1==a.prioritySubprojectAliases.length?a.prioritySubprojectAliases[0]:"MULTIPLE")+")",level:"important"},{include:a.duplicateIndices,tableMessage:Constants.warningMessages.duplicateIndices},{include:a.nearDuplicateIndices&&!a.duplicateIndices,tableMessage:Constants.warningMessages.nearDuplicateIndices},
{include:a.hasEmptySequence,tableMessage:Constants.warningMessages.missingIndex},{include:a.hasLowQualityLibraries,tableMessage:Constants.warningMessages.lowQualityLibraries},{include:a.pooledElements&&a.pooledElements.some(function(b){return"Revoked"===b.identityConsentLevel}),tableMessage:Constants.warningMessages.consentRevoked}]:[]}};
WarningTarget.pool={getWarnings:function(a){var b=[];a.pooledElements&&(b=a.pooledElements.filter(function(c){return"Revoked"===c.identityConsentLevel}).map(function(c){return c.name}));return[{include:a.prioritySubprojectAliases&&0<a.prioritySubprojectAliases.length,headerMessage:"Belongs to high priority subproject"+(1==a.prioritySubprojectAliases.length?" '"+a.prioritySubprojectAliases[0]+"'":"s: "+a.prioritySubprojectAliases.join(", ")),tableMessage:"PRIORITY ("+(1==a.prioritySubprojectAliases.length?
a.prioritySubprojectAliases[0]:"MULTIPLE")+")",tileMessage:"PRIORITY ("+(1==a.prioritySubprojectAliases.length?a.prioritySubprojectAliases[0]:a.prioritySubprojectAliases.join(", "))+")",level:"important"},{include:a.duplicateIndices,headerMessage:"This pool contains duplicate indices!",tableMessage:Constants.warningMessages.duplicateIndices,tileMessage:Constants.warningMessages.duplicateIndices},{include:a.nearDuplicateIndices&&!a.duplicateIndices,headerMessage:"This pool contains near-duplicate indices!",
tableMessage:Constants.warningMessages.nearDuplicateIndices,tileMessage:Constants.warningMessages.nearDuplicateIndices},{include:a.hasEmptySequence&&(!a.pooledElements||1<a.pooledElements.length),headerMessage:"This pool contains at least one library with no index!",tableMessage:Constants.warningMessages.missingIndex,tileMessage:Constants.warningMessages.missingIndex},{include:a.hasLowQualityLibraries,headerMessage:"This pool contains at least one low quality library!",tableMessage:Constants.warningMessages.lowQualityLibraries,
tileMessage:Constants.warningMessages.lowQualityLibraries},{include:0<b.length,headerMessage:"Donor has revoked consent for "+b.toString(),tableMessage:Constants.warningMessages.consentRevoked,tileMessage:Constants.warningMessages.consentRevoked}]}};
WarningTarget.poolelement={makeTarget:function(a,b){return{getWarnings:function(c){var d=null;c.indexIds&&(d=Constants.libraryIndexFamilies.reduce(function(e,g){return e.concat(g.indices.filter(function(f){return-1!=c.indexIds.indexOf(f.id)}))},[]).sort(function(e,g){return e.position-g.position}).map(function(e){return e.sequence}).join("-"));return[{include:c.subprojectPriority,tableMessage:"PRIORITY ("+c.subprojectAlias+")",level:"important"},{include:c.libraryLowQuality,tableMessage:Constants.warningMessages.lowQualityLibraries+
")"},{include:a&&d&&-1!=a.indexOf(d),tableMessage:Constants.warningMessages.duplicateIndices},{include:b&&d&&-1!=b.indexOf(d)&&!(a&&-1!=a.indexOf(d)),tableMessage:Constants.warningMessages.nearDuplicateIndices},{include:Utils.validation.isEmpty(d),tableMessage:Constants.warningMessages.missingIndex},{include:"Revoked"===c.identityConsentLevel,tableMessage:Constants.warningMessages.consentRevoked},{include:!!c.sequencingControlTypeAlias,tableMessage:"Sequencing Control: "+c.sequencingControlTypeAlias,
level:"info"},Warning.common.qcFailure(c),Warning.common.effectiveQcFailure(c)]}}}};WarningTarget.poolorder={getWarnings:function(a){return[{include:a.duplicateIndices,tableMessage:Constants.warningMessages.duplicateIndices},{include:a.nearDuplicateIndices&&!a.duplicateIndices,tableMessage:Constants.warningMessages.nearDuplicateIndices}]}};
WarningTarget.project={getWarnings:function(a){return[{include:"Active"===a.status&&a.rebExpiry&&a.rebExpiry<Utils.getCurrentDate(),headerMessage:"Project is active beyond REB expiry",tableMessage:"REB Expired"}]}};
WarningTarget.sample={getWarnings:function(a){return[{include:a.subprojectPriority,headerMessage:"Belongs to high priority subproject '"+a.subprojectAlias+"'",tableMessage:"PRIORITY ("+a.subprojectAlias+")",level:"important"},{include:"Revoked"===a.identityConsentLevel,headerMessage:"Donor has revoked consent",tableMessage:Constants.warningMessages.consentRevoked},{include:a.synthetic,headerMessage:"This entity does not exist except for sample tracking purposes!",level:"info"},{include:!0===a.requisitionStopped,
headerMessage:"Requisition has been stopped",tableMessage:"Requisition stopped",level:"error"},{include:!0===a.requisitionPaused,headerMessage:"Requisition has been paused",tableMessage:"Requisition paused",level:"error"},Warning.common.qcFailure(a),Warning.common.effectiveQcFailure(a)]}};
var WorkflowDisplay=function(){function a(t,z,x,F){v.children().hide();v.append(E);jQuery.ajax({type:t,url:z,contentType:"application/json; charset\x3dutf8",dataType:"json",success:x,error:F})}function b(){v.empty().append(jQuery("\x3cp class\x3d'workflowInstruction'\x3eWorkflow was successfully completed.\x3c/p\x3e"))}function c(t){E.remove();v.children().show();v.children("input").focus();var z=q,x=z.text;try{var F=JSON.parse(t.responseText);var n=F.detail&&"validation"===F.dataFormat?F.data.GENERAL:
F.message}catch(m){n="Internal Server Error"}x.call(z,n)}function d(t,z,x){a("POST",encodeURI(Urls.rest.workflows.processInput(t,z)+"?"+Utils.page.param({input:x})),w,c)}function e(t){return jQuery("\x3cp class\x3d'workflowInstruction'\x3e"+t+"\x3c/p\x3e")}function g(t,z){var x=jQuery("\x3cinput type\x3d'text'\x3e"),F=function(){d(t,z,x.val())};x.keypress(function(n){13===n.which&&F()}).bind("paste",function(){setTimeout(F,100)});return x}function f(t,z){z=jQuery("\x3ctd class\x3d'logIconCell'"+(z?
" title\x3d'"+z+"'":"")+"\x3e");t?z.append(jQuery("\x3cimg src\x3d'/styles/images/"+t+"' class\x3d'logIcon'\x3e")):z.append(jQuery("\x3cdiv class\x3d'logIcon'\x3e"));return z}function h(t,z,x){return t===z-1?f("arrow-undo.svg","Undo").click(function(){a("DELETE",Urls.rest.workflows.latestStep(x),w,c)}):f("arrow-back.svg","Go Back").click(function(){a("GET",Urls.rest.workflows.getStep(x,t),w,c)})}function k(t,z){return jQuery("\x3ctr class\x3d"+(1===t%2?"odd":"even")+"\x3e").append(z)}function l(t,
z,x,F){var n=jQuery("\x3ctable class\x3d'workflowLogTable'\x3e"),m=1;if(null!=x&&x<t.length){var u=-1===x?f("arrow-right.svg"):f();F=jQuery("\x3ctd\x3e").text(F?"Complete workflow":"Resume workflow");var A=f("arrow-play.svg","Return").click(function(){a("GET",Urls.rest.workflows.latestStep(z),w,c)});n.append(k(m++,[u,F,A]))}for(var G=t.length-1;0<=G;G--)u=G===x?f("arrow-right.svg"):f(),F=jQuery("\x3ctd\x3e").text(t[G]),A=h(G,t.length,z),n.append(k(m++,[u,F,A]));return n}function p(t){return jQuery("\x3ca class\x3d'ui-button ui-state-default'\x3e").text("Confirm").click(function(){a("POST",
Urls.rest.workflows.execute(t),b,c)})}function r(t,z){return jQuery("\x3ca class\x3d'ui-button ui-state-default'\x3e").text("Skip").click(function(){d(t,z,"SKIP")})}function w(t){if(Number.isInteger(t.stepNumber)){var z=t.workflowId,x=t.stepNumber,F=t.complete,n=t.inputTypes,m=t.log;t=[e(t.message),g(z,x)];-1<n.indexOf("SKIP")&&(t.push(jQuery("\x3cbr\x3e")),t.push(r(z,x)));t.push(q);t.push(l(m,z,x,F));v.empty().append(t).children("input").focus()}else z=t.workflowId,x=t.stepNumber,F=t.message,n=t.log,
t=t.complete,v.empty().append([e(F),p(z),q,l(n,z,x,t)])}var v,E=jQuery("\x3cimg src\x3d'/styles/images/ajax-loader.gif'\x3e"),q=jQuery("\x3cdiv id\x3d'inputError'\x3e\x3c/div\x3e");return{init:function(t,z){v=jQuery("#"+t);w(z)}}}();
//# sourceMappingURL=header_script.js.map
